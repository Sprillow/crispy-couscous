/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var __webpack_modules__={203:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=_superPropBase(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(arguments.length<3?e:i):r.value}},_get.apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var i,n=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function trimLeft(e){return e.replace(/^\s+/,"")}function trimRight(e){return e.replace(/\s+$/,"")}function isNumeric(e){return"string"==typeof e&&(e=e.trim()),!isNaN(e)&&/[+-]?([0-9]*[.])?[0-9]+/.test(e)}function isBoolean(e){var t=e.trim();return"true"===t||"false"===t}function toHex$1(e){for(var t="",i=0;i<e.length;)t+=e.charCodeAt(i++).toString(16);return t}__webpack_require__.d(__webpack_exports__,{H6:()=>game,Hf:()=>Stage,JH:()=>Entity,Rk:()=>video,SB:()=>state,UL:()=>Rect,Uh:()=>device$1,_m:()=>loader,d_:()=>pool,fu:()=>level,jy:()=>Sprite,n0:()=>audio,qH:()=>input,uT:()=>Body}),"undefined"!=typeof window&&void 0===window.console&&(window.console={},window.console.log=function(){},window.console.assert=function(){},window.console.warn=function(){},window.console.error=function(){alert(Array.prototype.slice.call(arguments).join(", "))});var stringUtils=Object.freeze({__proto__:null,capitalize,trimLeft,trimRight,isNumeric,isBoolean,toHex:toHex$1}),vendors$1=["ms","MS","moz","webkit","o"];function prefixed(e,t){if(e in(t=t||window))return t[e];var i,n=capitalize(e);return vendors$1.some((function(e){var r=e+n;return i=r in t?t[r]:void 0})),i}function setPrefixed(e,t,i){if(!(e in(i=i||window))){var n=capitalize(e);return vendors$1.some((function(e){var r=e+n;if(r in i)return i[r]=t,!0})),!1}i[e]=t}var agentUtils=Object.freeze({__proto__:null,prefixed,setPrefixed}),DEG_TO_RAD=Math.PI/180,RAD_TO_DEG=180/Math.PI,TAU=2*Math.PI,ETA=.5*Math.PI,EPSILON=1e-6;function isPowerOfTwo(e){return 0==(e&e-1)}function nextPowerOfTwo(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function degToRad(e){return e*DEG_TO_RAD}function radToDeg(e){return e*RAD_TO_DEG}function _clamp(e,t,i){return e<t?t:e>i?i:+e}function random$1(e,t){return~~(Math.random()*(t-e))+e}function randomFloat(e,t){return Math.random()*(t-e)+e}function weightedRandom$1(e,t){return~~(Math.pow(Math.random(),2)*(t-e))+e}function round(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=Math.pow(10,t);return~~(.5+e*i)/i}function toBeCloseTo(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return Math.abs(e-t)<Math.pow(10,-i)/2}var math=Object.freeze({__proto__:null,DEG_TO_RAD,RAD_TO_DEG,TAU,ETA,EPSILON,isPowerOfTwo,nextPowerOfTwo,degToRad,radToDeg,clamp:_clamp,random:random$1,randomFloat,weightedRandom:weightedRandom$1,round,toBeCloseTo});function _remove(e,t){var i=Array.prototype.indexOf.call(e,t);return-1!==i&&Array.prototype.splice.call(e,i,1),e}function random(e){return e[random$1(0,e.length)]}function weightedRandom(e){return e[weightedRandom$1(0,e.length)]}var arrayUtils=Object.freeze({__proto__:null,remove:_remove,random,weightedRandom}),REMOVE_PATH=/^.*(\\|\/|\:)/,REMOVE_EXT=/\.[^\.]*$/;function getBasename(e){return e.replace(REMOVE_PATH,"").replace(REMOVE_EXT,"")}function getExtension(e){return e.substring(e.lastIndexOf(".")+1,e.length)}var fileUtils=Object.freeze({__proto__:null,getBasename,getExtension});function defer(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,[e.bind(t),.01].concat(n))}function throttle(e,t,i){var n,r=window.performance.now();return"boolean"!=typeof i&&(i=!1),function(){var o=window.performance.now(),s=o-r,a=arguments;if(!(s<t))return r=o,e.apply(null,a);!1===i&&(clearTimeout(n),n=setTimeout((function(){return r=o,e.apply(null,a)}),s))}}var fnUtils=Object.freeze({__proto__:null,defer,throttle}),objectClass={},instance_counter=0,pool={register:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t)throw new Error("Cannot register object '"+e+"', invalid class");objectClass[e]={class:t,pool:i?[]:void 0}},pull:function(e){for(var t=new Array(arguments.length),i=0;i<arguments.length;i++)t[i]=arguments[i];var n=objectClass[e];if(n){var r,o=n.class,s=n.pool;return s&&(r=s.pop())?(t.shift(),"function"==typeof r.onResetEvent&&r.onResetEvent.apply(r,t),instance_counter--):(t[0]=o,r=new(o.bind.apply(o,t)),s&&(r.className=e)),r}throw new Error("Cannot instantiate object of type '"+e+"'")},purge:function(){for(var e in objectClass)objectClass[e]&&(objectClass[e].pool=[]);instance_counter=0},push:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.poolable(e)){if(!0===t)throw new Error("me.pool: object "+e+" cannot be recycled");return!1}return objectClass[e.className].pool.push(e),instance_counter++,!0},exists:function(e){return e in objectClass},poolable:function(e){var t=e.className;return void 0!==t&&"function"==typeof e.onResetEvent&&t in objectClass&&"undefined"!==objectClass[t].pool},getInstanceCount:function(){return instance_counter}},Vector2d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,e),this.onResetEvent(t,i)}return _createClass(e,[{key:"onResetEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e,this.y=t,this}},{key:"_set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"set",value:function(e,t){if(e!==+e||t!==+t)throw new Error("invalid x,y parameters (not a number)");return this._set(e,t)}},{key:"setZero",value:function(){return this.set(0,0)}},{key:"setV",value:function(e){return this._set(e.x,e.y)}},{key:"add",value:function(e){return this._set(this.x+e.x,this.y+e.y)}},{key:"sub",value:function(e){return this._set(this.x-e.x,this.y-e.y)}},{key:"scale",value:function(e,t){return this._set(this.x*e,this.y*(void 0!==t?t:e))}},{key:"toIso",value:function(){return this._set(this.x-this.y,.5*(this.x+this.y))}},{key:"to2d",value:function(){return this._set(this.y+this.x/2,this.y-this.x/2)}},{key:"scaleV",value:function(e){return this._set(this.x*e.x,this.y*e.y)}},{key:"div",value:function(e){return this._set(this.x/e,this.y/e)}},{key:"abs",value:function(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)}},{key:"clamp",value:function(t,i){return new e(_clamp(this.x,t,i),_clamp(this.y,t,i))}},{key:"clampSelf",value:function(e,t){return this._set(_clamp(this.x,e,t),_clamp(this.y,e,t))}},{key:"minV",value:function(e){return this._set(this.x<e.x?this.x:e.x,this.y<e.y?this.y:e.y)}},{key:"maxV",value:function(e){return this._set(this.x>e.x?this.x:e.x,this.y>e.y?this.y:e.y)}},{key:"floor",value:function(){return new e(Math.floor(this.x),Math.floor(this.y))}},{key:"floorSelf",value:function(){return this._set(Math.floor(this.x),Math.floor(this.y))}},{key:"ceil",value:function(){return new e(Math.ceil(this.x),Math.ceil(this.y))}},{key:"ceilSelf",value:function(){return this._set(Math.ceil(this.x),Math.ceil(this.y))}},{key:"negate",value:function(){return new e(-this.x,-this.y)}},{key:"negateSelf",value:function(){return this._set(-this.x,-this.y)}},{key:"copy",value:function(e){return this._set(e.x,e.y)}},{key:"equals",value:function(){var e,t;return 2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.x===e&&this.y===t}},{key:"normalize",value:function(){return this.div(this.length()||1)}},{key:"perp",value:function(){return this._set(this.y,-this.x)}},{key:"rotate",value:function(e,t){var i=0,n=0;"object"===_typeof(t)&&(i=t.x,n=t.y);var r=this.x-i,o=this.y-n,s=Math.cos(e),a=Math.sin(e);return this._set(r*s-o*a+i,r*a+o*s+n)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"length2",value:function(){return this.dot(this)}},{key:"length",value:function(){return Math.sqrt(this.length2())}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"distance",value:function(e){var t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)}},{key:"angle",value:function(e){return Math.acos(_clamp(this.dot(e)/(this.length()*e.length()),-1,1))}},{key:"project",value:function(e){return this.scale(this.dot(e)/e.length2())}},{key:"projectN",value:function(e){return this.scale(this.dot(e))}},{key:"clone",value:function(){return pool.pull("Vector2d",this.x,this.y)}},{key:"toString",value:function(){return"x:"+this.x+",y:"+this.y}}]),e}(),_toHex=function(e){return"0123456789ABCDEF".charAt(e-e%16>>4)+"0123456789ABCDEF".charAt(e%16)},rgbaRx=/^rgba?\((\d+), ?(\d+), ?(\d+)(, ?([\d\.]+))?\)$/,hex3Rx=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,hex4Rx=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,hex6Rx=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,hex8Rx=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,cssToRGB=new Map;[["black",[0,0,0]],["silver",[192,192,129]],["gray",[128,128,128]],["white",[255,255,255]],["maroon",[128,0,0]],["red",[255,0,0]],["purple",[128,0,128]],["fuchsia",[255,0,255]],["green",[0,128,0]],["lime",[0,255,0]],["olive",[128,128,0]],["yellow",[255,255,0]],["navy",[0,0,128]],["blue",[0,0,255]],["teal",[0,128,128]],["aqua",[0,255,255]],["orange",[255,165,0]],["aliceblue",[240,248,245]],["antiquewhite",[250,235,215]],["aquamarine",[127,255,212]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["brown",[165,42,42]],["burlywood",[222,184,35]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["coral",[255,127,80]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray[*]",[169,169,169]],["darkgreen",[0,100,0]],["darkgrey[*]",[169,169,169]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,143]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkslategrey",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dimgrey",[105,105,105]],["dodgerblue",[30,144,255]],["firebrick",[178,34,34]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["greenyellow",[173,255,47]],["grey",[128,128,128]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["khaki",[240,230,140]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgray",[211,211,211]],["lightgreen",[144,238,144]],["lightgrey",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightslategrey",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["orchid",[218,112,214]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["pink",[255,192,203]],["plum",[221,160,221]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["salmon",[250,128,114]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["sienna",[160,82,45]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["slategrey",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["tomato",[255,99,71]],["turquoise",[64,224,208]],["violet",[238,130,238]],["wheat",[245,222,179]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]]].forEach((function(e){cssToRGB.set(e[0],e[1])}));var Color=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;_classCallCheck(this,e),this.onResetEvent(t,i,n,r)}return _createClass(e,[{key:"onResetEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return void 0===this.glArray&&(this.glArray=new Float32Array([0,0,0,1])),this.setColor(e,t,i,n)}},{key:"r",get:function(){return~~(255*this.glArray[0])},set:function(e){this.glArray[0]=_clamp(~~e||0,0,255)/255}},{key:"g",get:function(){return~~(255*this.glArray[1])},set:function(e){this.glArray[1]=_clamp(~~e||0,0,255)/255}},{key:"b",get:function(){return~~(255*this.glArray[2])},set:function(e){this.glArray[2]=_clamp(~~e||0,0,255)/255}},{key:"alpha",get:function(){return this.glArray[3]},set:function(e){this.glArray[3]=void 0===e?1:_clamp(+e,0,1)}},{key:"setColor",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this.r=e,this.g=t,this.b=i,this.alpha=n,this}},{key:"clone",value:function(){return pool.pull("Color").copy(this)}},{key:"copy",value:function(t){return t instanceof e?(this.glArray.set(t.glArray),this):this.parseCSS(t)}},{key:"add",value:function(e){return this.glArray[0]=_clamp(this.glArray[0]+e.glArray[0],0,1),this.glArray[1]=_clamp(this.glArray[1]+e.glArray[1],0,1),this.glArray[2]=_clamp(this.glArray[2]+e.glArray[2],0,1),this.glArray[3]=(this.glArray[3]+e.glArray[3])/2,this}},{key:"darken",value:function(e){return e=_clamp(e,0,1),this.glArray[0]*=e,this.glArray[1]*=e,this.glArray[2]*=e,this}},{key:"lerp",value:function(e,t){return t=_clamp(t,0,1),this.glArray[0]+=(e.glArray[0]-this.glArray[0])*t,this.glArray[1]+=(e.glArray[1]-this.glArray[1])*t,this.glArray[2]+=(e.glArray[2]-this.glArray[2])*t,this}},{key:"lighten",value:function(e){return e=_clamp(e,0,1),this.glArray[0]=_clamp(this.glArray[0]+(1-this.glArray[0])*e,0,1),this.glArray[1]=_clamp(this.glArray[1]+(1-this.glArray[1])*e,0,1),this.glArray[2]=_clamp(this.glArray[2]+(1-this.glArray[2])*e,0,1),this}},{key:"random",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return e<0&&(e=0),t>255&&(t=255),this.setColor(random$1(e,t),random$1(e,t),random$1(e,t),this.alpha)}},{key:"equals",value:function(e){return this.glArray[0]===e.glArray[0]&&this.glArray[1]===e.glArray[1]&&this.glArray[2]===e.glArray[2]&&this.glArray[3]===e.glArray[3]}},{key:"parseCSS",value:function(e){return cssToRGB.has(e)?this.setColor.apply(this,cssToRGB.get(e)):this.parseRGB(e)}},{key:"parseRGB",value:function(e){var t=rgbaRx.exec(e);return t?this.setColor(+t[1],+t[2],+t[3],+t[5]):this.parseHex(e)}},{key:"parseHex",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t=hex8Rx.exec(e))return this.setColor(parseInt(t[!1===i?1:2],16),parseInt(t[!1===i?2:3],16),parseInt(t[!1===i?3:4],16),(_clamp(parseInt(t[!1===i?4:1],16),0,255)/255).toFixed(1));if(t=hex6Rx.exec(e))return this.setColor(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16));if(t=hex4Rx.exec(e)){var n=t[!1===i?1:2],r=t[!1===i?2:3],o=t[!1===i?3:4],s=t[!1===i?4:1];return this.setColor(parseInt(n+n,16),parseInt(r+r,16),parseInt(o+o,16),(_clamp(parseInt(s+s,16),0,255)/255).toFixed(1))}if(t=hex3Rx.exec(e))return this.setColor(parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16));throw new Error("invalid parameter: "+e)}},{key:"toUint32",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,t=255&this.r,i=255&this.g,n=255&this.b,r=255*e&255;return(r<<24)+(t<<16)+(i<<8)+n}},{key:"toArray",value:function(){return this.glArray}},{key:"toHex",value:function(){return"#"+_toHex(this.r)+_toHex(this.g)+_toHex(this.b)}},{key:"toHex8",value:function(){return"#"+_toHex(this.r)+_toHex(this.g)+_toHex(this.b)+_toHex(255*this.alpha)}},{key:"toRGB",value:function(){return"rgb("+this.r+","+this.g+","+this.b+")"}},{key:"toRGBA",value:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.alpha+")"}}]),e}(),Matrix3d=function(){function e(){_classCallCheck(this,e),this.onResetEvent.apply(this,arguments)}return _createClass(e,[{key:"onResetEvent",value:function(){void 0===this.val&&(this.val=new Float32Array(16)),arguments.length&&arguments[0]instanceof e?this.copy(arguments[0]):16===arguments.length?this.setTransform.apply(this,arguments):this.identity()}},{key:"tx",get:function(){return this.val[12]}},{key:"ty",get:function(){return this.val[13]}},{key:"tz",get:function(){return this.val[14]}},{key:"identity",value:function(){return this.setTransform(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}},{key:"setTransform",value:function(e,t,i,n,r,o,s,a,l,u,h,c,d,f,p,v){var y=this.val;return y[0]=e,y[1]=t,y[2]=i,y[3]=n,y[4]=r,y[5]=o,y[6]=s,y[7]=a,y[8]=l,y[9]=u,y[10]=h,y[11]=c,y[12]=d,y[13]=f,y[14]=p,y[15]=v,this}},{key:"copy",value:function(e){return this.val.set(e.val),this}},{key:"fromMat2d",value:function(e){var t=e.val;return this.setTransform(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1)}},{key:"multiply",value:function(e){var t=this.val,i=e.val,n=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=t[6],h=t[7],c=t[8],d=t[9],f=t[10],p=t[11],v=t[12],y=t[13],g=t[14],_=t[15],m=i[0],x=i[1],w=i[2],b=i[3];return t[0]=m*n+x*a+w*c+b*v,t[1]=m*r+x*l+w*d+b*y,t[2]=m*o+x*u+w*f+b*g,t[3]=m*s+x*h+w*p+b*_,m=i[4],x=i[5],w=i[6],b=i[7],t[4]=m*n+x*a+w*c+b*v,t[5]=m*r+x*l+w*d+b*y,t[6]=m*o+x*u+w*f+b*g,t[7]=m*s+x*h+w*p+b*_,m=i[8],x=i[9],w=i[10],b=i[11],t[8]=m*n+x*a+w*c+b*v,t[9]=m*r+x*l+w*d+b*y,t[10]=m*o+x*u+w*f+b*g,t[11]=m*s+x*h+w*p+b*_,m=i[12],x=i[13],w=i[14],b=i[15],t[12]=m*n+x*a+w*c+b*v,t[13]=m*r+x*l+w*d+b*y,t[14]=m*o+x*u+w*f+b*g,t[15]=m*s+x*h+w*p+b*_,this}},{key:"transpose",value:function(){var e=this.val,t=e[1],i=e[2],n=e[3],r=e[6],o=e[7],s=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=t,e[6]=e[9],e[7]=e[13],e[8]=i,e[9]=r,e[11]=e[14],e[12]=n,e[13]=o,e[14]=s,this}},{key:"invert",value:function(){var e=this.val,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8],h=e[9],c=e[10],d=e[11],f=e[12],p=e[13],v=e[14],y=e[15],g=t*s-i*o,_=t*a-n*o,m=t*l-r*o,x=i*a-n*s,w=i*l-r*s,b=n*l-r*a,k=u*p-h*f,T=u*v-c*f,E=u*y-d*f,A=h*v-c*p,S=h*y-d*p,C=c*y-d*v,O=g*C-_*S+m*A+x*E-w*T+b*k;return O?(O=1/O,e[0]=(s*C-a*S+l*A)*O,e[1]=(n*S-i*C-r*A)*O,e[2]=(p*b-v*w+y*x)*O,e[3]=(c*w-h*b-d*x)*O,e[4]=(a*E-o*C-l*T)*O,e[5]=(t*C-n*E+r*T)*O,e[6]=(v*m-f*b-y*_)*O,e[7]=(u*b-c*m+d*_)*O,e[8]=(o*S-s*E+l*k)*O,e[9]=(i*E-t*S-r*k)*O,e[10]=(f*w-p*m+y*g)*O,e[11]=(h*m-u*w-d*g)*O,e[12]=(s*T-o*A-a*k)*O,e[13]=(t*A-i*T+n*k)*O,e[14]=(p*_-f*x-v*g)*O,e[15]=(u*x-h*_+c*g)*O,this):null}},{key:"apply",value:function(e){var t=this.val,i=e.x,n=e.y,r=void 0!==e.z?e.z:1,o=t[3]*i+t[7]*n+t[11]*r+t[15]||1;return e.x=(t[0]*i+t[4]*n+t[8]*r+t[12])/o,e.y=(t[1]*i+t[5]*n+t[9]*r+t[13])/o,void 0!==e.z&&(e.z=(t[2]*i+t[6]*n+t[10]*r+t[14])/o),e}},{key:"applyInverse",value:function(e){var t=pool.pull("Matrix3d",this).invert();return t.apply(e),pool.push(t),e}},{key:"ortho",value:function(e,t,i,n,r,o){var s=this.val,a=1/(e-t),l=1/(i-n),u=1/(r-o);return s[0]=-2*a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*l,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*u,s[11]=0,s[12]=(e+t)*a,s[13]=(n+i)*l,s[14]=(o+r)*u,s[15]=1,this}},{key:"scale",value:function(e,t,i){var n=this.val,r=e,o=void 0===t?r:t,s=void 0===i?0:i;return n[0]=n[0]*r,n[1]=n[1]*r,n[2]=n[2]*r,n[3]=n[3]*r,n[4]=n[4]*o,n[5]=n[5]*o,n[6]=n[6]*o,n[7]=n[7]*o,n[8]=n[8]*s,n[9]=n[9]*s,n[10]=n[10]*s,n[11]=n[11]*s,this}},{key:"scaleV",value:function(e){return this.scale(e.x,e.y,e.z)}},{key:"scaleX",value:function(e){return this.scale(e,1)}},{key:"scaleY",value:function(e){return this.scale(1,e)}},{key:"rotate",value:function(e,t){var i,n,r,o,s,a,l,u,h,c,d,f,p,v,y,g,_,m,x,w,b,k,T,E,A=this.val,S=t.x,C=t.y,O=t.z,P=Math.sqrt(S*S+C*C+O*O);return P<EPSILON?null:(S*=P=1/P,C*=P,O*=P,i=Math.sin(e),r=1-(n=Math.cos(e)),o=A[0],s=A[1],a=A[2],l=A[3],u=A[4],h=A[5],c=A[6],d=A[7],f=A[8],p=A[9],v=A[10],y=A[11],g=S*S*r+n,_=C*S*r+O*i,m=O*S*r-C*i,x=S*C*r-O*i,w=C*C*r+n,b=O*C*r+S*i,k=S*O*r+C*i,T=C*O*r-S*i,E=O*O*r+n,A[0]=o*g+u*_+f*m,A[1]=s*g+h*_+p*m,A[2]=a*g+c*_+v*m,A[3]=l*g+d*_+y*m,A[4]=o*x+u*w+f*b,A[5]=s*x+h*w+p*b,A[6]=a*x+c*w+v*b,A[7]=l*x+d*w+y*b,A[8]=o*k+u*T+f*E,A[9]=s*k+h*T+p*E,A[10]=a*k+c*T+v*E,A[11]=l*k+d*T+y*E,this)}},{key:"translate",value:function(){var e,t,i,n=this.val;return arguments.length>1?(e=arguments[0],t=arguments[1],i=void 0===arguments[2]?0:arguments[2]):(e=arguments[0].x,t=arguments[0].y,i=void 0===arguments[0].z?0:arguments[0].z),n[12]=n[0]*e+n[4]*t+n[8]*i+n[12],n[13]=n[1]*e+n[5]*t+n[9]*i+n[13],n[14]=n[2]*e+n[6]*t+n[10]*i+n[14],n[15]=n[3]*e+n[7]*t+n[11]*i+n[15],this}},{key:"isIdentity",value:function(){var e=this.val;return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]}},{key:"equals",value:function(e){var t=e.val,i=this.val;return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]}},{key:"clone",value:function(){return pool.pull("Matrix3d",this)}},{key:"toArray",value:function(){return this.val}},{key:"toString",value:function(){var e=this.val;return"me.Matrix3d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}}]),e}(),Matrix2d=function(){function e(){_classCallCheck(this,e),this.onResetEvent.apply(this,arguments)}return _createClass(e,[{key:"onResetEvent",value:function(){return void 0===this.val&&(this.val=new Float32Array(9)),arguments.length&&arguments[0]instanceof e?this.copy(arguments[0]):arguments.length&&arguments[0]instanceof Matrix3d?this.fromMat3d(arguments[0]):arguments.length>=6?this.setTransform.apply(this,arguments):this.identity(),this}},{key:"tx",get:function(){return this.val[6]}},{key:"ty",get:function(){return this.val[7]}},{key:"identity",value:function(){return this.setTransform(1,0,0,0,1,0,0,0,1),this}},{key:"setTransform",value:function(){var e=this.val;return 9===arguments.length?(e[0]=arguments[0],e[1]=arguments[1],e[2]=arguments[2],e[3]=arguments[3],e[4]=arguments[4],e[5]=arguments[5],e[6]=arguments[6],e[7]=arguments[7],e[8]=arguments[8]):6===arguments.length&&(e[0]=arguments[0],e[1]=arguments[2],e[2]=arguments[4],e[3]=arguments[1],e[4]=arguments[3],e[5]=arguments[5],e[6]=0,e[7]=0,e[8]=1),this}},{key:"copy",value:function(e){return this.val.set(e.val),this}},{key:"fromMat3d",value:function(e){var t=e.val,i=this.val;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[4],i[4]=t[5],i[5]=t[6],i[6]=t[8],i[7]=t[9],i[8]=t[10],this}},{key:"multiply",value:function(e){var t=e.val,i=this.val,n=i[0],r=i[1],o=i[3],s=i[4],a=t[0],l=t[1],u=t[3],h=t[4],c=t[6],d=t[7];return i[0]=n*a+o*l,i[1]=r*a+s*l,i[3]=n*u+o*h,i[4]=r*u+s*h,i[6]+=n*c+o*d,i[7]+=r*c+s*d,this}},{key:"transpose",value:function(){var e=this.val,t=e[1],i=e[2],n=e[5];return e[1]=e[3],e[2]=e[6],e[3]=t,e[5]=e[7],e[6]=i,e[7]=n,this}},{key:"invert",value:function(){var e=this.val,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8],h=u*o-s*l,c=s*a-u*r,d=l*r-o*a,f=t*h+i*c+n*d;return e[0]=h/f,e[1]=(n*l-u*i)/f,e[2]=(s*i-n*o)/f,e[3]=c/f,e[4]=(u*t-n*a)/f,e[5]=(n*r-s*t)/f,e[6]=d/f,e[7]=(i*a-l*t)/f,e[8]=(o*t-i*r)/f,this}},{key:"apply",value:function(e){var t=this.val,i=e.x,n=e.y;return e.x=i*t[0]+n*t[3]+t[6],e.y=i*t[1]+n*t[4]+t[7],e}},{key:"applyInverse",value:function(e){var t=this.val,i=e.x,n=e.y,r=1/(t[0]*t[4]+t[3]*-t[1]);return e.x=t[4]*r*i+-t[3]*r*n+(t[7]*t[3]-t[6]*t[4])*r,e.y=t[0]*r*n+-t[1]*r*i+(-t[7]*t[0]+t[6]*t[1])*r,e}},{key:"scale",value:function(e,t){var i=this.val,n=e,r=void 0===t?n:t;return i[0]*=n,i[1]*=n,i[3]*=r,i[4]*=r,this}},{key:"scaleV",value:function(e){return this.scale(e.x,e.y)}},{key:"scaleX",value:function(e){return this.scale(e,1)}},{key:"scaleY",value:function(e){return this.scale(1,e)}},{key:"rotate",value:function(e){if(0!==e){var t=this.val,i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=Math.sin(e),u=Math.cos(e);t[0]=u*i+l*o,t[1]=u*n+l*s,t[2]=u*r+l*a,t[3]=u*o-l*i,t[4]=u*s-l*n,t[5]=u*a-l*r}return this}},{key:"translate",value:function(){var e,t,i=this.val;return 2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),i[6]+=i[0]*e+i[3]*t,i[7]+=i[1]*e+i[4]*t,this}},{key:"isIdentity",value:function(){var e=this.val;return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&1===e[4]&&0===e[5]&&0===e[6]&&0===e[7]&&1===e[8]}},{key:"equals",value:function(e){var t=e.val,i=this.val;return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]}},{key:"clone",value:function(){return pool.pull("Matrix2d",this)}},{key:"toArray",value:function(){return this.val}},{key:"toString",value:function(){var e=this.val;return"me.Matrix2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}}]),e}(),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{},eventemitter3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,i="~";function n(){}function r(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(e,t,n,o,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new r(n,o||e,s),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),a.prototype.eventNames=function(){var e,n,r=[];if(0===this._eventsCount)return r;for(n in e=this._events)t.call(e,n)&&r.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,s=new Array(o);r<o;r++)s[r]=n[r].fn;return s},a.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,r,o,s){var a=i?i+e:e;if(!this._events[a])return!1;var l,u,h=this._events[a],c=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),c){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,n),!0;case 4:return h.fn.call(h.context,t,n,r),!0;case 5:return h.fn.call(h.context,t,n,r,o),!0;case 6:return h.fn.call(h.context,t,n,r,o,s),!0}for(u=1,l=new Array(c-1);u<c;u++)l[u-1]=arguments[u];h.fn.apply(h.context,l)}else{var d,f=h.length;for(u=0;u<f;u++)switch(h[u].once&&this.removeListener(e,h[u].fn,void 0,!0),c){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,t);break;case 3:h[u].fn.call(h[u].context,t,n);break;case 4:h[u].fn.call(h[u].context,t,n,r);break;default:if(!l)for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];h[u].fn.apply(h[u].context,l)}}return!0},a.prototype.on=function(e,t,i){return o(this,e,t,i,!1)},a.prototype.once=function(e,t,i){return o(this,e,t,i,!0)},a.prototype.removeListener=function(e,t,n,r){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||s(this,o);else{for(var l=0,u=[],h=a.length;l<h;l++)(a[l].fn!==t||r&&!a[l].once||n&&a[l].context!==n)&&u.push(a[l]);u.length?this._events[o]=1===u.length?u[0]:u:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a}(eventemitter3);var EventEmitter=eventemitter3.exports,eventEmitter=new EventEmitter,BOOT="me.boot",STATE_PAUSE="me.state.onPause",STATE_RESUME="me.state.onResume",STATE_STOP="me.state.onStop",STATE_RESTART="me.state.onRestart",VIDEO_INIT="me.video.onInit",GAME_INIT="me.game.onInit",GAME_RESET="me.game.onReset",GAME_BEFORE_UPDATE="me.game.beforeUpdate",GAME_AFTER_UPDATE="me.game.afterUpdate",GAME_UPDATE="me.game.onUpdate",GAME_BEFORE_DRAW="me.game.beforeDraw",GAME_AFTER_DRAW="me.game.afterDraw",LEVEL_LOADED="me.game.onLevelLoaded",LOADER_COMPLETE="me.loader.onload",LOADER_PROGRESS="me.loader.onProgress",KEYDOWN="me.input.keydown",KEYUP="me.input.keyup",GAMEPAD_CONNECTED="gamepad.connected",GAMEPAD_DISCONNECTED="gamepad.disconnected",GAMEPAD_UPDATE="gamepad.update",POINTERMOVE="me.event.pointermove",POINTERLOCKCHANGE="me.event.pointerlockChange",DRAGSTART="me.game.dragstart",DRAGEND="me.game.dragend",WINDOW_ONRESIZE="window.onresize",CANVAS_ONRESIZE="canvas.onresize",VIEWPORT_ONRESIZE="viewport.onresize",WINDOW_ONORIENTATION_CHANGE="window.orientationchange",WINDOW_ONSCROLL="window.onscroll",VIEWPORT_ONCHANGE="viewport.onchange",WEBGL_ONCONTEXT_LOST="renderer.webglcontextlost",WEBGL_ONCONTEXT_RESTORED="renderer.webglcontextrestored";function emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return eventEmitter.emit.apply(eventEmitter,[e].concat(i))}function on(e,t,i){return eventEmitter.on(e,t,i)}function once(e,t,i){return eventEmitter.once(e,t,i)}function off(e,t){return eventEmitter.off(e,t)}var event=Object.freeze({__proto__:null,BOOT,STATE_PAUSE,STATE_RESUME,STATE_STOP,STATE_RESTART,VIDEO_INIT,GAME_INIT,GAME_RESET,GAME_BEFORE_UPDATE,GAME_AFTER_UPDATE,GAME_UPDATE,GAME_BEFORE_DRAW,GAME_AFTER_DRAW,LEVEL_LOADED,LOADER_COMPLETE,LOADER_PROGRESS,KEYDOWN,KEYUP,GAMEPAD_CONNECTED,GAMEPAD_DISCONNECTED,GAMEPAD_UPDATE,POINTERMOVE,POINTERLOCKCHANGE,DRAGSTART,DRAGEND,WINDOW_ONRESIZE,CANVAS_ONRESIZE,VIEWPORT_ONRESIZE,WINDOW_ONORIENTATION_CHANGE,WINDOW_ONSCROLL,VIEWPORT_ONCHANGE,WEBGL_ONCONTEXT_LOST,WEBGL_ONCONTEXT_RESTORED,emit,on,once,off}),howler={},exports;exports=howler,function(){var e=function(){this.init()};e.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var i=this||t;if(e=parseFloat(e),i.ctx||u(),void 0!==e&&e>=0&&e<=1){if(i._volume=e,i._muted)return i;i.usingWebAudio&&i.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var n=0;n<i._howls.length;n++)if(!i._howls[n]._webAudio)for(var r=i._howls[n]._getSoundIds(),o=0;o<r.length;o++){var s=i._howls[n]._soundById(r[o]);s&&s._node&&(s._node.volume=s._volume*e)}return i}return i._volume},mute:function(e){var i=this||t;i.ctx||u(),i._muted=e,i.usingWebAudio&&i.masterGain.gain.setValueAtTime(e?0:i._volume,t.ctx.currentTime);for(var n=0;n<i._howls.length;n++)if(!i._howls[n]._webAudio)for(var r=i._howls[n]._getSoundIds(),o=0;o<r.length;o++){var s=i._howls[n]._soundById(r[o]);s&&s._node&&(s._node.muted=!!e||s._muted)}return i},stop:function(){for(var e=this||t,i=0;i<e._howls.length;i++)e._howls[i].stop();return e},unload:function(){for(var e=this||t,i=e._howls.length-1;i>=0;i--)e._howls[i].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,u()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,i=null;try{i="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!i||"function"!=typeof i.canPlayType)return e;var n=i.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator?e._navigator.userAgent:"",o=r.match(/OPR\/([0-6].)/g),s=o&&parseInt(o[0].split("/")[1],10)<33,a=-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome"),l=r.match(/Version\/(.*?) /),u=a&&l&&parseInt(l[1],10)<15;return e._codecs={mp3:!(s||!n&&!i.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(i.canPlayType('audio/wav; codecs="1"')||i.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!i.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!i.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/m4a;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(i.canPlayType("audio/x-m4b;")||i.canPlayType("audio/m4b;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(i.canPlayType("audio/x-mp4;")||i.canPlayType("audio/mp4;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(u||!i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(u||!i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!i.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(i.canPlayType("audio/x-flac;")||i.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var i=function t(i){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,e._releaseHtml5Audio(n)}catch(i){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var o=e._howls[r]._getSoundIds(),s=0;s<o.length;s++){var a=e._howls[r]._soundById(o[s]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var i=0;i<e._howls.length;i++)e._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",i,!0),document.addEventListener("touchend",i,!0),document.addEventListener("click",i,!0),document.addEventListener("keydown",i,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var i=(new Audio).play();return i&&"undefined"!=typeof Promise&&(i instanceof Promise||"function"==typeof i.then)&&i.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var i=this||t;return e._unlocked&&i._html5AudioPool.push(e),i},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&t.usingWebAudio){for(var i=0;i<e._howls.length;i++)if(e._howls[i]._webAudio)for(var n=0;n<e._howls[i]._sounds.length;n++)if(!e._howls[i]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&t.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var t=new e,i=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};i.prototype={init:function(e){var i=this;return t.ctx||u(),i._autoplay=e.autoplay||!1,i._format="string"!=typeof e.format?e.format:[e.format],i._html5=e.html5||!1,i._muted=e.mute||!1,i._loop=e.loop||!1,i._pool=e.pool||5,i._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,i._rate=e.rate||1,i._sprite=e.sprite||{},i._src="string"!=typeof e.src?e.src:[e.src],i._volume=void 0!==e.volume?e.volume:1,i._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},i._duration=0,i._state="unloaded",i._sounds=[],i._endTimers={},i._queue=[],i._playLock=!1,i._onend=e.onend?[{fn:e.onend}]:[],i._onfade=e.onfade?[{fn:e.onfade}]:[],i._onload=e.onload?[{fn:e.onload}]:[],i._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],i._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],i._onpause=e.onpause?[{fn:e.onpause}]:[],i._onplay=e.onplay?[{fn:e.onplay}]:[],i._onstop=e.onstop?[{fn:e.onstop}]:[],i._onmute=e.onmute?[{fn:e.onmute}]:[],i._onvolume=e.onvolume?[{fn:e.onvolume}]:[],i._onrate=e.onrate?[{fn:e.onrate}]:[],i._onseek=e.onseek?[{fn:e.onseek}]:[],i._onunlock=e.onunlock?[{fn:e.onunlock}]:[],i._onresume=[],i._webAudio=t.usingWebAudio&&!i._html5,void 0!==t.ctx&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(i),i._autoplay&&i._queue.push({event:"play",action:function(){i.play()}}),i._preload&&"none"!==i._preload&&i.load(),i},load:function(){var e=this,i=null;if(t.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var r=0;r<e._src.length;r++){var s,a;if(e._format&&e._format[r])s=e._format[r];else{if("string"!=typeof(a=e._src[r])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(s=/^data:audio\/([^;,]+);/i.exec(a))||(s=/\.([^.]+)$/.exec(a.split("?",1)[0])),s&&(s=s[1].toLowerCase())}if(s||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),s&&t.codecs(s)){i=e._src[r];break}}if(i)return e._src=i,e._state="loading","https:"===window.location.protocol&&"http:"===i.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new n(e),e._webAudio&&o(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,i){var n=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(void 0===e&&(e="__default",!n._playLock)){for(var o=0,s=0;s<n._sounds.length;s++)n._sounds[s]._paused&&!n._sounds[s]._ended&&(o++,r=n._sounds[s]._id);1===o?e=null:r=null}}var a=r?n._soundById(r):n._inactiveSound();if(!a)return null;if(r&&!e&&(e=a._sprite||"__default"),"loaded"!==n._state){a._sprite=e,a._ended=!1;var l=a._id;return n._queue.push({event:"play",action:function(){n.play(l)}}),l}if(r&&!a._paused)return i||n._loadQueue("play"),a._id;n._webAudio&&t._autoResume();var u=Math.max(0,a._seek>0?a._seek:n._sprite[e][0]/1e3),h=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-u),c=1e3*h/Math.abs(a._rate),d=n._sprite[e][0]/1e3,f=(n._sprite[e][0]+n._sprite[e][1])/1e3;a._sprite=e,a._ended=!1;var p=function(){a._paused=!1,a._seek=u,a._start=d,a._stop=f,a._loop=!(!a._loop&&!n._sprite[e][2])};if(!(u>=f)){var v=a._node;if(n._webAudio){var y=function(){n._playLock=!1,p(),n._refreshBuffer(a);var e=a._muted||n._muted?0:a._volume;v.gain.setValueAtTime(e,t.ctx.currentTime),a._playStart=t.ctx.currentTime,void 0===v.bufferSource.start?a._loop?v.bufferSource.noteGrainOn(0,u,86400):v.bufferSource.noteGrainOn(0,u,h):a._loop?v.bufferSource.start(0,u,86400):v.bufferSource.start(0,u,h),c!==1/0&&(n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),c)),i||setTimeout((function(){n._emit("play",a._id),n._loadQueue()}),0)};"running"===t.state&&"interrupted"!==t.ctx.state?y():(n._playLock=!0,n.once("resume",y),n._clearTimer(a._id))}else{var g=function(){v.currentTime=u,v.muted=a._muted||n._muted||t._muted||v.muted,v.volume=a._volume*t.volume(),v.playbackRate=a._rate;try{var r=v.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(n._playLock=!0,p(),r.then((function(){n._playLock=!1,v._unlocked=!0,i?n._loadQueue():n._emit("play",a._id)})).catch((function(){n._playLock=!1,n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):i||(n._playLock=!1,p(),n._emit("play",a._id)),v.playbackRate=a._rate,v.paused)return void n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||a._loop?n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),c):(n._endTimers[a._id]=function(){n._ended(a),v.removeEventListener("ended",n._endTimers[a._id],!1)},v.addEventListener("ended",n._endTimers[a._id],!1))}catch(e){n._emit("playerror",a._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===v.src&&(v.src=n._src,v.load());var _=window&&window.ejecta||!v.readyState&&t._navigator.isCocoonJS;v.readyState>=3||_?g():(n._playLock=!0,n._state="loading",v.addEventListener(t._canPlayEvent,(function e(){n._state="loaded",g(),v.removeEventListener(t._canPlayEvent,e,!1)}),!1),n._clearTimer(a._id))}return a._id}n._ended(a)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var i=t._getSoundIds(e),n=0;n<i.length;n++){t._clearTimer(i[n]);var r=t._soundById(i[n]);if(r&&!r._paused&&(r._seek=t.seek(i[n]),r._rateSeek=0,r._paused=!0,t._stopFade(i[n]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(e)}}),i;for(var n=i._getSoundIds(e),r=0;r<n.length;r++){i._clearTimer(n[r]);var o=i._soundById(n[r]);o&&(o._seek=o._start||0,o._rateSeek=0,o._paused=!0,o._ended=!0,i._stopFade(n[r]),o._node&&(i._webAudio?o._node.bufferSource&&(void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),i._cleanBuffer(o._node)):isNaN(o._node.duration)&&o._node.duration!==1/0||(o._node.currentTime=o._start||0,o._node.pause(),o._node.duration===1/0&&i._clearSound(o._node))),t||i._emit("stop",o._id))}return i},mute:function(e,i){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,i)}}),n;if(void 0===i){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var r=n._getSoundIds(i),o=0;o<r.length;o++){var s=n._soundById(r[o]);s&&(s._muted=e,s._interval&&n._stopFade(s._id),n._webAudio&&s._node?s._node.gain.setValueAtTime(e?0:s._volume,t.ctx.currentTime):s._node&&(s._node.muted=!!t._muted||e),n._emit("mute",s._id))}return n},volume:function(){var e,i,n,r=this,o=arguments;if(0===o.length)return r._volume;if(1===o.length||2===o.length&&void 0===o[1]){var s=r._getSoundIds(),a=s.indexOf(o[0]);a>=0?i=parseInt(o[0],10):e=parseFloat(o[0])}else o.length>=2&&(e=parseFloat(o[0]),i=parseInt(o[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(n=i?r._soundById(i):r._sounds[0])?n._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,o)}}),r;void 0===i&&(r._volume=e),i=r._getSoundIds(i);for(var l=0;l<i.length;l++)(n=r._soundById(i[l]))&&(n._volume=e,o[2]||r._stopFade(i[l]),r._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,t.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*t.volume()),r._emit("volume",n._id));return r},fade:function(e,i,n,r){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"fade",action:function(){o.fade(e,i,n,r)}}),o;e=Math.min(Math.max(0,parseFloat(e)),1),i=Math.min(Math.max(0,parseFloat(i)),1),n=parseFloat(n),o.volume(e,r);for(var s=o._getSoundIds(r),a=0;a<s.length;a++){var l=o._soundById(s[a]);if(l){if(r||o._stopFade(s[a]),o._webAudio&&!l._muted){var u=t.ctx.currentTime,h=u+n/1e3;l._volume=e,l._node.gain.setValueAtTime(e,u),l._node.gain.linearRampToValueAtTime(i,h)}o._startFadeInterval(l,e,i,n,s[a],void 0===r)}}return o},_startFadeInterval:function(e,t,i,n,r,o){var s=this,a=t,l=i-t,u=Math.abs(l/.01),h=Math.max(4,u>0?n/u:n),c=Date.now();e._fadeTo=i,e._interval=setInterval((function(){var r=(Date.now()-c)/n;c=Date.now(),a+=l*r,a=Math.round(100*a)/100,a=l<0?Math.max(i,a):Math.min(i,a),s._webAudio?e._volume=a:s.volume(a,e._id,!0),o&&(s._volume=a),(i<t&&a<=i||i>t&&a>=i)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,s.volume(i,e._id),s._emit("fade",e._id))}),h)},_stopFade:function(e){var i=this,n=i._soundById(e);return n&&n._interval&&(i._webAudio&&n._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(n._interval),n._interval=null,i.volume(n._fadeTo,e),n._fadeTo=null,i._emit("fade",e)),i},loop:function(){var e,t,i,n=this,r=arguments;if(0===r.length)return n._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(i=n._soundById(parseInt(r[0],10)))&&i._loop;e=r[0],n._loop=e}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var o=n._getSoundIds(t),s=0;s<o.length;s++)(i=n._soundById(o[s]))&&(i._loop=e,n._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=e,e&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,n.playing(o[s])&&(n.pause(o[s],!0),n.play(o[s],!0)))));return n},rate:function(){var e,i,n,r=this,o=arguments;if(0===o.length)i=r._sounds[0]._id;else if(1===o.length){var s=r._getSoundIds(),a=s.indexOf(o[0]);a>=0?i=parseInt(o[0],10):e=parseFloat(o[0])}else 2===o.length&&(e=parseFloat(o[0]),i=parseInt(o[1],10));if("number"!=typeof e)return(n=r._soundById(i))?n._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,o)}}),r;void 0===i&&(r._rate=e),i=r._getSoundIds(i);for(var l=0;l<i.length;l++)if(n=r._soundById(i[l])){r.playing(i[l])&&(n._rateSeek=r.seek(i[l]),n._playStart=r._webAudio?t.ctx.currentTime:n._playStart),n._rate=e,r._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,t.ctx.currentTime):n._node&&(n._node.playbackRate=e);var u=r.seek(i[l]),h=(r._sprite[n._sprite][0]+r._sprite[n._sprite][1])/1e3-u,c=1e3*h/Math.abs(n._rate);!r._endTimers[i[l]]&&n._paused||(r._clearTimer(i[l]),r._endTimers[i[l]]=setTimeout(r._ended.bind(r,n),c)),r._emit("rate",n._id)}return r},seek:function(){var e,i,n=this,r=arguments;if(0===r.length)n._sounds.length&&(i=n._sounds[0]._id);else if(1===r.length){var o=n._getSoundIds(),s=o.indexOf(r[0]);s>=0?i=parseInt(r[0],10):n._sounds.length&&(i=n._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),i=parseInt(r[1],10));if(void 0===i)return 0;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,r)}}),n;var a=n._soundById(i);if(a){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var l=n.playing(i)?t.ctx.currentTime-a._playStart:0,u=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(u+l*Math.abs(a._rate))}return a._node.currentTime}var h=n.playing(i);h&&n.pause(i,!0),a._seek=e,a._ended=!1,n._clearTimer(i),n._webAudio||!a._node||isNaN(a._node.duration)||(a._node.currentTime=e);var c=function(){h&&n.play(i,!0),n._emit("seek",i)};if(h&&!n._webAudio){var d=function e(){n._playLock?setTimeout(e,0):c()};setTimeout(d,0)}else c()}return n},playing:function(e){var t=this;if("number"==typeof e){var i=t._soundById(e);return!!i&&!i._paused}for(var n=0;n<t._sounds.length;n++)if(!t._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this,i=t._duration,n=t._soundById(e);return n&&(i=t._sprite[n._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var e=this,i=e._sounds,n=0;n<i.length;n++)i[n]._paused||e.stop(i[n]._id),e._webAudio||(e._clearSound(i[n]._node),i[n]._node.removeEventListener("error",i[n]._errorFn,!1),i[n]._node.removeEventListener(t._canPlayEvent,i[n]._loadFn,!1),i[n]._node.removeEventListener("ended",i[n]._endFn,!1),t._releaseHtml5Audio(i[n]._node)),delete i[n]._node,e._clearTimer(i[n]._id);var o=t._howls.indexOf(e);o>=0&&t._howls.splice(o,1);var s=!0;for(n=0;n<t._howls.length;n++)if(t._howls[n]._src===e._src||e._src.indexOf(t._howls[n]._src)>=0){s=!1;break}return r&&s&&delete r[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,i,n){var r=this["_on"+e];return"function"==typeof t&&r.push(n?{id:i,fn:t,once:n}:{id:i,fn:t}),this},off:function(e,t,i){var n=this,r=n["_on"+e],o=0;if("number"==typeof t&&(i=t,t=null),t||i)for(o=0;o<r.length;o++){var s=i===r[o].id;if(t===r[o].fn&&s||!t&&s){r.splice(o,1);break}}else if(e)n["_on"+e]=[];else{var a=Object.keys(n);for(o=0;o<a.length;o++)0===a[o].indexOf("_on")&&Array.isArray(n[a[o]])&&(n[a[o]]=[])}return n},once:function(e,t,i){return this.on(e,t,i,1),this},_emit:function(e,t,i){for(var n=this,r=n["_on"+e],o=r.length-1;o>=0;o--)r[o].id&&r[o].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,i)}.bind(n,r[o].fn),0),r[o].once&&n.off(e,r[o].fn,r[o].id));return n._loadQueue(e),n},_loadQueue:function(e){var t=this;if(t._queue.length>0){var i=t._queue[0];i.event===e&&(t._queue.shift(),t._loadQueue()),e||i.action()}return t},_ended:function(e){var i=this,n=e._sprite;if(!i._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(i._ended.bind(i,e),100),i;var r=!(!e._loop&&!i._sprite[n][2]);if(i._emit("end",e._id),!i._webAudio&&r&&i.stop(e._id,!0).play(e._id),i._webAudio&&r){i._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var o=1e3*(e._stop-e._start)/Math.abs(e._rate);i._endTimers[e._id]=setTimeout(i._ended.bind(i,e),o)}return i._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,i._clearTimer(e._id),i._cleanBuffer(e._node),t._autoSuspend()),i._webAudio||r||i.stop(e._id,!0),i},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var i=t._soundById(e);i&&i._node&&i._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,i=0;i<t._sounds.length;i++)if(e===t._sounds[i]._id)return t._sounds[i];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new n(e)},_drain:function(){var e=this,t=e._pool,i=0,n=0;if(!(e._sounds.length<t)){for(n=0;n<e._sounds.length;n++)e._sounds[n]._ended&&i++;for(n=e._sounds.length-1;n>=0;n--){if(i<=t)return;e._sounds[n]._ended&&(e._webAudio&&e._sounds[n]._node&&e._sounds[n]._node.disconnect(0),e._sounds.splice(n,1),i--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],i=0;i<this._sounds.length;i++)t.push(this._sounds[i]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=r[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),this},_cleanBuffer:function(e){var i=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),i))try{e.bufferSource.buffer=t._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var n=function(e){this._parent=e,this.init()};n.prototype={init:function(){var e=this,i=e._parent;return e._muted=i._muted,e._loop=i._loop,e._volume=i._volume,e._rate=i._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,i._sounds.push(e),e.create(),e},create:function(){var e=this,i=e._parent,n=t._muted||e._muted||e._parent._muted?0:e._volume;return i._webAudio?(e._node=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(n,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=i._src,e._node.preload=!0===i._preload?"auto":i._preload,e._node.volume=n*t.volume(),e._node.load()),e},reset:function(){var e=this,i=e._parent;return e._muted=i._muted,e._loop=i._loop,e._volume=i._volume,e._rate=i._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,i=e._parent;i._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(i._sprite).length&&(i._sprite={__default:[0,1e3*i._duration]}),"loaded"!==i._state&&(i._state="loaded",i._emit("load"),i._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var r={},o=function(e){var t=e._src;if(r[t])return e._duration=r[t].duration,void l(e);if(/^data:[^;]+;base64,/.test(t)){for(var i=atob(t.split(",")[1]),n=new Uint8Array(i.length),o=0;o<i.length;++o)n[o]=i.charCodeAt(o);a(n.buffer,e)}else{var u=new XMLHttpRequest;u.open(e._xhr.method,t,!0),u.withCredentials=e._xhr.withCredentials,u.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){u.setRequestHeader(t,e._xhr.headers[t])})),u.onload=function(){var t=(u.status+"")[0];"0"===t||"2"===t||"3"===t?a(u.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+u.status+".")},u.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete r[t],e.load())},s(u)}},s=function(e){try{e.send()}catch(t){e.onerror()}},a=function(e,i){var n=function(){i._emit("loaderror",null,"Decoding audio data failed.")},o=function(e){e&&i._sounds.length>0?(r[i._src]=e,l(i,e)):n()};"undefined"!=typeof Promise&&1===t.ctx.decodeAudioData.length?t.ctx.decodeAudioData(e).then(o).catch(n):t.ctx.decodeAudioData(e,o,n)},l=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},u=function(){if(t.usingWebAudio){try{"undefined"!=typeof AudioContext?t.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch(e){t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),i=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=i?parseInt(i[1],10):null;if(e&&n&&n<9){var r=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!r&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};exports.Howler=t,exports.Howl=i,void 0!==commonjsGlobal?(commonjsGlobal.HowlerGlobal=e,commonjsGlobal.Howler=t,commonjsGlobal.Howl=i,commonjsGlobal.Sound=n):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=i,window.Sound=n)}(),function(){var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var i=t._howls.length-1;i>=0;i--)t._howls[i].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,i){var n=this;return n.ctx&&n.ctx.listener?(t="number"!=typeof t?n._pos[1]:t,i="number"!=typeof i?n._pos[2]:i,"number"!=typeof e?n._pos:(n._pos=[e,t,i],void 0!==n.ctx.listener.positionX?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]),n)):n},HowlerGlobal.prototype.orientation=function(e,t,i,n,r,o){var s=this;if(!s.ctx||!s.ctx.listener)return s;var a=s._orientation;return t="number"!=typeof t?a[1]:t,i="number"!=typeof i?a[2]:i,n="number"!=typeof n?a[3]:n,r="number"!=typeof r?a[4]:r,o="number"!=typeof o?a[5]:o,"number"!=typeof e?a:(s._orientation=[e,t,i,n,r,o],void 0!==s.ctx.listener.forwardX?(s.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),s.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),s.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),s.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),s.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),s.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):s.ctx.listener.setOrientation(e,t,i,n,r,o),s)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var i=this;return i._orientation=t.orientation||[1,0,0],i._stereo=t.stereo||null,i._pos=t.pos||null,i._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},i._onstereo=t.onstereo?[{fn:t.onstereo}]:[],i._onpos=t.onpos?[{fn:t.onpos}]:[],i._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,i){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,i)}}),n;var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===i){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var o=n._getSoundIds(i),s=0;s<o.length;s++){var a=n._soundById(o[s]);if(a){if("number"!=typeof e)return a._stereo;a._stereo=e,a._pos=[e,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||t(a,r),"spatial"===r?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(e,0,0):a._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),n._emit("stereo",a._id)}}return n},Howl.prototype.pos=function(e,i,n,r){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"pos",action:function(){o.pos(e,i,n,r)}}),o;if(i="number"!=typeof i?0:i,n="number"!=typeof n?-.5:n,void 0===r){if("number"!=typeof e)return o._pos;o._pos=[e,i,n]}for(var s=o._getSoundIds(r),a=0;a<s.length;a++){var l=o._soundById(s[a]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,i,n],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setPosition(e,i,n)),o._emit("pos",l._id)}}return o},Howl.prototype.orientation=function(e,i,n,r){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"orientation",action:function(){o.orientation(e,i,n,r)}}),o;if(i="number"!=typeof i?o._orientation[1]:i,n="number"!=typeof n?o._orientation[2]:n,void 0===r){if("number"!=typeof e)return o._orientation;o._orientation=[e,i,n]}for(var s=o._getSoundIds(r),a=0;a<s.length;a++){var l=o._soundById(s[a]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,i,n],l._node&&(l._panner||(l._pos||(l._pos=o._pos||[0,0,-.5]),t(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setOrientation(e,i,n)),o._emit("orientation",l._id)}}return o},Howl.prototype.pannerAttr=function(){var e,i,n,r=this,o=arguments;if(!r._webAudio)return r;if(0===o.length)return r._pannerAttr;if(1===o.length){if("object"!==_typeof(o[0]))return(n=r._soundById(parseInt(o[0],10)))?n._pannerAttr:r._pannerAttr;e=o[0],void 0===i&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),r._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:r._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:r._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:r._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:r._panningModel})}else 2===o.length&&(e=o[0],i=parseInt(o[1],10));for(var s=r._getSoundIds(i),a=0;a<s.length;a++)if(n=r._soundById(s[a])){var l=n._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var u=n._panner;u?(u.coneInnerAngle=l.coneInnerAngle,u.coneOuterAngle=l.coneOuterAngle,u.coneOuterGain=l.coneOuterGain,u.distanceModel=l.distanceModel,u.maxDistance=l.maxDistance,u.refDistance=l.refDistance,u.rolloffFactor=l.rolloffFactor,u.panningModel=l.panningModel):(n._pos||(n._pos=r._pos||[0,0,-.5]),t(n,"spatial"))}return r},Sound.prototype.init=function(e){return function(){var t=this,i=t._parent;t._orientation=i._orientation,t._stereo=i._stereo,t._pos=i._pos,t._pannerAttr=i._pannerAttr,e.call(this),t._stereo?i.stereo(t._stereo):t._pos&&i.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,i=t._parent;return t._orientation=i._orientation,t._stereo=i._stereo,t._pos=i._pos,t._pannerAttr=i._pannerAttr,t._stereo?i.stereo(t._stereo):t._pos?i.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,i._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}();var ObservableVector2d=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(_classCallCheck(this,i),e=t.call(this,n,r),void 0===o)throw new Error("undefined `onUpdate` callback");return e.setCallback(o.onUpdate,o.scope),e}return _createClass(i,[{key:"onResetEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;return this.setMuted(e,t),void 0!==i&&this.setCallback(i.onUpdate,i.scope),this}},{key:"x",get:function(){return this._x},set:function(e){var t=this.onUpdate.call(this.scope,e,this._y,this._x,this._y);this._x=t&&"x"in t?t.x:e}},{key:"y",get:function(){return this._y},set:function(e){var t=this.onUpdate.call(this.scope,this._x,e,this._x,this._y);this._y=t&&"y"in t?t.y:e}},{key:"_set",value:function(e,t){var i=this.onUpdate.call(this.scope,e,t,this._x,this._y);return i&&"x"in i&&"y"in i?(this._x=i.x,this._y=i.y):(this._x=e,this._y=t),this}},{key:"setMuted",value:function(e,t){return this._x=e,this._y=t,this}},{key:"setCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("function"!=typeof e)throw new Error("invalid `onUpdate` callback");return this.onUpdate=e,this.scope=t,this}},{key:"add",value:function(e){return this._set(this._x+e.x,this._y+e.y)}},{key:"sub",value:function(e){return this._set(this._x-e.x,this._y-e.y)}},{key:"scale",value:function(e,t){return this._set(this._x*e,this._y*(void 0!==t?t:e))}},{key:"scaleV",value:function(e){return this._set(this._x*e.x,this._y*e.y)}},{key:"div",value:function(e){return this._set(this._x/e,this._y/e)}},{key:"abs",value:function(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y)}},{key:"clamp",value:function(e,t){return new i(_clamp(this.x,e,t),_clamp(this.y,e,t),{onUpdate:this.onUpdate,scope:this.scope})}},{key:"clampSelf",value:function(e,t){return this._set(_clamp(this._x,e,t),_clamp(this._y,e,t))}},{key:"minV",value:function(e){return this._set(this._x<e.x?this._x:e.x,this._y<e.y?this._y:e.y)}},{key:"maxV",value:function(e){return this._set(this._x>e.x?this._x:e.x,this._y>e.y?this._y:e.y)}},{key:"floor",value:function(){return new i(Math.floor(this._x),Math.floor(this._y),{onUpdate:this.onUpdate,scope:this.scope})}},{key:"floorSelf",value:function(){return this._set(Math.floor(this._x),Math.floor(this._y))}},{key:"ceil",value:function(){return new i(Math.ceil(this._x),Math.ceil(this._y),{onUpdate:this.onUpdate,scope:this.scope})}},{key:"ceilSelf",value:function(){return this._set(Math.ceil(this._x),Math.ceil(this._y))}},{key:"negate",value:function(){return new i(-this._x,-this._y,{onUpdate:this.onUpdate,scope:this.scope})}},{key:"negateSelf",value:function(){return this._set(-this._x,-this._y)}},{key:"copy",value:function(e){return this._set(e.x,e.y)}},{key:"equals",value:function(e){return this._x===e.x&&this._y===e.y}},{key:"perp",value:function(){return this._set(this._y,-this._x)}},{key:"rotate",value:function(e,t){var i=0,n=0;"object"===_typeof(t)&&(i=t.x,n=t.y);var r=this._x-i,o=this._y-n,s=Math.cos(e),a=Math.sin(e);return this._set(r*s-o*a+i,r*a+o*s+n)}},{key:"dot",value:function(e){return this._x*e.x+this._y*e.y}},{key:"cross",value:function(e){return this._x*e.y-this._y*e.x}},{key:"lerp",value:function(e,t){return this._x+=(e.x-this._x)*t,this._y+=(e.y-this._y)*t,this}},{key:"distance",value:function(e){return Math.sqrt((this._x-e.x)*(this._x-e.x)+(this._y-e.y)*(this._y-e.y))}},{key:"clone",value:function(){return pool.pull("ObservableVector2d",this._x,this._y,{onUpdate:this.onUpdate,scope:this.scope})}},{key:"toVector2d",value:function(){return pool.pull("Vector2d",this._x,this._y)}},{key:"toString",value:function(){return"x:"+this._x+",y:"+this._y}}]),i}(Vector2d),Vector3d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,e),this.onResetEvent(t,i,n)}return _createClass(e,[{key:"onResetEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.x=e,this.y=t,this.z=i,this}},{key:"_set",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.x=e,this.y=t,this.z=i,this}},{key:"set",value:function(e,t,i){if(e!==+e||t!==+t||void 0!==i&&i!==+i)throw new Error("invalid x, y, z parameters (not a number)");return this._set(e,t,i)}},{key:"setZero",value:function(){return this.set(0,0,0)}},{key:"setV",value:function(e){return this._set(e.x,e.y,e.z)}},{key:"add",value:function(e){return this._set(this.x+e.x,this.y+e.y,this.z+(e.z||0))}},{key:"sub",value:function(e){return this._set(this.x-e.x,this.y-e.y,this.z-(e.z||0))}},{key:"scale",value:function(e,t,i){return t=void 0!==t?t:e,this._set(this.x*e,this.y*t,this.z*(i||1))}},{key:"scaleV",value:function(e){return this.scale(e.x,e.y,e.z)}},{key:"toIso",value:function(){return this._set(this.x-this.y,.5*(this.x+this.y),this.z)}},{key:"to2d",value:function(){return this._set(this.y+this.x/2,this.y-this.x/2,this.z)}},{key:"div",value:function(e){return this._set(this.x/e,this.y/e,this.z/e)}},{key:"abs",value:function(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)}},{key:"clamp",value:function(t,i){return new e(_clamp(this.x,t,i),_clamp(this.y,t,i),_clamp(this.z,t,i))}},{key:"clampSelf",value:function(e,t){return this._set(_clamp(this.x,e,t),_clamp(this.y,e,t),_clamp(this.z,e,t))}},{key:"minV",value:function(e){var t=e.z||0;return this._set(this.x<e.x?this.x:e.x,this.y<e.y?this.y:e.y,this.z<t?this.z:t)}},{key:"maxV",value:function(e){var t=e.z||0;return this._set(this.x>e.x?this.x:e.x,this.y>e.y?this.y:e.y,this.z>t?this.z:t)}},{key:"floor",value:function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}},{key:"floorSelf",value:function(){return this._set(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}},{key:"ceil",value:function(){return new e(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}},{key:"ceilSelf",value:function(){return this._set(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}},{key:"negate",value:function(){return new e(-this.x,-this.y,-this.z)}},{key:"negateSelf",value:function(){return this._set(-this.x,-this.y,-this.z)}},{key:"copy",value:function(e){return this._set(e.x,e.y,e.z||0)}},{key:"equals",value:function(){var e,t,i;return arguments.length>=2?(e=arguments[0],t=arguments[1],i=arguments[2]):(e=arguments[0].x,t=arguments[0].y,i=arguments[0].z),void 0===i&&(i=this.z),this.x===e&&this.y===t&&this.z===i}},{key:"normalize",value:function(){return this.div(this.length()||1)}},{key:"perp",value:function(){return this._set(this.y,-this.x,this.z)}},{key:"rotate",value:function(e,t){var i=0,n=0;"object"===_typeof(t)&&(i=t.x,n=t.y);var r=this.x-i,o=this.y-n,s=Math.cos(e),a=Math.sin(e);return this._set(r*s-o*a+i,r*a+o*s+n,this.z)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*(void 0!==e.z?e.z:this.z)}},{key:"cross",value:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,s=e.z;return this.x=i*s-n*o,this.y=n*r-t*s,this.z=t*o-i*r,this}},{key:"length2",value:function(){return this.dot(this)}},{key:"length",value:function(){return Math.sqrt(this.length2())}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"distance",value:function(e){var t=this.x-e.x,i=this.y-e.y,n=this.z-(e.z||0);return Math.sqrt(t*t+i*i+n*n)}},{key:"angle",value:function(e){return Math.acos(_clamp(this.dot(e)/(this.length()*e.length()),-1,1))}},{key:"project",value:function(e){var t=this.dot(e)/e.length2();return this.scale(t,t,t)}},{key:"projectN",value:function(e){var t=this.dot(e)/e.length2();return this.scale(t,t,t)}},{key:"clone",value:function(){return pool.pull("Vector3d",this.x,this.y,this.z)}},{key:"toString",value:function(){return"x:"+this.x+",y:"+this.y+",z:"+this.z}}]),e}(),ObservableVector3d=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0;if(_classCallCheck(this,i),e=t.call(this,n,r,o),void 0===s)throw new Error("undefined `onUpdate` callback");return e.setCallback(s.onUpdate,s.scope),e}return _createClass(i,[{key:"onResetEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;return this.setMuted(e,t,i),void 0!==n&&this.setCallback(n.onUpdate,n.scope),this}},{key:"x",get:function(){return this._x},set:function(e){var t=this.onUpdate.call(this.scope,e,this._y,this._z,this._x,this._y,this._z);this._x=t&&"x"in t?t.x:e}},{key:"y",get:function(){return this._y},set:function(e){var t=this.onUpdate.call(this.scope,this._x,e,this._z,this._x,this._y,this._z);this._y=t&&"y"in t?t.y:e}},{key:"z",get:function(){return this._z},set:function(e){var t=this.onUpdate.call(this.scope,this._x,this._y,e,this._x,this._y,this._z);this._z=t&&"z"in t?t.z:e}},{key:"_set",value:function(e,t,i){var n=this.onUpdate.call(this.scope,e,t,i,this._x,this._y,this._z);return n&&"x"in n&&"y"in n&&"z"in n?(this._x=n.x,this._y=n.y,this._z=n.z):(this._x=e,this._y=t,this._z=i||0),this}},{key:"setMuted",value:function(e,t,i){return this._x=e,this._y=t,this._z=i||0,this}},{key:"setCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("function"!=typeof e)throw new Error("invalid `onUpdate` callback");return this.onUpdate=e,this.scope=t,this}},{key:"add",value:function(e){return this._set(this._x+e.x,this._y+e.y,this._z+(e.z||0))}},{key:"sub",value:function(e){return this._set(this._x-e.x,this._y-e.y,this._z-(e.z||0))}},{key:"scale",value:function(e,t,i){return t=void 0!==t?t:e,this._set(this._x*e,this._y*t,this._z*(i||1))}},{key:"scaleV",value:function(e){return this._set(this._x*e.x,this._y*e.y,this._z*(e.z||1))}},{key:"div",value:function(e){return this._set(this._x/e,this._y/e,this._z/e)}},{key:"abs",value:function(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y,this._Z<0?-this._z:this._z)}},{key:"clamp",value:function(e,t){return new i(_clamp(this._x,e,t),_clamp(this._y,e,t),_clamp(this._z,e,t),{onUpdate:this.onUpdate,scope:this.scope})}},{key:"clampSelf",value:function(e,t){return this._set(_clamp(this._x,e,t),_clamp(this._y,e,t),_clamp(this._z,e,t))}},{key:"minV",value:function(e){var t=e.z||0;return this._set(this._x<e.x?this._x:e.x,this._y<e.y?this._y:e.y,this._z<t?this._z:t)}},{key:"maxV",value:function(e){var t=e.z||0;return this._set(this._x>e.x?this._x:e.x,this._y>e.y?this._y:e.y,this._z>t?this._z:t)}},{key:"floor",value:function(){return new i(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),{onUpdate:this.onUpdate,scope:this.scope})}},{key:"floorSelf",value:function(){return this._set(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}},{key:"ceil",value:function(){return new i(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z),{onUpdate:this.onUpdate,scope:this.scope})}},{key:"ceilSelf",value:function(){return this._set(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z))}},{key:"negate",value:function(){return new i(-this._x,-this._y,-this._z,{onUpdate:this.onUpdate,scope:this.scope})}},{key:"negateSelf",value:function(){return this._set(-this._x,-this._y,-this._z)}},{key:"copy",value:function(e){return this._set(e.x,e.y,e.z||0)}},{key:"equals",value:function(e){return this._x===e.x&&this._y===e.y&&this._z===(e.z||this._z)}},{key:"perp",value:function(){return this._set(this._y,-this._x,this._z)}},{key:"rotate",value:function(e,t){var i=0,n=0;"object"===_typeof(t)&&(i=t.x,n=t.y);var r=this.x-i,o=this.y-n,s=Math.cos(e),a=Math.sin(e);return this._set(r*s-o*a+i,r*a+o*s+n,this.z)}},{key:"dot",value:function(e){return this._x*e.x+this._y*e.y+this._z*(e.z||1)}},{key:"cross",value:function(e){var t=this._x,i=this._y,n=this._z,r=e.x,o=e.y,s=e.z;return this._set(i*s-n*o,n*r-t*s,t*o-i*r)}},{key:"lerp",value:function(e,t){return this._x+=(e.x-this._x)*t,this._y+=(e.y-this._y)*t,this._z+=(e.z-this._z)*t,this}},{key:"distance",value:function(e){var t=this._x-e.x,i=this._y-e.y,n=this._z-(e.z||0);return Math.sqrt(t*t+i*i+n*n)}},{key:"clone",value:function(){return pool.pull("ObservableVector3d",this._x,this._y,this._z,{onUpdate:this.onUpdate})}},{key:"toVector3d",value:function(){return pool.pull("Vector3d",this._x,this._y,this._z)}},{key:"toString",value:function(){return"x:"+this._x+",y:"+this._y+",z:"+this._z}}]),i}(Vector3d),earcut$2={exports:{}};function earcut(e,t,i){i=i||2;var n,r,o,s,a,l,u,h=t&&t.length,c=h?t[0]*i:e.length,d=linkedList(e,0,c,i,!0),f=[];if(!d||d.next===d.prev)return f;if(h&&(d=eliminateHoles(e,t,d,i)),e.length>80*i){n=o=e[0],r=s=e[1];for(var p=i;p<c;p+=i)(a=e[p])<n&&(n=a),(l=e[p+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);u=0!==(u=Math.max(o-n,s-r))?1/u:0}return earcutLinked(d,f,i,n,r,u),f}function linkedList(e,t,i,n,r){var o,s;if(r===signedArea(e,t,i,n)>0)for(o=t;o<i;o+=n)s=insertNode(o,e[o],e[o+1],s);else for(o=i-n;o>=t;o-=n)s=insertNode(o,e[o],e[o+1],s);return s&&equals(s,s.next)&&(removeNode(s),s=s.next),s}function filterPoints(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!equals(n,n.next)&&0!==area(n.prev,n,n.next))n=n.next;else{if(removeNode(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t}function earcutLinked(e,t,i,n,r,o,s){if(e){!s&&o&&indexCurve(e,n,r,o);for(var a,l,u=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?isEarHashed(e,n,r,o):isEar(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),removeNode(e),e=l.next,u=l.next;else if((e=l)===u){s?1===s?earcutLinked(e=cureLocalIntersections(filterPoints(e),t,i),t,i,n,r,o,2):2===s&&splitEarcut(e,t,i,n,r,o):earcutLinked(filterPoints(e),t,i,n,r,o,1);break}}}function isEar(e){var t=e.prev,i=e,n=e.next;if(area(t,i,n)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(pointInTriangle(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&area(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function isEarHashed(e,t,i,n){var r=e.prev,o=e,s=e.next;if(area(r,o,s)>=0)return!1;for(var a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,l=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,u=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,h=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,c=zOrder(a,l,t,i,n),d=zOrder(u,h,t,i,n),f=e.prevZ,p=e.nextZ;f&&f.z>=c&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&pointInTriangle(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&pointInTriangle(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=c;){if(f!==e.prev&&f!==e.next&&pointInTriangle(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&pointInTriangle(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function cureLocalIntersections(e,t,i){var n=e;do{var r=n.prev,o=n.next.next;!equals(r,o)&&intersects(r,n,n.next,o)&&locallyInside(r,o)&&locallyInside(o,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(o.i/i),removeNode(n),removeNode(n.next),n=e=o),n=n.next}while(n!==e);return filterPoints(n)}function splitEarcut(e,t,i,n,r,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&isValidDiagonal(s,a)){var l=splitPolygon(s,a);return s=filterPoints(s,s.next),l=filterPoints(l,l.next),earcutLinked(s,t,i,n,r,o),void earcutLinked(l,t,i,n,r,o)}a=a.next}s=s.next}while(s!==e)}function eliminateHoles(e,t,i,n){var r,o,s,a=[];for(r=0,o=t.length;r<o;r++)(s=linkedList(e,t[r]*n,r<o-1?t[r+1]*n:e.length,n,!1))===s.next&&(s.steiner=!0),a.push(getLeftmost(s));for(a.sort(compareX),r=0;r<a.length;r++)i=filterPoints(i=eliminateHole(a[r],i),i.next);return i}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){var i=findHoleBridge(e,t);if(!i)return t;var n=splitPolygon(i,e),r=filterPoints(i,i.next);return filterPoints(n,n.next),t===i?r:t}function findHoleBridge(e,t){var i,n=t,r=e.x,o=e.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s){if(s=a,a===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(r===s)return i;var l,u=i,h=i.x,c=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=h&&r!==n.x&&pointInTriangle(o<c?r:s,o,h,c,o<c?s:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),locallyInside(n,e)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&sectorContainsSector(i,n)))&&(i=n,d=l)),n=n.next}while(n!==u);return i}function sectorContainsSector(e,t){return area(e.prev,e,t.prev)<0&&area(t.next,e,e.next)<0}function indexCurve(e,t,i,n){var r=e;do{null===r.z&&(r.z=zOrder(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,sortLinked(r)}function sortLinked(e){var t,i,n,r,o,s,a,l,u=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,n=i,a=0,t=0;t<u&&(a++,n=n.nextZ);t++);for(l=u;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=n}o.nextZ=null,u*=2}while(s>1);return e}function zOrder(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function pointInTriangle(e,t,i,n,r,o,s,a){return(r-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(n-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(r-s)*(n-a)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&(locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)&&(area(e.prev,e,t.prev)||area(e,t.prev,t))||equals(e,t)&&area(e.prev,e,e.next)>0&&area(t.prev,t,t.next)>0)}function area(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,i,n){var r=sign(area(e,t,i)),o=sign(area(e,t,n)),s=sign(area(i,n,e)),a=sign(area(i,n,t));return r!==o&&s!==a||!(0!==r||!onSegment(e,i,t))||!(0!==o||!onSegment(e,n,t))||!(0!==s||!onSegment(i,e,n))||!(0!==a||!onSegment(i,t,n))}function onSegment(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function sign(e){return e>0?1:e<0?-1:0}function intersectsPolygon(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&intersects(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){var i=e,n=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}function splitPolygon(e,t){var i=new Node$1(e.i,e.x,e.y),n=new Node$1(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function insertNode(e,t,i,n){var r=new Node$1(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node$1(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,t,i,n){for(var r=0,o=t,s=i-n;o<i;o+=n)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}earcut$2.exports=earcut,earcut$2.exports.default=earcut,earcut.deviation=function(e,t,i,n){var r=t&&t.length,o=r?t[0]*i:e.length,s=Math.abs(signedArea(e,0,o,i));if(r)for(var a=0,l=t.length;a<l;a++){var u=t[a]*i,h=a<l-1?t[a+1]*i:e.length;s-=Math.abs(signedArea(e,u,h,i))}var c=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,f=n[a+1]*i,p=n[a+2]*i;c+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},earcut.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[r][o][s]);r>0&&(n+=e[r-1].length,i.holes.push(n))}return i};var earcut$1=earcut$2.exports,Polygon=function(){function e(t,i,n){_classCallCheck(this,e),this.pos=new Vector2d,this._bounds,this.points=[],this.edges=[],this.indices=[],this.normals=[],this.shapeType="Polygon",this.setShape(t,i,n)}return _createClass(e,[{key:"onResetEvent",value:function(e,t,i){this.setShape(e,t,i)}},{key:"setShape",value:function(e,t,i){return this.pos.set(e,t),this.setVertices(i),this}},{key:"setVertices",value:function(e){var t=this;if(!Array.isArray(e))return this;if(e[0]instanceof Vector2d)this.points=e;else if(this.points.length=0,"object"===_typeof(e[0]))e.forEach((function(e){t.points.push(new Vector2d(e.x,e.y))}));else for(var i=0;i<e.length;i+=2)this.points.push(new Vector2d(e[i],e[i+1]));return this.recalc(),this.updateBounds(),this}},{key:"transform",value:function(e){for(var t=this.points,i=t.length,n=0;n<i;n++)e.apply(t[n]);return this.recalc(),this.updateBounds(),this}},{key:"toIso",value:function(){return this.rotate(Math.PI/4).scale(Math.SQRT2,Math.SQRT1_2)}},{key:"to2d",value:function(){return this.scale(Math.SQRT1_2,Math.SQRT2).rotate(-Math.PI/4)}},{key:"rotate",value:function(e,t){if(0!==e){for(var i=this.points,n=i.length,r=0;r<n;r++)i[r].rotate(e,t);this.recalc(),this.updateBounds()}return this}},{key:"scale",value:function(e,t){t=void 0!==t?t:e;for(var i=this.points,n=i.length,r=0;r<n;r++)i[r].scale(e,t);return this.recalc(),this.updateBounds(),this}},{key:"scaleV",value:function(e){return this.scale(e.x,e.y)}},{key:"recalc",value:function(){var e,t=this.edges,i=this.normals,n=this.indices,r=this.points,o=r.length;if(o<3)throw new Error("Requires at least 3 points");for(e=0;e<o;e++)void 0===t[e]&&(t[e]=new Vector2d),t[e].copy(r[(e+1)%o]).sub(r[e]),void 0===i[e]&&(i[e]=new Vector2d),i[e].copy(t[e]).perp().normalize();return t.length=o,i.length=o,n.length=0,this}},{key:"getIndices",value:function(){return 0===this.indices.length&&(this.indices=earcut$1(this.points.flatMap((function(e){return[e.x,e.y]})))),this.indices}},{key:"isConvex",value:function(){var e,t,i,n,r=0,o=this.points,s=o.length;if(s<3)return null;for(e=0;e<s;e++)if(i=(e+2)%s,n=(o[t=(e+1)%s].x-o[e].x)*(o[i].y-o[t].y),(n-=(o[t].y-o[e].y)*(o[i].x-o[t].x))<0?r|=1:n>0&&(r|=2),3===r)return!1;return 0!==r||null}},{key:"translate",value:function(){var e,t;return 2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.pos.x+=e,this.pos.y+=t,this.getBounds().translate(e,t),this}},{key:"shift",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.pos.x=e,this.pos.y=t,this.updateBounds()}},{key:"contains",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y);for(var i=!1,n=this.pos.x,r=this.pos.y,o=this.points,s=o.length,a=0,l=s-1;a<s;l=a++){var u=o[a].y+r,h=o[a].x+n,c=o[l].y+r,d=o[l].x+n;u>t!=c>t&&e<(d-h)*(t-u)/(c-u)+h&&(i=!i)}return i}},{key:"getBounds",value:function(){return void 0===this._bounds&&(this._bounds=pool.pull("Bounds")),this._bounds}},{key:"updateBounds",value:function(){var e=this.getBounds();return e.update(this.points),e.translate(this.pos),e}},{key:"clone",value:function(){var t=[];return this.points.forEach((function(e){t.push(e.clone())})),new e(this.pos.x,this.pos.y,t)}}]),e}(),Rect=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,o){var s;return _classCallCheck(this,i),(s=t.call(this,e,n,[new Vector2d(0,0),new Vector2d(r,0),new Vector2d(r,o),new Vector2d(0,o)])).shapeType="Rectangle",s}return _createClass(i,[{key:"onResetEvent",value:function(e,t,i,n){this.setShape(e,t,i,n)}},{key:"setShape",value:function(e,t,i,n){var r=i;return this.pos.set(e,t),4===arguments.length&&((r=this.points)[0].set(0,0),r[1].set(i,0),r[2].set(i,n),r[3].set(0,n)),this.setVertices(r),this}},{key:"left",get:function(){return this.pos.x}},{key:"right",get:function(){var e=this.width;return this.pos.x+e||e}},{key:"top",get:function(){return this.pos.y}},{key:"bottom",get:function(){var e=this.height;return this.pos.y+e||e}},{key:"width",get:function(){return this.points[2].x},set:function(e){this.points[1].x=this.points[2].x=e,this.recalc(),this.updateBounds()}},{key:"height",get:function(){return this.points[2].y},set:function(e){this.points[2].y=this.points[3].y=e,this.recalc(),this.updateBounds()}},{key:"centerX",get:function(){return isFinite(this.width)?this.pos.x+this.width/2:this.width},set:function(e){this.pos.x=e-this.width/2}},{key:"centerY",get:function(){return isFinite(this.height)?this.pos.y+this.height/2:this.height},set:function(e){this.pos.y=e-this.height/2}},{key:"resize",value:function(e,t){return this.width=e,this.height=t,this}},{key:"scale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this.width*=e,this.height*=t,this}},{key:"clone",value:function(){return new i(this.pos.x,this.pos.y,this.width,this.height)}},{key:"copy",value:function(e){return this.setShape(e.pos.x,e.pos.y,e.width,e.height)}},{key:"union",value:function(e){var t=Math.min(this.left,e.left),i=Math.min(this.top,e.top);return this.resize(Math.max(this.right,e.right)-t,Math.max(this.bottom,e.bottom)-i),this.pos.set(t,i),this}},{key:"overlaps",value:function(e){return this.left<e.right&&e.left<this.right&&this.top<e.bottom&&e.top<this.bottom}},{key:"contains",value:function(){var e,t,n,r,o=arguments[0];return 2===arguments.length?(e=t=o,n=r=arguments[1]):o instanceof i?(e=o.left,t=o.right,n=o.top,r=o.bottom):(e=t=o.x,n=r=o.y),e>=this.left&&t<=this.right&&n>=this.top&&r<=this.bottom}},{key:"equals",value:function(e){return e.left===this.left&&e.right===this.right&&e.top===this.top&&e.bottom===this.bottom}},{key:"isFinite",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return isFinite(this.pos.x)&&isFinite(this.pos.y)&&isFinite(this.width)&&isFinite(this.height)}))},{key:"toPolygon",value:function(){return new Polygon(this.pos.x,this.pos.y,this.points)}}]),i}(Polygon),_keyStatus={},_keyLock={},_keyLocked={},_keyRefs={},_preventDefaultForKeys={},_keyBindings={},keyDownEvent=function(e,t,i){t=t||e.keyCode||e.button;var n=_keyBindings[t];if(emit(KEYDOWN,n,t,!n||!_keyLocked[n]),n){if(!_keyLocked[n]){var r=void 0!==i?i:t;_keyRefs[n][r]||(_keyStatus[n]++,_keyRefs[n][r]=!0)}return!_preventDefaultForKeys[t]||"function"!=typeof e.preventDefault||e.preventDefault()}return!0},keyUpEvent=function(e,t,i){t=t||e.keyCode||e.button;var n=_keyBindings[t];if(emit(KEYUP,n,t),n){var r=void 0!==i?i:t;return _keyRefs[n][r]=void 0,_keyStatus[n]>0&&_keyStatus[n]--,_keyLocked[n]=!1,!_preventDefaultForKeys[t]||"function"!=typeof e.preventDefault||e.preventDefault()}return!0},keyBoardEventTarget=null,KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOW_KEY:91,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,TILDE:126,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWAND_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222};function initKeyboardEvent(){null===keyBoardEventTarget&&!1===device$1.isMobile&&((keyBoardEventTarget=window).addEventListener("keydown",keyDownEvent,!1),keyBoardEventTarget.addEventListener("keyup",keyUpEvent,!1))}function isKeyPressed(e){return!(!_keyStatus[e]||_keyLocked[e]||(_keyLock[e]&&(_keyLocked[e]=!0),0))}function keyStatus(e){return _keyStatus[e]>0}function triggerKeyEvent(e,t,i){!0===t?keyDownEvent({},e,i):keyUpEvent({},e,i)}function bindKey(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:preventDefault;_keyBindings[e]=t,_preventDefaultForKeys[e]=n,_keyStatus[t]=0,_keyLock[t]=i||!1,_keyLocked[t]=!1,_keyRefs[t]={}}function getBindingKey(e){return _keyBindings[e]}function unlockKey(e){_keyLocked[e]=!1}function unbindKey(e){var t=_keyBindings[e];_keyStatus[t]=0,_keyLock[t]=!1,_keyRefs[t]={},_keyBindings[e]=null,_preventDefaultForKeys[e]=null}var Bounds$1=function(){function e(t){_classCallCheck(this,e),this.onResetEvent(t)}return _createClass(e,[{key:"onResetEvent",value:function(e){void 0===this.min?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),void 0!==e&&this.update(e),this._center=new Vector2d}},{key:"clear",value:function(){this.setMinMax(1/0,1/0,-1/0,-1/0)}},{key:"setMinMax",value:function(e,t,i,n){this.min.x=e,this.min.y=t,this.max.x=i,this.max.y=n}},{key:"x",get:function(){return this.min.x},set:function(e){var t=this.max.x-this.min.x;this.min.x=e,this.max.x=e+t}},{key:"y",get:function(){return this.min.y},set:function(e){var t=this.max.y-this.min.y;this.min.y=e,this.max.y=e+t}},{key:"width",get:function(){return this.max.x-this.min.x},set:function(e){this.max.x=this.min.x+e}},{key:"height",get:function(){return this.max.y-this.min.y},set:function(e){this.max.y=this.min.y+e}},{key:"left",get:function(){return this.min.x}},{key:"right",get:function(){return this.max.x}},{key:"top",get:function(){return this.min.y}},{key:"bottom",get:function(){return this.max.y}},{key:"centerX",get:function(){return this.min.x+this.width/2}},{key:"centerY",get:function(){return this.min.y+this.height/2}},{key:"center",get:function(){return this._center.set(this.centerX,this.centerY)}},{key:"update",value:function(e){this.add(e,!0)}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t&&this.clear();for(var i=0;i<e.length;i++){var n=e[i];n.x>this.max.x&&(this.max.x=n.x),n.x<this.min.x&&(this.min.x=n.x),n.y>this.max.y&&(this.max.y=n.y),n.y<this.min.y&&(this.min.y=n.y)}}},{key:"addBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t&&this.clear(),e.max.x>this.max.x&&(this.max.x=e.max.x),e.min.x<this.min.x&&(this.min.x=e.min.x),e.max.y>this.max.y&&(this.max.y=e.max.y),e.min.y<this.min.y&&(this.min.y=e.min.y)}},{key:"addPoint",value:function(e,t){void 0!==t&&(e=t.apply(e)),this.min.x=Math.min(this.min.x,e.x),this.max.x=Math.max(this.max.x,e.x),this.min.y=Math.min(this.min.y,e.y),this.max.y=Math.max(this.max.y,e.y)}},{key:"addFrame",value:function(e,t,i,n,r){var o=me.pool.pull("Vector2d");this.addPoint(o.set(e,t),r),this.addPoint(o.set(i,t),r),this.addPoint(o.set(e,n),r),this.addPoint(o.set(i,n),r),me.pool.push(o)}},{key:"contains",value:function(){var t,i,n,r,o=arguments[0];return 2===arguments.length?(t=i=o,n=r=arguments[1]):o instanceof e?(t=o.min.x,i=o.max.x,n=o.min.y,r=o.max.y):(t=i=o.x,n=r=o.y),t>=this.min.x&&i<=this.max.x&&n>=this.min.y&&r<=this.max.y}},{key:"overlaps",value:function(e){return!(this.right<e.left||this.left>e.right||this.bottom<e.top||this.top>e.bottom)}},{key:"isFinite",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}))},{key:"translate",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.min.x+=e,this.max.x+=e,this.min.y+=t,this.max.y+=t}},{key:"shift",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y);var i=this.max.x-this.min.x,n=this.max.y-this.min.y;this.min.x=e,this.max.x=e+i,this.min.y=t,this.max.y=t+n}},{key:"clone",value:function(){var t=new e;return t.addBounds(this),t}},{key:"toPolygon",value:function(){return new Polygon(this.x,this.y,[new Vector2d(0,0),new Vector2d(this.width,0),new Vector2d(this.width,this.height),new Vector2d(0,this.height)])}}]),e}(),tmpVec=new Vector2d,Pointer=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return _classCallCheck(this,i),(e=t.call(this)).setMinMax(n,r,n+o,r+s),e.LEFT=0,e.MIDDLE=1,e.RIGHT=2,e.event=void 0,e.type=void 0,e.button=0,e.isPrimary=!1,e.pageX=0,e.pageY=0,e.clientX=0,e.clientY=0,e.movementX=0,e.movementY=0,e.deltaMode=0,e.deltaX=0,e.deltaY=0,e.deltaZ=0,e.gameX=0,e.gameY=0,e.gameScreenX=0,e.gameScreenY=0,e.gameWorldX=0,e.gameWorldY=0,e.gameLocalX=0,e.gameLocalY=0,e.pointerId=void 0,e.isNormalized=!1,e.locked=!1,e.bind=[0,0,0],e}return _createClass(i,[{key:"setEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;this.event=e,this.pageX=t,this.pageY=i,this.clientX=n,this.clientY=r,globalToLocal(this.pageX,this.pageY,tmpVec),this.gameScreenX=this.x=tmpVec.x,this.gameScreenY=this.y=tmpVec.y,this.isNormalized=!device$1.PointerEvent||device$1.PointerEvent&&!(e instanceof window.PointerEvent),this.locked=locked,this.movementX=e.movementX||0,this.movementY=e.movementY||0,"wheel"===e.type?(this.deltaMode=e.deltaMode||0,this.deltaX=e.deltaX||0,this.deltaY=e.deltaY||0,this.deltaZ=e.deltaZ||0):(this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0),this.pointerId=o,this.isPrimary=void 0===e.isPrimary||e.isPrimary,this.button=e.button||0,this.type=e.type,void 0!==viewport&&viewport.localToWorld(this.gameScreenX,this.gameScreenY,tmpVec),this.gameWorldX=tmpVec.x,this.gameWorldY=tmpVec.y,!1===this.isNormalized?(this.width=e.width||1,this.height=e.height||1):"number"==typeof e.radiusX?(this.width=2*e.radiusX||1,this.height=2*e.radiusY||1):this.width=this.height=1}}]),i}(Bounds$1),T_POINTERS=[],eventHandlers=new Map,currentPointer,pointerInitialized=!1,lastTimeStamp=0,activeEventList=[],WHEEL=["wheel"],POINTER_MOVE=["pointermove","mousemove","touchmove"],POINTER_DOWN=["pointerdown","mousedown","touchstart"],POINTER_UP=["pointerup","mouseup","touchend"],POINTER_CANCEL=["pointercancel","mousecancel","touchcancel"],POINTER_ENTER=["pointerenter","mouseenter","touchenter"],POINTER_OVER=["pointerover","mouseover","touchover"],POINTER_LEAVE=["pointerleave","mouseleave","touchleave"],pointerEventList=[WHEEL[0],POINTER_MOVE[0],POINTER_DOWN[0],POINTER_UP[0],POINTER_CANCEL[0],POINTER_ENTER[0],POINTER_OVER[0],POINTER_LEAVE[0]],mouseEventList=[WHEEL[0],POINTER_MOVE[1],POINTER_DOWN[1],POINTER_UP[1],POINTER_CANCEL[1],POINTER_ENTER[1],POINTER_OVER[1],POINTER_LEAVE[1]],touchEventList=[POINTER_MOVE[2],POINTER_DOWN[2],POINTER_UP[2],POINTER_CANCEL[2],POINTER_ENTER[2],POINTER_OVER[2],POINTER_LEAVE[2]],pointerEventMap={wheel:WHEEL,pointermove:POINTER_MOVE,pointerdown:POINTER_DOWN,pointerup:POINTER_UP,pointercancel:POINTER_CANCEL,pointerenter:POINTER_ENTER,pointerover:POINTER_OVER,pointerleave:POINTER_LEAVE},normalizedEvents=[];function registerEventListener(e,t){for(var i=0;i<e.length;i++)-1===POINTER_MOVE.indexOf(e[i])&&pointerEventTarget.addEventListener(e[i],t,{passive:!1===preventDefault})}function enablePointerEvent(){if(!pointerInitialized){currentPointer=new Rect(0,0,1,1);for(var e=0;e<device$1.maxTouchPoints;e++)T_POINTERS.push(new Pointer);var t;null===pointerEventTarget&&(pointerEventTarget=renderer.getScreenCanvas()),activeEventList=device$1.PointerEvent?pointerEventList:mouseEventList,device$1.touch&&!device$1.PointerEvent&&(activeEventList=activeEventList.concat(touchEventList)),registerEventListener(activeEventList,onPointerEvent),void 0===throttlingInterval&&(throttlingInterval=~~(1e3/timer$1.maxfps)),!0===device$1.autoFocus&&(device$1.focus(),pointerEventTarget.addEventListener(activeEventList[2],(function(){device$1.focus()}),{passive:!1===preventDefault}));var i=findAllActiveEvents(activeEventList,POINTER_MOVE);if(throttlingInterval<17)for(t=0;t<i.length;t++)-1!==activeEventList.indexOf(i[t])&&pointerEventTarget.addEventListener(i[t],onMoveEvent,{passive:!0});else for(t=0;t<i.length;t++)-1!==activeEventList.indexOf(i[t])&&pointerEventTarget.addEventListener(i[t],throttle(onMoveEvent,throttlingInterval,!1),{passive:!0});setTouchAction(pointerEventTarget),device$1.hasPointerLockSupport&&document.addEventListener("pointerlockchange",(function(){locked=document.pointerLockElement===getParent(),emit(POINTERLOCKCHANGE,locked)}),!0),pointerInitialized=!0}}function findActiveEvent(e,t){for(var i=0;i<t.length;i++)if(-1!==e.indexOf(t[i]))return t[i]}function findAllActiveEvents(e,t){for(var i=[],n=0;n<t.length;n++)-1!==e.indexOf(t[n])&&i.push(t[n]);return i}function triggerEvent(e,t,i,n){var r;if(e.callbacks[t]){e.pointerId=n;for(var o=e.callbacks[t].length-1;o>=0&&(r=e.callbacks[t][o]);o--)if(!1===r(i))return!0}return!1}function dispatchEvent(e){for(var t=!1;e.length>0;){var i=e.pop();if(T_POINTERS.push(i),void 0!==i.event.timeStamp){if(i.event.timeStamp<lastTimeStamp)continue;lastTimeStamp=i.event.timeStamp}currentPointer.setShape(i.gameWorldX,i.gameWorldY,i.width,i.height),POINTER_MOVE.includes(i.type)&&(i.gameX=i.gameLocalX=i.gameScreenX,i.gameY=i.gameLocalY=i.gameScreenY,emit(POINTERMOVE,i));for(var n,r=world.broadphase.retrieve(currentPointer,Container.prototype._sortReverseZ),o=(r=r.concat([viewport])).length;n=r[--o];){if(eventHandlers.has(n)&&!0!==n.isKinematic){var s,a=eventHandlers.get(n),l=a.region,u=l.ancestor,h=l.getBounds();if(!0===l.isFloating?(i.gameX=i.gameLocalX=i.gameScreenX,i.gameY=i.gameLocalY=i.gameScreenY):(i.gameX=i.gameLocalX=i.gameWorldX,i.gameY=i.gameLocalY=i.gameWorldY),void 0!==u){var c=u.getBounds();i.gameLocalX=i.gameX-c.x,i.gameLocalY=i.gameY-c.y}var d=i.gameX,f=i.gameY;if(void 0!==l.currentTransform&&!l.currentTransform.isIdentity()){var p=l.currentTransform.applyInverse(pool.pull("Vector2d",d,f));d=p.x,f=p.y,pool.push(p)}switch(s=h.contains(d,f),i.type){case POINTER_MOVE[0]:case POINTER_MOVE[1]:case POINTER_MOVE[2]:case POINTER_MOVE[3]:if(a.pointerId!==i.pointerId||s){if(null===a.pointerId&&s&&triggerEvent(a,findActiveEvent(activeEventList,POINTER_ENTER),i,i.pointerId)){t=!0;break}}else if(triggerEvent(a,findActiveEvent(activeEventList,POINTER_LEAVE),i,null)){t=!0;break}if(s&&triggerEvent(a,i.type,i,i.pointerId)){t=!0;break}break;case POINTER_UP[0]:case POINTER_UP[1]:case POINTER_UP[2]:case POINTER_UP[3]:if(a.pointerId===i.pointerId&&s&&triggerEvent(a,i.type,i,null)){t=!0;break}break;case POINTER_CANCEL[0]:case POINTER_CANCEL[1]:case POINTER_CANCEL[2]:case POINTER_CANCEL[3]:if(a.pointerId===i.pointerId&&triggerEvent(a,i.type,i,null)){t=!0;break}break;default:if(s&&triggerEvent(a,i.type,i,i.pointerId)){t=!0;break}}}if(!0===t)break}}return t}function normalizeEvent(e){var t;if(device$1.TouchEvent&&e.changedTouches)for(var i=0,n=e.changedTouches.length;i<n;i++){var r=e.changedTouches[i];(t=T_POINTERS.pop()).setEvent(e,r.pageX,r.pageY,r.clientX,r.clientY,r.identifier),normalizedEvents.push(t)}else(t=T_POINTERS.pop()).setEvent(e,e.pageX,e.pageY,e.clientX,e.clientY,e.pointerId),normalizedEvents.push(t);return!1===e.isPrimary||(normalizedEvents[0].isPrimary=!0,Object.assign(pointer,normalizedEvents[0])),normalizedEvents}function onMoveEvent(e){dispatchEvent(normalizeEvent(e))}function onPointerEvent(e){normalizeEvent(e);var t=normalizedEvents[0].button;(dispatchEvent(normalizedEvents)||"wheel"===e.type)&&e.preventDefault();var i=pointer.bind[t];i&&triggerKeyEvent(i,POINTER_DOWN.includes(e.type),t+1)}var pointerEventTarget=null,pointer=new Pointer(0,0,1,1),locked=!1,throttlingInterval;function globalToLocal(e,t,i){i=i||pool.pull("Vector2d");var n=device$1.getElementBounds(renderer.getScreenCanvas()),r=device$1.devicePixelRatio;e-=n.left+(window.pageXOffset||0),t-=n.top+(window.pageYOffset||0);var o=scaleRatio;return 1===o.x&&1===o.y||(e/=o.x,t/=o.y),i.set(e*r,t*r)}function setTouchAction(e,t){e.style["touch-action"]=t||"none"}function bindPointer(){var e=arguments.length<2?pointer.LEFT:arguments[0],t=arguments.length<2?arguments[0]:arguments[1];if(enablePointerEvent(),!getBindingKey(t))throw new Error("no action defined for keycode "+t);pointer.bind[e]=t}function unbindPointer(e){pointer.bind[void 0===e?pointer.LEFT:e]=null}function registerPointerEvent(e,t,i){if(enablePointerEvent(),-1===pointerEventList.indexOf(e))throw new Error("invalid event type : "+e);if(void 0===t)throw new Error("registerPointerEvent: region for "+toString(t)+" event is undefined ");var n=findAllActiveEvents(activeEventList,pointerEventMap[e]);eventHandlers.has(t)||eventHandlers.set(t,{region:t,callbacks:{},pointerId:null});for(var r=eventHandlers.get(t),o=0;o<n.length;o++)e=n[o],r.callbacks[e]?r.callbacks[e].push(i):r.callbacks[e]=[i]}function releasePointerEvent(e,t,i){if(-1===pointerEventList.indexOf(e))throw new Error("invalid event type : "+e);var n=findAllActiveEvents(activeEventList,pointerEventMap[e]),r=eventHandlers.get(t);if(void 0!==r){for(var o=0;o<n.length;o++)if(e=n[o],r.callbacks[e]){if(void 0!==i)_remove(r.callbacks[e],i);else for(;r.callbacks[e].length>0;)r.callbacks[e].pop();0===r.callbacks[e].length&&delete r.callbacks[e]}0===Object.keys(r.callbacks).length&&eventHandlers.delete(t)}}function releaseAllPointerEvents(e){if(eventHandlers.has(e))for(var t=0;t<pointerEventList.length;t++)releasePointerEvent(pointerEventList[t],e)}function requestPointerLock(){return!!device$1.hasPointerLockSupport&&(getParent().requestPointerLock(),!0)}function exitPointerLock(){return!!device$1.hasPointerLockSupport&&(document.exitPointerLock(),!0)}var deadzone=.1;function wiredXbox360NormalizeFn(e,t,i){return i===this.GAMEPAD.BUTTONS.L2||i===this.GAMEPAD.BUTTONS.R2?(e+1)/2:e}function ouyaNormalizeFn(e,t,i){return e>0?i===this.GAMEPAD.BUTTONS.L2?Math.max(0,e-2e4)/111070:(e-1)/131070:(65536+e)/131070+.5}var vendorProductRE=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-/i,leadingZeroRE=/^0+/;function addMapping(e,t){var i=e.replace(vendorProductRE,(function(e,t,i){return"000".substr(t.length-1)+t+"-"+"000".substr(i.length-1)+i+"-"})),n=e.replace(vendorProductRE,(function(e,t,i){return t.replace(leadingZeroRE,"")+"-"+i.replace(leadingZeroRE,"")+"-"}));t.analog=t.analog||t.buttons.map((function(){return-1})),t.normalize_fn=t.normalize_fn||function(e){return e},remap.set(i,t),remap.set(n,t)}var bindings={},remap=new Map,updateEventHandler;[["45e-28e-Xbox 360 Wired Controller",{axes:[0,1,3,4],buttons:[11,12,13,14,8,9,-1,-1,5,4,6,7,0,1,2,3,10],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:wiredXbox360NormalizeFn}],["54c-268-PLAYSTATION(R)3 Controller",{axes:[0,1,2,3],buttons:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]}],["54c-5c4-Wireless Controller",{axes:[0,1,2,3],buttons:[1,0,2,3,4,5,6,7,8,9,10,11,14,15,16,17,12,13]}],["2836-1-OUYA Game Controller",{axes:[0,3,7,9],buttons:[3,6,4,5,7,8,15,16,-1,-1,9,10,11,12,13,14,-1],analog:[-1,-1,-1,-1,-1,-1,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:ouyaNormalizeFn}],["OUYA Game Controller (Vendor: 2836 Product: 0001)",{axes:[0,1,3,4],buttons:[0,3,1,2,4,5,12,13,-1,-1,6,7,8,9,10,11,-1],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:ouyaNormalizeFn}]].forEach((function(e){addMapping(e[0],e[1])}));var updateGamepads=function(){var e=navigator.getGamepads();Object.keys(bindings).forEach((function(t){var i=e[t];if(i){var n=null;"standard"!==i.mapping&&(n=remap.get(i.id));var r=bindings[t];Object.keys(r.buttons).forEach((function(e){var o=r.buttons[e],s=e,a=-1;if(!(n&&(s=n.buttons[e],a=n.analog[e],s<0&&a<0))){var l=i.buttons[s]||{};if(n&&a>=0){var u=n.normalize_fn(i.axes[a],-1,+e);l={value:u,pressed:l.pressed||Math.abs(u)>=deadzone}}emit(GAMEPAD_UPDATE,t,"buttons",+e,l),!o.pressed&&l.pressed?triggerKeyEvent(o.keyCode,!0,s+256):o.pressed&&!l.pressed&&triggerKeyEvent(o.keyCode,!1,s+256),o.value=l.value,o.pressed=l.pressed}})),Object.keys(r.axes).forEach((function(e){var o=r.axes[e],s=e;if(!(n&&(s=n.axes[e])<0)){var a=i.axes[s];if(void 0!==a){n&&(a=n.normalize_fn(a,+e,-1));var l=Math.sign(a)||1;if(0!==o[l].keyCode){var u=Math.abs(a)>=deadzone+Math.abs(o[l].threshold);emit(GAMEPAD_UPDATE,t,"axes",+e,a),!o[l].pressed&&u?(o[-l].pressed&&(triggerKeyEvent(o[-l].keyCode,!1,s+256),o[-l].value=0,o[-l].pressed=!1),triggerKeyEvent(o[l].keyCode,!0,s+256)):!o[l].pressed&&!o[-l].pressed||u||triggerKeyEvent(o[l=o[l].pressed?l:-l].keyCode,!1,s+256),o[l].value=a,o[l].pressed=u}}}}))}}))};window.addEventListener("gamepadconnected",(function(e){emit(GAMEPAD_CONNECTED,e.gamepad)}),!1),window.addEventListener("gamepaddisconnected",(function(e){emit(GAMEPAD_DISCONNECTED,e.gamepad)}),!1);var GAMEPAD={AXES:{LX:0,LY:1,RX:2,RY:3,EXTRA_1:4,EXTRA_2:5,EXTRA_3:6,EXTRA_4:7},BUTTONS:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,BACK:8,START:9,FORWARD:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16,EXTRA_1:17,EXTRA_2:18,EXTRA_3:19,EXTRA_4:20}};function bindGamepad(e,t,i){if(!getBindingKey(i))throw new Error("no action defined for keycode "+i);void 0===updateEventHandler&&"function"==typeof navigator.getGamepads&&(updateEventHandler=on(GAME_BEFORE_UPDATE,updateGamepads)),bindings[e]||(bindings[e]={axes:{},buttons:{}});var n={keyCode:i,value:0,pressed:!1,threshold:t.threshold},r=bindings[e][t.type];if("buttons"===t.type)r[t.code]=n;else if("axes"===t.type){var o=Math.sign(t.threshold)||1;r[t.code]||(r[t.code]={});var s=r[t.code];s[o]=n,s[-o]||(s[-o]={keyCode:0,value:0,pressed:!1,threshold:-o})}}function unbindGamepad(e,t){if(!bindings[e])throw new Error("no bindings for gamepad "+e);bindings[e].buttons[t]={}}function setGamepadDeadzone(e){deadzone=e}for(var setGamepadMapping=addMapping,preventDefault=!0,input=Object.freeze({__proto__:null,preventDefault,get pointerEventTarget(){return pointerEventTarget},pointer,get locked(){return locked},get throttlingInterval(){return throttlingInterval},globalToLocal,setTouchAction,bindPointer,unbindPointer,registerPointerEvent,releasePointerEvent,releaseAllPointerEvents,requestPointerLock,exitPointerLock,get keyBoardEventTarget(){return keyBoardEventTarget},KEY,initKeyboardEvent,isKeyPressed,keyStatus,triggerKeyEvent,bindKey,getBindingKey,unlockKey,unbindKey,GAMEPAD,bindGamepad,unbindGamepad,setGamepadDeadzone,setGamepadMapping}),Renderable=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,o){var s;return _classCallCheck(this,i),(s=t.call(this,e,n,r,o)).isRenderable=!0,s.isKinematic=!0,s.body=void 0,void 0===s.currentTransform&&(s.currentTransform=pool.pull("Matrix2d")),s.currentTransform.identity(),s.GUID=void 0,s.onVisibilityChange=void 0,s.alwaysUpdate=!1,s.updateWhenPaused=!1,s.isPersistent=!1,s.floating=!1,s.anchorPoint instanceof ObservableVector2d?s.anchorPoint.setMuted(.5,.5).setCallback(s.onAnchorUpdate,_assertThisInitialized(s)):s.anchorPoint=pool.pull("ObservableVector2d",.5,.5,{onUpdate:s.onAnchorUpdate,scope:_assertThisInitialized(s)}),s.autoTransform=!0,s.alpha=1,s.ancestor=void 0,s.mask=void 0,s.tint=pool.pull("Color",255,255,255,1),s.name="",s.pos instanceof ObservableVector3d?s.pos.setMuted(e,n,0).setCallback(s.updateBoundsPos,_assertThisInitialized(s)):s.pos=pool.pull("ObservableVector3d",e,n,0,{onUpdate:s.updateBoundsPos,scope:_assertThisInitialized(s)}),s.isDirty=!1,s._flip={x:!1,y:!1},s._inViewport=!1,s.setOpacity(1),s}return _createClass(i,[{key:"isFloating",get:function(){return!0===this.floating||void 0!==this.ancestor&&!0===this.ancestor.floating}},{key:"inViewport",get:function(){return this._inViewport},set:function(e){this._inViewport!==e&&(this._inViewport=e,"function"==typeof this.onVisibilityChange&&this.onVisibilityChange.call(this,e))}},{key:"isFlippedX",get:function(){return!0===this._flip.x}},{key:"isFlippedY",get:function(){return!0===this._flip.y}},{key:"getBounds",value:function(){return void 0===this._bounds&&(_get(_getPrototypeOf(i.prototype),"getBounds",this).call(this),this.isFinite()?this._bounds.setMinMax(this.pos.x,this.pos.y,this.pos.x+this.width,this.pos.y+this.height):this._bounds.setMinMax(this.pos.x,this.pos.y,this.width,this.height)),this._bounds}},{key:"getOpacity",value:function(){return this.alpha}},{key:"setOpacity",value:function(e){"number"==typeof e&&(this.alpha=_clamp(e,0,1),isNaN(this.alpha)&&(this.alpha=1),this.isDirty=!0)}},{key:"flipX",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._flip.x=!!e,this.isDirty=!0,this}},{key:"flipY",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._flip.y=!!e,this.isDirty=!0,this}},{key:"transform",value:function(e){return this.currentTransform.multiply(e),this.updateBoundsPos(this.pos.x,this.pos.y),this.isDirty=!0,this}},{key:"angleTo",value:function(e){var t,n,r=this.getBounds();if(e instanceof i){var o=e.getBounds();t=o.centerX-r.centerX,n=o.centerY-r.centerY}else t=e.x-r.centerX,n=e.y-r.centerY;return Math.atan2(n,t)}},{key:"distanceTo",value:function(e){var t,n,r=this.getBounds();if(e instanceof i){var o=e.getBounds();t=r.centerX-o.centerX,n=r.centerY-o.centerY}else t=r.centerX-e.x,n=r.centerY-e.y;return Math.sqrt(t*t+n*n)}},{key:"lookAt",value:function(e){var t;t=e instanceof i?e.pos:e;var n=this.angleTo(t);return this.rotate(n),this}},{key:"rotate",value:function(e,t){return isNaN(e)||(this.currentTransform.rotate(e,t),this.isDirty=!0),this}},{key:"scale",value:function(e,t){return this.currentTransform.scale(e,t),_get(_getPrototypeOf(i.prototype),"scale",this).call(this,e,t),this.isDirty=!0,this}},{key:"scaleV",value:function(e){return this.scale(e.x,e.y),this}},{key:"update",value:function(){return this.isDirty}},{key:"updateBounds",value:function(){return _get(_getPrototypeOf(i.prototype),"updateBounds",this).call(this),this.updateBoundsPos(this.pos.x,this.pos.y),this.getBounds()}},{key:"updateBoundsPos",value:function(e,t){var i=this.getBounds();i.shift(e,t),void 0!==this.anchorPoint&&i.isFinite()&&i.translate(-this.anchorPoint.x*i.width,-this.anchorPoint.y*i.height),this.ancestor instanceof Container&&!0!==this.floating&&i.translate(this.ancestor.getAbsolutePosition())}},{key:"getAbsolutePosition",value:function(){return void 0===this._absPos&&(this._absPos=pool.pull("Vector2d")),this._absPos.set(this.pos.x,this.pos.y),this.ancestor instanceof Container&&!0!==this.floating&&this._absPos.add(this.ancestor.getAbsolutePosition()),this._absPos}},{key:"onAnchorUpdate",value:function(e,t){this.anchorPoint.setMuted(e,t),this.updateBoundsPos(this.pos.x,this.pos.y)}},{key:"preDraw",value:function(e){var t=this.getBounds(),i=t.width*this.anchorPoint.x,n=t.height*this.anchorPoint.y;if(e.save(),e.setGlobalAlpha(e.globalAlpha()*this.getOpacity()),this._flip.x||this._flip.y){var r=this._flip.x?this.centerX-i:0,o=this._flip.y?this.centerY-n:0;e.translate(r,o),e.scale(this._flip.x?-1:1,this._flip.y?-1:1),e.translate(-r,-o)}void 0!==this.mask&&(e.translate(this.pos.x,this.pos.y),e.setMask(this.mask),e.translate(-this.pos.x,-this.pos.y)),!0!==this.autoTransform||this.currentTransform.isIdentity()||(e.translate(this.pos.x,this.pos.y),e.transform(this.currentTransform),e.translate(-this.pos.x,-this.pos.y)),e.translate(-i,-n),e.setTint(this.tint,this.getOpacity())}},{key:"draw",value:function(){}},{key:"postDraw",value:function(e){e.clearTint(),void 0!==this.mask&&e.clearMask(),e.restore(),this.isDirty=!1}},{key:"onCollision",value:function(){return!1}},{key:"destroy",value:function(){pool.push(this.currentTransform),this.currentTransform=void 0,pool.push(this.anchorPoint),this.anchorPoint=void 0,pool.push(this.pos),this.pos=void 0,void 0!==this._absPos&&(pool.push(this._absPos),this._absPos=void 0),pool.push(this._bounds),this._bounds=void 0,this.onVisibilityChange=void 0,void 0!==this.mask&&(pool.push(this.mask),this.mask=void 0),void 0!==this.tint&&(pool.push(this.tint),this.tint=void 0),this.ancestor=void 0,void 0!==this.body&&(this.body.destroy.apply(this.body,arguments),this.body=void 0),releaseAllPointerEvents(this),this.onDestroyEvent.apply(this,arguments)}},{key:"onDestroyEvent",value:function(){}}]),i}(Rect),Ellipse=function(){function e(t,i,n,r){_classCallCheck(this,e),this.pos=new Vector2d,this._bounds=void 0,this.radius=NaN,this.radiusV=new Vector2d,this.radiusSq=new Vector2d,this.ratio=new Vector2d,this.shapeType="Ellipse",this.setShape(t,i,n,r)}return _createClass(e,[{key:"onResetEvent",value:function(e,t,i,n){this.setShape(e,t,i,n)}},{key:"setShape",value:function(e,t,i,n){var r=i/2,o=n/2;this.pos.set(e,t),this.radius=Math.max(r,o),this.ratio.set(r/this.radius,o/this.radius),this.radiusV.set(this.radius,this.radius).scaleV(this.ratio);var s=this.radius*this.radius;return this.radiusSq.set(s,s).scaleV(this.ratio),this.getBounds().setMinMax(e,t,e+i,e+n),this.getBounds().translate(-this.radiusV.x,-this.radiusV.y),this}},{key:"rotate",value:function(e,t){return this.pos.rotate(e,t),this.getBounds().shift(this.pos),this.getBounds().translate(-this.radiusV.x,-this.radiusV.y),this}},{key:"scale",value:function(e,t){return t=void 0!==t?t:e,this.setShape(this.pos.x,this.pos.y,2*this.radiusV.x*e,2*this.radiusV.y*t)}},{key:"scaleV",value:function(e){return this.scale(e.x,e.y)}},{key:"transform",value:function(){return this}},{key:"translate",value:function(){var e,t;return 2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.pos.x+=e,this.pos.y+=t,this.getBounds().translate(e,t),this}},{key:"contains",value:function(){var e,t;return 2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),e-=this.pos.x,t-=this.pos.y,e*e/this.radiusSq.x+t*t/this.radiusSq.y<=1}},{key:"getBounds",value:function(){return void 0===this._bounds&&(this._bounds=pool.pull("Bounds")),this._bounds}},{key:"clone",value:function(){return new e(this.pos.x,this.pos.y,2*this.radiusV.x,2*this.radiusV.y)}}]),e}(),LEFT_VORNOI_REGION=-1,MIDDLE_VORNOI_REGION=0,RIGHT_VORNOI_REGION=1,T_VECTORS=[],v=0;v<10;v++)T_VECTORS.push(new Vector2d);for(var T_ARRAYS=[],a=0;a<5;a++)T_ARRAYS.push([]);function flattenPointsOn(e,t,i){for(var n=Number.MAX_VALUE,r=-Number.MAX_VALUE,o=e.length,s=0;s<o;s++){var a=e[s].dot(t);a<n&&(n=a),a>r&&(r=a)}i[0]=n,i[1]=r}function isSeparatingAxis(e,t,i,n,r,o){var s=T_ARRAYS.pop(),a=T_ARRAYS.pop(),l=T_VECTORS.pop().copy(t).sub(e),u=l.dot(r);if(flattenPointsOn(i,r,s),flattenPointsOn(n,r,a),a[0]+=u,a[1]+=u,s[0]>a[1]||a[0]>s[1])return T_VECTORS.push(l),T_ARRAYS.push(s),T_ARRAYS.push(a),!0;if(o){var h=0;if(s[0]<a[0])if(o.aInB=!1,s[1]<a[1])h=s[1]-a[0],o.bInA=!1;else{var c=s[1]-a[0],d=a[1]-s[0];h=c<d?c:-d}else if(o.bInA=!1,s[1]>a[1])h=s[0]-a[1],o.aInB=!1;else{var f=s[1]-a[0],p=a[1]-s[0];h=f<p?f:-p}var v=Math.abs(h);v<o.overlap&&(o.overlap=v,o.overlapN.copy(r),h<0&&o.overlapN.negateSelf())}return T_VECTORS.push(l),T_ARRAYS.push(s),T_ARRAYS.push(a),!1}function vornoiRegion(e,t){var i=e.length2(),n=t.dot(e);return n<0?LEFT_VORNOI_REGION:n>i?RIGHT_VORNOI_REGION:MIDDLE_VORNOI_REGION}function testPolygonPolygon(e,t,i,n,r){var o,s=t.points,a=t.normals,l=a.length,u=n.points,h=n.normals,c=h.length,d=T_VECTORS.pop().copy(e.pos).add(e.ancestor.getAbsolutePosition()).add(t.pos),f=T_VECTORS.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(n.pos);for(o=0;o<l;o++)if(isSeparatingAxis(d,f,s,u,a[o],r))return T_VECTORS.push(d),T_VECTORS.push(f),!1;for(o=0;o<c;o++)if(isSeparatingAxis(d,f,s,u,h[o],r))return T_VECTORS.push(d),T_VECTORS.push(f),!1;return r&&(r.a=e,r.b=i,r.overlapV.copy(r.overlapN).scale(r.overlap)),T_VECTORS.push(d),T_VECTORS.push(f),!0}function testEllipseEllipse(e,t,i,n,r){var o=T_VECTORS.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(n.pos).sub(e.pos).add(e.ancestor.getAbsolutePosition()).sub(t.pos),s=t.radius,a=n.radius,l=s+a,u=l*l,h=o.length2();if(h>u)return T_VECTORS.push(o),!1;if(r){var c=Math.sqrt(h);r.a=e,r.b=i,r.overlap=l-c,r.overlapN.copy(o.normalize()),r.overlapV.copy(o).scale(r.overlap),r.aInB=s<=a&&c<=a-s,r.bInA=a<=s&&c<=s-a}return T_VECTORS.push(o),!0}function testPolygonEllipse(e,t,i,n,r){for(var o=T_VECTORS.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(n.pos).sub(e.pos).add(e.ancestor.getAbsolutePosition()).sub(t.pos),s=n.radius,a=s*s,l=t.points,u=t.edges,h=u.length,c=T_VECTORS.pop(),d=T_VECTORS.pop(),f=T_VECTORS.pop(),p=0,v=0;v<h;v++){var y=v===h-1?0:v+1,g=0===v?h-1:v-1,_=0,m=null;c.copy(u[v]),f.copy(o).sub(l[v]),r&&f.length2()>a&&(r.aInB=!1);var x=vornoiRegion(c,f),w=!0;if(x===LEFT_VORNOI_REGION){var b=null;if(h>1&&(c.copy(u[g]),(x=vornoiRegion(c,b=T_VECTORS.pop().copy(o).sub(l[g])))!==RIGHT_VORNOI_REGION&&(w=!1)),w){if((p=f.length())>s)return T_VECTORS.push(o),T_VECTORS.push(c),T_VECTORS.push(d),T_VECTORS.push(f),b&&T_VECTORS.push(b),!1;r&&(r.bInA=!1,m=f.normalize(),_=s-p)}b&&T_VECTORS.push(b)}else if(x===RIGHT_VORNOI_REGION){if(h>1&&(c.copy(u[y]),f.copy(o).sub(l[y]),(x=vornoiRegion(c,f))!==LEFT_VORNOI_REGION&&(w=!1)),w){if((p=f.length())>s)return T_VECTORS.push(o),T_VECTORS.push(c),T_VECTORS.push(d),T_VECTORS.push(f),!1;r&&(r.bInA=!1,m=f.normalize(),_=s-p)}}else{d.copy(t.normals[v]),p=f.dot(d);var k=Math.abs(p);if((1===h||p>0)&&k>s)return T_VECTORS.push(o),T_VECTORS.push(c),T_VECTORS.push(d),T_VECTORS.push(f),!1;r&&(m=d,_=s-p,(p>=0||_<2*s)&&(r.bInA=!1))}m&&r&&Math.abs(_)<Math.abs(r.overlap)&&(r.overlap=_,r.overlapN.copy(m))}return r&&(r.a=e,r.b=i,r.overlapV.copy(r.overlapN).scale(r.overlap)),T_VECTORS.push(o),T_VECTORS.push(c),T_VECTORS.push(d),T_VECTORS.push(f),!0}function testEllipsePolygon(e,t,i,n,r){var o=this.testPolygonEllipse(i,n,e,t,r);if(o&&r){var s=r.a,a=r.aInB;r.overlapN.negateSelf(),r.overlapV.negateSelf(),r.a=r.b,r.b=s,r.aInB=r.bInA,r.bInA=a}return o}var SAT=Object.freeze({__proto__:null,testPolygonPolygon,testEllipseEllipse,testPolygonEllipse,testEllipsePolygon}),dummyObj={pos:new Vector2d(0,0),ancestor:{_absPos:new Vector2d(0,0),getAbsolutePosition:function(){return this._absPos}}};function shouldCollide(e,t){return!0!==e.isKinematic&&!0!==t.isKinematic&&"object"===_typeof(e.body)&&"object"===_typeof(t.body)&&!(!0===e.body.isStatic&&!0===t.body.isStatic)&&0!=(e.body.collisionMask&t.body.collisionType)&&0!=(e.body.collisionType&t.body.collisionMask)}var ResponseObject=function(){function e(){_classCallCheck(this,e),this.a=null,this.b=null,this.overlapN=new Vector2d,this.overlapV=new Vector2d,this.aInB=!0,this.bInA=!0,this.indexShapeA=-1,this.indexShapeB=-1,this.overlap=Number.MAX_VALUE}return _createClass(e,[{key:"clear",value:function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.indexShapeA=-1,this.indexShapeB=-1,this}}]),e}(),globalResponse=new ResponseObject;function collisionCheck(e){for(var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:globalResponse,n=0,r=world.broadphase.retrieve(e),o=r.length;t=r[--o];)if(t!==e&&shouldCollide(e,t)&&e.body.getBounds().overlaps(t.body.getBounds())){var s=e.body.shapes.length,a=t.body.shapes.length;if(0===s||0===a)continue;var l=0;do{var u=e.body.getShape(l),h=0;do{var c=t.body.getShape(h);!0===SAT["test"+u.shapeType+c.shapeType].call(this,e,u,t,c,i.clear())&&(n++,i.indexShapeA=l,i.indexShapeB=h,e.onCollision&&!1!==e.onCollision(i,t)&&!1===e.body.isStatic&&e.body.respondToCollision.call(e.body,i),t.onCollision&&!1!==t.onCollision(i,e)&&!1===t.body.isStatic&&t.body.respondToCollision.call(t.body,i)),h++}while(h<a);l++}while(l<s)}return n>0}function _rayCast(e){for(var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=0,r=world.broadphase.retrieve(e),o=r.length;t=r[--o];)if(t.body&&e.getBounds().overlaps(t.getBounds())){var s=t.body.shapes.length;if(0===t.body.shapes.length)continue;var a=e,l=0;do{var u=t.body.getShape(l);SAT["test"+a.shapeType+u.shapeType].call(this,dummyObj,a,t,u)&&(i[n]=t,n++),l++}while(l<s)}return i.length=n,i}var collision={maxChildren:8,maxDepth:4,types:{NO_OBJECT:0,PLAYER_OBJECT:1,NPC_OBJECT:2,ENEMY_OBJECT:4,COLLECTABLE_OBJECT:8,ACTION_OBJECT:16,PROJECTILE_OBJECT:32,WORLD_SHAPE:64,USER:128,ALL_OBJECT:4294967295},response:globalResponse,rayCast:function(e,t){return _rayCast(e,t)}},Body=function(){function e(t,i,n){if(_classCallCheck(this,e),this.ancestor=t,void 0===this.bounds&&(this.bounds=new Bounds$1),void 0===this.shapes&&(this.shapes=[]),this.collisionMask=collision.types.ALL_OBJECT,this.collisionType=collision.types.ENEMY_OBJECT,void 0===this.vel&&(this.vel=new Vector2d),this.vel.set(0,0),void 0===this.force&&(this.force=new Vector2d),this.force.set(0,0),void 0===this.friction&&(this.friction=new Vector2d),this.friction.set(0,0),this.bounce=0,this.mass=1,void 0===this.maxVel&&(this.maxVel=new Vector2d),this.maxVel.set(490,490),this.isStatic=!1,this.gravityScale=1,this.ignoreGravity=!1,this.falling=!1,this.jumping=!1,"function"==typeof n&&(this.onBodyUpdate=n),this.bounds.clear(),void 0!==i)if(Array.isArray(i))for(var r=0;r<i.length;r++)this.addShape(i[r]);else this.addShape(i);this.ancestor.isKinematic=!1}return _createClass(e,[{key:"setStatic",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isStatic=!0===e}},{key:"addShape",value:function(e){if(e instanceof Rect||e instanceof Bounds$1){var t=e.toPolygon();this.shapes.push(t),this.bounds.add(t.points),this.bounds.translate(t.pos)}else e instanceof Ellipse?(this.shapes.includes(e)||this.shapes.push(e),this.bounds.addBounds(e.getBounds()),this.bounds.translate(e.getBounds().x,e.getBounds().y)):e instanceof Polygon?(this.shapes.includes(e)||this.shapes.push(e),this.bounds.add(e.points),this.bounds.translate(e.pos)):this.fromJSON(e);return"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this),this.shapes.length}},{key:"setVertices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getShape(t);n instanceof Polygon?n.setShape(0,0,e):this.shapes[t]=new Polygon(0,0,e),this.bounds.add(this.shapes[t].points,i),"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this)}},{key:"addVertices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.setVertices(e,t,!1)}},{key:"fromJSON",value:function(e,t){var i=e;if(void 0!==t&&(i=e[t]),void 0===i)throw new Error("Identifier ("+t+") undefined for the given JSON object)");if(i.length){for(var n=0;n<i.length;n++)this.addVertices(i[n].shape,n);this.mass=i[0].density||0,this.friction.set(i[0].friction||0,i[0].friction||0),this.bounce=i[0].bounce||0}return i.length}},{key:"getShape",value:function(e){return this.shapes[e||0]}},{key:"getBounds",value:function(){return this.bounds}},{key:"removeShape",value:function(e){this.bounds.clear(),_remove(this.shapes,e);for(var t=0;t<this.shapes.length;t++)this.addShape(this.shapes[t]);return this.shapes.length}},{key:"removeShapeAt",value:function(e){return this.removeShape(this.getShape(e))}},{key:"setCollisionMask",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:collision.types.ALL_OBJECT;this.collisionMask=e}},{key:"setCollisionType",value:function(e){if(void 0!==e){if(void 0===collision.types[e])throw new Error("Invalid value for the collisionType property");this.collisionType=collision.types[e]}}},{key:"respondToCollision",value:function(e){var t=e.overlapV;if(this.ancestor.pos.sub(t),0!==t.x&&(this.vel.x=~~(.5+this.vel.x-t.x)||0,this.bounce>0&&(this.vel.x*=-this.bounce)),0!==t.y){this.vel.y=~~(.5+this.vel.y-t.y)||0,this.bounce>0&&(this.vel.y*=-this.bounce);var i=Math.sign(world.gravity.y*this.gravityScale)||1;this.falling=t.y>=i,this.jumping=t.y<=-i}}},{key:"forEach",value:function(e,t){var i=this,n=0,r=this.shapes,o=r.length;if("function"!=typeof e)throw new Error(e+" is not a function");for(arguments.length>1&&(i=t);n<o;)e.call(i,r[n],n,r),n++}},{key:"contains",value:function(){var e,t;if(2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.getBounds().contains(e,t))for(var i,n=this.shapes.length;n--,i=this.shapes[n];)if(i.contains(e,t))return!0;return!1}},{key:"rotate",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getBounds().center;return this.bounds.clear(),this.forEach((function(n){n.rotate(e,i),t.bounds.addBounds(n.getBounds()),n instanceof Ellipse?t.bounds.translate(n.getBounds().x,n.getBounds().y):t.bounds.translate(n.pos)})),this}},{key:"setMaxVelocity",value:function(e,t){this.maxVel.x=e,this.maxVel.y=t}},{key:"setFriction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.friction.x=e,this.friction.y=t}},{key:"computeVelocity",value:function(){var e=timer$1.tick;if(!this.ignoreGravity){var t=world.gravity;this.vel.x+=t.x*this.gravityScale*e,this.vel.y+=t.y*this.gravityScale*e,this.falling=this.vel.y*Math.sign(t.y*this.gravityScale)>0,this.jumping=!this.falling&&this.jumping}if(0!==this.force.x&&(this.vel.x+=this.force.x*e),0!==this.force.y&&(this.vel.y+=this.force.y*e),this.friction.x>0){var i=this.friction.x*e,n=this.vel.x+i,r=this.vel.x-i;this.vel.x=n<0?n:r>0?r:0}if(this.friction.y>0){var o=this.friction.y*e,s=this.vel.y+o,a=this.vel.y-o;this.vel.y=s<0?s:a>0?a:0}0!==this.vel.y&&(this.vel.y=_clamp(this.vel.y,-this.maxVel.y,this.maxVel.y)),0!==this.vel.x&&(this.vel.x=_clamp(this.vel.x,-this.maxVel.x,this.maxVel.x))}},{key:"update",value:function(e){return this.computeVelocity(e),this.ancestor.pos.add(this.vel),0!==this.vel.x||0!==this.vel.y}},{key:"destroy",value:function(){this.onBodyUpdate=void 0,this.ancestor=void 0,this.bounds=void 0,this.setStatic(!1),this.shapes.length=0}}]),e}(),deferredRemove=function(e,t){this.removeChildNow(e,t)},globalFloatingCounter=0,Container=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:viewport.width,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:viewport.height,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return _classCallCheck(this,i),(e=t.call(this,n,r,o,s)).pendingSort=null,e.root=a,e.children=void 0,e.sortOn=sortOn,e.autoSort=!0,e.autoDepth=!0,e.clipping=!1,e.onChildChange=function(){},e.enableChildBoundsUpdate=!1,e.backgroundColor=pool.pull("Color",0,0,0,0),e.drawCount=0,e.autoTransform=!0,e.isKinematic=!1,e.anchorPoint.set(0,0),!0===e.root&&on(CANVAS_ONRESIZE,e.updateBounds.bind(_assertThisInitialized(e),!0)),e}return _createClass(i,[{key:"reset",value:function(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);for(var e,t=this.getChildren(),i=t.length;i>=0;e=t[--i])e&&!0!==e.isPersistent&&this.removeChildNow(e);void 0!==this.currentTransform&&this.currentTransform.identity(),this.backgroundColor.setColor(0,0,0,0)}},{key:"addChild",value:function(e,t){return e.ancestor instanceof i?e.ancestor.removeChildNow(e):e.isRenderable&&(e.GUID=utils.createGUID(e.id)),e.ancestor=this,this.getChildren().push(e),void 0!==e.pos&&("number"==typeof t?e.pos.z=t:!0===this.autoDepth&&(e.pos.z=this.getChildren().length)),!0===this.autoSort&&this.sort(),"function"==typeof e.onActivateEvent&&this.isAttachedToRoot()&&e.onActivateEvent(),!0===this.isAttachedToRoot()&&repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),e.body instanceof Body&&world.addBody(e.body),this.onChildChange.call(this,this.getChildren().length-1),e}},{key:"addChildAt",value:function(e,t){if(t>=0&&t<this.getChildren().length)return e.ancestor instanceof i?e.ancestor.removeChildNow(e):e.isRenderable&&(e.GUID=utils.createGUID()),e.ancestor=this,this.getChildren().splice(t,0,e),"function"==typeof e.onActivateEvent&&this.isAttachedToRoot()&&e.onActivateEvent(),!0===this.isAttachedToRoot()&&repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),e.body instanceof Body&&world.addBody(e.body),this.onChildChange.call(this,t),e;throw new Error("Index ("+t+") Out Of Bounds for addChildAt()")}},{key:"forEach",value:function(e,t){var i=this,n=0,r=this.getChildren(),o=r.length;if("function"!=typeof e)throw new Error(e+" is not a function");for(arguments.length>1&&(i=t);n<o;)e.call(i,r[n],n,r),n++}},{key:"swapChildren",value:function(e,t){var i=this.getChildIndex(e),n=this.getChildIndex(t);if(-1===i||-1===n)throw new Error(e+" Both the supplied childs must be a child of the caller "+this);var r=e.pos.z;e.pos.z=t.pos.z,t.pos.z=r,this.getChildren()[i]=t,this.getChildren()[n]=e}},{key:"getChildAt",value:function(e){if(e>=0&&e<this.getChildren().length)return this.getChildren()[e];throw new Error("Index ("+e+") Out Of Bounds for getChildAt()")}},{key:"getChildIndex",value:function(e){return this.getChildren().indexOf(e)}},{key:"getNextChild",value:function(e){var t=this.getChildren().indexOf(e)-1;if(t>=0&&t<this.getChildren().length)return this.getChildAt(t)}},{key:"hasChild",value:function(e){return this===e.ancestor}},{key:"getChildByProp",value:function(e,t){var n=[];return this.forEach((function(r){!function(e,i){var r=e[i];t instanceof RegExp&&"string"==typeof r?t.test(r)&&n.push(e):r===t&&n.push(e)}(r,e),r instanceof i&&(n=n.concat(r.getChildByProp(e,t)))})),n}},{key:"getChildByType",value:function(e){var t=[];return this.forEach((function(n){n instanceof e&&t.push(n),n instanceof i&&(t=t.concat(n.getChildByType(e)))})),t}},{key:"getChildByName",value:function(e){return this.getChildByProp("name",e)}},{key:"getChildByGUID",value:function(e){var t=this.getChildByProp("GUID",e);return t.length>0?t[0]:null}},{key:"getChildren",value:function(){return void 0===this.children&&(this.children=[]),this.children}},{key:"updateBounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_get(_getPrototypeOf(i.prototype),"updateBounds",this).call(this);var t=this.getBounds();return!0!==e&&!0!==this.enableChildBoundsUpdate||this.forEach((function(e){e.isRenderable&&e.getBounds().isFinite()&&t.addBounds(e.getBounds())})),t}},{key:"isAttachedToRoot",value:function(){if(!0===this.root)return!0;for(var e=this.ancestor;e;){if(!0===e.root)return!0;e=e.ancestor}return!1}},{key:"updateBoundsPos",value:function(e,t){var n=this;return _get(_getPrototypeOf(i.prototype),"updateBoundsPos",this).call(this,e,t),this.forEach((function(i){i.isRenderable&&i.updateBoundsPos(i.pos.x+e-n.pos.x,i.pos.y+t-n.pos.y)})),this.getBounds()}},{key:"onActivateEvent",value:function(){this.forEach((function(e){"function"==typeof e.onActivateEvent&&e.onActivateEvent()}))}},{key:"removeChild",value:function(e,t){if(!this.hasChild(e))throw new Error("Child is not mine.");utils.function.defer(deferredRemove,this,e,t)}},{key:"removeChildNow",value:function(e,t){if(this.hasChild(e)&&this.getChildIndex(e)>=0){"function"==typeof e.onDeactivateEvent&&e.onDeactivateEvent(),e.body instanceof Body&&world.removeBody(e.body),t||!1===pool.push(e,!1)&&"function"==typeof e.destroy&&e.destroy();var i=this.getChildIndex(e);i>=0&&(this.getChildren().splice(i,1),e.ancestor=void 0),!0===this.isAttachedToRoot()&&repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),this.onChildChange.call(this,i)}}},{key:"setChildsProperty",value:function(e,t,n){this.forEach((function(r){!0===n&&r instanceof i&&r.setChildsProperty(e,t,n),r[e]=t}))}},{key:"moveUp",value:function(e){var t=this.getChildIndex(e);t-1>=0&&this.swapChildren(e,this.getChildAt(t-1))}},{key:"moveDown",value:function(e){var t=this.getChildIndex(e);t>=0&&t+1<this.getChildren().length&&this.swapChildren(e,this.getChildAt(t+1))}},{key:"moveToTop",value:function(e){var t=this.getChildIndex(e);if(t>0){var i=this.getChildren();i.splice(0,0,i.splice(t,1)[0]),e.pos.z=i[1].pos.z+1}}},{key:"moveToBottom",value:function(e){var t=this.getChildIndex(e),i=this.getChildren();t>=0&&t<i.length-1&&(i.splice(i.length-1,0,i.splice(t,1)[0]),e.pos.z=i[i.length-2].pos.z-1)}},{key:"sort",value:function(e){this.pendingSort||(!0===e&&this.forEach((function(t){t instanceof i&&t.sort(e)})),this.pendingSort=utils.function.defer((function(){this.getChildren().sort(this["_sort"+this.sortOn.toUpperCase()]),this.pendingSort=null,repaint()}),this))}},{key:"onDeactivateEvent",value:function(){this.forEach((function(e){"function"==typeof e.onDeactivateEvent&&e.onDeactivateEvent()}))}},{key:"_sortZ",value:function(e,t){return t.pos&&e.pos?t.pos.z-e.pos.z:e.pos?-1/0:1/0}},{key:"_sortReverseZ",value:function(e,t){return e.pos&&t.pos?e.pos.z-t.pos.z:e.pos?1/0:-1/0}},{key:"_sortX",value:function(e,t){return t.pos&&e.pos?t.pos.z-e.pos.z||t.pos.x-e.pos.x:e.pos?-1/0:1/0}},{key:"_sortY",value:function(e,t){return t.pos&&e.pos?t.pos.z-e.pos.z||t.pos.y-e.pos.y:e.pos?-1/0:1/0}},{key:"destroy",value:function(){this.reset(),_get(_getPrototypeOf(i.prototype),"destroy",this).call(this,arguments)}},{key:"update",value:function(e){for(var t,n=!1,r=state.isPaused(),o=this.getChildren(),s=o.length;s--,t=o[s];)r&&!t.updateWhenPaused||(t.isRenderable?((n=globalFloatingCounter>0||t.floating)&&globalFloatingCounter++,t.inViewport=!1,state.current().cameras.forEach((function(e){e.isVisible(t,n)&&(t.inViewport=!0)})),this.isDirty|=(t.inViewport||t.alwaysUpdate)&&t.update(e),globalFloatingCounter>0&&globalFloatingCounter--):this.isDirty|=t.update(e));return _get(_getPrototypeOf(i.prototype),"update",this).call(this,e)}},{key:"draw",value:function(e,t){var i=!1,n=this.getBounds();this.drawCount=0,!1===this.root&&!0===this.clipping&&!0===n.isFinite()&&e.clipRect(n.left,n.top,n.width,n.height),e.translate(this.pos.x,this.pos.y),this.backgroundColor.alpha>1/255&&e.clearColor(this.backgroundColor);for(var r,o=this.getChildren(),s=o.length;r=o[--s];)r.isRenderable&&(i=!0===r.floating,(r.inViewport||i)&&(i&&(e.save(),e.resetTransform()),r.preDraw(e),r.draw(e,t),r.postDraw(e),i&&e.restore(),this.drawCount++))}}]),i}(Renderable),QT_ARRAY=[];function QT_ARRAY_POP(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(QT_ARRAY.length>0){var r=QT_ARRAY.pop();return r.bounds=e,r.max_objects=t,r.max_levels=i,r.level=n,r}return new QuadTree(e,t,i,n)}function QT_ARRAY_PUSH(e){QT_ARRAY.push(e)}var QT_VECTOR=new Vector2d,QuadTree=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;_classCallCheck(this,e),this.max_objects=i,this.max_levels=n,this.level=r,this.bounds=t,this.objects=[],this.nodes=[]}return _createClass(e,[{key:"split",value:function(){var e=this.level+1,t=this.bounds.width/2,i=this.bounds.height/2,n=this.bounds.left,r=this.bounds.top;this.nodes[0]=QT_ARRAY_POP({left:n+t,top:r,width:t,height:i},this.max_objects,this.max_levels,e),this.nodes[1]=QT_ARRAY_POP({left:n,top:r,width:t,height:i},this.max_objects,this.max_levels,e),this.nodes[2]=QT_ARRAY_POP({left:n,top:r+i,width:t,height:i},this.max_objects,this.max_levels,e),this.nodes[3]=QT_ARRAY_POP({left:n+t,top:r+i,width:t,height:i},this.max_objects,this.max_levels,e)}},{key:"getIndex",value:function(e){var t,i=e.getBounds(),n=-1,r=(t=!0===e.isFloating?viewport.localToWorld(i.left,i.top,QT_VECTOR):QT_VECTOR.set(e.left,e.top)).x,o=t.y,s=i.width,a=i.height,l=this.bounds.left+this.bounds.width/2,u=this.bounds.top+this.bounds.height/2,h=o<u&&o+a<u,c=o>u;return r<l&&r+s<l?h?n=1:c&&(n=2):r>l&&(h?n=0:c&&(n=3)),n}},{key:"insertContainer",value:function(e){for(var t,i=e.children.length;i--,t=e.children[i];)!0!==t.isKinematic&&(t instanceof Container?("rootContainer"!==t.name&&this.insert(t),this.insertContainer(t)):"function"==typeof t.getBounds&&this.insert(t))}},{key:"insert",value:function(e){var t=-1;if(this.nodes.length>0&&-1!==(t=this.getIndex(e)))this.nodes[t].insert(e);else if(this.objects.push(e),this.objects.length>this.max_objects&&this.level<this.max_levels){0===this.nodes.length&&this.split();for(var i=0;i<this.objects.length;)-1!==(t=this.getIndex(this.objects[i]))?this.nodes[t].insert(this.objects.splice(i,1)[0]):i+=1}}},{key:"retrieve",value:function(e,t){var i=this.objects;if(this.nodes.length>0){var n=this.getIndex(e);if(-1!==n)i=i.concat(this.nodes[n].retrieve(e));else for(var r=0;r<this.nodes.length;r+=1)i=i.concat(this.nodes[r].retrieve(e))}return"function"==typeof t&&i.sort(t),i}},{key:"remove",value:function(e){var t=!1;if(void 0===e.getBounds)return!1;if(this.nodes.length>0){var i=this.getIndex(e);-1!==i&&(t=_remove(this.nodes[i],e))&&this.nodes[i].isPrunable()&&this.nodes.splice(i,1)}return!1===t&&-1!==this.objects.indexOf(e)&&(_remove(this.objects,e),t=!0),t}},{key:"isPrunable",value:function(){return!(this.hasChildren()||this.objects.length>0)}},{key:"hasChildren",value:function(){for(var e=0;e<this.nodes.length;e+=1){var t=this.nodes[e];if(t.length>0||t.objects.length>0)return!0}return!1}},{key:"clear",value:function(e){this.objects.length=0;for(var t=0;t<this.nodes.length;t++)this.nodes[t].clear(),QT_ARRAY_PUSH(this.nodes[t]);this.nodes.length=0,void 0!==e&&this.bounds.setMinMax(e.min.x,e.min.y,e.max.x,e.max.y)}}]),e}(),World=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return _classCallCheck(this,i),(e=t.call(this,n,r,o,s,!0)).name="rootContainer",e.anchorPoint.set(0,0),e.fps=60,e.gravity=new Vector2d(0,.98),e.preRender=!1,e.bodies=new Set,e.broadphase=new QuadTree(e.getBounds().clone(),collision.maxChildren,collision.maxDepth),on(GAME_RESET,e.reset,_assertThisInitialized(e)),on(LEVEL_LOADED,(function(){e.broadphase.clear(e.getBounds())})),e}return _createClass(i,[{key:"reset",value:function(){this.broadphase.clear(),this.anchorPoint.set(0,0),_get(_getPrototypeOf(i.prototype),"reset",this).call(this),this.bodies.clear()}},{key:"addBody",value:function(e){return this.bodies.add(e),this}},{key:"removeBody",value:function(e){return this.bodies.delete(e),this}},{key:"update",value:function(e){var t=state.isPaused();return this.broadphase.clear(),this.broadphase.insertContainer(this),this.bodies.forEach((function(i){if(!i.isStatic){var n=i.ancestor;t&&!n.updateWhenPaused||!n.inViewport&&!n.alwaysUpdate||(!0===i.update(e)&&(n.isDirty=!0),collisionCheck(n))}})),_get(_getPrototypeOf(i.prototype),"update",this).call(this,e)}}]),i}(Container),isDirty=!0,isAlwaysDirty=!1,frameCounter=0,frameRate=1,accumulator=0,accumulatorMax=0,accumulatorUpdateDelta=0,stepSize=1e3/60,updateDelta=0,lastUpdateStart=null,updateAverageDelta=0,viewport,world;on(BOOT,(function(){world=new World,emit(GAME_INIT)}));var mergeGroup=!0,sortOn="z",lastUpdate=window.performance.now();function onLevelLoaded(){}function _reset(){var e=state.current();void 0!==e&&(viewport=e.cameras.get("default")),emit(GAME_RESET),updateFrameRate()}function updateFrameRate(){frameCounter=0,frameRate=~~(.5+60/timer$1.maxfps),stepSize=1e3/world.fps,accumulator=0,accumulatorMax=10*stepSize,isAlwaysDirty=timer$1.maxfps>world.fps}function getParentContainer(e){return e.ancestor}function repaint(){isDirty=!0}function update$1(e,t){if(++frameCounter%frameRate==0){for(frameCounter=0,emit(GAME_BEFORE_UPDATE,e),accumulator+=timer$1.getDelta(),accumulator=Math.min(accumulator,accumulatorMax),updateDelta=timer$1.interpolation?timer$1.getDelta():stepSize,accumulatorUpdateDelta=timer$1.interpolation?updateDelta:Math.max(updateDelta,updateAverageDelta);accumulator>=accumulatorUpdateDelta||timer$1.interpolation;)if(lastUpdateStart=window.performance.now(),!0!==state.isPaused()&&emit(GAME_UPDATE,e),isDirty=t.update(updateDelta)||isDirty,lastUpdate=window.performance.now(),updateAverageDelta=lastUpdate-lastUpdateStart,accumulator-=accumulatorUpdateDelta,timer$1.interpolation){accumulator=0;break}emit(GAME_AFTER_UPDATE,lastUpdate)}}function draw(e){!0===renderer.isContextValid&&(isDirty||isAlwaysDirty)&&(emit(GAME_BEFORE_DRAW,window.performance.now()),renderer.clear(),e.draw(renderer),isDirty=!1,renderer.flush(),emit(GAME_AFTER_DRAW,window.performance.now()))}var game=Object.freeze({__proto__:null,get viewport(){return viewport},get world(){return world},mergeGroup,sortOn,get lastUpdate(){return lastUpdate},onLevelLoaded,reset:_reset,updateFrameRate,getParentContainer,repaint,update:update$1,draw}),MIN=Math.min,MAX=Math.max,targetV=new Vector2d,Camera2d=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,o){var s;return _classCallCheck(this,i),(s=t.call(this,e,n,r-e,o-n)).AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},s.bounds=pool.pull("Bounds"),s.smoothFollow=!0,s.damping=1,s.near=-1e3,s.far=1e3,s.projectionMatrix=new Matrix3d,s.invCurrentTransform=new Matrix2d,s.offset=new Vector2d,s.target=null,s.follow_axis=s.AXIS.NONE,s._shake={intensity:0,duration:0,axis:s.AXIS.BOTH,onComplete:null},s._fadeOut={color:null,tween:null},s._fadeIn={color:null,tween:null},s.name="default",s.setDeadzone(s.width/6,s.height/6),s.anchorPoint.set(0,0),s.isKinematic=!1,s.bounds.setMinMax(e,n,r,o),s._updateProjectionMatrix(),on(GAME_RESET,s.reset,_assertThisInitialized(s)),on(CANVAS_ONRESIZE,s.resize,_assertThisInitialized(s)),s}return _createClass(i,[{key:"_updateProjectionMatrix",value:function(){this.projectionMatrix.ortho(0,this.width,this.height,0,this.near,this.far)}},{key:"_followH",value:function(e){var t=this.pos.x;return e.x-this.pos.x>this.deadzone.right?t=MIN(e.x-this.deadzone.right,this.bounds.width-this.width):e.x-this.pos.x<this.deadzone.pos.x&&(t=MAX(e.x-this.deadzone.pos.x,this.bounds.left)),t}},{key:"_followV",value:function(e){var t=this.pos.y;return e.y-this.pos.y>this.deadzone.bottom?t=MIN(e.y-this.deadzone.bottom,this.bounds.height-this.height):e.y-this.pos.y<this.deadzone.pos.y&&(t=MAX(e.y-this.deadzone.pos.y,this.bounds.top)),t}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.pos.x=e,this.pos.y=t,this.unfollow(),this.smoothFollow=!0,this.damping=1,this.currentTransform.identity(),this.invCurrentTransform.identity().invert(),this._updateProjectionMatrix()}},{key:"setDeadzone",value:function(e,t){void 0===this.deadzone&&(this.deadzone=new Rect(0,0,0,0)),this.deadzone.pos.set(~~((this.width-e)/2),~~((this.height-t)/2-.25*t)),this.deadzone.resize(e,t),this.smoothFollow=!1,this.updateTarget(),this.smoothFollow=!0}},{key:"resize",value:function(e,t){return _get(_getPrototypeOf(i.prototype),"resize",this).call(this,e,t),this.smoothFollow=!1,this.setBounds(0,0,e,t),this.setDeadzone(e/6,t/6),this.update(),this.smoothFollow=!0,this._updateProjectionMatrix(),emit(VIEWPORT_ONRESIZE,this.width,this.height),this}},{key:"setBounds",value:function(e,t,i,n){this.smoothFollow=!1,this.bounds.setMinMax(e,t,i+e,n+t),this.moveTo(this.pos.x,this.pos.y),this.update(),this.smoothFollow=!0}},{key:"follow",value:function(e,t,i){if(e instanceof Renderable)this.target=e.pos;else{if(!(e instanceof Vector2d||e instanceof Vector3d||e instanceof ObservableVector2d||e instanceof ObservableVector3d))throw new Error("invalid target for me.Camera2d.follow");this.target=e}this.follow_axis=void 0===t?this.AXIS.BOTH:t,this.smoothFollow=!1,this.damping="number"!=typeof i?1:_clamp(i,0,1),this.updateTarget(),this.smoothFollow=!0}},{key:"unfollow",value:function(){this.target=null,this.follow_axis=this.AXIS.NONE}},{key:"move",value:function(e,t){this.moveTo(this.pos.x+e,this.pos.y+t)}},{key:"moveTo",value:function(e,t){var i=this.pos.x,n=this.pos.y;this.pos.x=_clamp(e,this.bounds.left,this.bounds.width),this.pos.y=_clamp(t,this.bounds.top,this.bounds.height),i===this.pos.x&&n===this.pos.y||emit(VIEWPORT_ONCHANGE,this.pos)}},{key:"updateTarget",value:function(){if(this.target){switch(targetV.setV(this.pos),this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:targetV.x=this._followH(this.target);break;case this.AXIS.VERTICAL:targetV.y=this._followV(this.target);break;case this.AXIS.BOTH:targetV.x=this._followH(this.target),targetV.y=this._followV(this.target)}if(!this.pos.equals(targetV)){if(!0===this.smoothFollow&&this.damping<1){if(toBeCloseTo(targetV.x,this.pos.x,2)&&toBeCloseTo(targetV.y,this.pos.y,2))return this.pos.setV(targetV),!1;this.pos.lerp(targetV,this.damping)}else this.pos.setV(targetV);return!0}}return!1}},{key:"update",value:function(e){var t=this.updateTarget(e);return this._shake.duration>0&&(this._shake.duration-=e,this._shake.duration<=0?(this._shake.duration=0,this.offset.setZero(),"function"==typeof this._shake.onComplete&&this._shake.onComplete()):(this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.HORIZONTAL||(this.offset.x=(Math.random()-.5)*this._shake.intensity),this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.VERTICAL||(this.offset.y=(Math.random()-.5)*this._shake.intensity)),t=!0),!0===t&&emit(VIEWPORT_ONCHANGE,this.pos),null==this._fadeIn.tween&&null==this._fadeOut.tween||(t=!0),this.currentTransform.isIdentity()?this.invCurrentTransform.identity():this.invCurrentTransform.copy(this.currentTransform).invert(),t}},{key:"shake",value:function(e,t,i,n,r){0!==this._shake.duration&&!0!==r||(this._shake.intensity=e,this._shake.duration=t,this._shake.axis=i||this.AXIS.BOTH,this._shake.onComplete="function"==typeof n?n:void 0)}},{key:"fadeOut",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2?arguments[2]:void 0;this._fadeOut.color=pool.pull("Color").copy(e),this._fadeOut.tween=pool.pull("Tween",this._fadeOut.color).to({alpha:0},t).onComplete(i||null),this._fadeOut.tween.isPersistent=!0,this._fadeOut.tween.start()}},{key:"fadeIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2?arguments[2]:void 0;this._fadeIn.color=pool.pull("Color").copy(e);var n=this._fadeIn.color.alpha;this._fadeIn.color.alpha=0,this._fadeIn.tween=pool.pull("Tween",this._fadeIn.color).to({alpha:n},t).onComplete(i||null),this._fadeIn.tween.isPersistent=!0,this._fadeIn.tween.start()}},{key:"focusOn",value:function(e){var t=e.getBounds();this.moveTo(e.pos.x+t.left+t.width/2,e.pos.y+t.top+t.height/2)}},{key:"isVisible",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.floating;return!0===t||!0===e.floating?renderer.overlaps(e.getBounds()):e.getBounds().overlaps(this)}},{key:"localToWorld",value:function(e,t,i){return(i=i||pool.pull("Vector2d")).set(e,t).add(this.pos).sub(world.pos),this.currentTransform.isIdentity()||this.invCurrentTransform.apply(i),i}},{key:"worldToLocal",value:function(e,t,i){return(i=i||pool.pull("Vector2d")).set(e,t),this.currentTransform.isIdentity()||this.currentTransform.apply(i),i.sub(this.pos).add(world.pos)}},{key:"drawFX",value:function(e){this._fadeIn.tween&&(e.save(),e.resetTransform(),e.setColor(this._fadeIn.color),e.fillRect(0,0,this.width,this.height),e.restore(),1===this._fadeIn.color.alpha&&(this._fadeIn.tween=null,pool.push(this._fadeIn.color),this._fadeIn.color=null)),this._fadeOut.tween&&(e.save(),e.resetTransform(),e.setColor(this._fadeOut.color),e.fillRect(0,0,this.width,this.height),e.restore(),0===this._fadeOut.color.alpha&&(this._fadeOut.tween=null,pool.push(this._fadeOut.color),this._fadeOut.color=null))}},{key:"draw",value:function(e,t){var i=this.pos.x+this.offset.x,n=this.pos.y+this.offset.y;t.currentTransform.translate(-i,-n),e.setProjection(this.projectionMatrix),e.clipRect(0,0,this.width,this.height),this.preDraw(e),t.preDraw(e),t.draw(e,this),this.drawFX(e),t.postDraw(e),this.postDraw(e),t.currentTransform.translate(i,n)}}]),i}(Renderable),default_camera,default_settings={cameras:[]},Stage=function(){function e(t){_classCallCheck(this,e),this.cameras=new Map,this.settings=Object.assign(default_settings,t||{})}return _createClass(e,[{key:"reset",value:function(){var e=this;if(this.settings.cameras.forEach((function(t){e.cameras.set(t.name,t)})),!1===this.cameras.has("default")){if(void 0===default_camera){var t=renderer.getWidth(),i=renderer.getHeight();default_camera=new Camera2d(0,0,t,i)}this.cameras.set("default",default_camera)}_reset(),this.onResetEvent.apply(this,arguments)}},{key:"update",value:function(e){var t=world.update(e);return this.cameras.forEach((function(i){i.update(e)&&(t=!0)})),t}},{key:"draw",value:function(e){this.cameras.forEach((function(t){t.draw(e,world)}))}},{key:"destroy",value:function(){this.cameras.clear(),this.onDestroyEvent.apply(this,arguments)}},{key:"onResetEvent",value:function(){"function"==typeof this.settings.onResetEvent&&this.settings.onResetEvent.apply(this,arguments)}},{key:"onDestroyEvent",value:function(){"function"==typeof this.settings.onDestroyEvent&&this.settings.onDestroyEvent.apply(this,arguments)}}]),e}(),ProgressBar=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,o){var s;return _classCallCheck(this,i),(s=t.call(this,e,n,r,o)).barHeight=o,s.anchorPoint.set(0,0),on(LOADER_PROGRESS,s.onProgressUpdate,_assertThisInitialized(s)),on(VIEWPORT_ONRESIZE,s.resize,_assertThisInitialized(s)),s.anchorPoint.set(0,0),s.progress=0,s}return _createClass(i,[{key:"onProgressUpdate",value:function(e){this.progress=~~(e*this.width),this.isDirty=!0}},{key:"draw",value:function(e){e.setColor("black"),e.fillRect(this.pos.x,viewport.centerY,e.getWidth(),this.barHeight/2),e.setColor("#55aa00"),e.fillRect(this.pos.x,viewport.centerY,this.progress,this.barHeight/2)}},{key:"onDestroyEvent",value:function(){off(LOADER_PROGRESS,this.onProgressUpdate),off(VIEWPORT_ONRESIZE,this.resize)}}]),i}(Renderable),IconLogo=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n){var r;_classCallCheck(this,i),(r=t.call(this,e,n,100,85)).iconCanvas=createCanvas(renderer.WebGLVersion>1?r.width:nextPowerOfTwo(r.width),renderer.WebGLVersion>1?r.height:nextPowerOfTwo(r.height),!1);var o=renderer.getContext2d(r.iconCanvas);return o.beginPath(),o.moveTo(.7,48.9),o.bezierCurveTo(10.8,68.9,38.4,75.8,62.2,64.5),o.bezierCurveTo(86.1,53.1,97.2,27.7,87,7.7),o.lineTo(87,7.7),o.bezierCurveTo(89.9,15.4,73.9,30.2,50.5,41.4),o.bezierCurveTo(27.1,52.5,5.2,55.8,.7,48.9),o.lineTo(.7,48.9),o.closePath(),o.fillStyle="rgb(255, 255, 255)",o.fill(),o.beginPath(),o.moveTo(84,7),o.bezierCurveTo(87.6,14.7,72.5,30.2,50.2,41.6),o.bezierCurveTo(27.9,53,6.9,55.9,3.2,48.2),o.bezierCurveTo(-.5,40.4,14.6,24.9,36.9,13.5),o.bezierCurveTo(59.2,2.2,80.3,-.8,84,7),o.lineTo(84,7),o.closePath(),o.lineWidth=5.3,o.strokeStyle="rgb(255, 255, 255)",o.lineJoin="miter",o.miterLimit=4,o.stroke(),r.anchorPoint.set(.5,.5),r}return _createClass(i,[{key:"draw",value:function(e){e.drawImage(this.iconCanvas,e.getWidth()/2,this.pos.y)}}]),i}(Renderable),DefaultLoadingScreen=function(e){_inherits(i,e);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"onResetEvent",value:function(){world.backgroundColor.parseCSS("#202020"),world.addChild(new ProgressBar(0,renderer.getHeight()/2,renderer.getWidth(),8),1),world.addChild(new IconLogo(renderer.getWidth()/2,renderer.getHeight()/2-16-35),2);var e=pool.pull("Text",renderer.getWidth()/2,renderer.getHeight()/2+16,{font:"century gothic",size:32,fillStyle:"white",textAlign:"left",textBaseline:"top",text:"melon",offScreenCanvas:renderer.WebGLVersion>=1});e.anchorPoint.set(0,0);var t=pool.pull("Text",renderer.getWidth()/2,renderer.getHeight()/2+16,{font:"century gothic",size:32,fillStyle:"#55aa00",textAlign:"left",textBaseline:"top",bold:!0,text:"JS",offScreenCanvas:renderer.WebGLVersion>=1});t.anchorPoint.set(0,0);var i=e.getBounds().width+t.getBounds().width;e.pos.x=renderer.getWidth()/2-i/2,t.pos.x=e.pos.x+e.getBounds().width,world.addChild(e,2),world.addChild(t,2)}}]),i}(Stage),_state=-1,_animFrameId=-1,_isPaused=!1,_stages={},_fade={color:"",duration:0},_onSwitchComplete=null,_extraArgs=null,_pauseTime=0;function _startRunLoop(){-1===_animFrameId&&-1!==_state&&(timer$1.reset(),_animFrameId=window.requestAnimationFrame(_renderFrame))}function _resumeRunLoop(){_isPaused&&-1!==_state&&(timer$1.reset(),_isPaused=!1)}function _pauseRunLoop(){_isPaused=!0}function _renderFrame(e){var t=_stages[_state].stage;update$1(e,t),draw(t),-1!==_animFrameId&&(_animFrameId=window.requestAnimationFrame(_renderFrame))}function _stopRunLoop(){window.cancelAnimationFrame(_animFrameId),_animFrameId=-1}function _switchState(e){_stopRunLoop(),_stages[_state]&&_stages[_state].stage.destroy(),_stages[e]&&(_stages[_state=e].stage.reset.apply(_stages[_state].stage,_extraArgs),_startRunLoop(),_onSwitchComplete&&_onSwitchComplete(),repaint())}on(BOOT,(function(){state.set(state.LOADING,new DefaultLoadingScreen),state.set(state.DEFAULT,new Stage),on(VIDEO_INIT,(function(){state.change(state.DEFAULT,!0)}))}));var state={LOADING:0,MENU:1,READY:2,PLAY:3,GAMEOVER:4,GAME_END:5,SCORE:6,CREDITS:7,SETTINGS:8,DEFAULT:9,USER:100,stop:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_state!==this.LOADING&&this.isRunning()&&(_stopRunLoop(),!0===e&&e(),_pauseTime=window.performance.now(),emit(STATE_STOP))},pause:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_state===this.LOADING||this.isPaused()||(_pauseRunLoop(),!0===e&&pauseTrack(),_pauseTime=window.performance.now(),emit(STATE_PAUSE))},restart:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isRunning()||(_startRunLoop(),!0===e&&resumeTrack(),_pauseTime=window.performance.now()-_pauseTime,repaint(),emit(STATE_RESTART,_pauseTime))},resume:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isPaused()&&(_resumeRunLoop(),!0===e&&resumeTrack(),_pauseTime=window.performance.now()-_pauseTime,emit(STATE_RESUME,_pauseTime))},isRunning:function(){return-1!==_animFrameId},isPaused:function(){return _isPaused},set:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(t instanceof Stage))throw new Error(t+" is not an instance of me.Stage");_stages[e]={},_stages[e].stage=t,_stages[e].transition=!0,!0===i&&this.change(e)},current:function(){if(void 0!==_stages[_state])return _stages[_state].stage},transition:function(e,t,i){"fade"===e&&(_fade.color=t,_fade.duration=i)},setTransition:function(e,t){_stages[e].transition=t},change:function(e,t){if(void 0===_stages[e])throw new Error("Undefined Stage for state '"+e+"'");this.isCurrent(e)||(_extraArgs=null,arguments.length>1&&(_extraArgs=Array.prototype.slice.call(arguments,1)),_fade.duration&&_stages[e].transition?(_onSwitchComplete=function(){viewport.fadeOut(_fade.color,_fade.duration)},viewport.fadeIn(_fade.color,_fade.duration,(function(){defer(_switchState,this,e)}))):!0===t?_switchState(e):defer(_switchState,this,e))},isCurrent:function(e){return _state===e}};function setTMXValue(name,type,value){var match;if("string"!=typeof value)return value;switch(type){case"int":case"float":value=Number(value);break;case"bool":value="true"===value;break;default:if(!value||isBoolean(value))value=!value||"true"===value;else if(isNumeric(value))value=Number(value);else if(0===value.search(/^json:/i)){match=value.split(/^json:/i)[1];try{value=JSON.parse(match)}catch(e){throw new Error("Unable to parse JSON: "+match)}}else if(0===value.search(/^eval:/i)){match=value.split(/^eval:/i)[1];try{value=eval(match)}catch(e){throw new Error("Unable to evaluate: "+match)}}else((match=value.match(/^#([\da-fA-F])([\da-fA-F]{3})$/))||(match=value.match(/^#([\da-fA-F]{2})([\da-fA-F]{6})$/)))&&(value="#"+match[2]+match[1]);0===name.search(/^(ratio|anchorPoint)$/)&&"number"==typeof value&&(value={x:value,y:value})}return value}function parseAttributes(e,t){if(t.attributes&&t.attributes.length>0)for(var i=0;i<t.attributes.length;i++){var n=t.attributes.item(i);void 0!==n.name?e[n.name]=n.value:e[n.nodeName]=n.nodeValue}}function decompress(){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}function decodeCSV(e){for(var t=e.replace("\n","").trim().split(","),i=[],n=0;n<t.length;n++)i.push(+t[n]);return i}function decodeBase64AsArray(e,t){var i,n,r;t=t||1;var o=window.atob(e.replace(/[^A-Za-z0-9\+\/\=]/g,"")),s=new Uint32Array(o.length/t);for(i=0,r=o.length/t;i<r;i++)for(s[i]=0,n=t-1;n>=0;--n)s[i]+=o.charCodeAt(i*t+n)<<(n<<3);return s}function decode(e,t,i){switch(i=i||"none",t=t||"none"){case"csv":return decodeCSV(e);case"base64":var n=decodeBase64AsArray(e,4);return"none"===i?n:decompress();case"none":return e;case"xml":throw new Error("XML encoding is deprecated, use base64 instead");default:throw new Error("Unknown layer encoding: "+t)}}function normalize(e,t){var i=t.nodeName;switch(i){case"data":var n=parse(t);n.text=n.text||n.chunk.text,n.encoding=n.encoding||"xml",e.data=decode(n.text,n.encoding,n.compression),e.encoding="none";break;case"imagelayer":case"layer":case"objectgroup":case"group":var r=parse(t);r.type="layer"===i?"tilelayer":i,r.image&&(r.image=r.image.source),e.layers=e.layers||[],e.layers.push(r);break;case"animation":e.animation=parse(t).frames;break;case"frame":case"object":var o=i+"s";e[o]=e[o]||[],e[o].push(parse(t));break;case"tile":var s=parse(t);s.image&&(s.imagewidth=s.image.width,s.imageheight=s.image.height,s.image=s.image.source),e.tiles=e.tiles||{},e.tiles[s.id]=s;break;case"tileset":var a=parse(t);a.image&&(a.imagewidth=a.image.width,a.imageheight=a.image.height,a.image=a.image.source),e.tilesets=e.tilesets||[],e.tilesets.push(a);break;case"polygon":case"polyline":e[i]=[];for(var l,u=parse(t).points.split(" "),h=0;h<u.length;h++)l=u[h].split(","),e[i].push({x:+l[0],y:+l[1]});break;case"properties":e.properties=parse(t);break;case"property":var c=parse(t),d=void 0!==c.value?c.value:c.text;e[c.name]=setTMXValue(c.name,c.type||"string",d);break;default:e[i]=parse(t)}}function parse(e){var t={},i="";if(1===e.nodeType&&parseAttributes(t,e),e.hasChildNodes())for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes.item(n);switch(r.nodeType){case 1:normalize(t,r);break;case 3:i+=r.nodeValue.trim()}}return i&&(t.text=i),t}function applyTMXProperties(e,t){var i=t.properties,n=t.propertytypes;if(void 0!==i)for(var r in i)if(i.hasOwnProperty(r)){var o="string",s=r,a=i[r];void 0!==i[r].name&&(s=i[r].name),void 0!==n?o=n[r]:void 0!==i[r].type&&(o=i[r].type),void 0!==i[r].value&&(a=i[r].value),e[s]=setTMXValue(s,o,a)}}var src={},arraymultimap={},multimap={},__generator=commonjsGlobal&&commonjsGlobal.__generator||function(e,t){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},__values=commonjsGlobal&&commonjsGlobal.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=commonjsGlobal&&commonjsGlobal.__read||function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,o=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s};Object.defineProperty(multimap,"__esModule",{value:!0}),multimap.Multimap=void 0;var Multimap=function(){function e(e,t){var i,n;if(this.size_=0,this.map=new Map,this.operator=e,t)try{for(var r=__values(t),o=r.next();!o.done;o=r.next()){var s=__read(o.value,2),a=s[0],l=s[1];this.put(a,l)}}catch(e){i={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return this}return Object.defineProperty(e.prototype,"size",{get:function(){return this.size_},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=this.map.get(e);return t?this.operator.clone(t):this.operator.create()},e.prototype.put=function(e,t){var i=this.map.get(e);return i||(i=this.operator.create()),!!this.operator.add(t,i)&&(this.map.set(e,i),this.size_++,!0)},e.prototype.putAll=function(t,i){var n,r,o,s,a=0;if(i){var l=t,u=i;try{for(var h=__values(u),c=h.next();!c.done;c=h.next()){var d=c.value;this.put(l,d),a++}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}}else{if(!(t instanceof e))throw new TypeError("unexpected arguments");try{for(var f=__values(t.entries()),p=f.next();!p.done;p=f.next()){var v=__read(p.value,2);l=v[0],d=v[1],this.put(l,d),a++}}catch(e){o={error:e}}finally{try{p&&!p.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}return a>0},e.prototype.has=function(e){return this.map.has(e)},e.prototype.hasEntry=function(e,t){return this.operator.has(t,this.get(e))},e.prototype.delete=function(e){return this.size_-=this.operator.size(this.get(e)),this.map.delete(e)},e.prototype.deleteEntry=function(e,t){var i=this.get(e);return!!this.operator.delete(t,i)&&(this.map.set(e,i),this.size_--,!0)},e.prototype.clear=function(){this.map.clear(),this.size_=0},e.prototype.keys=function(){return this.map.keys()},e.prototype.entries=function(){var e=this;return function(){var t,i,n,r,o,s,a,l,u,h,c,d,f,p;return __generator(this,(function(v){switch(v.label){case 0:v.trys.push([0,11,12,13]),t=__values(e.map.entries()),i=t.next(),v.label=1;case 1:if(i.done)return[3,10];n=__read(i.value,2),r=n[0],o=n[1],v.label=2;case 2:v.trys.push([2,7,8,9]),f=void 0,s=__values(o),a=s.next(),v.label=3;case 3:return a.done?[3,6]:(l=a.value,[4,[r,l]]);case 4:v.sent(),v.label=5;case 5:return a=s.next(),[3,3];case 6:return[3,9];case 7:return u=v.sent(),f={error:u},[3,9];case 8:try{a&&!a.done&&(p=s.return)&&p.call(s)}finally{if(f)throw f.error}return[7];case 9:return i=t.next(),[3,1];case 10:return[3,13];case 11:return h=v.sent(),c={error:h},[3,13];case 12:try{i&&!i.done&&(d=t.return)&&d.call(t)}finally{if(c)throw c.error}return[7];case 13:return[2]}}))}()},e.prototype.values=function(){var e=this;return function(){var t,i,n,r,o;return __generator(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,6,7]),t=__values(e.entries()),i=t.next(),s.label=1;case 1:return i.done?[3,4]:[4,__read(i.value,2)[1]];case 2:s.sent(),s.label=3;case 3:return i=t.next(),[3,1];case 4:return[3,7];case 5:return n=s.sent(),r={error:n},[3,7];case 6:try{i&&!i.done&&(o=t.return)&&o.call(t)}finally{if(r)throw r.error}return[7];case 7:return[2]}}))}()},e.prototype.forEach=function(e,t){var i,n;try{for(var r=__values(this.entries()),o=r.next();!o.done;o=r.next()){var s=__read(o.value,2),a=s[0],l=s[1];e.call(void 0===t?this:t,l,a,this)}}catch(e){i={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}},e.prototype[Symbol.iterator]=function(){return this.entries()},e.prototype.asMap=function(){var e,t,i=new Map;try{for(var n=__values(this.keys()),r=n.next();!r.done;r=n.next()){var o=r.value;i.set(o,this.operator.clone(this.get(o)))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return i},e}();multimap.Multimap=Multimap;var __extends$1=commonjsGlobal&&commonjsGlobal.__extends||(_extendStatics=function(e,t){return _extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},_extendStatics(e,t)},function(e,t){function i(){this.constructor=e}_extendStatics(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),_extendStatics;Object.defineProperty(arraymultimap,"__esModule",{value:!0}),arraymultimap.ArrayMultimap=void 0;var multimap_1$1=multimap,ArrayMultimap=function(e){function t(t){return e.call(this,new ArrayOperator,t)||this}return __extends$1(t,e),Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return"ArrayMultimap"},enumerable:!1,configurable:!0}),t}(multimap_1$1.Multimap);arraymultimap.ArrayMultimap=ArrayMultimap;var ArrayOperator=function(){function e(){}return e.prototype.create=function(){return[]},e.prototype.clone=function(e){return e.slice()},e.prototype.add=function(e,t){return t.push(e),!0},e.prototype.size=function(e){return e.length},e.prototype.delete=function(e,t){var i=t.indexOf(e);return i>-1&&(t.splice(i,1),!0)},e.prototype.has=function(e,t){return t.includes(e)},e}(),setmultimap={},__extends=commonjsGlobal&&commonjsGlobal.__extends||(_extendStatics2=function(e,t){return _extendStatics2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},_extendStatics2(e,t)},function(e,t){function i(){this.constructor=e}_extendStatics2(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),_extendStatics2;Object.defineProperty(setmultimap,"__esModule",{value:!0}),setmultimap.SetMultimap=void 0;var multimap_1=multimap,SetMultimap=function(e){function t(t){return e.call(this,new SetOperator,t)||this}return __extends(t,e),Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return"SetMultimap"},enumerable:!1,configurable:!0}),t}(multimap_1.Multimap);setmultimap.SetMultimap=SetMultimap;var SetOperator=function(){function e(){}return e.prototype.create=function(){return new Set},e.prototype.clone=function(e){return new Set(e)},e.prototype.add=function(e,t){var i=t.size;return t.add(e),i!==t.size},e.prototype.size=function(e){return e.size},e.prototype.delete=function(e,t){return t.delete(e)},e.prototype.has=function(e,t){return t.has(e)},e}();!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SetMultimap=e.ArrayMultimap=void 0;var t=arraymultimap;Object.defineProperty(e,"ArrayMultimap",{enumerable:!0,get:function(){return t.ArrayMultimap}});var i=setmultimap;Object.defineProperty(e,"SetMultimap",{enumerable:!0,get:function(){return i.SetMultimap}})}(src);var TextureCache=function(){function e(t){_classCallCheck(this,e),this.cache=new src.ArrayMultimap,this.tinted=new Map,this.units=new Map,this.max_size=t||1/0,this.clear()}return _createClass(e,[{key:"clear",value:function(){this.cache.clear(),this.tinted.clear(),this.units.clear(),this.length=0}},{key:"validate",value:function(){if(this.length>=this.max_size)throw new Error("Texture cache overflow: "+this.max_size+" texture units available for this GPU.")}},{key:"get",value:function(e,t){var i;return void 0===t?i=this.cache.get(e)[0]:this.cache.forEach((function(n,r){var o=n.getAtlas();r===e&&o[0].width===t.framewidth&&o[0].height===t.frameheight&&(i=n)})),void 0===i&&(t||(t=createAtlas(e.width,e.height,e.src?getBasename(e.src):void 0)),i=new TextureAtlas(t,e,!1),this.set(e,i)),i}},{key:"delete",value:function(e){this.cache.has(e)||this.cache.delete(e)}},{key:"tint",value:function(e,t){var i=this.tinted.get(e);return void 0===i&&(i=this.tinted.set(e,new Map)),i.has(t)||i.set(t,renderer.tint(e,t,"multiply")),i.get(t)}},{key:"set",value:function(e,t){var i=e.width,n=e.height;if(!(1!==renderer.WebGLVersion||isPowerOfTwo(i)&&isPowerOfTwo(n))){var r=void 0!==e.src?e.src:e;console.warn("[Texture] "+r+" is not a POT texture ("+i+"x"+n+")")}return this.cache.put(e,t)}},{key:"getUnit",value:function(e){return this.units.has(e)||(this.validate(),this.units.set(e,this.length++)),this.units.get(e)}}]),e}();function createAtlas(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"no-repeat";return{meta:{app:"melonJS",size:{w:e,h:t},repeat:n,image:"default"},frames:[{filename:i,frame:{x:0,y:0,w:e,h:t}}]}}var TextureAtlas=function(){function e(t,i,n){var r=this;if(_classCallCheck(this,e),this.format=null,this.sources=new Map,this.atlases=new Map,void 0!==t)for(var o in t=Array.isArray(t)?t:[t]){var s=t[o];if(void 0!==s.meta){if(s.meta.app.includes("texturepacker")||s.meta.app.includes("free-tex-packer")){if(this.format="texturepacker",void 0===i){var a=loader.getImage(s.meta.image);if(!a)throw new Error("Atlas texture '"+a+"' not found");this.sources.set(s.meta.image,a)}else this.sources.set(s.meta.image||"default","string"==typeof i?loader.getImage(i):i);this.repeat="no-repeat"}else if(s.meta.app.includes("ShoeBox")){if(!s.meta.exporter||!s.meta.exporter.includes("melonJS"))throw new Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx");this.format="ShoeBox",this.repeat="no-repeat",this.sources.set("default","string"==typeof i?loader.getImage(i):i)}else s.meta.app.includes("melonJS")&&(this.format="melonJS",this.repeat=s.meta.repeat||"no-repeat",this.sources.set("default","string"==typeof i?loader.getImage(i):i));this.atlases.set(s.meta.image||"default",this.parse(s))}else void 0!==s.framewidth&&void 0!==s.frameheight&&(this.format="Spritesheet (fixed cell size)",this.repeat="no-repeat",void 0!==i&&(s.image="string"==typeof i?loader.getImage(i):i),this.atlases.set("default",this.parseFromSpriteSheet(s)),this.sources.set("default",s.image))}if(0===this.atlases.length)throw new Error("texture atlas format not supported");!1!==n&&this.sources.forEach((function(e){n instanceof TextureCache?n.set(e,r):renderer.cache.set(e,r)}))}return _createClass(e,[{key:"parse",value:function(e){var t=this,i={};return e.frames.forEach((function(n){if(n.hasOwnProperty("filename")){var r,o,s=n.frame,a=n.spriteSourceSize&&n.sourceSize&&n.pivot;a&&(r=n.sourceSize.w*n.pivot.x-(n.trimmed?n.spriteSourceSize.x:0),o=n.sourceSize.h*n.pivot.y-(n.trimmed?n.spriteSourceSize.y:0)),i[n.filename]={name:n.filename,texture:e.meta.image||"default",offset:new Vector2d(s.x,s.y),anchorPoint:a?new Vector2d(r/s.w,o/s.h):null,trimmed:!!n.trimmed,width:s.w,height:s.h,angle:!0===n.rotated?-ETA:0},t.addUVs(i,n.filename,e.meta.size.w,e.meta.size.h)}})),i}},{key:"parseFromSpriteSheet",value:function(e){var t={},i=e.image,n=e.spacing||0,r=e.margin||0,o=i.width,s=i.height,a=pool.pull("Vector2d",~~((o-r+n)/(e.framewidth+n)),~~((s-r+n)/(e.frameheight+n)));if(o%(e.framewidth+n)!=0||s%(e.frameheight+n)!=0){var l=a.x*(e.framewidth+n),u=a.y*(e.frameheight+n);l-o!==n&&u-s!==n&&(o=l,s=u,console.warn("Spritesheet Texture for image: "+i.src+" is not divisible by "+(e.framewidth+n)+"x"+(e.frameheight+n)+", truncating effective size to "+o+"x"+s))}for(var h=0,c=a.x*a.y;h<c;h++){var d=""+h;t[d]={name:d,texture:"default",offset:new Vector2d(r+(n+e.framewidth)*(h%a.x),r+(n+e.frameheight)*~~(h/a.x)),anchorPoint:e.anchorPoint||null,trimmed:!1,width:e.framewidth,height:e.frameheight,angle:0},this.addUVs(t,d,o,s)}return pool.push(a),t}},{key:"getAtlas",value:function(e){return"string"==typeof e?this.atlases.get(e):this.atlases.values().next().value}},{key:"getFormat",value:function(){return this.format}},{key:"getTexture",value:function(e){return"object"===_typeof(e)&&"string"==typeof e.texture?this.sources.get(e.texture):this.sources.values().next().value}},{key:"addRegion",value:function(e,t,i,n,r){!0===renderer.settings.verbose&&console.warn("Adding texture region",e,"for texture",this);var o=this.getTexture(),s=this.getAtlas(),a=o.width,l=o.height;return s[e]={name:e,offset:new Vector2d(t,i),width:n,height:r,angle:0},this.addUVs(s,e,a,l),s[e]}},{key:"getRegion",value:function(e,t){var i;return"string"==typeof t?i=this.getAtlas(t)[e]:this.atlases.forEach((function(t){void 0!==t[e]&&(i=t[e])})),i}},{key:"getUVs",value:function(e){var t=this.getRegion(e);if(void 0===t){var i=e.split(","),n=+i[0],r=+i[1],o=+i[2],s=+i[3];t=this.addRegion(e,n,r,o,s)}return t.uvs}},{key:"addUVs",value:function(e,t,i,n){if(renderer instanceof WebGLRenderer){var r=e[t].offset,o=e[t].width,s=e[t].height;e[t].uvs=new Float32Array([r.x/i,r.y/n,(r.x+o)/i,(r.y+s)/n]),e[r.x+","+r.y+","+i+","+n]=e[t]}return e[t].uvs}},{key:"createSpriteFromName",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return pool.pull(!0===i?"me.NineSliceSprite":"me.Sprite",0,0,Object.assign({image:this,region:e},t||{}))}},{key:"createAnimationFromName",value:function(e,t){for(var i,n=[],r={},o=0,s=0,a=0;a<e.length;++a){if(null==(i=this.getRegion(e[a])))throw new Error("Texture - region for "+e[a]+" not found");n[a]=i,r[e[a]]=a,o=Math.max(i.width,o),s=Math.max(i.height,s)}return new Sprite(0,0,Object.assign({image:this,framewidth:o,frameheight:s,margin:0,spacing:0,atlas:n,atlasIndices:r},t||{}))}}]),e}(),Sprite=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var o;if(_classCallCheck(this,i),(o=t.call(this,e,n,0,0)).animationpause=!1,o.animationspeed=100,o.offset=pool.pull("Vector2d",0,0),o.source=null,o.anim={},o.resetAnim=void 0,o.current={name:"default",length:0,offset:new Vector2d,width:0,height:0,angle:0,idx:0},o.dt=0,o._flicker={isFlickering:!1,duration:0,callback:null,state:!1},r.image instanceof TextureAtlas){if(o.source=r.image,o.image=o.source.getTexture(),o.textureAtlas=r.image,void 0!==r.region){var s=o.source.getRegion(r.region);if(!s)throw new Error("Texture - region for "+r.region+" not found");o.setRegion(s),o.current.width=r.framewidth||s.width,o.current.height=r.frameheight||s.height}}else{if(o.image="object"===_typeof(r.image)?r.image:loader.getImage(r.image),!o.image)throw new Error("me.Sprite: '"+r.image+"' image/texture not found!");o.current.width=r.framewidth=r.framewidth||o.image.width,o.current.height=r.frameheight=r.frameheight||o.image.height,o.source=renderer.cache.get(o.image,r),o.textureAtlas=o.source.getAtlas()}return void 0!==r.atlas&&(o.textureAtlas=r.atlas,o.atlasIndices=r.atlasIndices),o.width=o.current.width,o.height=o.current.height,void 0!==r.flipX&&o.flipX(!!r.flipX),void 0!==r.flipY&&o.flipY(!!r.flipY),void 0!==r.rotation&&o.rotate(r.rotation),r.anchorPoint&&o.anchorPoint.set(r.anchorPoint.x,r.anchorPoint.y),void 0!==r.tint&&o.tint.setColor(r.tint),"string"==typeof r.name&&(o.name=r.name),void 0!==r.z&&(o.pos.z=r.z),0!==o.addAnimation("default",null)&&o.setCurrentAnimation("default"),o.autoTransform=!0,o}return _createClass(i,[{key:"isFlickering",value:function(){return this._flicker.isFlickering}},{key:"flicker",value:function(e,t){return this._flicker.duration=e,this._flicker.duration<=0?(this._flicker.isFlickering=!1,this._flicker.callback=null):this._flicker.isFlickering||(this._flicker.callback=t,this._flicker.isFlickering=!0),this}},{key:"addAnimation",value:function(e,t,i){this.anim[e]={name:e,frames:[],idx:0,length:0};var n=0;if("object"!==_typeof(this.textureAtlas))return 0;null==t&&(t=[],Object.keys(this.textureAtlas).forEach((function(e,i){t[i]=i})));for(var r=0,o=t.length;r<o;r++){var s,a=t[r],l=(s="number"==typeof a||"string"==typeof a?{name:a,delay:i||this.animationspeed}:a).name;if("number"==typeof l)void 0!==this.textureAtlas[l]&&(this.anim[e].frames[r]=Object.assign({},this.textureAtlas[l],s),n++);else{if(this.source.getFormat().includes("Spritesheet"))throw new Error("string parameters for addAnimation are not allowed for standard spritesheet based Texture");this.anim[e].frames[r]=Object.assign({},this.textureAtlas[this.atlasIndices[l]],s),n++}}return this.anim[e].length=n,n}},{key:"setCurrentAnimation",value:function(e,t,i){if(!this.anim[e])throw new Error("animation id '"+e+"' not defined");return this.current.name=e,this.current.length=this.anim[this.current.name].length,this.resetAnim="string"==typeof t?this.setCurrentAnimation.bind(this,t,null,!0):"function"==typeof t?t:void 0,this.setAnimationFrame(this.current.idx),i||(this.dt=0),this.isDirty=!0,this}},{key:"reverseAnimation",value:function(e){return void 0!==e&&void 0!==this.anim[e]?this.anim[e].frames.reverse():this.anim[this.current.name].frames.reverse(),this.isDirty=!0,this}},{key:"isCurrentAnimation",value:function(e){return this.current.name===e}},{key:"setRegion",value:function(e){return this.image=this.source.getTexture(e),this.current.offset.setV(e.offset),this.current.angle=e.angle,this.width=this.current.width=e.width,this.height=this.current.height=e.height,e.anchorPoint&&this.anchorPoint.set(this._flip.x&&!0===e.trimmed?1-e.anchorPoint.x:e.anchorPoint.x,this._flip.y&&!0===e.trimmed?1-e.anchorPoint.y:e.anchorPoint.y),this.isDirty=!0,this}},{key:"setAnimationFrame",value:function(e){return this.current.idx=(e||0)%this.current.length,this.setRegion(this.getAnimationFrameObjectByIndex(this.current.idx))}},{key:"getCurrentAnimationFrame",value:function(){return this.current.idx}},{key:"getAnimationFrameObjectByIndex",value:function(e){return this.anim[this.current.name].frames[e]}},{key:"update",value:function(e){if(!this.animationpause&&this.current&&this.current.length>0){var t=this.getAnimationFrameObjectByIndex(this.current.idx).delay;for(this.dt+=e;this.dt>=t;){this.isDirty=!0,this.dt-=t;var i=this.current.length>1?this.current.idx+1:this.current.idx;if(this.setAnimationFrame(i),0===this.current.idx&&"function"==typeof this.resetAnim&&!1===this.resetAnim()){this.setAnimationFrame(this.current.length-1),this.dt%=t;break}t=this.getAnimationFrameObjectByIndex(this.current.idx).delay}}return this._flicker.isFlickering&&(this._flicker.duration-=e,this._flicker.duration<0&&("function"==typeof this._flicker.callback&&this._flicker.callback(),this.flicker(-1)),this.isDirty=!0),this.isDirty}},{key:"destroy",value:function(){pool.push(this.offset),this.offset=void 0,_get(_getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"draw",value:function(e){if(!this._flicker.isFlickering||(this._flicker.state=!this._flicker.state,this._flicker.state)){var t=this.current,i=this.pos.x,n=this.pos.y,r=t.width,o=t.height,s=t.offset,a=this.offset;0!==t.angle&&(e.translate(-i,-n),e.rotate(t.angle),i-=o,r=t.height,o=t.width),e.drawImage(this.image,a.x+s.x,a.y+s.y,r,o,i,n,r,o)}}}]),i}(Renderable),TMX_FLIP_H=2147483648,TMX_FLIP_V=1073741824,TMX_FLIP_AD=536870912,TMX_CLEAR_BIT_MASK$1=536870911,Tile=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,o){var s,a,l;if(_classCallCheck(this,i),s=t.call(this),o.isCollection){var u=o.getTileImage(r&TMX_CLEAR_BIT_MASK$1);a=u.width,l=u.height}else a=o.tilewidth,l=o.tileheight;return s.setMinMax(0,0,a,l),s.tileset=o,s.currentTransform=null,s.col=e,s.row=n,s.tileId=r,s.flippedX=0!=(s.tileId&TMX_FLIP_H),s.flippedY=0!=(s.tileId&TMX_FLIP_V),s.flippedAD=0!=(s.tileId&TMX_FLIP_AD),s.flipped=s.flippedX||s.flippedY||s.flippedAD,!0===s.flipped&&(null===s.currentTransform&&(s.currentTransform=new Matrix2d),s.setTileTransform(s.currentTransform.identity())),s.tileId&=TMX_CLEAR_BIT_MASK$1,s}return _createClass(i,[{key:"setTileTransform",value:function(e){e.translate(this.width/2,this.height/2),this.flippedAD&&(e.rotate(-90*Math.PI/180),e.scale(-1,1)),this.flippedX&&e.scale(this.flippedAD?1:-1,this.flippedAD?-1:1),this.flippedY&&e.scale(this.flippedAD?-1:1,this.flippedAD?1:-1),e.translate(-this.width/2,-this.height/2)}},{key:"getRenderable",value:function(e){var t,i=this.tileset;if(i.animations.has(this.tileId)){var n=[],r=[];i.animations.get(this.tileId).frames.forEach((function(e){r.push(e.tileid),n.push({name:""+e.tileid,delay:e.duration})})),(t=i.texture.createAnimationFromName(r,e)).addAnimation(this.tileId-i.firstgid,n),t.setCurrentAnimation(this.tileId-i.firstgid)}else if(!0===i.isCollection){var o=i.getTileImage(this.tileId);(t=new Sprite(0,0,Object.assign({image:o}))).anchorPoint.set(0,0),t.scale(e.width/this.width,e.height/this.height),void 0!==e.rotation&&(t.anchorPoint.set(.5,.5),t.currentTransform.rotate(e.rotation),t.currentTransform.translate(e.width/2,e.height/2),e.rotation=void 0)}else(t=i.texture.createSpriteFromName(this.tileId-i.firstgid,e)).anchorPoint.set(0,0);return this.setTileTransform(t.currentTransform),t}}]),i}(Bounds$1),Line=function(e){_inherits(i,e);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"contains",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),e-=this.pos.x,t-=this.pos.y;var i=this.points[0],n=this.points[1];return(t-i.y)*(n.x-i.x)==(n.y-i.y)*(e-i.x)}},{key:"recalc",value:function(){var e=this.edges,t=this.normals,i=this.indices,n=this.points;if(2!==n.length)throw new Error("Requires exactly 2 points");return void 0===e[0]&&(e[0]=new Vector2d),e[0].copy(n[1]).sub(n[0]),void 0===t[0]&&(t[0]=new Vector2d),t[0].copy(e[0]).perp().normalize(),i.length=0,this}},{key:"clone",value:function(){var e=[];return this.points.forEach((function(t){e.push(t.clone())})),new i(this.pos.x,this.pos.y,e)}}]),i}(Polygon),Renderer=function(){function e(t){return _classCallCheck(this,e),this.settings=t,this.isContextValid=!0,this.currentScissor=new Int32Array([0,0,this.settings.width,this.settings.height]),this.currentBlendMode="normal",!0===device$1.ejecta?this.canvas=document.getElementById("canvas"):void 0!==window.canvas?this.canvas=window.canvas:void 0!==this.settings.canvas?this.canvas=this.settings.canvas:this.canvas=createCanvas(this.settings.zoomX,this.settings.zoomY),this.backBufferCanvas=this.canvas,this.context=null,this.currentColor=new Color(0,0,0,1),this.currentTint=new Color(255,255,255,1),this.projectionMatrix=new Matrix3d,this.uvOffset=0,on(GAME_RESET,(function(){renderer.reset()})),this}return _createClass(e,[{key:"clear",value:function(){}},{key:"reset",value:function(){this.resetTransform(),this.setBlendMode(this.settings.blendMode),this.setColor("#000000"),this.clearTint(),this.cache.clear(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.backBufferCanvas.width,this.currentScissor[3]=this.backBufferCanvas.height}},{key:"getCanvas",value:function(){return this.backBufferCanvas}},{key:"getScreenCanvas",value:function(){return this.canvas}},{key:"getScreenContext",value:function(){return this.context}},{key:"getBlendMode",value:function(){return this.currentBlendMode}},{key:"getContext2d",value:function(e,t){if(null==e)throw new Error("You must pass a canvas element in order to create a 2d context");if(void 0===e.getContext)throw new Error("Your browser does not support HTML5 canvas.");"boolean"!=typeof t&&(t=!0);var i=e.getContext("2d",{alpha:t});return i.canvas||(i.canvas=e),this.setAntiAlias(i,this.settings.antiAlias),i}},{key:"getWidth",value:function(){return this.backBufferCanvas.width}},{key:"getHeight",value:function(){return this.backBufferCanvas.height}},{key:"getColor",value:function(){return this.currentColor}},{key:"globalAlpha",value:function(){return this.currentColor.glArray[3]}},{key:"overlaps",value:function(e){return e.left<=this.getWidth()&&e.right>=0&&e.top<=this.getHeight()&&e.bottom>=0}},{key:"resize",value:function(e,t){e===this.backBufferCanvas.width&&t===this.backBufferCanvas.height||(this.canvas.width=this.backBufferCanvas.width=e,this.canvas.height=this.backBufferCanvas.height=t,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=e,this.currentScissor[3]=t,emit(CANVAS_ONRESIZE,e,t))}},{key:"setAntiAlias",value:function(e,t){var i=e.canvas;setPrefixed("imageSmoothingEnabled",!0===t,e),!0!==t?(i.style["image-rendering"]="optimizeSpeed",i.style["image-rendering"]="-moz-crisp-edges",i.style["image-rendering"]="-o-crisp-edges",i.style["image-rendering"]="-webkit-optimize-contrast",i.style["image-rendering"]="optimize-contrast",i.style["image-rendering"]="crisp-edges",i.style["image-rendering"]="pixelated",i.style.msInterpolationMode="nearest-neighbor"):i.style["image-rendering"]="auto"}},{key:"setProjection",value:function(e){this.projectionMatrix.copy(e)}},{key:"stroke",value:function(e,t){e instanceof Rect||e instanceof Bounds$1?this.strokeRect(e.left,e.top,e.width,e.height,t):e instanceof Line||e instanceof Polygon?this.strokePolygon(e,t):e instanceof Ellipse&&this.strokeEllipse(e.pos.x,e.pos.y,e.radiusV.x,e.radiusV.y,t)}},{key:"tint",value:function(e,t,i){var n=createCanvas(e.width,e.height,!0),r=this.getContext2d(n);return r.save(),r.fillStyle=t instanceof Color?t.toRGB():t,r.fillRect(0,0,e.width,e.height),r.globalCompositeOperation=i||"multiply",r.drawImage(e,0,0),r.globalCompositeOperation="destination-atop",r.drawImage(e,0,0),r.restore(),n}},{key:"fill",value:function(e){this.stroke(e,!0)}},{key:"setMask",value:function(e){}},{key:"clearMask",value:function(){}},{key:"setTint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.alpha;this.currentTint.copy(e),this.currentTint.alpha*=t}},{key:"clearTint",value:function(){this.currentTint.setColor(255,255,255,1)}},{key:"drawFont",value:function(){}}]),e}(),CanvasRenderer=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var n;return _classCallCheck(this,i),(n=t.call(this,e)).context=n.getContext2d(n.getScreenCanvas(),n.settings.transparent),n.settings.doubleBuffering?(n.backBufferCanvas=createCanvas(n.settings.width,n.settings.height,!0),n.backBufferContext2D=n.getContext2d(n.backBufferCanvas)):(n.backBufferCanvas=n.getScreenCanvas(),n.backBufferContext2D=n.context),n.setBlendMode(n.settings.blendMode),n.setColor(n.currentColor),n.cache=new TextureCache,!1===n.settings.textureSeamFix||n.settings.antiAlias||(n.uvOffset=1),_possibleConstructorReturn(n,_assertThisInitialized(n))}return _createClass(i,[{key:"reset",value:function(){_get(_getPrototypeOf(i.prototype),"reset",this).call(this),this.clearColor(this.currentColor,!0!==this.settings.transparent)}},{key:"resetTransform",value:function(){this.backBufferContext2D.setTransform(1,0,0,1,0,0)}},{key:"setBlendMode",value:function(e,t){t=t||this.getContext(),this.currentBlendMode=e,"multiply"===e?t.globalCompositeOperation="multiply":(t.globalCompositeOperation="source-over",this.currentBlendMode="normal"),this.settings.doubleBuffering&&this.settings.transparent&&(this.context.globalCompositeOperation="copy")}},{key:"clear",value:function(){this.settings.transparent&&this.clearColor("rgba(0,0,0,0)",!0)}},{key:"flush",value:function(){this.settings.doubleBuffering&&this.context.drawImage(this.backBufferCanvas,0,0)}},{key:"clearColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#000000",t=arguments.length>1?arguments[1]:void 0;this.save(),this.resetTransform(),this.backBufferContext2D.globalCompositeOperation=t?"copy":"source-over",this.backBufferContext2D.fillStyle=e instanceof Color?e.toRGBA():e,this.fillRect(0,0,this.backBufferCanvas.width,this.backBufferCanvas.height),this.restore()}},{key:"clearRect",value:function(e,t,i,n){this.backBufferContext2D.clearRect(e,t,i,n)}},{key:"createPattern",value:function(e,t){return this.backBufferContext2D.createPattern(e,t)}},{key:"drawImage",value:function(e,t,i,n,r,o,s,a,l){if(!(this.backBufferContext2D.globalAlpha<1/255)){void 0===n?(n=a=e.width,r=l=e.height,o=t,s=i,t=0,i=0):void 0===o&&(o=t,s=i,a=n,l=r,n=e.width,r=e.height,t=0,i=0),!1===this.settings.subPixel&&(o=~~o,s=~~s);var u=e,h=this.currentTint.toArray();1===h[0]&&1===h[1]&&1===h[2]||(u=this.cache.tint(e,this.currentTint.toRGB())),this.backBufferContext2D.drawImage(u,t,i,n,r,o,s,a,l)}}},{key:"drawPattern",value:function(e,t,i,n,r){if(!(this.backBufferContext2D.globalAlpha<1/255)){var o=this.backBufferContext2D.fillStyle;this.backBufferContext2D.fillStyle=e,this.backBufferContext2D.fillRect(t,i,n,r),this.backBufferContext2D.fillStyle=o}}},{key:"strokeArc",value:function(e,t,i,n,r,o){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=this.backBufferContext2D;a.globalAlpha<1/255||(a.translate(e,t),a.beginPath(),a.arc(0,0,i,n,r,o||!1),a[!0===s?"fill":"stroke"](),a.translate(-e,-t))}},{key:"fillArc",value:function(e,t,i,n,r,o){this.strokeArc(e,t,i,n,r,o||!1,!0)}},{key:"strokeEllipse",value:function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.backBufferContext2D;if(!(o.globalAlpha<1/255)){var s=i,a=n,l=e-s,u=e+s,h=t-a,c=t+a,d=.551784*s,f=.551784*a,p=e-d,v=e+d,y=t-f,g=t+f;o.beginPath(),o.moveTo(e,h),o.bezierCurveTo(v,h,u,y,u,t),o.bezierCurveTo(u,g,v,c,e,c),o.bezierCurveTo(p,c,l,g,l,t),o.bezierCurveTo(l,y,p,h,e,h),o[!0===r?"fill":"stroke"](),o.closePath()}}},{key:"fillEllipse",value:function(e,t,i,n){this.strokeEllipse(e,t,i,n,!0)}},{key:"strokeLine",value:function(e,t,i,n){var r=this.backBufferContext2D;r<1/255||(r.beginPath(),r.moveTo(e,t),r.lineTo(i,n),r.stroke())}},{key:"fillLine",value:function(e,t,i,n){this.strokeLine(e,t,i,n)}},{key:"strokePolygon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.backBufferContext2D;if(!(i.globalAlpha<1/255)){var n;this.translate(e.pos.x,e.pos.y),i.beginPath(),i.moveTo(e.points[0].x,e.points[0].y);for(var r=1;r<e.points.length;r++)n=e.points[r],i.lineTo(n.x,n.y);i.lineTo(e.points[0].x,e.points[0].y),i[!0===t?"fill":"stroke"](),i.closePath(),this.translate(-e.pos.x,-e.pos.y)}}},{key:"fillPolygon",value:function(e){this.strokePolygon(e,!0)}},{key:"strokeRect",value:function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!0===r)this.fillRect(e,t,i,n);else{if(this.backBufferContext2D.globalAlpha<1/255)return;this.backBufferContext2D.strokeRect(e,t,i,n)}}},{key:"fillRect",value:function(e,t,i,n){this.backBufferContext2D.globalAlpha<1/255||this.backBufferContext2D.fillRect(e,t,i,n)}},{key:"getContext",value:function(){return this.backBufferContext2D}},{key:"getFontContext",value:function(){return this.getContext()}},{key:"save",value:function(){this.backBufferContext2D.save()}},{key:"restore",value:function(){this.backBufferContext2D.restore(),this.currentColor.glArray[3]=this.backBufferContext2D.globalAlpha,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.backBufferCanvas.width,this.currentScissor[3]=this.backBufferCanvas.height}},{key:"rotate",value:function(e){this.backBufferContext2D.rotate(e)}},{key:"scale",value:function(e,t){this.backBufferContext2D.scale(e,t)}},{key:"setColor",value:function(e){this.backBufferContext2D.strokeStyle=this.backBufferContext2D.fillStyle=e instanceof Color?e.toRGBA():e}},{key:"setGlobalAlpha",value:function(e){this.backBufferContext2D.globalAlpha=this.currentColor.glArray[3]=e}},{key:"setLineWidth",value:function(e){this.backBufferContext2D.lineWidth=e}},{key:"setTransform",value:function(e){this.resetTransform(),this.transform(e)}},{key:"transform",value:function(e){var t=e.toArray(),i=t[0],n=t[1],r=t[3],o=t[4],s=t[6],a=t[7];!1===this.settings.subPixel&&(s|=0,a|=0),this.backBufferContext2D.transform(i,n,r,o,s,a)}},{key:"translate",value:function(e,t){!1===this.settings.subPixel?this.backBufferContext2D.translate(~~e,~~t):this.backBufferContext2D.translate(e,t)}},{key:"clipRect",value:function(e,t,i,n){var r=this.backBufferCanvas;if(0!==e||0!==t||i!==r.width||n!==r.height){var o=this.currentScissor;if(o[0]!==e||o[1]!==t||o[2]!==i||o[3]!==n){var s=this.backBufferContext2D;s.beginPath(),s.rect(e,t,i,n),s.clip(),o[0]=e,o[1]=t,o[2]=i,o[3]=n}}}},{key:"setMask",value:function(e){var t=this.backBufferContext2D,i=e.pos.x,n=e.pos.y;if(t.save(),e instanceof Ellipse){var r=e.radiusV.x,o=e.radiusV.y,s=i-r,a=i+r,l=n-o,u=n+o,h=.551784*r,c=.551784*o,d=i-h,f=i+h,p=n-c,v=n+c;t.beginPath(),t.moveTo(i,l),t.bezierCurveTo(f,l,a,p,a,n),t.bezierCurveTo(a,v,f,u,i,u),t.bezierCurveTo(d,u,s,v,s,n),t.bezierCurveTo(s,p,d,l,i,l)}else{var y;t.beginPath(),t.moveTo(i+e.points[0].x,n+e.points[0].y);for(var g=1;g<e.points.length;g++)y=e.points[g],t.lineTo(i+y.x,n+y.y)}t.clip()}},{key:"clearMask",value:function(){this.backBufferContext2D.restore()}}]),i}(Renderer);function initArray(e){e.layerData=new Array(e.cols);for(var t=0;t<e.cols;t++){e.layerData[t]=new Array(e.rows);for(var i=0;i<e.rows;i++)e.layerData[t][i]=null}}function setLayerData(e,t){var i=0;initArray(e);for(var n=0;n<e.rows;n++)for(var r=0;r<e.cols;r++){var o=t[i++];0!==o&&(e.layerData[r][n]=e.getTileById(o,r,n))}}function preRenderLayer(e,t){for(var i=0;i<e.rows;i++)for(var n=0;n<e.cols;n++){var r=e.layerData[n][i];r instanceof Tile&&e.getRenderer().drawTile(t,n,i,r)}}var TMXLayer=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,o,s,a,l){var u;_classCallCheck(this,i),(u=t.call(this,0,0,0,0)).tilewidth=n.tilewidth||r,u.tileheight=n.tileheight||o,u.orientation=s,u.tilesets=a,u.tileset=u.tilesets?u.tilesets.getTilesetByIndex(0):null,u.maxTileSize={width:0,height:0};for(var h=0;h<u.tilesets.length;h++){var c=u.tilesets.getTilesetByIndex(h);u.maxTileSize.width=Math.max(u.maxTileSize.width,c.tilewidth),u.maxTileSize.height=Math.max(u.maxTileSize.height,c.tileheight)}u.animatedTilesets=[],u.isAnimated=!1,u.renderorder=n.renderorder||"right-down",u.pos.z=l,u.anchorPoint.set(0,0),u.name=n.name,u.cols=+n.width,u.rows=+n.height;var d=void 0!==n.visible?+n.visible:1;return u.setOpacity(d?+n.opacity:0),"string"==typeof n.tintcolor&&u.tint.parseHex(n.tintcolor,!0),"isometric"===u.orientation?(u.width=(u.cols+u.rows)*(u.tilewidth/2),u.height=(u.cols+u.rows)*(u.tileheight/2)):(u.width=u.cols*u.tilewidth,u.height=u.rows*u.tileheight),applyTMXProperties(_assertThisInitialized(u),n),void 0===u.preRender&&(u.preRender=world.preRender),u.setRenderer(e.getRenderer()),setLayerData(_assertThisInitialized(u),decode(n.data,n.encoding,n.compression)),u}return _createClass(i,[{key:"onActivateEvent",value:function(){if(void 0===this.animatedTilesets&&(this.animatedTilesets=[]),this.tilesets)for(var e=this.tilesets.tilesets,t=0;t<e.length;t++)e[t].isAnimated&&this.animatedTilesets.push(e[t]);this.isAnimated=this.animatedTilesets.length>0,this.isAnimated&&(this.preRender=!1),this.getBounds().addBounds(this.getRenderer().getBounds(),!0),this.getBounds().shift(this.pos),!0!==this.preRender||this.canvasRenderer||(this.canvasRenderer=new CanvasRenderer({canvas:createCanvas(this.width,this.height),widht:this.width,heigth:this.height,transparent:!0}),preRenderLayer(this,this.canvasRenderer))}},{key:"onDeactivateEvent",value:function(){this.animatedTilesets=void 0}},{key:"setRenderer",value:function(e){this.renderer=e}},{key:"getRenderer",value:function(){return this.renderer}},{key:"getTileId",value:function(e,t){var i=this.getTile(e,t);return i?i.tileId:null}},{key:"getTile",value:function(e,t){var i=null;if(this.contains(e,t)){var n=this.getRenderer().pixelToTileCoords(e,t,pool.pull("Vector2d"));i=this.cellAt(n.x,n.y),pool.push(n)}return i}},{key:"setTile",value:function(e,t,i){return this.layerData[t][i]=e,e}},{key:"getTileById",value:function(e,t,i){return this.tileset.contains(e)||(this.tileset=this.tilesets.getTilesetByGid(e)),new Tile(t,i,e,this.tileset)}},{key:"cellAt",value:function(e,t,i){var n=~~e,r=~~t,o=this.getRenderer();return!1===i||n>=0&&n<o.cols&&r>=0&&r<o.rows?this.layerData[n][r]:null}},{key:"clearTile",value:function(e,t){this.layerData[e][t]=null,this.preRender&&this.canvasRenderer.clearRect(e*this.tilewidth,t*this.tileheight,this.tilewidth,this.tileheight)}},{key:"update",value:function(e){if(this.isAnimated){for(var t=!1,i=0;i<this.animatedTilesets.length;i++)t=this.animatedTilesets[i].update(e)||t;return t}return!1}},{key:"draw",value:function(e,t){if(this.preRender){var i=Math.min(t.width,this.width),n=Math.min(t.height,this.height);e.drawImage(this.canvasRenderer.getCanvas(),t.pos.x,t.pos.y,i,n,t.pos.x,t.pos.y,i,n)}else this.getRenderer().drawTileLayer(e,this,t)}}]),i}(Renderable),Bounds=function(){function e(t){_classCallCheck(this,e),this.onResetEvent(t)}return _createClass(e,[{key:"onResetEvent",value:function(e){void 0===this.min?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),void 0!==e&&this.update(e),this._center=new Vector2d}},{key:"clear",value:function(){this.setMinMax(1/0,1/0,-1/0,-1/0)}},{key:"setMinMax",value:function(e,t,i,n){this.min.x=e,this.min.y=t,this.max.x=i,this.max.y=n}},{key:"x",get:function(){return this.min.x},set:function(e){var t=this.max.x-this.min.x;this.min.x=e,this.max.x=e+t}},{key:"y",get:function(){return this.min.y},set:function(e){var t=this.max.y-this.min.y;this.min.y=e,this.max.y=e+t}},{key:"width",get:function(){return this.max.x-this.min.x},set:function(e){this.max.x=this.min.x+e}},{key:"height",get:function(){return this.max.y-this.min.y},set:function(e){this.max.y=this.min.y+e}},{key:"left",get:function(){return this.min.x}},{key:"right",get:function(){return this.max.x}},{key:"top",get:function(){return this.min.y}},{key:"bottom",get:function(){return this.max.y}},{key:"centerX",get:function(){return this.min.x+this.width/2}},{key:"centerY",get:function(){return this.min.y+this.height/2}},{key:"center",get:function(){return this._center.set(this.centerX,this.centerY)}},{key:"update",value:function(e){this.add(e,!0)}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t&&this.clear();for(var i=0;i<e.length;i++){var n=e[i];n.x>this.max.x&&(this.max.x=n.x),n.x<this.min.x&&(this.min.x=n.x),n.y>this.max.y&&(this.max.y=n.y),n.y<this.min.y&&(this.min.y=n.y)}}},{key:"addBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t&&this.clear(),e.max.x>this.max.x&&(this.max.x=e.max.x),e.min.x<this.min.x&&(this.min.x=e.min.x),e.max.y>this.max.y&&(this.max.y=e.max.y),e.min.y<this.min.y&&(this.min.y=e.min.y)}},{key:"addPoint",value:function(e,t){void 0!==t&&(e=t.apply(e)),this.min.x=Math.min(this.min.x,e.x),this.max.x=Math.max(this.max.x,e.x),this.min.y=Math.min(this.min.y,e.y),this.max.y=Math.max(this.max.y,e.y)}},{key:"addFrame",value:function(e,t,i,n,r){var o=me.pool.pull("Vector2d");this.addPoint(o.set(e,t),r),this.addPoint(o.set(i,t),r),this.addPoint(o.set(e,n),r),this.addPoint(o.set(i,n),r),me.pool.push(o)}},{key:"contains",value:function(){var t,i,n,r,o=arguments[0];return 2===arguments.length?(t=i=o,n=r=arguments[1]):o instanceof e?(t=o.min.x,i=o.max.x,n=o.min.y,r=o.max.y):(t=i=o.x,n=r=o.y),t>=this.min.x&&i<=this.max.x&&n>=this.min.y&&r<=this.max.y}},{key:"overlaps",value:function(e){return!(this.right<e.left||this.left>e.right||this.bottom<e.top||this.top>e.bottom)}},{key:"isFinite",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}))},{key:"translate",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.min.x+=e,this.max.x+=e,this.min.y+=t,this.max.y+=t}},{key:"shift",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y);var i=this.max.x-this.min.x,n=this.max.y-this.min.y;this.min.x=e,this.max.x=e+i,this.min.y=t,this.max.y=t+n}},{key:"clone",value:function(){var t=new e;return t.addBounds(this),t}},{key:"toPolygon",value:function(){return new Polygon(this.x,this.y,[new Vector2d(0,0),new Vector2d(this.width,0),new Vector2d(this.width,this.height),new Vector2d(0,this.height)])}}]),e}(),TMXRenderer=function(){function e(t,i,n,r){_classCallCheck(this,e),this.cols=t,this.rows=i,this.tilewidth=n,this.tileheight=r,this.bounds=new Bounds}return _createClass(e,[{key:"canRender",value:function(e){return this.tilewidth===e.tilewidth&&this.tileheight===e.tileheight}},{key:"getBounds",value:function(e){var t=e instanceof TMXLayer?pool.pull("Bounds"):this.bounds;return t.setMinMax(0,0,this.cols*this.tilewidth,this.rows*this.tileheight),t}},{key:"pixelToTileCoords",value:function(e,t,i){return i}},{key:"tileToPixelCoords",value:function(e,t,i){return i}},{key:"drawTile",value:function(e,t,i,n){}},{key:"drawTileLayer",value:function(e,t,i){}}]),e}(),TMXOrthogonalRenderer=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e.cols,e.rows,e.tilewidth,e.tileheight)}return _createClass(i,[{key:"canRender",value:function(e){return"orthogonal"===e.orientation&&_get(_getPrototypeOf(i.prototype),"canRender",this).call(this,e)}},{key:"pixelToTileCoords",value:function(e,t,i){return(i||new Vector2d).set(e/this.tilewidth,t/this.tileheight)}},{key:"tileToPixelCoords",value:function(e,t,i){return(i||new Vector2d).set(e*this.tilewidth,t*this.tileheight)}},{key:"adjustPosition",value:function(e){"number"==typeof e.gid&&(e.y-=e.height)}},{key:"drawTile",value:function(e,t,i,n){var r=n.tileset;r.drawTile(e,r.tileoffset.x+t*this.tilewidth,r.tileoffset.y+(i+1)*this.tileheight-r.tileheight,n)}},{key:"drawTileLayer",value:function(e,t,i){var n=1,r=1,o=this.pixelToTileCoords(Math.max(i.pos.x-(t.maxTileSize.width-t.tilewidth),0),Math.max(i.pos.y-(t.maxTileSize.height-t.tileheight),0),pool.pull("Vector2d")).floorSelf(),s=this.pixelToTileCoords(i.pos.x+i.width+this.tilewidth,i.pos.y+i.height+this.tileheight,pool.pull("Vector2d")).ceilSelf();switch(s.x=s.x>this.cols?this.cols:s.x,s.y=s.y>this.rows?this.rows:s.y,t.renderorder){case"right-up":s.y=o.y+(o.y=s.y)-s.y,r=-1;break;case"left-down":s.x=o.x+(o.x=s.x)-s.x,n=-1;break;case"left-up":s.x=o.x+(o.x=s.x)-s.x,s.y=o.y+(o.y=s.y)-s.y,n=-1,r=-1}for(var a=o.y;a!==s.y;a+=r)for(var l=o.x;l!==s.x;l+=n){var u=t.cellAt(l,a,!1);u&&this.drawTile(e,l,a,u)}pool.push(o),pool.push(s)}}]),i}(TMXRenderer),TMXIsometricRenderer=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var n;return _classCallCheck(this,i),(n=t.call(this,e.cols,e.rows,e.tilewidth,e.tileheight)).hTilewidth=n.tilewidth/2,n.hTileheight=n.tileheight/2,n.originX=n.rows*n.hTilewidth,n}return _createClass(i,[{key:"canRender",value:function(e){return"isometric"===e.orientation&&_get(_getPrototypeOf(i.prototype),"canRender",this).call(this,e)}},{key:"getBounds",value:function(e){var t=e instanceof TMXLayer?pool.pull("Bounds"):this.bounds;return t.setMinMax(0,0,(this.cols+this.rows)*(this.tilewidth/2),(this.cols+this.rows)*(this.tileheight/2)),t}},{key:"pixelToTileCoords",value:function(e,t,i){return(i||new Vector2d).set(t/this.tileheight+(e-this.originX)/this.tilewidth,t/this.tileheight-(e-this.originX)/this.tilewidth)}},{key:"tileToPixelCoords",value:function(e,t,i){return(i||new Vector2d).set((e-t)*this.hTilewidth+this.originX,(e+t)*this.hTileheight)}},{key:"adjustPosition",value:function(e){var t=e.x/this.hTilewidth,i=e.y/this.tileheight,n=pool.pull("Vector2d");this.tileToPixelCoords(t,i,n),e.x=n.x,e.y=n.y,pool.push(n)}},{key:"drawTile",value:function(e,t,i,n){var r=n.tileset;r.drawTile(e,(this.cols-1)*r.tilewidth+(t-i)*r.tilewidth>>1,-r.tilewidth+(t+i)*r.tileheight>>2,n)}},{key:"drawTileLayer",value:function(e,t,i){var n=t.tileset,r=this.pixelToTileCoords(i.pos.x-n.tilewidth,i.pos.y-n.tileheight,pool.pull("Vector2d")).floorSelf(),o=this.pixelToTileCoords(i.pos.x+i.width+n.tilewidth,i.pos.y+i.height+n.tileheight,pool.pull("Vector2d")).ceilSelf(),s=this.tileToPixelCoords(o.x,o.y,pool.pull("Vector2d")),a=this.tileToPixelCoords(r.x,r.y,pool.pull("Vector2d"));a.x-=this.hTilewidth,a.y+=this.tileheight;var l=a.y-i.pos.y>this.hTileheight,u=i.pos.x-a.x<this.hTilewidth;l&&(u?(r.x--,a.x-=this.hTilewidth):(r.y--,a.x+=this.hTilewidth),a.y-=this.hTileheight);for(var h=l^u,c=r.clone(),d=2*a.y;d-2*this.tileheight<2*s.y;d+=this.tileheight){c.setV(r);for(var f=a.x;f<s.x;f+=this.tilewidth){var p=t.cellAt(c.x,c.y);if(p){var v=(n=p.tileset).tileoffset;n.drawTile(e,v.x+f,v.y+d/2-n.tileheight,p)}c.x++,c.y--}h?(r.y++,a.x-=this.hTilewidth,h=!1):(r.x++,a.x+=this.hTilewidth,h=!0)}pool.push(c),pool.push(r),pool.push(o),pool.push(s),pool.push(a)}}]),i}(TMXRenderer),offsetsStaggerX=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],offsetsStaggerY=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}],TMXHexagonalRenderer=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var n;return _classCallCheck(this,i),(n=t.call(this,e.cols,e.rows,-2&e.tilewidth,-2&e.tileheight)).hexsidelength=e.hexsidelength||0,n.staggerX="x"===e.staggeraxis,n.staggerEven="even"===e.staggerindex,n.sidelengthx=0,n.sidelengthy=0,"hexagonal"===e.orientation&&(n.staggerX?n.sidelengthx=n.hexsidelength:n.sidelengthy=n.hexsidelength),n.sideoffsetx=(n.tilewidth-n.sidelengthx)/2,n.sideoffsety=(n.tileheight-n.sidelengthy)/2,n.columnwidth=n.sideoffsetx+n.sidelengthx,n.rowheight=n.sideoffsety+n.sidelengthy,n.centers=[new Vector2d,new Vector2d,new Vector2d,new Vector2d],n}return _createClass(i,[{key:"canRender",value:function(e){return"hexagonal"===e.orientation&&_get(_getPrototypeOf(i.prototype),"canRender",this).call(this,e)}},{key:"getBounds",value:function(e){var t=e instanceof TMXLayer?pool.pull("Bounds"):this.bounds;return this.staggerX?(t.setMinMax(0,0,this.cols*this.columnwidth+this.sideoffsetx,this.rows*(this.tileheight+this.sidelengthy)),t.width>1&&(t.height+=this.rowheight)):(t.setMinMax(0,0,this.cols*(this.tilewidth+this.sidelengthx),this.rows*this.rowheight+this.sideoffsety),t.height>1&&(t.width+=this.columnwidth)),t}},{key:"doStaggerX",value:function(e){return this.staggerX&&1&e^this.staggerEven}},{key:"doStaggerY",value:function(e){return!this.staggerX&&1&e^this.staggerEven}},{key:"topLeft",value:function(e,t,i){var n=i||new Vector2d;return this.staggerX?1&e^this.staggerEven?n.set(e-1,t):n.set(e-1,t-1):1&t^this.staggerEven?n.set(e,t-1):n.set(e-1,t-1),n}},{key:"topRight",value:function(e,t,i){var n=i||new Vector2d;return this.staggerX?1&e^this.staggerEven?n.set(e+1,t):n.set(e+1,t-1):1&t^this.staggerEven?n.set(e+1,t-1):n.set(e,t-1),n}},{key:"bottomLeft",value:function(e,t,i){var n=i||new Vector2d;return this.staggerX?1&e^this.staggerEven?n.set(e-1,t+1):n.set(e-1,t):1&t^this.staggerEven?n.set(e,t+1):n.set(e-1,t+1),n}},{key:"bottomRight",value:function(e,t,i){var n=i||new Vector2d;return this.staggerX?1&e^this.staggerEven?n.set(e+1,t+1):n.set(e+1,t):1&t^this.staggerEven?n.set(e+1,t+1):n.set(e,t+1),n}},{key:"pixelToTileCoords",value:function(e,t,i){var n=i||new Vector2d;this.staggerX?e-=this.staggerEven?this.tilewidth:this.sideoffsetx:t-=this.staggerEven?this.tileheight:this.sideoffsety;var r,o,s,a,l=pool.pull("Vector2d",Math.floor(e/(2*this.columnwidth)),Math.floor(t/(2*this.rowheight))),u=pool.pull("Vector2d",e-l.x*(2*this.columnwidth),t-l.y*(2*this.rowheight));this.staggerX?(l.x=2*l.x,this.staggerEven&&++l.x):(l.y=2*l.y,this.staggerEven&&++l.y),this.staggerX?(s=(r=this.sidelengthx/2)+this.columnwidth,a=this.tileheight/2,this.centers[0].set(r,a),this.centers[1].set(s,a-this.rowheight),this.centers[2].set(s,a+this.rowheight),this.centers[3].set(s+this.columnwidth,a)):(o=this.sidelengthy/2,s=this.tilewidth/2,a=o+this.rowheight,this.centers[0].set(s,o),this.centers[1].set(s-this.columnwidth,a),this.centers[2].set(s+this.columnwidth,a),this.centers[3].set(s,a+this.rowheight));for(var h=0,c=Number.MAX_VALUE,d=0;d<4;++d){var f=this.centers[d].sub(u).length2();f<c&&(c=f,h=d)}var p=this.staggerX?offsetsStaggerX:offsetsStaggerY;return n.set(l.x+p[h].x,l.y+p[h].y),pool.push(l),pool.push(u),n}},{key:"tileToPixelCoords",value:function(e,t,i){var n=Math.floor(e),r=Math.floor(t),o=i||new Vector2d;return this.staggerX?(o.y=r*(this.tileheight+this.sidelengthy),this.doStaggerX(n)&&(o.y+=this.rowheight),o.x=n*this.columnwidth):(o.x=n*(this.tilewidth+this.sidelengthx),this.doStaggerY(r)&&(o.x+=this.columnwidth),o.y=r*this.rowheight),o}},{key:"adjustPosition",value:function(e){"number"==typeof e.gid&&(e.y-=e.height)}},{key:"drawTile",value:function(e,t,i,n){var r=n.tileset,o=this.tileToPixelCoords(t,i,pool.pull("Vector2d"));r.drawTile(e,r.tileoffset.x+o.x,r.tileoffset.y+o.y+(this.tileheight-r.tileheight),n),pool.push(o)}},{key:"drawTileLayer",value:function(e,t,i){var n,r=this.pixelToTileCoords(i.pos.x,i.pos.y,pool.pull("Vector2d"));r.sub(t.pos);var o=this.tileToPixelCoords(r.x+t.pos.x,r.y+t.pos.y,pool.pull("Vector2d")),s=r.clone(),a=o.clone(),l=i.pos.y-o.y<this.sideoffsety,u=i.pos.x-o.x<this.sideoffsetx;l&&r.y--,u&&r.x--;var h=t.cols,c=t.rows;if(this.staggerX){r.x=Math.max(0,r.x),r.y=Math.max(0,r.y),o=this.tileToPixelCoords(r.x+t.pos.x,r.y+t.pos.y);for(var d=this.doStaggerX(r.x+t.pos.x);o.y<i.bottom&&r.y<c;){for(s.setV(r),a.setV(o);a.x<i.right&&s.x<h;s.x+=2)(n=t.cellAt(s.x,s.y,!1))&&n.tileset.drawTile(e,a.x,a.y,n),a.x+=this.tilewidth+this.sidelengthx;d?(r.x-=1,r.y+=1,o.x-=this.columnwidth,d=!1):(r.x+=1,o.x+=this.columnwidth,d=!0),o.y+=this.rowheight}pool.push(s),pool.push(a)}else{for(r.x=Math.max(0,r.x),r.y=Math.max(0,r.y),o=this.tileToPixelCoords(r.x+t.pos.x,r.y+t.pos.y),this.doStaggerY(r.y)&&(o.x-=this.columnwidth);o.y<i.bottom&&r.y<c;r.y++){for(s.setV(r),a.setV(o),this.doStaggerY(r.y)&&(a.x+=this.columnwidth);a.x<i.right&&s.x<h;s.x++)(n=t.cellAt(s.x,s.y,!1))&&n.tileset.drawTile(e,a.x,a.y,n),a.x+=this.tilewidth+this.sidelengthx;o.y+=this.rowheight}pool.push(s),pool.push(a)}pool.push(r),pool.push(o)}}]),i}(TMXRenderer),TMXStaggeredRenderer=function(e){_inherits(i,e);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"canRender",value:function(e){return"staggered"===e.orientation&&_get(_getPrototypeOf(i.prototype),"canRender",this).call(this,e)}},{key:"pixelToTileCoords",value:function(e,t,i){var n=i||new Vector2d,r=e,o=t;this.staggerX?r-=this.staggerEven?this.sideoffsetx:0:o-=this.staggerEven?this.sideoffsety:0;var s=pool.pull("Vector2d",Math.floor(r/this.tilewidth),Math.floor(o/this.tileheight));this.staggerX?(s.x=2*s.x,this.staggerEven&&++s.x):(s.y=2*s.y,this.staggerEven&&++s.y);var a=pool.pull("Vector2d",r-s.x*this.tilewidth,o-s.y*this.tileheight),l=a.x*(this.tileheight/this.tilewidth);return this.sideoffsety-l>a.y&&(s=this.topLeft(s.x,s.y,s)),-this.sideoffsety+l>a.y&&(s=this.topRight(s.x,s.y,s)),this.sideoffsety+l<a.y&&(s=this.bottomLeft(s.x,s.y,s)),3*this.sideoffsety-l<a.y&&(s=this.bottomRight(s.x,s.y,s)),(n=this.tileToPixelCoords(s.x,s.y,n)).set(e-n.x,t-n.y),n.set(n.x-this.tilewidth/2,n.y*(this.tilewidth/this.tileheight)),n.div(this.tilewidth/Math.sqrt(2)).rotate(degToRad(-45)).add(s),pool.push(s),pool.push(a),n}}]),i}(TMXHexagonalRenderer),TMXTileset=function(){function e(t){_classCallCheck(this,e);var i=0;if(this.TileProperties=[],this.imageCollection=[],this.firstgid=this.lastgid=+t.firstgid,void 0!==t.source){var n=t.source,r=getExtension(n);if(("tsx"===r||"json"===r)&&!(t=loader.getTMX(getBasename(n))))throw new Error(n+" external TSX/JSON tileset not found")}this.name=t.name,this.tilewidth=+t.tilewidth,this.tileheight=+t.tileheight,this.spacing=+t.spacing||0,this.margin=+t.margin||0,this.tileoffset=new Vector2d,this.isAnimated=!1,this.isCollection=!1,this.animations=new Map,this._lastUpdate=0;var o=t.tiles;for(i in o)if(o.hasOwnProperty(i)){if("animation"in o[i]&&(this.isAnimated=!0,this.animations.set(o[+i].animation[0].tileid,{dt:0,idx:0,frames:o[+i].animation,cur:o[+i].animation[0]})),"properties"in o[i])if(Array.isArray(o[i].properties)){var s={};for(var a in o[i].properties)s[o[i].properties[a].name]=o[i].properties[a].value;this.setTileProperty(+o[i].id+this.firstgid,s)}else this.setTileProperty(+i+this.firstgid,o[i].properties);if("image"in o[i]){var l=loader.getImage(o[i].image);if(!l)throw new Error("melonJS: '"+o[i].image+"' file for tile '"+(+i+this.firstgid)+"' not found!");this.imageCollection[+i+this.firstgid]=l}}this.isCollection=this.imageCollection.length>0;var u=t.tileoffset;u&&(this.tileoffset.x=+u.x,this.tileoffset.y=+u.y);var h=t.tileproperties;if(h)for(i in h)h.hasOwnProperty(i)&&this.setTileProperty(+i+this.firstgid,h[i]);if(!1===this.isCollection){if(this.image=loader.getImage(t.image),!this.image)throw new Error("melonJS: '"+t.image+"' file for tileset '"+this.name+"' not found!");this.texture=renderer.cache.get(this.image,{framewidth:this.tilewidth,frameheight:this.tileheight,margin:this.margin,spacing:this.spacing}),this.atlas=this.texture.getAtlas();var c=+t.columns||Math.round(this.image.width/(this.tilewidth+this.spacing)),d=Math.round(this.image.height/(this.tileheight+this.spacing));t.tilecount%c>0&&++d,this.lastgid=this.firstgid+(c*d-1||0),t.tilecount&&this.lastgid-this.firstgid+1!=+t.tilecount&&console.warn("Computed tilecount ("+(this.lastgid-this.firstgid+1)+") does not match expected tilecount ("+t.tilecount+")")}}return _createClass(e,[{key:"getTileImage",value:function(e){return this.imageCollection[e]}},{key:"setTileProperty",value:function(e,t){this.TileProperties[e]=t}},{key:"contains",value:function(e){return e>=this.firstgid&&e<=this.lastgid}},{key:"getViewTileId",value:function(e){var t=e-this.firstgid;return this.animations.has(t)?this.animations.get(t).cur.tileid:t}},{key:"getTileProperties",value:function(e){return this.TileProperties[e]}},{key:"update",value:function(e){var t=0,i=timer$1.getTime(),n=!1;return this._lastUpdate!==i&&(this._lastUpdate=i,this.animations.forEach((function(i){for(i.dt+=e,t=i.cur.duration;i.dt>=t;)i.dt-=t,i.idx=(i.idx+1)%i.frames.length,i.cur=i.frames[i.idx],t=i.cur.duration,n=!0}))),n}},{key:"drawTile",value:function(e,t,i,n){if(n.flipped&&(e.save(),e.translate(t,i),e.transform(n.currentTransform),t=i=0),!0===this.isCollection)e.drawImage(this.imageCollection[n.tileId],0,0,n.width,n.height,t,i,n.width,n.height);else{var r=this.atlas[this.getViewTileId(n.tileId)].offset;e.drawImage(this.image,r.x,r.y,this.tilewidth,this.tileheight,t,i,this.tilewidth+e.uvOffset,this.tileheight+e.uvOffset)}n.flipped&&e.restore()}}]),e}(),TMX_CLEAR_BIT_MASK=536870911,TMXTilesetGroup=function(){function e(){_classCallCheck(this,e),this.tilesets=[],this.length=0}return _createClass(e,[{key:"add",value:function(e){this.tilesets.push(e),this.length++}},{key:"getTilesetByIndex",value:function(e){return this.tilesets[e]}},{key:"getTilesetByGid",value:function(e){var t=-1;e&=TMX_CLEAR_BIT_MASK;for(var i=0,n=this.tilesets.length;i<n;i++){if(this.tilesets[i].contains(e))return this.tilesets[i];this.tilesets[i].firstgid===this.tilesets[i].lastgid&&e>=this.tilesets[i].firstgid&&(t=i)}if(-1!==t)return this.tilesets[t];throw new Error("no matching tileset found for gid "+e)}}]),e}(),TMXObject=function(){function e(t,i,n){_classCallCheck(this,e),this.points=void 0,this.name=i.name,this.x=+i.x,this.y=+i.y,this.z=+n,this.width=+i.width||0,this.height=+i.height||0,this.gid=+i.gid||null,this.tintcolor=i.tintcolor,this.type=i.type,this.type=i.type,this.rotation=degToRad(+i.rotation||0),this.id=+i.id||void 0,this.orientation=t.orientation,this.shapes=void 0,this.isEllipse=!1,this.isPolygon=!1,this.isPolyLine=!1,"number"==typeof this.gid?this.setTile(t.tilesets):void 0!==i.ellipse?this.isEllipse=!0:void 0!==i.polygon?(this.points=i.polygon,this.isPolygon=!0):void 0!==i.polyline&&(this.points=i.polyline,this.isPolyLine=!0),void 0!==i.text?(this.text=i.text,this.text.font=i.text.fontfamily||"sans-serif",this.text.size=i.text.pixelsize||16,this.text.fillStyle=i.text.color||"#000000",this.text.textAlign=i.text.halign||"left",this.text.textBaseline=i.text.valign||"top",this.text.width=this.width,this.text.height=this.height,applyTMXProperties(this.text,i)):(applyTMXProperties(this,i),this.shapes||(this.shapes=this.parseTMXShapes())),t.isEditor||t.getRenderer().adjustPosition(this)}return _createClass(e,[{key:"setTile",value:function(e){var t=e.getTilesetByGid(this.gid);!1===t.isCollection&&(this.width=this.framewidth=t.tilewidth,this.height=this.frameheight=t.tileheight),this.tile=new Tile(this.x,this.y,this.gid,t)}},{key:"parseTMXShapes",value:function(){var e=0,t=[];if(!0===this.isEllipse)t.push(new Ellipse(this.width/2,this.height/2,this.width,this.height).rotate(this.rotation));else if(!0===this.isPolygon){var i=new Polygon(0,0,this.points);if(!1===i.isConvex())throw new Error("collision polygones in Tiled should be defined as Convex");t.push(i.rotate(this.rotation))}else if(!0===this.isPolyLine){var n,r,o=this.points,s=o.length-1;for(e=0;e<s;e++)n=new Vector2d(o[e].x,o[e].y),r=new Vector2d(o[e+1].x,o[e+1].y),0!==this.rotation&&(n=n.rotate(this.rotation),r=r.rotate(this.rotation)),t.push(new Line(0,0,[n,r]))}else t.push(new Polygon(0,0,[new Vector2d,new Vector2d(this.width,0),new Vector2d(this.width,this.height),new Vector2d(0,this.height)]).rotate(this.rotation));if("isometric"===this.orientation)for(e=0;e<t.length;e++)t[e].toIso();return t}},{key:"getObjectPropertyByName",value:function(e){return this[e]}}]),e}(),TMXGroup=function(){function e(t,i,n){var r=this;_classCallCheck(this,e),this.name=i.name,this.width=i.width||0,this.height=i.height||0,this.tintcolor=i.tintcolor,this.z=n,this.objects=[];var o=void 0===i.visible||i.visible;this.opacity=!0===o?_clamp(+i.opacity||1,0,1):0,applyTMXProperties(this,i),i.objects&&i.objects.forEach((function(e){e.tintcolor=r.tintcolor,r.objects.push(new TMXObject(t,e,n))})),i.layers&&i.layers.forEach((function(e){var i=new TMXLayer(t,e,t.tilewidth,t.tileheight,t.orientation,t.tilesets,n++);i.setRenderer(t.getRenderer()),r.width=Math.max(r.width,i.width),r.height=Math.max(r.height,i.height),r.objects.push(i)}))}return _createClass(e,[{key:"destroy",value:function(){this.objects=null}},{key:"getObjectCount",value:function(){return this.objects.length}},{key:"getObjectByIndex",value:function(e){return this.objects[e]}}]),e}(),COLLISION_GROUP="collision";function getNewDefaultRenderer(e){switch(e.orientation){case"orthogonal":return new TMXOrthogonalRenderer(e);case"isometric":return new TMXIsometricRenderer(e);case"hexagonal":return new TMXHexagonalRenderer(e);case"staggered":return new TMXStaggeredRenderer(e);default:throw new Error(e.orientation+" type TMX Tile Map not supported!")}}function readLayer(e,t,i){return new TMXLayer(e,t,e.tilewidth,e.tileheight,e.orientation,e.tilesets,i)}function readImageLayer(e,t,i){applyTMXProperties(t.properties,t);var n=pool.pull("ImageLayer",+t.offsetx||+t.x||0,+t.offsety||+t.y||0,Object.assign({name:t.name,image:t.image,ratio:pool.pull("Vector2d",+t.parallaxx||1,+t.parallaxy||1),tint:void 0!==t.tintcolor?pool.pull("Color").parseHex(t.tintcolor,!0):void 0,z:i},t.properties)),r=void 0===t.visible||t.visible;return n.setOpacity(r?+t.opacity:0),n}function readTileset(e){return new TMXTileset(e)}function readObjectGroup(e,t,i){return new TMXGroup(e,t,i)}var TMXTileMap=function(){function e(t,i){if(_classCallCheck(this,e),this.data=i,this.name=t,this.cols=+i.width,this.rows=+i.height,this.tilewidth=+i.tilewidth,this.tileheight=+i.tileheight,this.infinite=+i.infinite,this.orientation=i.orientation,this.renderorder=i.renderorder||"right-down",this.version=i.version,this.tiledversion=i.tiledversion,this.tilesets=null,void 0===this.layers&&(this.layers=[]),void 0===this.objectGroups&&(this.objectGroups=[]),this.isEditor="melon-editor"===i.editor,this.nextobjectid=+i.nextobjectid||void 0,this.hexsidelength=+i.hexsidelength,this.staggeraxis=i.staggeraxis,this.staggerindex=i.staggerindex,this.bounds=this.getRenderer().getBounds().clone(),this.width=this.bounds.width,this.height=this.bounds.height,this.backgroundcolor=i.backgroundcolor,applyTMXProperties(this,i),this.initialized=!1,1===this.infinite)throw new Error("Tiled Infinite Map not supported!")}return _createClass(e,[{key:"getRenderer",value:function(){return void 0!==this.renderer&&this.renderer.canRender(this)||(this.renderer=getNewDefaultRenderer(this)),this.renderer}},{key:"getBounds",value:function(){return this.bounds}},{key:"readMapObjects",value:function(e){var t=this;if(!0!==this.initialized){var i=0;this.tilesets||(this.tilesets=new TMXTilesetGroup),void 0!==e.tilesets&&e.tilesets.forEach((function(e){t.tilesets.add(readTileset(e))})),this.background_image&&this.layers.push(pool.pull("ImageLayer",0,0,{name:"background_image",image:this.background_image,z:i++})),e.layers.forEach((function(e){switch(e.type){case"imagelayer":t.layers.push(readImageLayer(t,e,i++));break;case"tilelayer":t.layers.push(readLayer(t,e,i++));break;case"objectgroup":case"group":t.objectGroups.push(readObjectGroup(t,e,i++))}})),this.initialized=!0}}},{key:"addTo",value:function(e,t,i){var n=e.autoSort,r=e.autoDepth,o=this.getBounds();function s(t,i){viewport.setBounds(0,0,Math.max(o.width,t),Math.max(o.height,i)),e.pos.set(Math.max(0,~~((t-o.width)/2)),Math.max(0,~~((i-o.height)/2)),e.pos.z)}e.autoSort=!1,e.autoDepth=!1,this.backgroundcolor&&e.backgroundColor.parseCSS(this.backgroundcolor),this.getLayers().forEach((function(t){e.addChild(t)})),this.getObjects(t).forEach((function(t){e.addChild(t)})),e.resize(this.bounds.width,this.bounds.height),e.sort(!0),!0===i&&(off(VIEWPORT_ONRESIZE,s),s(viewport.width,viewport.height),on(VIEWPORT_ONRESIZE,s,this)),e.autoSort=n,e.autoDepth=r}},{key:"getObjects",value:function(e){var t,i=[],n=!1;this.readMapObjects(this.data);for(var r=0;r<this.objectGroups.length;r++){var o=this.objectGroups[r];n=o.name.toLowerCase().includes(COLLISION_GROUP),!1===e&&((t=new Container(0,0,this.width,this.height)).anchorPoint.set(0,0),t.name=o.name,t.pos.z=o.z,t.setOpacity(o.opacity),t.autoSort=!1,t.autoDepth=!1);for(var s=0;s<o.objects.length;s++){var a,l=o.objects[s];void 0===l.anchorPoint&&(l.anchorPoint={x:0,y:0}),void 0!==l.tintcolor&&(l.tint=pool.pull("Color"),l.tint.parseHex(l.tintcolor,!0)),l instanceof TMXLayer?a=l:"object"===_typeof(l.text)?(void 0===l.text.anchorPoint&&(l.text.anchorPoint=l.anchorPoint),(a=!0===l.text.bitmap?pool.pull("BitmapText",l.x,l.y,l.text):pool.pull("Text",l.x,l.y,l.text)).pos.z=l.z):"object"===_typeof(l.tile)?((a=l.tile.getRenderable(l)).body=new Body(a,l.shapes||new Rect(0,0,this.width,this.height)),a.body.setStatic(!0),a.pos.setMuted(l.x,l.y,l.z)):(void 0!==l.name&&""!==l.name?a=pool.pull(l.name,l.x,l.y,l):((a=pool.pull("Renderable",l.x,l.y,l.width,l.height)).anchorPoint.set(0,0),a.name=l.name,a.type=l.type,a.id=l.id,a.body=new Body(a,l.shapes||new Rect(0,0,a.width,a.height)),a.body.setStatic(!0),a.resize(a.body.getBounds().width,a.body.getBounds().height)),a.pos.z=l.z),n&&!l.name&&a.body&&(a.body.collisionType=collision.types.WORLD_SHAPE,a.body.isStatic=!0),!1!==e?(!0===a.isRenderable&&(a.setOpacity(a.getOpacity()*o.opacity),a.renderable instanceof Renderable&&a.renderable.setOpacity(a.renderable.getOpacity()*o.opacity)),i.push(a)):t.addChild(a)}!1===e&&t.children.length>0&&(t.autoSort=!0,t.autoDepth=!0,i.push(t))}return i}},{key:"getLayers",value:function(){return this.readMapObjects(this.data),this.layers}},{key:"destroy",value:function(){this.tilesets=void 0,this.layers.length=0,this.objectGroups.length=0,this.initialized=!1}}]),e}(),levels={},levelIdx=[],currentLevelIdx=0;function safeLoadLevel(e,t,i){t.container.reset(),_reset(),levels[level.getCurrentLevelId()]&&levels[level.getCurrentLevelId()].destroy(),currentLevelIdx=levelIdx.indexOf(e),loadTMXLevel(e,t.container,t.flatten,t.setViewportBounds),emit(LEVEL_LOADED,e),t.onLoaded(e),i&&state.restart()}function loadTMXLevel(e,t,i,n){var r=levels[e];utils.resetGUID(e,r.nextobjectid),t.anchorPoint.set(0,0),r.addTo(t,i,n)}var level={add:function(e,t,i){if("tmx"===e)return null==levels[t]&&(levels[t]=new TMXTileMap(t,loader.getTMX(t)),levelIdx.push(t),i&&i(),!0);throw new Error("no level loader defined for format "+e)},load:function(e,t){if(t=Object.assign({container:world,onLoaded:onLevelLoaded,flatten:mergeGroup,setViewportBounds:!0},t||{}),void 0===levels[e])throw new Error("level "+e+" not found");if(!(levels[e]instanceof TMXTileMap))throw new Error("no level loader defined");return state.isRunning()?(state.stop(),utils.function.defer(safeLoadLevel,this,e,t,!0)):safeLoadLevel(e,t),!0},getCurrentLevelId:function(){return levelIdx[currentLevelIdx]},getCurrentLevel:function(){return levels[this.getCurrentLevelId()]},reload:function(e){return this.load(this.getCurrentLevelId(),e)},next:function(e){return currentLevelIdx+1<levelIdx.length&&this.load(levelIdx[currentLevelIdx+1],e)},previous:function(e){return currentLevelIdx-1>=0&&this.load(levelIdx[currentLevelIdx-1],e)},levelCount:function(){return levelIdx.length}},imgList={},tmxList={},binList={},jsonList={},baseURL={},resourceCount=0,loadCount=0,timerId$1=0;function checkLoadStatus(e){if(loadCount===resourceCount){if(!e&&!loader.onload)throw new Error("no load callback defined");clearTimeout(timerId$1);var t=e||loader.onload;setTimeout((function(){t(),emit(LOADER_COMPLETE)}),300)}else timerId$1=setTimeout((function(){checkLoadStatus(e)}),100)}function preloadImage(e,t,i){imgList[e.name]=new Image,imgList[e.name].onload=t,imgList[e.name].onerror=i,"string"==typeof loader.crossOrigin&&(imgList[e.name].crossOrigin=loader.crossOrigin),imgList[e.name].src=e.src+loader.nocache}function preloadFontFace(e,t,i){var n=new FontFace(e.name,e.src);n.load().then((function(){document.fonts.add(n),document.body.style.fontFamily=e.name,t()}),(function(){i(e.name)}))}function preloadTMX(e,t,i){function n(t){tmxList[e.name]=t,"tmx"===e.type&&level.add(e.type,e.name)}if(e.data)return n(e.data),void t();var r=new XMLHttpRequest,o=getExtension(e.src);r.overrideMimeType&&("json"===o?r.overrideMimeType("application/json"):r.overrideMimeType("text/xml")),r.open("GET",e.src+loader.nocache,!0),r.withCredentials=loader.withCredentials,r.ontimeout=i,r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||0===r.status&&r.responseText){var s=null;switch(o){case"xml":case"tmx":case"tsx":if(device$1.ua.match(/msie/i)||!r.responseXML){if(!window.DOMParser)throw new Error("XML file format loading not supported, use the JSON file format instead");s=(new DOMParser).parseFromString(r.responseText,"text/xml")}else s=r.responseXML;var a=parse(s);switch(o){case"tmx":s=a.map;break;case"tsx":s=a.tilesets[0]}break;case"json":s=JSON.parse(r.responseText);break;default:throw new Error("TMX file format "+o+"not supported !")}n(s),t()}else i(e.name)},r.send()}function preloadJSON(e,t,i){var n=new XMLHttpRequest;n.overrideMimeType&&n.overrideMimeType("application/json"),n.open("GET",e.src+loader.nocache,!0),n.withCredentials=loader.withCredentials,n.ontimeout=i,n.onreadystatechange=function(){4===n.readyState&&(200===n.status||0===n.status&&n.responseText?(jsonList[e.name]=JSON.parse(n.responseText),t()):i(e.name))},n.send()}function preloadBinary(e,t,i){var n=new XMLHttpRequest;n.open("GET",e.src+loader.nocache,!0),n.withCredentials=loader.withCredentials,n.responseType="arraybuffer",n.onerror=i,n.onload=function(){var i=n.response;if(i){for(var r=new Uint8Array(i),o=[],s=0;s<r.byteLength;s++)o[s]=String.fromCharCode(r[s]);binList[e.name]=o.join(""),t()}},n.send()}function preloadJavascript(e,t,i){var n=document.createElement("script");n.src=e.src,n.type="text/javascript","string"==typeof loader.crossOrigin&&(n.crossOrigin=loader.crossOrigin),n.defer=!0,n.onload=function(){t()},n.onerror=function(){i(e.name)},document.getElementsByTagName("body")[0].appendChild(n)}var loader={nocache:"",onload:void 0,onProgress:void 0,crossOrigin:void 0,withCredentials:!1,onResourceLoaded:function(e){var t=++loadCount/resourceCount;this.onProgress&&this.onProgress(t,e),emit(LOADER_PROGRESS,t,e)},onLoadingError:function(e){throw new Error("Failed loading resource "+e.src)},setNocache:function(e){this.nocache=e?"?"+~~(1e7*Math.random()):""},setBaseURL:function(e,t){"*"!==e?baseURL[e]=t:(baseURL.audio=t,baseURL.binary=t,baseURL.image=t,baseURL.json=t,baseURL.js=t,baseURL.tmx=t,baseURL.tsx=t)},preload:function(e,t){for(var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;n<e.length;n++)resourceCount+=this.load(e[n],this.onResourceLoaded.bind(this,e[n]),this.onLoadingError.bind(this,e[n]));void 0!==t&&(this.onload=t),!0===i&&state.change(state.LOADING),checkLoadStatus(t)},load:function(e,t,i){switch(void 0!==baseURL[e.type]&&(e.src=baseURL[e.type]+e.src),e.type){case"binary":return preloadBinary.call(this,e,t,i),1;case"image":return preloadImage.call(this,e,t,i),1;case"json":return preloadJSON.call(this,e,t,i),1;case"js":return preloadJavascript.call(this,e,t,i),1;case"tmx":case"tsx":return preloadTMX.call(this,e,t,i),1;case"audio":return _load(e,!!e.stream,t,i),1;case"fontface":return preloadFontFace.call(this,e,t,i),1;default:throw new Error("load : unknown or invalid resource type : "+e.type)}},unload:function(e){switch(e.type){case"binary":return e.name in binList&&(delete binList[e.name],!0);case"image":return e.name in imgList&&(delete imgList[e.name],!0);case"json":return e.name in jsonList&&(delete jsonList[e.name],!0);case"js":case"fontface":return!0;case"tmx":case"tsx":return e.name in tmxList&&(delete tmxList[e.name],!0);case"audio":return _unload(e.name);default:throw new Error("unload : unknown or invalid resource type : "+e.type)}},unloadAll:function(){var e;for(e in binList)binList.hasOwnProperty(e)&&this.unload({name:e,type:"binary"});for(e in imgList)imgList.hasOwnProperty(e)&&this.unload({name:e,type:"image"});for(e in tmxList)tmxList.hasOwnProperty(e)&&this.unload({name:e,type:"tmx"});for(e in jsonList)jsonList.hasOwnProperty(e)&&this.unload({name:e,type:"json"});_unloadAll()},getTMX:function(e){return(e=""+e)in tmxList?tmxList[e]:null},getBinary:function(e){return(e=""+e)in binList?binList[e]:null},getImage:function(e){return(e=getBasename(""+e))in imgList?imgList[e]:null},getJSON:function(e){return(e=""+e)in jsonList?jsonList[e]:null}},audioTracks={},current_track_id=null,retry_counter=0,audioExts=[],soundLoadError=function(e,t){if(retry_counter++>3)throw new Error("melonJS: failed loading "+e);audioTracks[e].load()},stopOnAudioError=!0;function init$1(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mp3";return audioExts=e.split(","),!howler.Howler.noAudio}function hasFormat(e){return hasAudio()&&howler.Howler.codecs(e)}function hasAudio(){return!howler.Howler.noAudio}function enable(){unmuteAll()}function disable(){muteAll()}function _load(e,t,i,n){var r=[];if(0===audioExts.length)throw new Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.");for(var o=0;o<audioExts.length;o++)r.push(e.src+e.name+"."+audioExts[o]+loader.nocache);return audioTracks[e.name]=new howler.Howl({src:r,volume:howler.Howler.volume(),html5:!0===t,xhrWithCredentials:loader.withCredentials,onloaderror:function(){soundLoadError.call(this,e.name,n)},onload:function(){retry_counter=0,i&&i()}}),1}function play(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r=audioTracks[e];if(r&&void 0!==r){var o=r.play();return"boolean"==typeof t&&r.loop(t,o),r.volume("number"==typeof n?_clamp(n,0,1):howler.Howler.volume(),o),"function"==typeof i&&(!0===t?r.on("end",i,o):r.once("end",i,o)),o}throw new Error("audio clip "+e+" does not exist")}function fade(e,t,i,n,r){var o=audioTracks[e];if(!o||void 0===o)throw new Error("audio clip "+e+" does not exist");o.fade(t,i,n,r)}function seek(e){var t=audioTracks[e];if(t&&void 0!==t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return t.seek.apply(t,n)}throw new Error("audio clip "+e+" does not exist")}function rate(e){var t=audioTracks[e];if(t&&void 0!==t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return t.rate.apply(t,n)}throw new Error("audio clip "+e+" does not exist")}function stop(e,t){if(void 0!==e){var i=audioTracks[e];if(!i||void 0===i)throw new Error("audio clip "+e+" does not exist");i.stop(t),i.off("end",void 0,t)}else howler.Howler.stop()}function pause(e,t){var i=audioTracks[e];if(!i||void 0===i)throw new Error("audio clip "+e+" does not exist");i.pause(t)}function resume(e,t){var i=audioTracks[e];if(!i||void 0===i)throw new Error("audio clip "+e+" does not exist");i.play(t)}function playTrack(e,t){return play(current_track_id=e,!0,null,t)}function stopTrack(){null!==current_track_id&&(audioTracks[current_track_id].stop(),current_track_id=null)}function pauseTrack(){null!==current_track_id&&audioTracks[current_track_id].pause()}function resumeTrack(){null!==current_track_id&&audioTracks[current_track_id].play()}function getCurrentTrack(){return current_track_id}function setVolume(e){howler.Howler.volume(e)}function getVolume(){return howler.Howler.volume()}function mute(e,t,i){i=void 0===i||!!i;var n=audioTracks[e];if(!n||void 0===n)throw new Error("audio clip "+e+" does not exist");n.mute(i,t)}function unmute(e,t){mute(e,t,!1)}function muteAll(){howler.Howler.mute(!0)}function unmuteAll(){howler.Howler.mute(!1)}function muted(){return howler.Howler._muted}function _unload(e){return e in audioTracks&&(audioTracks[e].unload(),delete audioTracks[e],!0)}function _unloadAll(){for(var e in audioTracks)audioTracks.hasOwnProperty(e)&&_unload(e)}var audio=Object.freeze({__proto__:null,stopOnAudioError,init:init$1,hasFormat,hasAudio,enable,disable,load:_load,play,fade,seek,rate,stop,pause,resume,playTrack,stopTrack,pauseTrack,resumeTrack,getCurrentTrack,setVolume,getVolume,mute,unmute,muteAll,unmuteAll,muted,unload:_unload,unloadAll:_unloadAll}),data={};function isReserved(e){return"add"===e||"remove"===e}on(BOOT,(function(){if(!0===device$1.localStorage){var e=localStorage.getItem("me.save");"string"==typeof e&&e.length>0&&(JSON.parse(e)||[]).forEach((function(e){data[e]=JSON.parse(localStorage.getItem("me.save."+e))}))}}));var save={add:function(e){var t=save;Object.keys(e).forEach((function(i){var n;isReserved(i)||(n=i,Object.defineProperty(t,n,{configurable:!0,enumerable:!0,get:function(){return data[n]},set:function(e){data[n]=e,!0===device$1.localStorage&&localStorage.setItem("me.save."+n,JSON.stringify(e))}}),i in data||(t[i]=e[i]))})),!0===device$1.localStorage&&localStorage.setItem("me.save",JSON.stringify(Object.keys(data)))},remove:function(e){isReserved(e)||void 0!==data[e]&&(delete data[e],!0===device$1.localStorage&&(localStorage.removeItem("me.save."+e),localStorage.setItem("me.save",JSON.stringify(Object.keys(data)))))}},accelInitialized=!1,deviceOrientationInitialized=!1,swipeEnabled=!0;function _disableSwipeFn(e){return e.preventDefault(),"function"==typeof window.scroll&&window.scroll(0,0),!1}var readyBound=!1,isReady=!1,readyList=[];function _domReady(){if(!isReady){if(!document.body)return setTimeout(_domReady,13);for(document.removeEventListener&&document.removeEventListener("DOMContentLoaded",this._domReady,!1),window.removeEventListener("load",_domReady,!1);readyList.length;)readyList.shift().call(window,[]);isReady=!0}}var _domRect={left:0,top:0,x:0,y:0,width:0,height:0,right:0,bottom:0};function _detectDevice(){device.iOS=/iPhone|iPad|iPod/i.test(device.ua),device.android=/Android/i.test(device.ua),device.android2=/Android 2/i.test(device.ua),device.linux=/Linux/i.test(device.ua),device.chromeOS=/CrOS/.test(device.ua),device.wp=/Windows Phone/i.test(device.ua),device.BlackBerry=/BlackBerry/i.test(device.ua),device.Kindle=/Kindle|Silk.*Mobile Safari/i.test(device.ua),device.isMobile=/Mobi/i.test(device.ua)||device.iOS||device.android||device.wp||device.BlackBerry||device.Kindle||!1,device.ejecta=void 0!==window.ejecta,device.isWeixin=/MicroMessenger/i.test(device.ua)}function _checkCapabilities(){_detectDevice(),device.isMobile&&device.enableSwipe(!1),device.TouchEvent=!!("ontouchstart"in window),device.PointerEvent=!!window.PointerEvent,window.gesture=prefixed("gesture"),device.touch=device.TouchEvent||device.PointerEvent,device.maxTouchPoints=device.touch?device.PointerEvent?navigator.maxTouchPoints||1:10:1,device.wheel="onwheel"in document.createElement("div"),device.hasPointerLockSupport=void 0!==document.pointerLockElement,device.hasDeviceOrientation=!!window.DeviceOrientationEvent,device.hasAccelerometer=!!window.DeviceMotionEvent,device.ScreenOrientation="undefined"!=typeof screen&&void 0!==screen.orientation,device.hasFullscreenSupport=prefixed("fullscreenEnabled",document)||document.mozFullScreenEnabled,document.exitFullscreen=prefixed("cancelFullScreen",document)||prefixed("exitFullscreen",document),navigator.vibrate=prefixed("vibrate",navigator),device.hasWebAudio=!(!window.AudioContext&&!window.webkitAudioContext);try{device.localStorage=!!window.localStorage}catch(e){device.localStorage=!1}try{device.OffscreenCanvas=void 0!==window.OffscreenCanvas&&null!==new OffscreenCanvas(0,0).getContext("2d")}catch(e){device.OffscreenCanvas=!1}var e,t;window.addEventListener("blur",(function(){device.stopOnBlur&&state.stop(!0),device.pauseOnBlur&&state.pause(!0)}),!1),window.addEventListener("focus",(function(){device.stopOnBlur&&state.restart(!0),device.resumeOnFocus&&state.resume(!0),device.autoFocus&&device.focus()}),!1),void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),"string"==typeof t&&document.addEventListener(t,(function(){document[e]?(device.stopOnBlur&&state.stop(!0),device.pauseOnBlur&&state.pause(!0)):(device.stopOnBlur&&state.restart(!0),device.resumeOnFocus&&state.resume(!0))}),!1)}on(BOOT,(function(){_checkCapabilities()}));var device={ua:navigator.userAgent,localStorage:!1,hasAccelerometer:!1,hasDeviceOrientation:!1,ScreenOrientation:!1,hasFullscreenSupport:!1,hasPointerLockSupport:!1,hasWebAudio:!1,nativeBase64:"function"==typeof window.atob,maxTouchPoints:1,touch:!1,wheel:!1,isMobile:!1,iOS:!1,android:!1,android2:!1,linux:!1,ejecta:!1,isWeixin:!1,chromeOS:!1,wp:!1,BlackBerry:!1,Kindle:!1,accelerationX:0,accelerationY:0,accelerationZ:0,gamma:0,beta:0,alpha:0,language:navigator.language||navigator.browserLanguage||navigator.userLanguage||"en",pauseOnBlur:!0,resumeOnFocus:!0,autoFocus:!0,stopOnBlur:!1,OffscreenCanvas:!1,onReady:function(e){isReady?e.call(window,[]):(readyList.push(e),readyBound||("complete"===document.readyState?window.setTimeout(_domReady,0):(document.addEventListener&&document.addEventListener("DOMContentLoaded",_domReady,!1),window.addEventListener("load",_domReady,!1)),readyBound=!0))},enableSwipe:function(e){!1!==e?!1===swipeEnabled&&(window.document.removeEventListener("touchmove",_disableSwipeFn,!1),swipeEnabled=!0):!0===swipeEnabled&&(window.document.addEventListener("touchmove",_disableSwipeFn,!1),swipeEnabled=!1)},requestFullscreen:function(e){this.hasFullscreenSupport&&((e=e||getParent()).requestFullscreen=prefixed("requestFullscreen",e)||e.mozRequestFullScreen,e.requestFullscreen())},exitFullscreen:function(){this.hasFullscreenSupport&&document.exitFullscreen()},getScreenOrientation:function(){var e="portrait",t="landscape",i=window.screen;if(!0===this.ScreenOrientation){var n=prefixed("orientation",i);if(void 0!==n&&"string"==typeof n.type)return n.type;if("string"==typeof n)return n}return"number"==typeof window.orientation?90===Math.abs(window.orientation)?t:e:window.outerWidth>window.outerHeight?t:e},lockOrientation:function(e){var t=window.screen;if(void 0!==t){var i=prefixed("lockOrientation",t);if(void 0!==i)return i(e)}return!1},unlockOrientation:function(){var e=window.screen;if(void 0!==e){var t=prefixed("unlockOrientation",e);if(void 0!==t)return t()}return!1},isPortrait:function(){return this.getScreenOrientation().includes("portrait")},isLandscape:function(){return this.getScreenOrientation().includes("landscape")},getStorage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"local";if("local"===e)return save;throw new Error("storage type "+e+" not supported")},getParentElement:function(e){var t=this.getElement(e);return null!==t.parentNode&&(t=t.parentNode),t},getElement:function(e){var t=null;return"undefined"!==e&&("string"==typeof e?t=document.getElementById(e):"object"===_typeof(e)&&e.nodeType===Node.ELEMENT_NODE&&(t=e)),t||(t=document.body),t},getElementBounds:function(e){return"object"===_typeof(e)&&e!==document.body&&void 0!==e.getBoundingClientRect?e.getBoundingClientRect():(_domRect.width=_domRect.right=window.innerWidth,_domRect.height=_domRect.bottom=window.innerHeight,_domRect)},getParentBounds:function(e){return this.getElementBounds(this.getParentElement(e))},isWebGLSupported:function(e){var t=!1;try{var i=document.createElement("canvas"),n={stencil:!0,failIfMajorPerformanceCaveat:e.failIfMajorPerformanceCaveat};t=!(!window.WebGLRenderingContext||!i.getContext("webgl",n)&&!i.getContext("experimental-webgl",n))}catch(e){t=!1}return t},getMaxShaderPrecision:function(e){return e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0?"highp":e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"},focus:function(){"function"==typeof window.focus&&window.focus()},onDeviceMotion:function(e){this.accelerationX=e.accelerationIncludingGravity.x,this.accelerationY=e.accelerationIncludingGravity.y,this.accelerationZ=e.accelerationIncludingGravity.z},onDeviceRotate:function(e){this.gamma=e.gamma,this.beta=e.beta,this.alpha=e.alpha},watchAccelerometer:function(){var e=this;return this.hasAccelerometer&&!accelInitialized&&(DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"===t&&(window.addEventListener("devicemotion",e.onDeviceMotion,!1),accelInitialized=!0)})).catch(console.error):(window.addEventListener("devicemotion",this.onDeviceMotion,!1),accelInitialized=!0)),accelInitialized},unwatchAccelerometer:function(){accelInitialized&&(window.removeEventListener("devicemotion",this.onDeviceMotion,!1),accelInitialized=!1)},watchDeviceOrientation:function(){var e=this;return this.hasDeviceOrientation&&!deviceOrientationInitialized&&("function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"===t&&(window.addEventListener("deviceorientation",e.onDeviceRotate,!1),deviceOrientationInitialized=!0)})).catch(console.error):(window.addEventListener("deviceorientation",this.onDeviceRotate,!1),deviceOrientationInitialized=!0)),deviceOrientationInitialized},unwatchDeviceOrientation:function(){deviceOrientationInitialized&&(window.removeEventListener("deviceorientation",this.onDeviceRotate,!1),deviceOrientationInitialized=!1)},vibrate:function(e){navigator.vibrate&&navigator.vibrate(e)}};Object.defineProperty(device,"devicePixelRatio",{get:function(){return window.devicePixelRatio||1}}),Object.defineProperty(device,"isFullscreen",{get:function(){return!(!this.hasFullscreenSupport||!prefixed("fullscreenElement",document)&&!document.mozFullScreenElement)}}),Object.defineProperty(device,"sound",{get:function(){return hasAudio()}});var device$1=device;function extractUniforms(e,t){var i,n={},r=/uniform\s+(\w+)\s+(\w+)/g,o={},s={},a={};return[t.vertex,t.fragment].forEach((function(e){for(;i=r.exec(e);)o[i[2]]=i[1]})),Object.keys(o).forEach((function(i){var n=o[i];a[i]=e.getUniformLocation(t.program,i),s[i]={get:function(e){return function(){return a[e]}}(i),set:function(t,i,n){return 0===i.indexOf("mat")?function(i){e[n](a[t],!1,i)}:function(i){var r=n;i.length&&"v"!==n.substr(-1)&&(r+="v"),e[r](a[t],i)}}(i,n,"uniform"+fnHash[n])}})),Object.defineProperties(n,s),n}function extractAttributes(e,t){for(var i,n={},r=/attribute\s+\w+\s+(\w+)/g,o=0;i=r.exec(t.vertex);)n[i[1]]=o++;return n}function compileShader(e,t,i){var n=e.createShader(t);if(e.shaderSource(n,i),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n));return n}function compileProgram(e,t,i,n){var r=compileShader(e,e.VERTEX_SHADER,t),o=compileShader(e,e.FRAGMENT_SHADER,i),s=e.createProgram();for(var a in e.attachShader(s,r),e.attachShader(s,o),n)e.bindAttribLocation(s,n[a],a);if(e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){var l="Error initializing Shader "+this+"\ngl.VALIDATE_STATUS: "+e.getProgramParameter(s,e.VALIDATE_STATUS)+"\ngl.getError()"+e.getError()+"\ngl.getProgramInfoLog()"+e.getProgramInfoLog(s);throw e.deleteProgram(s),s=null,new Error(l)}return e.useProgram(s),e.deleteShader(r),e.deleteShader(o),s}var fnHash={bool:"1i",int:"1i",float:"1f",vec2:"2fv",vec3:"3fv",vec4:"4fv",bvec2:"2iv",bvec3:"3iv",bvec4:"4iv",ivec2:"2iv",ivec3:"3iv",ivec4:"4iv",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler2D:"1i"};function setPrecision(e,t){return"precision"!==e.substring(0,9)?"precision "+t+" float;"+e:e}function minify(e){return(e=(e=(e=e.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1")).replace(/(\\n\s+)|(\s+\\n)/g,"")).replace(/(\\r|\\n)+/g,"")).replace(/\s*([;,[\](){}\\\/\-+*|^&!=<>?~%])\s*/g,"$1")}var GLShader=function(){function e(t,i,n,r){return _classCallCheck(this,e),this.gl=t,this.vertex=setPrecision(minify(i),r||device$1.getMaxShaderPrecision(this.gl)),this.fragment=setPrecision(minify(n),r||device$1.getMaxShaderPrecision(this.gl)),this.attributes=extractAttributes(this.gl,this),this.program=compileProgram(this.gl,this.vertex,this.fragment,this.attributes),this.uniforms=extractUniforms(this.gl,this),on(WEBGL_ONCONTEXT_LOST,this.destroy,this),this}return _createClass(e,[{key:"bind",value:function(){this.gl.useProgram(this.program)}},{key:"getAttribLocation",value:function(e){var t=this.attributes[e];return void 0!==t?t:-1}},{key:"setUniform",value:function(e,t){var i=this.uniforms;if(void 0===i[e])throw new Error("undefined ("+e+") uniform for shader "+this);"object"===_typeof(t)&&"function"==typeof t.toArray?i[e]=t.toArray():i[e]=t}},{key:"destroy",value:function(){this.uniforms=null,this.attributes=null,this.gl.deleteProgram(this.program),this.vertex=null,this.fragment=null}}]),e}(),VertexArrayBuffer=function(){function e(t,i){return _classCallCheck(this,e),this.vertexSize=t,this.quadSize=i,this.maxVertex=256,this.vertexCount=0,this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.quadSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer),this}return _createClass(e,[{key:"clear",value:function(){this.vertexCount=0}},{key:"isFull",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.quadSize;return this.vertexCount+e>=this.maxVertex}},{key:"resize",value:function(){this.maxVertex<<=1;var e=this.bufferF32;return this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.quadSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer),this.bufferF32.set(e),this}},{key:"push",value:function(e,t,i,n,r){var o=this.vertexCount*this.vertexSize;return this.vertexCount>=this.maxVertex&&this.resize(),this.bufferF32[o+0]=e,this.bufferF32[o+1]=t,void 0!==i&&(this.bufferF32[o+2]=i,this.bufferF32[o+3]=n),void 0!==r&&(this.bufferU32[o+4]=r),this.vertexCount++,this}},{key:"toFloat32",value:function(e,t){return void 0!==t?this.bufferF32.subarray(e,t):this.bufferF32}},{key:"toUint32",value:function(e,t){return void 0!==t?this.bufferU32.subarray(e,t):this.bufferU32}},{key:"length",value:function(){return this.vertexCount}},{key:"isEmpty",value:function(){return 0===this.vertexCount}}]),e}(),primitiveVertex="// Current vertex point\nattribute vec2 aVertex;\n\n// Projection matrix\nuniform mat4 uProjectionMatrix;\n\n// Vertex color\nuniform vec4 uColor;\n\n// Fragment color\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(uColor.rgb * uColor.a, uColor.a);\n}\n",primitiveFragment="varying vec4 vColor;\n\nvoid main(void) {\n    gl_FragColor = vColor;\n}\n",quadVertex="attribute vec2 aVertex;\nattribute vec2 aRegion;\nattribute vec4 aColor;\n\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vRegion;\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n     gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(aColor.bgr * aColor.a, aColor.a);\n    vRegion = aRegion;\n}\n",quadFragment="uniform sampler2D uSampler;\nvarying vec4 vColor;\nvarying vec2 vRegion;\n\nvoid main(void) {\n    gl_FragColor = texture2D(uSampler, vRegion) * vColor;\n}\n",V_ARRAY=[new Vector2d,new Vector2d,new Vector2d,new Vector2d],WebGLCompositor=function(){function e(t){_classCallCheck(this,e),this.init(t)}return _createClass(e,[{key:"init",value:function(e){var t=this,i=e.gl;this.currentTextureUnit=-1,this.boundTextures=[],this.renderer=e,this.gl=e.gl,this.color=e.currentColor,this.viewMatrix=e.currentTransform,this.activeShader=null,this.mode=i.TRIANGLES,this.attributes=[],this.vertexByteSize=0,this.vertexSize=0,this.primitiveShader=new GLShader(this.gl,primitiveVertex,primitiveFragment),this.quadShader=new GLShader(this.gl,quadVertex,quadFragment),this.addAttribute("aVertex",2,i.FLOAT,!1,0*Float32Array.BYTES_PER_ELEMENT),this.addAttribute("aRegion",2,i.FLOAT,!1,2*Float32Array.BYTES_PER_ELEMENT),this.addAttribute("aColor",4,i.UNSIGNED_BYTE,!0,4*Float32Array.BYTES_PER_ELEMENT),this.vertexBuffer=new VertexArrayBuffer(this.vertexSize,6),i.bindBuffer(i.ARRAY_BUFFER,i.createBuffer()),i.bufferData(i.ARRAY_BUFFER,this.vertexBuffer.buffer,i.STREAM_DRAW),on(CANVAS_ONRESIZE,(function(e,i){t.flush(),t.setViewport(0,0,e,i)}))}},{key:"reset",value:function(){this.gl=this.renderer.gl,this.flush(),this.setViewport(0,0,this.renderer.getScreenCanvas().width,this.renderer.getScreenCanvas().height),this.clearColor(0,0,0,0);for(var e=0;e<this.renderer.maxTextures;e++){var t=this.getTexture2D(e);void 0!==t&&this.deleteTexture2D(t)}this.currentTextureUnit=-1,this.useShader(this.quadShader)}},{key:"addAttribute",value:function(e,t,i,n,r){switch(this.attributes.push({name:e,size:t,type:i,normalized:n,offset:r}),i){case this.gl.BYTE:this.vertexByteSize+=t*Int8Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_BYTE:this.vertexByteSize+=t*Uint8Array.BYTES_PER_ELEMENT;break;case this.gl.SHORT:this.vertexByteSize+=t*Int16Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_SHORT:this.vertexByteSize+=t*Uint16Array.BYTES_PER_ELEMENT;break;case this.gl.INT:this.vertexByteSize+=t*Int32Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_INT:this.vertexByteSize+=t*Uint32Array.BYTES_PER_ELEMENT;break;case this.gl.FLOAT:this.vertexByteSize+=t*Float32Array.BYTES_PER_ELEMENT;break;default:throw new Error("Invalid GL Attribute type")}this.vertexSize=this.vertexByteSize/Float32Array.BYTES_PER_ELEMENT}},{key:"setViewport",value:function(e,t,i,n){this.gl.viewport(e,t,i,n)}},{key:"createTexture2D",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"no-repeat",r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],u=this.gl,h=isPowerOfTwo(r||t.width)&&isPowerOfTwo(o||t.height),c=u.createTexture(),d=0===n.search(/^repeat(-x)?$/)&&(h||this.renderer.WebGLVersion>1)?u.REPEAT:u.CLAMP_TO_EDGE,f=0===n.search(/^repeat(-y)?$/)&&(h||this.renderer.WebGLVersion>1)?u.REPEAT:u.CLAMP_TO_EDGE;return this.bindTexture2D(c,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,d),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,f),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,i),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),r||o||s?u.texImage2D(u.TEXTURE_2D,0,u.RGBA,r,o,s,u.RGBA,u.UNSIGNED_BYTE,t):u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,t),h&&!1!==l&&u.generateMipmap(u.TEXTURE_2D),c}},{key:"deleteTexture2D",value:function(e){this.gl.deleteTexture(e),this.unbindTexture2D(e)}},{key:"getTexture2D",value:function(e){return this.boundTextures[e]}},{key:"bindTexture2D",value:function(e,t){var i=this.gl;e!==this.boundTextures[t]?(this.flush(),this.currentTextureUnit!==t&&(this.currentTextureUnit=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(i.TEXTURE_2D,e),this.boundTextures[t]=e):this.currentTextureUnit!==t&&(this.flush(),this.currentTextureUnit=t,i.activeTexture(i.TEXTURE0+t))}},{key:"unbindTexture2D",value:function(e,t){return void 0===t&&(t=this.boundTextures.indexOf(e)),-1!==t&&(delete this.boundTextures[t],t===this.currentTextureUnit&&(this.currentTextureUnit=-1)),t}},{key:"uploadTexture",value:function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.renderer.cache.getUnit(e),s=this.boundTextures[o];return void 0===s||r?this.createTexture2D(o,e.getTexture(),this.renderer.settings.antiAlias?this.gl.LINEAR:this.gl.NEAREST,e.repeat,t,i,n,e.premultipliedAlpha):this.bindTexture2D(s,o),this.currentTextureUnit}},{key:"useShader",value:function(e){if(this.activeShader!==e){this.flush(),this.activeShader=e,this.activeShader.bind(),this.activeShader.setUniform("uProjectionMatrix",this.renderer.projectionMatrix);for(var t=0;t<this.attributes.length;++t){var i=this.gl,n=this.attributes[t],r=this.activeShader.getAttribLocation(n.name);-1!==r?(i.enableVertexAttribArray(r),i.vertexAttribPointer(r,n.size,n.type,n.normalized,this.vertexByteSize,n.offset)):i.disableVertexAttribArray(t)}}}},{key:"addQuad",value:function(e,t,i,n,r,o,s,a,l,u){if(!(this.color.alpha<1/255)){this.useShader(this.quadShader),this.vertexBuffer.isFull(6)&&this.flush();var h=this.uploadTexture(e);this.quadShader.setUniform("uSampler",h);var c=this.viewMatrix,d=V_ARRAY[0].set(t,i),f=V_ARRAY[1].set(t+n,i),p=V_ARRAY[2].set(t,i+r),v=V_ARRAY[3].set(t+n,i+r);c.isIdentity()||(c.apply(d),c.apply(f),c.apply(p),c.apply(v)),this.vertexBuffer.push(d.x,d.y,o,s,u),this.vertexBuffer.push(f.x,f.y,a,s,u),this.vertexBuffer.push(p.x,p.y,o,l,u),this.vertexBuffer.push(p.x,p.y,o,l,u),this.vertexBuffer.push(f.x,f.y,a,s,u),this.vertexBuffer.push(v.x,v.y,a,l,u)}}},{key:"flush",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mode,t=this.vertexBuffer,i=t.vertexCount;if(i>0){var n=this.gl,r=t.vertexSize;this.renderer.WebGLVersion>1?n.bufferData(n.ARRAY_BUFFER,t.toFloat32(),n.STREAM_DRAW,0,i*r):n.bufferData(n.ARRAY_BUFFER,t.toFloat32(0,i*r),n.STREAM_DRAW),n.drawArrays(e,0,i),t.clear()}}},{key:"drawVertices",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length;this.useShader(this.primitiveShader),this.primitiveShader.setUniform("uColor",this.color);for(var n=this.viewMatrix,r=this.vertexBuffer,o=n.isIdentity(),s=0;s<i;s++)o||n.apply(t[s]),r.push(t[s].x,t[s].y);this.flush(e)}},{key:"clearColor",value:function(e,t,i,n){this.gl.clearColor(e,t,i,n)}},{key:"clear",value:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}]),e}(),WebGLRenderer=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var n;_classCallCheck(this,i),(n=t.call(this,e)).WebGLVersion=1,n.GPUVendor=null,n.GPURenderer=null,n.context=n.gl=n.getContextGL(n.getScreenCanvas(),e.transparent),n.maxTextures=n.gl.getParameter(n.gl.MAX_TEXTURE_IMAGE_UNITS),n._colorStack=[],n._matrixStack=[],n._scissorStack=[],n._glPoints=[new Vector2d,new Vector2d,new Vector2d,new Vector2d],n.currentTransform=new Matrix2d,n.currentCompositor=null,n.compositors=new Map;var r=new(n.settings.compositor||WebGLCompositor)(_assertThisInitialized(n));n.compositors.set("default",r),n.setCompositor(r),n.gl.disable(n.gl.DEPTH_TEST),n.gl.disable(n.gl.SCISSOR_TEST),n.gl.enable(n.gl.BLEND),n.setBlendMode(n.settings.blendMode);var o=n.gl.getExtension("WEBGL_debug_renderer_info");return null!==o&&(n.GPUVendor=n.gl.getParameter(o.UNMASKED_VENDOR_WEBGL),n.GPURenderer=n.gl.getParameter(o.UNMASKED_RENDERER_WEBGL)),n.cache=new TextureCache(n.maxTextures),n.getScreenCanvas().addEventListener("webglcontextlost",(function(e){e.preventDefault(),n.isContextValid=!1,emit(WEBGL_ONCONTEXT_LOST,_assertThisInitialized(n))}),!1),n.getScreenCanvas().addEventListener("webglcontextrestored",(function(){n.reset(),n.isContextValid=!0,emit(WEBGL_ONCONTEXT_RESTORED,_assertThisInitialized(n))}),!1),_possibleConstructorReturn(n,_assertThisInitialized(n))}return _createClass(i,[{key:"reset",value:function(){var e=this;_get(_getPrototypeOf(i.prototype),"reset",this).call(this),this.compositors.forEach((function(t){!1===e.isContextValid?t.init(e):t.reset()})),this.gl.disable(this.gl.SCISSOR_TEST),void 0!==this.fontContext2D&&this.createFontTexture(this.cache)}},{key:"setCompositor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";if("string"==typeof e&&(e=this.compositors.get(e)),void 0===e)throw new Error("Invalid WebGL Compositor");this.currentCompositor!==e&&(null!==this.currentCompositor&&this.currentCompositor.flush(),this.currentCompositor=e)}},{key:"resetTransform",value:function(){this.currentTransform.identity()}},{key:"createFontTexture",value:function(e){if(void 0===this.fontTexture){var t=this.backBufferCanvas,i=t.width,n=t.height;1===this.WebGLVersion&&(isPowerOfTwo(i)||(i=nextPowerOfTwo(t.width)),isPowerOfTwo(n)||(n=nextPowerOfTwo(t.height)));var r=createCanvas(i,n,!0);this.fontContext2D=this.getContext2d(r),this.fontTexture=new TextureAtlas(createAtlas(t.width,t.height,"fontTexture"),r,e),this.currentCompositor.uploadTexture(this.fontTexture,0,0,0)}else e.set(this.fontContext2D.canvas,this.fontTexture)}},{key:"createPattern",value:function(e,t){if(!(1!==renderer.WebGLVersion||isPowerOfTwo(e.width)&&isPowerOfTwo(e.height))){var i=void 0!==e.src?e.src:e;throw new Error("[WebGL Renderer] "+i+" is not a POT texture ("+e.width+"x"+e.height+")")}var n=new TextureAtlas(createAtlas(e.width,e.height,"pattern",t),e);return this.currentCompositor.uploadTexture(n),n}},{key:"flush",value:function(){this.currentCompositor.flush()}},{key:"clearColor",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#000000",i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t instanceof Color)e=t.toArray();else{var n=pool.pull("me.Color");e=n.parseCSS(t).toArray(),pool.push(n)}this.currentCompositor.clearColor(e[0],e[1],e[2],!0===i?1:e[3]),this.currentCompositor.clear(),this.currentCompositor.clearColor(0,0,0,0)}},{key:"clearRect",value:function(e,t,i,n){this.save(),this.clipRect(e,t,i,n),this.clearColor(),this.restore()}},{key:"drawFont",value:function(e){var t=this.getFontContext();this.currentCompositor.uploadTexture(this.fontTexture,0,0,0,!0);var i=this.fontTexture.getUVs(e.left+","+e.top+","+e.width+","+e.height);this.currentCompositor.addQuad(this.fontTexture,e.left,e.top,e.width,e.height,i[0],i[1],i[2],i[3],this.currentTint.toUint32()),t.clearRect(e.left,e.top,e.width,e.height)}},{key:"drawImage",value:function(e,t,i,n,r,o,s,a,l){void 0===n?(n=a=e.width,r=l=e.height,o=t,s=i,t=0,i=0):void 0===o&&(o=t,s=i,a=n,l=r,n=e.width,r=e.height,t=0,i=0),!1===this.settings.subPixel&&(o|=0,s|=0);var u=this.cache.get(e),h=u.getUVs(t+","+i+","+n+","+r);this.currentCompositor.addQuad(u,o,s,a,l,h[0],h[1],h[2],h[3],this.currentTint.toUint32())}},{key:"drawPattern",value:function(e,t,i,n,r){var o=e.getUVs("0,0,"+n+","+r);this.currentCompositor.addQuad(e,t,i,n,r,o[0],o[1],o[2],o[3],this.currentTint.toUint32())}},{key:"getScreenContext",value:function(){return this.gl}},{key:"getContextGL",value:function(e,t){if(null==e)throw new Error("You must pass a canvas element in order to create a GL context");"boolean"!=typeof t&&(t=!0);var i,n={alpha:t,antialias:this.settings.antiAlias,depth:!1,stencil:!0,preserveDrawingBuffer:!1,premultipliedAlpha:t,powerPreference:this.settings.powerPreference,failIfMajorPerformanceCaveat:this.settings.failIfMajorPerformanceCaveat};if(!1===this.settings.preferWebGL1&&(i=e.getContext("webgl2",n))&&(this.WebGLVersion=2),i||(this.WebGLVersion=1,i=e.getContext("webgl",n)||e.getContext("experimental-webgl",n)),!i)throw new Error("A WebGL context could not be created.");return i}},{key:"getContext",value:function(){return this.gl}},{key:"setBlendMode",value:function(e,t){(t=t||this.gl).enable(t.BLEND),"multiply"===e?(t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.currentBlendMode=e):(t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.currentBlendMode="normal")}},{key:"getFontContext",value:function(){return void 0===this.fontContext2D&&(console.warn("[WebGL Renderer] WARNING : Using Standard me.Text with WebGL will severly impact performances !"),this.createFontTexture(this.cache)),this.fontContext2D}},{key:"restore",value:function(){if(0!==this._matrixStack.length){var e=this._colorStack.pop(),t=this._matrixStack.pop();this.currentColor.copy(e),this.currentTransform.copy(t),pool.push(e),pool.push(t)}0!==this._scissorStack.length?this.currentScissor.set(this._scissorStack.pop()):(this.gl.disable(this.gl.SCISSOR_TEST),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.backBufferCanvas.width,this.currentScissor[3]=this.backBufferCanvas.height)}},{key:"save",value:function(){this._colorStack.push(this.currentColor.clone()),this._matrixStack.push(this.currentTransform.clone()),this.gl.isEnabled(this.gl.SCISSOR_TEST)&&this._scissorStack.push(this.currentScissor.slice())}},{key:"rotate",value:function(e){this.currentTransform.rotate(e)}},{key:"scale",value:function(e,t){this.currentTransform.scale(e,t)}},{key:"setAntiAlias",value:function(e,t){_get(_getPrototypeOf(i.prototype),"setAntiAlias",this).call(this,e,t)}},{key:"setGlobalAlpha",value:function(e){this.currentColor.alpha=e}},{key:"setColor",value:function(e){var t=this.currentColor.alpha;this.currentColor.copy(e),this.currentColor.alpha*=t}},{key:"setLineWidth",value:function(e){this.getScreenContext().lineWidth(e)}},{key:"strokeArc",value:function(e,t,i,n,r){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6?arguments[6]:void 0;if(!0===s)this.fillArc(e,t,i,n,r,o);else{var a,l=this._glPoints,u=Math.floor(24*Math.sqrt(2*i)),h=(r-n)/(2*u),c=2*h,d=Math.cos(h),f=Math.sin(h);for(a=l.length;a<u+1;a++)l.push(new Vector2d);for(a=0;a<u;a++){var p=h+n+c*a,v=Math.cos(p),y=-Math.sin(p);l[a].x=e+(d*v+f*y)*i,l[a].y=t+(d*-y+f*v)*i}this.currentCompositor.drawVertices(this.gl.LINE_STRIP,l,u)}}},{key:"fillArc",value:function(e,t,i,n,r){var o,s=this._glPoints,a=0,l=Math.floor(24*Math.sqrt(2*i)),u=(r-n)/(2*l),h=2*u,c=Math.cos(u),d=Math.sin(u);for(o=s.length;o<2*l;o++)s.push(new Vector2d);for(o=0;o<l-1;o++){var f=u+n+h*o,p=Math.cos(f),v=-Math.sin(f);s[a++].set(e,t),s[a++].set(e-(c*p+d*v)*i,t-(c*-v+d*p)*i)}this.currentCompositor.drawVertices(this.gl.TRIANGLE_STRIP,s,a)}},{key:"strokeEllipse",value:function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!0===r)this.fillEllipse(e,t,i,n);else{var o,s=Math.floor(24*Math.sqrt(i))||Math.floor(12*Math.sqrt(i+n)),a=TAU/s,l=this._glPoints;for(o=l.length;o<s;o++)l.push(new Vector2d);for(o=0;o<s;o++)l[o].x=e+Math.sin(a*-o)*i,l[o].y=t+Math.cos(a*-o)*n;this.currentCompositor.drawVertices(this.gl.LINE_LOOP,l,s)}}},{key:"fillEllipse",value:function(e,t,i,n){var r,o=Math.floor(24*Math.sqrt(i))||Math.floor(12*Math.sqrt(i+n)),s=TAU/o,a=this._glPoints,l=0;for(r=a.length;r<2*(o+1);r++)a.push(new Vector2d);for(r=0;r<o+1;r++)a[l++].set(e,t),a[l++].set(e+Math.sin(s*r)*i,t+Math.cos(s*r)*n);this.currentCompositor.drawVertices(this.gl.TRIANGLE_STRIP,a,l)}},{key:"strokeLine",value:function(e,t,i,n){var r=this._glPoints;r[0].x=e,r[0].y=t,r[1].x=i,r[1].y=n,this.currentCompositor.drawVertices(this.gl.LINE_STRIP,r,2)}},{key:"fillLine",value:function(e,t,i,n){this.strokeLine(e,t,i,n)}},{key:"strokePolygon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!0===t)this.fillPolygon(e);else{var i,n=e.points.length,r=this._glPoints;for(i=r.length;i<n;i++)r.push(new Vector2d);for(i=0;i<n;i++)r[i].x=e.pos.x+e.points[i].x,r[i].y=e.pos.y+e.points[i].y;this.currentCompositor.drawVertices(this.gl.LINE_LOOP,r,n)}}},{key:"fillPolygon",value:function(e){var t,i=e.points,n=this._glPoints,r=e.getIndices(),o=e.pos.x,s=e.pos.y;for(t=n.length;t<r.length;t++)n.push(new Vector2d);for(t=0;t<r.length;t++)n[t].set(o+i[r[t]].x,s+i[r[t]].y);this.currentCompositor.drawVertices(this.gl.TRIANGLES,n,r.length)}},{key:"strokeRect",value:function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!0===r)this.fillRect(e,t,i,n);else{var o=this._glPoints;o[0].x=e,o[0].y=t,o[1].x=e+i,o[1].y=t,o[2].x=e+i,o[2].y=t+n,o[3].x=e,o[3].y=t+n,this.currentCompositor.drawVertices(this.gl.LINE_LOOP,o,4)}}},{key:"fillRect",value:function(e,t,i,n){var r=this._glPoints;r[0].x=e+i,r[0].y=t,r[1].x=e,r[1].y=t,r[2].x=e+i,r[2].y=t+n,r[3].x=e,r[3].y=t+n,this.currentCompositor.drawVertices(this.gl.TRIANGLE_STRIP,r,4)}},{key:"setTransform",value:function(e){this.resetTransform(),this.transform(e)}},{key:"transform",value:function(e){var t=this.currentTransform;if(t.multiply(e),!1===this.settings.subPixel){var i=t.toArray();i[6]|=0,i[7]|=0}}},{key:"translate",value:function(e,t){var i=this.currentTransform;if(i.translate(e,t),!1===this.settings.subPixel){var n=i.toArray();n[6]|=0,n[7]|=0}}},{key:"clipRect",value:function(e,t,i,n){var r=this.backBufferCanvas,o=this.gl;if(0!==e||0!==t||i!==r.width||n!==r.height){var s=this.currentScissor;if(o.isEnabled(o.SCISSOR_TEST)&&s[0]===e&&s[1]===t&&s[2]===i&&s[3]===n)return;this.flush(),o.enable(this.gl.SCISSOR_TEST),o.scissor(e+this.currentTransform.tx,r.height-n-t-this.currentTransform.ty,i,n),s[0]=e,s[1]=t,s[2]=i,s[3]=n}else o.disable(o.SCISSOR_TEST)}},{key:"setMask",value:function(e){var t=this.gl;this.flush(),t.enable(t.STENCIL_TEST),t.clear(t.STENCIL_BUFFER_BIT),t.colorMask(!1,!1,!1,!1),t.stencilFunc(t.NOTEQUAL,1,1),t.stencilOp(t.REPLACE,t.REPLACE,t.REPLACE),this.fill(e),this.flush(),t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,1,1),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}},{key:"clearMask",value:function(){this.flush(),this.gl.disable(this.gl.STENCIL_TEST)}}]),i}(Renderer),designRatio=1,designWidth=0,designHeight=0,settings={parent:document.body,renderer:2,doubleBuffering:!1,autoScale:!1,scale:1,scaleMethod:"fit",transparent:!1,blendMode:"normal",antiAlias:!1,failIfMajorPerformanceCaveat:!0,subPixel:!1,preferWebGL1:!1,powerPreference:"default",verbose:!1,consoleHeader:!0};function autoDetectRenderer(e){try{if(device$1.isWebGLSupported(e))return new WebGLRenderer(e)}catch(e){console.log("Error creating WebGL renderer :"+e.message)}return new CanvasRenderer(e)}function onresize(){var e=renderer.settings,t=1,i=1;if(e.autoScale){var n=1/0,r=1/0;if(window.getComputedStyle){var o=window.getComputedStyle(renderer.getScreenCanvas(),null);n=parseInt(o.maxWidth,10)||1/0,r=parseInt(o.maxHeight,10)||1/0}var s=device$1.getParentBounds(getParent()),a=Math.min(n,s.width),l=Math.min(r,s.height),u=a/l;if("fill-min"===e.scaleMethod&&u>designRatio||"fill-max"===e.scaleMethod&&u<designRatio||"flex-width"===e.scaleMethod){var h=Math.min(n,designHeight*u);t=i=a/h,renderer.resize(Math.floor(h),designHeight)}else if("fill-min"===e.scaleMethod&&u<designRatio||"fill-max"===e.scaleMethod&&u>designRatio||"flex-height"===e.scaleMethod){var c=Math.min(r,designWidth*(l/a));t=i=l/c,renderer.resize(designWidth,Math.floor(c))}else"flex"===e.scaleMethod?renderer.resize(Math.floor(a),Math.floor(l)):"stretch"===e.scaleMethod?(t=a/designWidth,i=l/designHeight):t=i=u<designRatio?a/designWidth:l/designHeight;scale(t,i)}}var CANVAS=0,WEBGL=1,AUTO=2,parent=null,scaleRatio=new Vector2d(1,1),renderer=null;function init(e,t,i){if(!initialized)throw new Error("me.video.init() called before engine initialization.");(settings=Object.assign(settings,i||{})).width=e,settings.height=t,settings.doubleBuffering=!!settings.doubleBuffering,settings.transparent=!!settings.transparent,settings.antiAlias=!!settings.antiAlias,settings.failIfMajorPerformanceCaveat=!!settings.failIfMajorPerformanceCaveat,settings.subPixel=!!settings.subPixel,settings.verbose=!!settings.verbose,-1!==settings.scaleMethod.search(/^(fill-(min|max)|fit|flex(-(width|height))?|stretch)$/)?settings.autoScale="auto"===settings.scale||!0:(settings.scaleMethod="fit",settings.autoScale="auto"===settings.scale||!1),!1!==settings.consoleHeader&&console.log("melonJS 2 (v"+version+") | http://melonjs.org");var n=utils.getUriFragment();!0!==n.webgl&&!0!==n.webgl1&&!0!==n.webgl2||(settings.renderer=WEBGL,!0===n.webgl1&&(settings.preferWebGL1=!0)),settings.scale=settings.autoScale?1:+settings.scale||1,scaleRatio.set(settings.scale,settings.scale),(settings.autoScale||1!==settings.scale)&&(settings.doubleBuffering=!0),designRatio=e/t,designWidth=e,designHeight=t,settings.zoomX=e*scaleRatio.x,settings.zoomY=e*scaleRatio.y,window.addEventListener("resize",utils.function.throttle((function(e){emit(WINDOW_ONRESIZE,e)}),100),!1),window.addEventListener("orientationchange",(function(e){emit(WINDOW_ONORIENTATION_CHANGE,e)}),!1),window.addEventListener("onmozorientationchange",(function(e){emit(WINDOW_ONORIENTATION_CHANGE,e)}),!1),!0===device$1.ScreenOrientation&&(window.screen.orientation.onchange=function(e){emit(WINDOW_ONORIENTATION_CHANGE,e)}),window.addEventListener("scroll",utils.function.throttle((function(e){emit(WINDOW_ONSCROLL,e)}),100),!1),on(WINDOW_ONRESIZE,onresize,this),on(WINDOW_ONORIENTATION_CHANGE,onresize,this);try{switch(settings.renderer){case AUTO:case WEBGL:renderer=autoDetectRenderer(settings);break;default:renderer=new CanvasRenderer(settings)}}catch(e){return console(e.message),!1}if((parent=device$1.getElement(settings.parent)).appendChild(renderer.getScreenCanvas()),onresize(),"MutationObserver"in window&&new MutationObserver(onresize.bind(this)).observe(parent,{attributes:!1,childList:!0,subtree:!0}),!1!==settings.consoleHeader){var r=renderer instanceof CanvasRenderer?"CANVAS":"WebGL"+renderer.WebGLVersion,o=device$1.hasWebAudio?"Web Audio":"HTML5 Audio",s="string"==typeof renderer.GPURenderer?" ("+renderer.GPURenderer+")":"";console.log(r+" renderer"+s+" | "+o+" | pixel ratio "+device$1.devicePixelRatio+" | "+(device$1.isMobile?"mobile":"desktop")+" | "+device$1.getScreenOrientation()+" | "+device$1.language),console.log("resolution: requested "+e+"x"+t+", got "+renderer.getWidth()+"x"+renderer.getHeight())}return emit(VIDEO_INIT),!0}function createCanvas(e,t){var i,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e||0===t)throw new Error("width or height was zero, Canvas could not be initialized !");return!0===device$1.OffscreenCanvas&&!0===n?void 0===(i=new OffscreenCanvas(0,0)).style&&(i.style={}):i=document.createElement("canvas"),i.width=e,i.height=t,i}function getParent(){return parent}function scale(e,t){var i=renderer.getScreenCanvas(),n=renderer.getScreenContext(),r=renderer.settings,o=device$1.devicePixelRatio,s=r.zoomX=i.width*e*o,a=r.zoomY=i.height*t*o;scaleRatio.set(e*o,t*o),i.style.width=s/o+"px",i.style.height=a/o+"px",renderer.setAntiAlias(n,r.antiAlias),renderer.setBlendMode(r.blendMode,n),repaint()}var video=Object.freeze({__proto__:null,CANVAS,WEBGL,AUTO,get parent(){return parent},scaleRatio,get renderer(){return renderer},init,createCanvas,getParent,scale}),GUID_base="",GUID_index=0,utils={agent:agentUtils,array:arrayUtils,file:fileUtils,string:stringUtils,function:fnUtils,getPixels:function(e){if(e instanceof HTMLImageElement){var t=CanvasRenderer.getContext2d(createCanvas(e.width,e.height));return t.drawImage(e,0,0),t.getImageData(0,0,e.width,e.height)}return e.getContext("2d").getImageData(0,0,e.width,e.height)},checkVersion:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:version,i=e.split("."),n=t.split("."),r=Math.min(i.length,n.length),o=0,s=0;s<r&&!(o=+i[s]-+n[s]);s++);return o||i.length-n.length},getUriFragment:function(e){var t={};if(void 0===e){var i=document.location;if(!i||!i.hash)return t;e=i.hash}else{var n=e.indexOf("#");if(-1===n)return t;e=e.substr(n,e.length)}return e.substr(1).split("&").filter((function(e){return""!==e})).forEach((function(e){var i=e.split("="),n=i.shift(),r=i.join("=");t[n]=r||!0})),t},resetGUID:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;GUID_base=toHex$1(e.toString().toUpperCase()),GUID_index=t},createGUID:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return GUID_index+=e,GUID_base+"-"+(e||GUID_index)}},framecount=0,framedelta=0,last=0,now=0,delta=0,step=0,minstep=0,timers=[],timerId=0;function update(e){last=now,(delta=(now=e)-last)<0&&(delta=0),timer.tick=delta>minstep&&timer.interpolation?delta/step:1,updateTimers()}function clearTimer(e){for(var t=0,i=timers.length;t<i;t++)if(timers[t].timerId===e){timers.splice(t,1);break}}function updateTimers(){for(var e=0,t=timers.length;e<t;e++){var i=timers[e];i.pauseable&&state.isPaused()||(i.elapsed+=delta),i.elapsed>=i.delay&&(i.fn.apply(null,i.args),!0===i.repeat?i.elapsed-=i.delay:timer.clearTimeout(i.timerId))}}on(BOOT,(function(){timer.reset(),now=last=0,on(GAME_BEFORE_UPDATE,update)}));var timer={tick:1,fps:0,maxfps:60,interpolation:!1,reset:function(){last=now=window.performance.now(),delta=0,framedelta=0,framecount=0,step=Math.ceil(1e3/this.maxfps),minstep=1e3/this.maxfps*1.25},setTimeout:function(e,t,i){for(var n=arguments.length,r=new Array(n>3?n-3:0),o=3;o<n;o++)r[o-3]=arguments[o];return timers.push({fn:e,delay:t,elapsed:0,repeat:!1,timerId:++timerId,pauseable:!0===i||!0,args:r}),timerId},setInterval:function(e,t,i){for(var n=arguments.length,r=new Array(n>3?n-3:0),o=3;o<n;o++)r[o-3]=arguments[o];return timers.push({fn:e,delay:t,elapsed:0,repeat:!0,timerId:++timerId,pauseable:!0===i||!0,args:r}),timerId},clearTimeout:function(e){utils.function.defer(clearTimer,this,e)},clearInterval:function(e){utils.function.defer(clearTimer,this,e)},getTime:function(){return now},getDelta:function(){return delta},countFPS:function(){framecount++,framedelta+=delta,framecount%10==0&&(this.fps=_clamp(Math.round(1e3*framecount/framedelta),0,this.maxfps),framedelta=0,framecount=0)}},timer$1=timer,lastTime=0,vendors=["ms","moz","webkit","o"],x,requestAnimationFrame=window.requestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame;for(x=0;x<vendors.length&&!requestAnimationFrame;++x)requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];for(x=0;x<vendors.length&&!cancelAnimationFrame;++x)cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];requestAnimationFrame&&cancelAnimationFrame||(requestAnimationFrame=function(e){var t=window.performance.now(),i=Math.max(0,1e3/timer$1.maxfps-(t-lastTime)),n=window.setTimeout((function(){e(t+i)}),i);return lastTime=t+i,n},cancelAnimationFrame=function(e){window.clearTimeout(e)},window.requestAnimationFrame=requestAnimationFrame,window.cancelAnimationFrame=cancelAnimationFrame);var plugins={},BasePlugin=_createClass((function e(){_classCallCheck(this,e),this.version="10.5.0"})),plugin={Base:BasePlugin,patch:function(e,t,i){if(void 0!==e.prototype&&(e=e.prototype),"function"!=typeof e[t])throw new Error(t+" is not an existing function");var n=e[t];Object.defineProperty(e,t,{configurable:!0,value:function(e,t){return function(){this._patched=n;var e=t.apply(this,arguments);return this._patched=null,e}}(0,i)})},register:function(e,t){if(plugins[t])throw new Error("plugin "+t+" already registered");var i=[];arguments.length>2&&(i=Array.prototype.slice.call(arguments,1)),i[0]=e;var n=new(e.bind.apply(e,i));if(void 0===n||!(n instanceof plugin.Base))throw new Error("Plugin should extend the me.plugin.Base Class !");if(utils.checkVersion(n.version)>0)throw new Error("Plugin version mismatch, expected: "+n.version+", got: "+version);plugins[t]=n}},Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*Easing.Bounce.In(2*e):.5*Easing.Bounce.Out(2*e-1)+.5}}},Interpolation={Linear:function(e,t){var i=e.length-1,n=i*t,r=Math.floor(n),o=Interpolation.Utils.Linear;return t<0?o(e[0],e[1],n):t>1?o(e[i],e[i-1],i-n):o(e[r],e[r+1>i?i:r+1],n-r)},Bezier:function(e,t){var i,n=0,r=e.length-1,o=Math.pow,s=Interpolation.Utils.Bernstein;for(i=0;i<=r;i++)n+=o(1-t,r-i)*o(t,i)*e[i]*s(r,i);return n},CatmullRom:function(e,t){var i=e.length-1,n=i*t,r=Math.floor(n),o=Interpolation.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(r=Math.floor(n=i*(1+t))),o(e[(r-1+i)%i],e[r],e[(r+1)%i],e[(r+2)%i],n-r)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[i]-(o(e[i],e[i],e[i-1],e[i-1],n-i)-e[i]):o(e[r?r-1:0],e[r],e[i<r+1?i:r+1],e[i<r+2?i:r+2],n-r)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i,n=1;if(e[t])return e[t];for(i=t;i>1;i--)n*=i;return e[t]=n,n}}(),CatmullRom:function(e,t,i,n,r){var o=.5*(i-e),s=.5*(n-t),a=r*r;return(2*t-2*i+o+s)*(r*a)+(-3*t+3*i-2*o-s)*a+o*r+t}}},Tween=function(){function e(t){_classCallCheck(this,e),this.setProperties(t)}return _createClass(e,[{key:"onResetEvent",value:function(e){this.setProperties(e)}},{key:"setProperties",value:function(e){for(var t in this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=Easing.Linear.None,this._interpolationFunction=Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._tweenTimeTracker=lastUpdate,this.isPersistent=!1,this.updateWhenPaused=!1,this.isRenderable=!1,e)"object"!==_typeof(e)&&(this._valuesStart[t]=parseFloat(e[t]))}},{key:"_resumeCallback",value:function(e){this._startTime&&(this._startTime+=e)}},{key:"onActivateEvent",value:function(){on(STATE_RESUME,this._resumeCallback,this)}},{key:"onDeactivateEvent",value:function(){off(STATE_RESUME,this._resumeCallback)}},{key:"to",value:function(e,t){return this._valuesEnd=e,void 0!==t&&("number"==typeof t?this._duration=t:"object"===_typeof(t)&&(t.duration&&(this._duration=t.duration),t.yoyo&&this.yoyo(t.yoyo),t.easing&&this.easing(t.easing),t.repeat&&this.repeat(t.repeat),t.delay&&this.delay(t.delay),t.interpolation&&this.interpolation(t.interpolation),t.autoStart&&this.start())),this}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:timer$1.getTime();for(var t in this._onStartCallbackFired=!1,world.addChild(this),this._startTime=e+this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0}return this}},{key:"stop",value:function(){return world.removeChildNow(this),this}},{key:"delay",value:function(e){return this._delayTime=e,this}},{key:"repeat",value:function(e){return this._repeat=e,this}},{key:"yoyo",value:function(e){return this._yoyo=e,this}},{key:"easing",value:function(e){if("function"!=typeof e)throw new Error("invalid easing function for me.Tween.easing()");return this._easingFunction=e,this}},{key:"interpolation",value:function(e){return this._interpolationFunction=e,this}},{key:"chain",value:function(){return this._chainedTweens=arguments,this}},{key:"onStart",value:function(e){return this._onStartCallback=e,this}},{key:"onUpdate",value:function(e){return this._onUpdateCallback=e,this}},{key:"onComplete",value:function(e){return this._onCompleteCallback=e,this}},{key:"update",value:function(e){this._tweenTimeTracker=lastUpdate>this._tweenTimeTracker?lastUpdate:this._tweenTimeTracker+e;var t,i=this._tweenTimeTracker;if(i<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback.call(this._object),this._onStartCallbackFired=!0);var n=(i-this._startTime)/this._duration;n=n>1?1:n;var r=this._easingFunction(n);for(t in this._valuesEnd){var o=this._valuesStart[t]||0,s=this._valuesEnd[t];s instanceof Array?this._object[t]=this._interpolationFunction(s,r):("string"==typeof s&&(s=o+parseFloat(s)),"number"==typeof s&&(this._object[t]=o+(s-o)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._object,r),1===n){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=i+this._delayTime,!0}world.removeChildNow(this),null!==this._onCompleteCallback&&this._onCompleteCallback.call(this._object);for(var l=0,u=this._chainedTweens.length;l<u;l++)this._chainedTweens[l].start(i);return!1}return!0}}],[{key:"Easing",get:function(){return Easing}},{key:"Interpolation",get:function(){return Interpolation}}]),e}(),runits=["ex","em","pt","px"],toPX=[12,24,.75,1],setContextStyle=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.font=t.font,e.fillStyle=t.fillStyle.toRGBA(),!0===i&&(e.strokeStyle=t.strokeStyle.toRGBA(),e.lineWidth=t.lineWidth),e.textAlign=t.textAlign,e.textBaseline=t.textBaseline},Text=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var o;return _classCallCheck(this,i),(o=t.call(this,e,n,r.width||0,r.height||0)).onResetEvent(e,n,r),o}return _createClass(i,[{key:"onResetEvent",value:function(e,t,i){void 0!==i.fillStyle?i.fillStyle instanceof Color?this.fillStyle=i.fillStyle:this.fillStyle=pool.pull("Color").parseCSS(i.fillStyle):this.fillStyle=pool.pull("Color",0,0,0),void 0!==i.strokeStyle?i.strokeStyle instanceof Color?this.strokeStyle=i.strokeStyle:this.strokeStyle=pool.pull("Color").parseCSS(i.strokeStyle):this.strokeStyle=pool.pull("Color",0,0,0),this.lineWidth=i.lineWidth||1,this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.offScreenCanvas=!1,this._text=[],this.fontSize=10,void 0!==i.anchorPoint?this.anchorPoint.setV(i.anchorPoint):this.anchorPoint.set(0,0),void 0!==i.floating&&(this.floating=!!i.floating),this.setFont(i.font,i.size),!0===i.bold&&this.bold(),!0===i.italic&&this.italic(),!0===i.offScreenCanvas&&(this.offScreenCanvas=!0,this.canvas=createCanvas(2,2,!0),this.context=this.canvas.getContext("2d")),this.setText(i.text),this.update(0)}},{key:"onDeactivateEvent",value:function(){!0===this.offScreenCanvas&&(renderer.currentCompositor.deleteTexture2D(renderer.currentCompositor.getTexture2D(this.glTextureUnit)),renderer.cache.delete(this.canvas),this.canvas.width=this.canvas.height=0,this.context=void 0,this.canvas=void 0,this.glTextureUnit=void 0)}},{key:"bold",value:function(){return this.font="bold "+this.font,this.isDirty=!0,this}},{key:"italic",value:function(){return this.font="italic "+this.font,this.isDirty=!0,this}},{key:"setFont",value:function(e,t){var i=e.split(",").map((function(e){return e=e.trim(),/(^".*"$)|(^'.*'$)/.test(e)?e:'"'+e+'"'}));if("number"==typeof t)this.fontSize=t,t+="px";else{var n=t.match(/([-+]?[\d.]*)(.*)/);this.fontSize=parseFloat(n[1]),n[2]?this.fontSize*=toPX[runits.indexOf(n[2])]:t+="px"}return this.height=this.fontSize,this.font=t+" "+i.join(","),this.isDirty=!0,this}},{key:"setText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this._text.toString()!==e.toString()&&(Array.isArray(e)?this._text=e:this._text=(""+e).split("\n"),this.isDirty=!0),this}},{key:"measureText",value:function(e,t,i){var n,r=i||this.getBounds(),o=this.fontSize*this.lineHeight,s=void 0!==t?(""+t).split("\n"):this._text;(n=!0===this.offScreenCanvas?this.context:e.getFontContext()).save(),setContextStyle(n,this),this.height=this.width=0;for(var a=0;a<s.length;a++)this.width=Math.max(n.measureText(trimRight(""+s[a])).width,this.width),this.height+=o;return r.width=Math.ceil(this.width),r.height=Math.ceil(this.height),r.x=Math.floor("right"===this.textAlign?this.pos.x-this.width:"center"===this.textAlign?this.pos.x-this.width/2:this.pos.x),r.y=Math.floor(0===this.textBaseline.search(/^(top|hanging)$/)?this.pos.y:"middle"===this.textBaseline?this.pos.y-r.height/2:this.pos.y-r.height),n.restore(),r}},{key:"update",value:function(){if(!0===this.isDirty){var e=this.measureText(renderer);if(!0===this.offScreenCanvas){var t=Math.round(e.width),i=Math.round(e.height);renderer instanceof WebGLRenderer&&(this.glTextureUnit=renderer.cache.getUnit(renderer.cache.get(this.canvas)),renderer.currentCompositor.unbindTexture2D(null,this.glTextureUnit),1===renderer.WebGLVersion&&(t=nextPowerOfTwo(e.width),i=nextPowerOfTwo(e.height))),this.canvas.width<t||this.canvas.height<i?(this.canvas.width=t,this.canvas.height=i):this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this._drawFont(this.context,this._text,this.pos.x-e.x,this.pos.y-e.y,!1)}}return this.isDirty}},{key:"draw",value:function(e,t,i,n,r){void 0===this.ancestor?(this.setText(t),this.pos.x===i&&this.pos.y===n||(this.pos.x=i,this.pos.y=n,this.isDirty=!0),this.update(0),e.save(),e.setGlobalAlpha(e.globalAlpha()*this.getOpacity())):(i=this.pos.x,n=this.pos.y),!1===e.settings.subPixel&&(i=~~i,n=~~n),!0===this.offScreenCanvas?e.drawImage(this.canvas,this.getBounds().x,this.getBounds().y):e.drawFont(this._drawFont(e.getFontContext(),this._text,i,n,r)),void 0===this.ancestor&&e.restore(),this.isDirty=!1}},{key:"drawStroke",value:function(e,t,i,n){this.draw(e,t,i,n,!0)}},{key:"_drawFont",value:function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];setContextStyle(e,this,r);for(var o=this.fontSize*this.lineHeight,s=0;s<t.length;s++){var a=trimRight(""+t[s]);e[r?"strokeText":"fillText"](a,i,n),n+=o}return this.getBounds()}},{key:"destroy",value:function(){pool.push(this.fillStyle),pool.push(this.strokeStyle),this.fillStyle=this.strokeStyle=void 0,this._text.length=0,_get(_getPrototypeOf(i.prototype),"destroy",this).call(this)}}]),i}(Renderable),measureTextWidth=function(e,t){for(var i=t.split(""),n=0,r=null,o=0;o<i.length;o++){var s=i[o].charCodeAt(0),a=e.fontData.glyphs[s],l=r&&r.kerning?r.getKerning(s):0;n+=(a.xadvance+l)*e.fontScale.x,r=a}return n},measureTextHeight=function(e){return e.fontData.capHeight*e.lineHeight*e.fontScale.y},BitmapText=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var o;return _classCallCheck(this,i),(o=t.call(this,e,n,r.width||0,r.height||0)).textAlign=r.textAlign||"left",o.textBaseline=r.textBaseline||"top",o.lineHeight=r.lineHeight||1,o._text=[],o.fontScale=pool.pull("Vector2d",1,1),o.fontImage="object"===_typeof(r.font)?r.font:loader.getImage(r.font),"string"!=typeof r.fontData?o.fontData=pool.pull("BitmapTextData",loader.getBinary(r.font)):o.fontData=pool.pull("BitmapTextData",r.fontData.includes("info face")?r.fontData:loader.getBinary(r.fontData)),void 0!==r.floating&&(o.floating=!!r.floating),"number"==typeof r.size&&1!==r.size&&o.resize(r.size),void 0!==r.fillStyle&&(r.fillStyle instanceof Color?o.fillStyle.setColor(r.fillStyle):o.fillStyle.parseCSS(r.fillStyle)),void 0!==r.anchorPoint?o.anchorPoint.set(r.anchorPoint.x,r.anchorPoint.y):o.anchorPoint.set(0,0),o.setText(r.text),o}return _createClass(i,[{key:"set",value:function(e,t){return this.textAlign=e,t&&this.resize(t),this.isDirty=!0,this}},{key:"setText",value:function(e){return void 0===e&&(e=""),this._text.toString()!==e.toString()&&(Array.isArray(e)?this._text=e:this._text=(""+e).split("\n"),this.isDirty=!0),this}},{key:"fillStyle",get:function(){return this.tint},set:function(e){this.tint=e}},{key:"resize",value:function(e){return this.fontScale.set(e,e),this.isDirty=!0,this}},{key:"measureText",value:function(e,t){e=e||this._text;var i=measureTextHeight(this),n=t||this.getBounds(),r="string"==typeof e?(""+e).split("\n"):e;n.height=n.width=0;for(var o=0;o<r.length;o++)n.width=Math.max(measureTextWidth(this,r[o]),n.width),n.height+=i;return n}},{key:"update",value:function(){return!0===this.isDirty&&this.measureText(),this.isDirty}},{key:"draw",value:function(e,t,i,n){var r=e.globalAlpha();void 0===this.ancestor?(this.setText(t),this.update(0),e.setGlobalAlpha(r*this.getOpacity())):(i=this.pos.x,n=this.pos.y);for(var o=i,s=measureTextHeight(this),a=0,l=0;l<this._text.length;l++){i=o;var u=trimRight(this._text[l]),h=measureTextWidth(this,u);switch(this.textAlign){case"right":i-=h;break;case"center":i-=.5*h}switch(this.textBaseline){case"middle":n-=.5*s;break;case"ideographic":case"alphabetic":case"bottom":n-=s}!0===this.isDirty&&void 0===this.ancestor&&(0===l&&(this.pos.y=n),a<h&&(a=h,this.pos.x=i));for(var c=null,d=0,f=u.length;d<f;d++){var p=u.charCodeAt(d),v=this.fontData.glyphs[p],y=v.width,g=v.height,_=c&&c.kerning?c.getKerning(p):0;0!==y&&0!==g&&e.drawImage(this.fontImage,v.x,v.y,y,g,i+v.xoffset,n+v.yoffset*this.fontScale.y,y*this.fontScale.x,g*this.fontScale.y),i+=(v.xadvance+_)*this.fontScale.x,c=v}n+=s}void 0===this.ancestor&&e.setGlobalAlpha(r),this.isDirty=!1}},{key:"destroy",value:function(){pool.push(this.fontScale),this.fontScale=void 0,pool.push(this.fontData),this.fontData=void 0,this._text.length=0,_get(_getPrototypeOf(i.prototype),"destroy",this).call(this)}}]),i}(Renderable),LOG2_PAGE_SIZE=9,PAGE_SIZE=1<<LOG2_PAGE_SIZE,Glyph=function(){function e(){_classCallCheck(this,e),this.id=0,this.x=0,this.y=0,this.width=0,this.height=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.xoffset=0,this.yoffset=0,this.xadvance=0,this.fixedWidth=!1}return _createClass(e,[{key:"getKerning",value:function(e){if(this.kerning){var t=this.kerning[e>>>LOG2_PAGE_SIZE];if(t)return t[e&PAGE_SIZE-1]||0}return 0}},{key:"setKerning",value:function(e,t){this.kerning||(this.kerning={});var i=this.kerning[e>>>LOG2_PAGE_SIZE];void 0===i&&(this.kerning[e>>>LOG2_PAGE_SIZE]={},i=this.kerning[e>>>LOG2_PAGE_SIZE]),i[e&PAGE_SIZE-1]=t}}]),e}(),capChars=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function getValueFromPair(e,t){var i=e.match(t);if(!i)throw new Error("Could not find pattern "+t+" in string: "+e);return i[0].split("=")[1]}function getFirstGlyph(e){for(var t=Object.keys(e),i=0;i<t.length;i++)if(t[i]>32)return e[t[i]];return null}function createSpaceGlyph(e){var t=" ".charCodeAt(0),i=e[t];i||((i=new Glyph).id=t,i.xadvance=getFirstGlyph(e).xadvance,e[t]=i)}var BitmapTextData=function(){function e(t){_classCallCheck(this,e),this.onResetEvent(t)}return _createClass(e,[{key:"onResetEvent",value:function(e){this.padTop=0,this.padRight=0,this.padBottom=0,this.padLeft=0,this.lineHeight=0,this.capHeight=1,this.descent=0,this.glyphs={},this.parse(e)}},{key:"parse",value:function(e){if(!e)throw new Error("File containing font data was empty, cannot load the bitmap font.");var t=e.split(/\r\n|\n/),i=e.match(/padding\=\d+,\d+,\d+,\d+/g);if(!i)throw new Error("Padding not found in first line");var n=i[0].split("=")[1].split(",");this.padTop=parseFloat(n[0]),this.padLeft=parseFloat(n[1]),this.padBottom=parseFloat(n[2]),this.padRight=parseFloat(n[3]),this.lineHeight=parseFloat(getValueFromPair(t[1],/lineHeight\=\d+/g));var r,o=parseFloat(getValueFromPair(t[1],/base\=\d+/g)),s=this.padTop+this.padBottom,a=null;for(r=4;r<t.length;r++){var l=t[r],u=l.split(/=|\s+/);if(l&&!/^kernings/.test(l))if(/^kerning\s/.test(l)){var h=parseFloat(u[2]),c=parseFloat(u[4]),d=parseFloat(u[6]);null!=(a=this.glyphs[h])&&a.setKerning(c,d)}else{a=new Glyph;var f=parseFloat(u[2]);a.id=f,a.x=parseFloat(u[4]),a.y=parseFloat(u[6]),a.width=parseFloat(u[8]),a.height=parseFloat(u[10]),a.xoffset=parseFloat(u[12]),a.yoffset=parseFloat(u[14]),a.xadvance=parseFloat(u[16]),a.width>0&&a.height>0&&(this.descent=Math.min(o+a.yoffset,this.descent)),this.glyphs[f]=a}}this.descent+=this.padBottom,createSpaceGlyph(this.glyphs);var p=null;for(r=0;r<capChars.length;r++){var v=capChars[r];if(p=this.glyphs[v.charCodeAt(0)])break}if(p)this.capHeight=p.height;else for(var y in this.glyphs)if(this.glyphs.hasOwnProperty(y)){if(0===(a=this.glyphs[y]).height||0===a.width)continue;this.capHeight=Math.max(this.capHeight,a.height)}this.capHeight-=s}}]),e}(),ColorLayer=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var o;return _classCallCheck(this,i),(o=t.call(this,0,0,1/0,1/0)).color=pool.pull("Color").parseCSS(n),o.onResetEvent(e,n,r),o}return _createClass(i,[{key:"onResetEvent",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.name=e,this.pos.z=i,this.floating=!0,this.color.parseCSS(t)}},{key:"draw",value:function(e,t){var i=viewport.pos;e.save(),e.clipRect(t.left-i.x,t.top-i.y,t.width,t.height),e.clearColor(this.color),e.restore()}},{key:"destroy",value:function(){pool.push(this.color),this.color=void 0,_get(_getPrototypeOf(i.prototype),"destroy",this).call(this)}}]),i}(Renderable),ImageLayer=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var o;return _classCallCheck(this,i),(o=t.call(this,e,n,r)).floating=!0,o.offset.set(e,n),o.ratio=pool.pull("Vector2d",1,1),void 0!==r.ratio&&(isNumeric(r.ratio)?o.ratio.set(r.ratio,+r.ratio):o.ratio.setV(r.ratio)),void 0===r.anchorPoint?o.anchorPoint.set(0,0):"number"==typeof r.anchorPoint?o.anchorPoint.set(r.anchorPoint,r.anchorPoint):o.anchorPoint.setV(r.anchorPoint),o.repeat=r.repeat||"repeat",on(WEBGL_ONCONTEXT_RESTORED,o.createPattern,_assertThisInitialized(o)),o}return _createClass(i,[{key:"repeat",get:function(){return this._repeat},set:function(e){switch(this._repeat=e,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0}this.resize(viewport.width,viewport.height),this.createPattern()}},{key:"onActivateEvent",value:function(){var e=this;on(VIEWPORT_ONCHANGE,this.updateLayer,this),on(VIEWPORT_ONRESIZE,this.resize,this),once(LEVEL_LOADED,(function(){e.updateLayer(viewport.pos)})),!0!==this.ancestor.root&&this.updateLayer(viewport.pos)}},{key:"resize",value:function(e,t){_get(_getPrototypeOf(i.prototype),"resize",this).call(this,this.repeatX?1/0:e,this.repeatY?1/0:t)}},{key:"createPattern",value:function(){this._pattern=renderer.createPattern(this.image,this._repeat)}},{key:"updateLayer",value:function(e){var t=this.ratio.x,i=this.ratio.y;if(0!==t||0!==i){var n=this.width,r=this.height,o=viewport.bounds.width,s=viewport.bounds.height,a=this.anchorPoint.x,l=this.anchorPoint.y,u=a*(t-1)*(o-viewport.width)+this.offset.x-t*e.x,h=l*(i-1)*(s-viewport.height)+this.offset.y-i*e.y;this.repeatX?this.pos.x=u%n:this.pos.x=u,this.repeatY?this.pos.y=h%r:this.pos.y=h,this.isDirty=!0}}},{key:"preDraw",value:function(e){e.save(),e.setGlobalAlpha(e.globalAlpha()*this.getOpacity()),e.setTint(this.tint)}},{key:"draw",value:function(e){var t=this.width,i=this.height,n=viewport.bounds.width,r=viewport.bounds.height,o=this.anchorPoint.x,s=this.anchorPoint.y,a=this.pos.x,l=this.pos.y;0===this.ratio.x&&0===this.ratio.y&&(a+=o*(n-t),l+=s*(r-i)),e.translate(a,l),e.drawPattern(this._pattern,0,0,2*viewport.width,2*viewport.height)}},{key:"onDeactivateEvent",value:function(){off(VIEWPORT_ONCHANGE,this.updateLayer),off(VIEWPORT_ONRESIZE,this.resize)}},{key:"destroy",value:function(){pool.push(this.ratio),this.ratio=void 0,off(WEBGL_ONCONTEXT_RESTORED,this.createPattern),_get(_getPrototypeOf(i.prototype),"destroy",this).call(this)}}]),i}(Sprite),NineSliceSprite=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var o;if(_classCallCheck(this,i),o=t.call(this,e,n,r),"number"!=typeof r.width||"number"!=typeof r.height)throw new Error("height and width properties are mandatory");return o.nss_width=Math.floor(r.width),o.nss_height=Math.floor(r.height),o.insetx=r.insetx,o.insety=r.insety,o}return _createClass(i,[{key:"draw",value:function(e){var t=this.current,i=this.pos.x,n=this.pos.y,r=t.width,o=t.height,s=t.offset,a=this.offset;0!==t.angle&&(e.translate(-i,-n),e.rotate(t.angle),i-=o,r=t.height,o=t.width);var l=a.x+s.x,u=a.y+s.y,h=this.insetx||r/4,c=this.insety||o/4;e.drawImage(this.image,l,u,h,c,i,n,h,c),e.drawImage(this.image,l+r-h,u,h,c,i+this.nss_width-h,n,h,c),e.drawImage(this.image,l,u+o-c,h,c,i,n+this.nss_height-c,h,c),e.drawImage(this.image,l+r-h,u+o-c,h,c,i+this.nss_width-h,n+this.nss_height-c,h,c);var d=r-(h<<1),f=o-(c<<1),p=this.nss_width-(h<<1),v=this.nss_height-(c<<1);e.drawImage(this.image,l+h,u,d,c,i+h,n,p,c),e.drawImage(this.image,l+h,u+o-c,d,c,i+h,n+this.nss_height-c,p,c),e.drawImage(this.image,l,u+c,h,f,i,n+c,h,v),e.drawImage(this.image,l+r-h,u+c,h,f,i+this.nss_width-h,n+c,h,v),e.drawImage(this.image,l+h,u+c,d,f,i+h,n+c,p,v)}}]),i}(Sprite),GUI_Object=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var o;return _classCallCheck(this,i),(o=t.call(this,e,n,r)).isClickable=!0,o.holdThreshold=250,o.isHoldable=!1,o.hover=!1,o.holdTimeout=null,o.released=!0,o.floating=!0,o.isKinematic=!1,o}return _createClass(i,[{key:"clicked",value:function(e){if(0===e.button&&this.isClickable)return this.dirty=!0,this.released=!1,this.isHoldable&&(null!==this.holdTimeout&&timer$1.clearTimeout(this.holdTimeout),this.holdTimeout=timer$1.setTimeout(this.hold.bind(this),this.holdThreshold,!1),this.released=!1),this.onClick(e)}},{key:"onClick",value:function(){return!1}},{key:"enter",value:function(e){return this.hover=!0,this.dirty=!0,this.onOver(e)}},{key:"onOver",value:function(){}},{key:"leave",value:function(e){return this.hover=!1,this.dirty=!0,this.release(e),this.onOut(e)}},{key:"onOut",value:function(){}},{key:"release",value:function(e){if(!1===this.released)return this.released=!0,this.dirty=!0,timer$1.clearTimeout(this.holdTimeout),this.onRelease(e)}},{key:"onRelease",value:function(){return!1}},{key:"hold",value:function(){timer$1.clearTimeout(this.holdTimeout),this.dirty=!0,this.released||this.onHold()}},{key:"onHold",value:function(){}},{key:"onActivateEvent",value:function(){registerPointerEvent("pointerdown",this,this.clicked.bind(this)),registerPointerEvent("pointerup",this,this.release.bind(this)),registerPointerEvent("pointercancel",this,this.release.bind(this)),registerPointerEvent("pointerenter",this,this.enter.bind(this)),registerPointerEvent("pointerleave",this,this.leave.bind(this))}},{key:"onDeactivateEvent",value:function(){releasePointerEvent("pointerdown",this),releasePointerEvent("pointerup",this),releasePointerEvent("pointercancel",this),releasePointerEvent("pointerenter",this),releasePointerEvent("pointerleave",this),timer$1.clearTimeout(this.holdTimeout)}}]),i}(Sprite),Collectable=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var o;return _classCallCheck(this,i),(o=t.call(this,e,n,r)).name=r.name,o.type=r.type,o.id=r.id,o.body=new Body(_assertThisInitialized(o),r.shapes||new Rect(0,0,o.width,o.height)),o.body.collisionType=collision.types.COLLECTABLE_OBJECT,o.body.setCollisionMask(collision.types.PLAYER_OBJECT),o.body.setStatic(!0),r.anchorPoint?o.anchorPoint.set(r.anchorPoint.x,r.anchorPoint.y):o.anchorPoint.set(0,0),o}return _createClass(i)}(Sprite),Trigger=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var o;return _classCallCheck(this,i),(o=t.call(this,e,n,r.width||0,r.height||0)).anchorPoint.set(0,0),o.fade=r.fade,o.duration=r.duration,o.fading=!1,o.name="Trigger",o.type=r.type,o.id=r.id,o.gotolevel=r.to,o.triggerSettings={event:"level"},["type","container","onLoaded","flatten","setViewportBounds","to"].forEach(function(e){void 0!==r[e]&&(this.triggerSettings[e]=r[e])}.bind(_assertThisInitialized(o))),o.body=new Body(_assertThisInitialized(o),r.shapes||new Rect(0,0,o.width,o.height)),o.body.collisionType=collision.types.ACTION_OBJECT,o.body.setCollisionMask(collision.types.PLAYER_OBJECT),o.body.setStatic(!0),o.resize(o.body.getBounds().width,o.body.getBounds().height),o}return _createClass(i,[{key:"getTriggerSettings",value:function(){return"string"==typeof this.triggerSettings.container&&(this.triggerSettings.container=world.getChildByName(this.triggerSettings.container)[0]),this.triggerSettings}},{key:"onFadeComplete",value:function(){level.load(this.gotolevel,this.getTriggerSettings()),viewport.fadeOut(this.fade,this.duration)}},{key:"triggerEvent",value:function(){var e=this.getTriggerSettings();if("level"!==e.event)throw new Error("Trigger invalid type");this.gotolevel=e.to,this.fade&&this.duration?this.fading||(this.fading=!0,viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))):level.load(this.gotolevel,e)}},{key:"onCollision",value:function(){return"Trigger"===this.name&&this.triggerEvent.apply(this),!1}}]),i}(Renderable),Draggable=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,o){var s;return _classCallCheck(this,i),(s=t.call(this,e,n,r,o)).isKinematic=!1,s.dragging=!1,s.dragId=null,s.grabOffset=new Vector2d(0,0),s.initEvents(),s}return _createClass(i,[{key:"initEvents",value:function(){var e=this;registerPointerEvent("pointerdown",this,(function(t){emit(DRAGSTART,t,e)})),registerPointerEvent("pointerup",this,(function(t){emit(DRAGEND,t,e)})),registerPointerEvent("pointercancel",this,(function(t){emit(DRAGEND,t,e)})),on(POINTERMOVE,this.dragMove.bind(this)),on(DRAGSTART,(function(t,i){i===e&&e.dragStart(t)})),on(DRAGEND,(function(t,i){i===e&&e.dragEnd(t)}))}},{key:"dragStart",value:function(e){if(!1===this.dragging)return this.dragging=!0,this.grabOffset.set(e.gameX,e.gameY),this.grabOffset.sub(this.pos),!1}},{key:"dragMove",value:function(e){!0===this.dragging&&(this.pos.set(e.gameX,e.gameY,this.pos.z),this.pos.sub(this.grabOffset))}},{key:"dragEnd",value:function(){if(!0===this.dragging)return this.dragging=!1,!1}},{key:"destroy",value:function(){off(POINTERMOVE,this.dragMove),off(DRAGSTART,this.dragStart),off(DRAGEND,this.dragEnd),releasePointerEvent("pointerdown",this),releasePointerEvent("pointerup",this),releasePointerEvent("pointercancel",this),_get(_getPrototypeOf(i.prototype),"destroy",this).call(this)}}]),i}(Renderable),DropTarget=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,o){var s;return _classCallCheck(this,i),(s=t.call(this,e,n,r,o)).isKinematic=!1,s.CHECKMETHOD_OVERLAP="overlaps",s.CHECKMETHOD_CONTAINS="contains",s.checkMethod=s.CHECKMETHOD_OVERLAP,on(DRAGEND,s.checkOnMe,_assertThisInitialized(s)),s}return _createClass(i,[{key:"setCheckMethod",value:function(e){"function"==typeof this.getBounds()[this.checkMethod]&&(this.checkMethod=e)}},{key:"checkOnMe",value:function(e,t){t&&this.getBounds()[this.checkMethod](t.getBounds())&&this.drop(t)}},{key:"drop",value:function(){}},{key:"destroy",value:function(){off(DRAGEND,this.checkOnMe),_get(_getPrototypeOf(i.prototype),"destroy",this).call(this)}}]),i}(Renderable),ParticleContainer=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var n;return _classCallCheck(this,i),(n=t.call(this,viewport.pos.x,viewport.pos.y,viewport.width,viewport.height)).autoSort=!1,n._updateCount=0,n._dt=0,n._emitter=e,n.autoTransform=!1,n.anchorPoint.set(0,0),n.isKinematic=!0,n}return _createClass(i,[{key:"update",value:function(e){if(++this._updateCount>this._emitter.framesToSkip&&(this._updateCount=0),this._updateCount>0)return this._dt+=e,!1;e+=this._dt,this._dt=0;for(var t=this.children.length-1;t>=0;--t){var i=this.children[t];i.inViewport=viewport.isVisible(i,this.floating),i.update(e)||this.removeChildNow(i)}return!0}},{key:"draw",value:function(e,t){if(this.children.length>0){var n,r=e.getContext();this._emitter.textureAdditive&&(n=r.globalCompositeOperation,r.globalCompositeOperation="lighter"),_get(_getPrototypeOf(i.prototype),"draw",this).call(this,e,t),this._emitter.textureAdditive&&(r.globalCompositeOperation=n)}}}]),i}(Container),pixel=(canvas=createCanvas(1,1),context=canvas.getContext("2d"),context.fillStyle="#fff",context.fillRect(0,0,1,1),canvas),canvas,context,ParticleEmitterSettings={width:0,height:0,image:pixel,totalParticles:50,angle:Math.PI/2,angleVariation:0,minLife:1e3,maxLife:3e3,speed:2,speedVariation:1,minRotation:0,maxRotation:0,minStartScale:1,maxStartScale:1,minEndScale:0,maxEndScale:0,gravity:0,wind:0,followTrajectory:!1,textureAdditive:!1,onlyInViewport:!0,floating:!1,maxParticles:10,frequency:100,duration:1/0,framesToSkip:0},ParticleEmitter=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var o;return _classCallCheck(this,i),(o=t.call(this,e,n,1/0,1/0))._stream=!1,o._frequencyTimer=0,o._durationTimer=0,o._enabled=!1,o.alwaysUpdate=!0,o.autoSort=!1,o.container=new ParticleContainer(_assertThisInitialized(o)),o.reset(r),o}return _createClass(i,[{key:"z",get:function(){return this.container.pos.z},set:function(e){this.container.pos.z=e}},{key:"floating",get:function(){return this.container.floating},set:function(e){this.container.floating=e}},{key:"onActivateEvent",value:function(){this.ancestor.addChild(this.container),this.container.pos.z=this.pos.z,this.ancestor.autoSort||this.ancestor.sort()}},{key:"onDeactivateEvent",value:function(){this.ancestor.hasChild(this.container)&&this.ancestor.removeChildNow(this.container)}},{key:"destroy",value:function(){this.reset()}},{key:"getRandomPointX",value:function(){return this.pos.x+randomFloat(0,this.width)}},{key:"getRandomPointY",value:function(){return this.pos.y+randomFloat(0,this.height)}},{key:"reset",value:function(e){var t=ParticleEmitterSettings,i="number"==typeof(e=e||{}).width?e.width:t.width,n="number"==typeof e.height?e.height:t.height;this.resize(i,n),Object.assign(this,t,e),this.container.reset()}},{key:"addParticles",value:function(e){for(var t=0;t<~~e;t++){var i=pool.pull("Particle",this);this.container.addChild(i)}}},{key:"isRunning",value:function(){return this._enabled&&this._stream}},{key:"streamParticles",value:function(e){this._enabled=!0,this._stream=!0,this.frequency=Math.max(this.frequency,1),this._durationTimer="number"==typeof e?e:this.duration}},{key:"stopStream",value:function(){this._enabled=!1}},{key:"burstParticles",value:function(e){this._enabled=!0,this._stream=!1,this.addParticles("number"==typeof e?e:this.totalParticles),this._enabled=!1}},{key:"update",value:function(e){if(this._enabled&&this._stream){if(this._durationTimer!==1/0&&(this._durationTimer-=e,this._durationTimer<=0))return this.stopStream(),!1;this._frequencyTimer+=e;var t=this.container.children.length;t<this.totalParticles&&this._frequencyTimer>=this.frequency&&(t+this.maxParticles<=this.totalParticles?this.addParticles(this.maxParticles):this.addParticles(this.totalParticles-t),this._frequencyTimer=0)}return!0}}]),i}(Renderable),Particle=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var n;return _classCallCheck(this,i),(n=t.call(this,e.getRandomPointX(),e.getRandomPointY(),e.image.width,e.image.height)).vel=new Vector2d,n.onResetEvent(e,!0),n}return _createClass(i,[{key:"onResetEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!1===t&&_get(_getPrototypeOf(i.prototype),"onResetEvent",this).call(this,e.getRandomPointX(),e.getRandomPointY(),e.image.width,e.image.height),this.alwaysUpdate=!0,this.image=e.image;var n=e.angle+(e.angleVariation>0?(randomFloat(0,2)-1)*e.angleVariation:0),r=e.speed+(e.speedVariation>0?(randomFloat(0,2)-1)*e.speedVariation:0);this.vel.set(r*Math.cos(n),-r*Math.sin(n)),this.life=randomFloat(e.minLife,e.maxLife),this.startLife=this.life,this.startScale=_clamp(randomFloat(e.minStartScale,e.maxStartScale),e.minStartScale,e.maxStartScale),this.endScale=_clamp(randomFloat(e.minEndScale,e.maxEndScale),e.minEndScale,e.maxEndScale),this.gravity=e.gravity,this.wind=e.wind,this.followTrajectory=e.followTrajectory,this.onlyInViewport=e.onlyInViewport,this.pos.z=e.z,this._deltaInv=timer$1.maxfps/1e3,e.followTrajectory||(this.angle=randomFloat(e.minRotation,e.maxRotation))}},{key:"update",value:function(e){var t=e*this._deltaInv;this.life=this.life>e?this.life-e:0;var i=this.life/this.startLife,n=this.startScale;this.startScale>this.endScale?n=(n*=i)<this.endScale?this.endScale:n:this.startScale<this.endScale&&(n=(n/=i)>this.endScale?this.endScale:n),this.alpha=i,this.vel.x+=this.wind*t,this.vel.y+=this.gravity*t;var r=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this.angle;return this.pos.x+=this.vel.x*t,this.pos.y+=this.vel.y*t,this.currentTransform.setTransform(n,0,0,0,n,0,this.pos.x,this.pos.y,1).rotate(r),(this.inViewport||!this.onlyInViewport)&&this.life>0}},{key:"preDraw",value:function(e){e.save(),e.setGlobalAlpha(e.globalAlpha()*this.alpha),e.transform(this.currentTransform)}},{key:"draw",value:function(e){var t=this.width,i=this.height;e.drawImage(this.image,0,0,t,i,-t/2,-i/2,t,i)}}]),i}(Renderable),Entity=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var o;if(_classCallCheck(this,i),"number"!=typeof r.width||"number"!=typeof r.height)throw new Error("height and width properties are mandatory when passing settings parameters to an object entity");return(o=t.call(this,e,n,r.width,r.height)).children=[],r.image&&(r.framewidth=r.framewidth||r.width,r.frameheight=r.frameheight||r.height,o.renderable=new Sprite(0,0,r)),r.anchorPoint?o.anchorPoint.set(r.anchorPoint.x,r.anchorPoint.y):o.anchorPoint.set(0,0),"string"==typeof r.name&&(o.name=r.name),o.type=r.type||"",o.id=r.id||"",o.alive=!0,void 0===r.shapes&&(r.shapes=new Polygon(0,0,[new Vector2d(0,0),new Vector2d(o.width,0),new Vector2d(o.width,o.height),new Vector2d(0,o.height)])),o.body=new Body(_assertThisInitialized(o),r.shapes,o.onBodyUpdate.bind(_assertThisInitialized(o))),0===o.width&&0===o.height&&o.resize(o.body.getBounds().width,o.body.getBounds().height),o.body.setCollisionMask(r.collisionMask),o.body.setCollisionType(r.collisionType),o.autoTransform=!1,o}return _createClass(i,[{key:"renderable",get:function(){return this.children[0]},set:function(e){if(!(e instanceof Renderable))throw new Error(e+"should extend me.Renderable");this.children[0]=e,this.children[0].ancestor=this}},{key:"update",value:function(e){return this.renderable&&(this.isDirty|=this.renderable.update(e)),_get(_getPrototypeOf(i.prototype),"update",this).call(this,e)}},{key:"onBodyUpdate",value:function(e){this.getBounds().addBounds(e.getBounds(),!0),this.updateBoundsPos(this.pos.x,this.pos.y)}},{key:"preDraw",value:function(e){e.save(),e.translate(this.pos.x+this.body.getBounds().x,this.pos.y+this.body.getBounds().y),this.renderable instanceof Renderable&&e.translate(this.anchorPoint.x*this.body.getBounds().width,this.anchorPoint.y*this.body.getBounds().height)}},{key:"draw",value:function(e,t){var i=this.renderable;i instanceof Renderable&&(i.preDraw(e),i.draw(e,t),i.postDraw(e))}},{key:"destroy",value:function(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.children.splice(0,1)),_get(_getPrototypeOf(i.prototype),"destroy",this).call(this,arguments)}},{key:"onDeactivateEvent",value:function(){this.renderable&&this.renderable.onDeactivateEvent&&this.renderable.onDeactivateEvent()}}]),i}(Renderable);function warning(e,t,i){var n="melonJS: %s is deprecated since version %s, please use %s",r=(new Error).stack;console.groupCollapsed?console.groupCollapsed("%c"+n,"font-weight:normal;color:yellow;",e,i,t):console.warn(n,e,i,t),void 0!==r&&console.warn(r),console.groupCollapsed&&console.groupEnd()}device$1.turnOnPointerLock=function(){return warning("device.turnOnPointerLock()","input.requestPointerLock()","10.3.0"),requestPointerLock()},device$1.turnOffPointerLock=function(){return warning("device.turnOffPointerLock()","input.exitPointerLock()","10.3.0"),exitPointerLock()},Object.defineProperty(Renderer.prototype,"Texture",{get:function(){return warning("me.video.renderer.Texture","me.TextureAtlas","10.4.0"),TextureAtlas}});var DraggableEntity=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){return _classCallCheck(this,i),warning("DraggableEntity","Draggable","10.5.0"),t.call(this,e,n,r.width,r.height)}return _createClass(i)}(Draggable),DroptargetEntity=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){return _classCallCheck(this,i),warning("DroptargetEntity","DropTarget","10.5.0"),t.call(this,e,n,r.width,r.height)}return _createClass(i)}(DropTarget),version="10.5.0",initialized=!1,skipAutoInit=!1;function boot(){!0!==initialized&&(pool.register("me.Entity",Entity),pool.register("me.Collectable",Collectable),pool.register("me.Trigger",Trigger),pool.register("me.Tween",Tween,!0),pool.register("me.Color",Color,!0),pool.register("me.Particle",Particle,!0),pool.register("me.Sprite",Sprite),pool.register("me.NineSliceSprite",NineSliceSprite),pool.register("me.Renderable",Renderable),pool.register("me.Text",Text,!0),pool.register("me.BitmapText",BitmapText),pool.register("me.BitmapTextData",BitmapTextData,!0),pool.register("me.ImageLayer",ImageLayer),pool.register("me.ColorLayer",ColorLayer,!0),pool.register("me.Vector2d",Vector2d,!0),pool.register("me.Vector3d",Vector3d,!0),pool.register("me.ObservableVector2d",ObservableVector2d,!0),pool.register("me.ObservableVector3d",ObservableVector3d,!0),pool.register("me.Matrix2d",Matrix2d,!0),pool.register("me.Matrix3d",Matrix3d,!0),pool.register("me.Rect",Rect,!0),pool.register("me.Polygon",Polygon,!0),pool.register("me.Line",Line,!0),pool.register("me.Ellipse",Ellipse,!0),pool.register("me.Bounds",Bounds$1,!0),pool.register("Entity",Entity),pool.register("Collectable",Collectable),pool.register("Trigger",Trigger),pool.register("Tween",Tween,!0),pool.register("Color",Color,!0),pool.register("Particle",Particle,!0),pool.register("Sprite",Sprite),pool.register("NineSliceSprite",NineSliceSprite),pool.register("Renderable",Renderable),pool.register("Text",Text,!0),pool.register("BitmapText",BitmapText),pool.register("BitmapTextData",BitmapTextData,!0),pool.register("ImageLayer",ImageLayer),pool.register("ColorLayer",ColorLayer,!0),pool.register("Vector2d",Vector2d,!0),pool.register("Vector3d",Vector3d,!0),pool.register("ObservableVector2d",ObservableVector2d,!0),pool.register("ObservableVector3d",ObservableVector3d,!0),pool.register("Matrix2d",Matrix2d,!0),pool.register("Matrix3d",Matrix3d,!0),pool.register("Rect",Rect,!0),pool.register("Polygon",Polygon,!0),pool.register("Line",Line,!0),pool.register("Ellipse",Ellipse,!0),pool.register("Bounds",Bounds$1,!0),emit(BOOT),loader.setNocache(utils.getUriFragment().nocache||!1),initKeyboardEvent(),initialized=!0)}device$1.onReady((function(){boot()}))},424:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(81),r=i.n(n),o=i(645),s=i.n(o)()(r());s.push([e.id,"body {\n\n    background-color: black;\n    color: white;\n\n    /* Allow mouse dragging. */\n    -moz-user-select: none;\n    -ms-user-select: none;\n    -o-user-select: none;\n    -webkit-user-select: none;\n    user-select: none;\n\n    /* disable touch panning/zooming */\n    -ms-touch-action: none;\n    touch-action: none;\n\n    /* Allow canvas to hit the edges of the browser viewport. */\n    margin: 0;\n}\n\n/* #screen {\n  margin: 0 auto;\n  width: 900px;\n  height: 900px;\n} */\n\n#screen canvas {\n    margin: auto;\n    /* Hide the gap for font descenders. */\n    display: block;\n}\n",""]);const a=s},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",n=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),n&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),n&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,n,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(n)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var u=0;u<e.length;u++){var h=[].concat(e[u]);n&&s[h[0]]||(void 0!==o&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=o),i&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=i):h[2]=i),r&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=r):h[4]="".concat(r)),t.push(h))}},t}},81:e=>{"use strict";e.exports=function(e){return e[1]}},616:function(e,t){!function(){function t(e,i){return i?require(e):e.slice?t[n(e)]:function(i,r){e(i={exports:{}}),t[n(r)]=i.exports};function n(e){return e.split("/").slice(-1).toString().replace(".js","")}}if(void 0!==e)var i=e;t((function(e){String.random=function(e,t){var i="";for(e=e||24,t=t||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";e-- >0;)i+=t.charAt(Math.floor(Math.random()*t.length));return i},String.match=function(e,t){var i,n;return"string"==typeof e&&("string"==typeof t&&(t={"=":t}),e===(i=(t=t||{})["="]||t["*"]||t[">"]||t["<"])||n===t["="]&&(i=t["*"]||t[">"],e.slice(0,(i||"").length)===i||n===t["*"]&&(n!==t[">"]&&n!==t["<"]?e>=t[">"]&&e<=t["<"]:n!==t[">"]&&e>=t[">"]||n!==t["<"]&&e<=t["<"])))},String.hash=function(e,t){if("string"==typeof e){if(t=t||0,!e.length)return t;for(var i=0,n=e.length;i<n;++i)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}};var t,i,n,r,o=Object.prototype.hasOwnProperty;Object.plain=function(e){return!!e&&(e instanceof Object&&e.constructor===Object||"Object"===Object.prototype.toString.call(e).match(/^\[object (\w+)\]$/)[1])},Object.empty=function(e,t){for(var i in e)if(o.call(e,i)&&(!t||-1==t.indexOf(i)))return!1;return!0},Object.keys=Object.keys||function(e){var t=[];for(var i in e)o.call(e,i)&&t.push(i);return t},t=setTimeout,i=0,n=0,r=typeof setImmediate!=""+void 0&&setImmediate||t,t.poll=t.poll||function(e){1>=+new Date-i&&n++<3333?e():r((function(){i=+new Date,e()}),n=0)},function(){var e,t=setTimeout,i=t.turn=t.turn||function(e){1==n.push(e)&&r(s)},n=i.s=[],r=t.poll,o=0,s=function(){(e=n[o++])&&e(),o!=n.length&&99!=o||(n=i.s=n.slice(o),o=0),n.length&&r(s)}}(),function(){var e,t=setTimeout,i=t.turn;(t.each=t.each||function(t,n,r,o){o=o||9,function s(a,l,u){if(l=(a=(t||[]).splice(0,o)).length){for(var h=0;h<l&&e===(u=n(a[h]));h++);if(e===u)return void i(s)}r&&r(u)}()})()}()}))(t,"./shim"),t((function(e){e.exports=function e(t,i,n){if(!t)return{to:e};var r="function"==typeof i;if(t=(this.tag||(this.tag={}))[t]||r&&(this.tag[t]={tag:t,to:e._={next:function(e){var t;(t=this.to)&&t.next(e)}}}),r){var o={off:e.off||(e.off=function(){if(this.next===e._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=e._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:e._,next:i,the:t,on:this,as:n};return(o.back=t.last||t).to=o,t.last=o}return(t=t.to)&&void 0!==i&&t.next(i),t}}))(t,"./onto"),t((function(e){t("./shim"),e.exports=function(e){return void 0!==e&&(null===e||e!==1/0&&e==e&&("string"==typeof e||"boolean"==typeof e||"number"==typeof e||!(!e||"string"!=typeof(e["#"]||0)||!Object.empty(e,["#"]))&&e["#"]))}}))(t,"./valid"),t((function(e){function i(){var e=+new Date;return a<e?(o=0,a=e+i.drift):a=e+(o+=1)/s+i.drift}t("./shim"),i.drift=0;var n,r=-1/0,o=0,s=999,a=r;i.is=function(e,t,i){var n=t&&e&&e._&&e._[">"]||i;if(n)return"number"==typeof(n=n[t])?n:r},i.ify=function(e,t,i,r,o){(e=e||{})._=e._||{},o&&(e._["#"]=o);var s=e._[">"]||(e._[">"]={});return n!==t&&"_"!==t&&("number"==typeof i&&(s[t]=i),n!==r&&(e[t]=r)),e},e.exports=i}))(t,"./state"),t((function(e){t("./shim"),e.exports=function(e){var t={s:{}},i=t.s;e=e||{max:999,age:9e3},t.check=function(e){return!!i[e]&&n(e)};var n=t.track=function(n){var r=i[n]||(i[n]={});return r.was=t.now=+new Date,t.to||(t.to=setTimeout(t.drop,e.age+9)),r};return t.drop=function(n){t.to=null,t.now=+new Date;var r=Object.keys(i);console.STAT&&console.STAT(t.now,+new Date-t.now,"dup drop keys"),setTimeout.each(r,(function(r){var o=i[r];o&&(n||e.age)>t.now-o.was||delete i[r]}),0,99)},t}}))(t,"./dup"),t((function(e){t("./onto"),e.exports=function(e,t){if(this.on){var n=(this.opt||{}).lack||9e3;if("function"!=typeof e){if(!e)return;var r=e["#"]||e,o=(this.tag||"")[r];if(!o)return;return t&&(o=this.on(r,t),clearTimeout(o.err),o.err=setTimeout((function(){o.off()}),n)),!0}if(r=t&&t["#"]||i(9),!e)return r;var s=this.on(r,e,t);return s.err=s.err||setTimeout((function(){s.off(),s.next({err:"Error: No ACK yet.",lack:!0})}),n),r}};var i=String.random||function(){return Math.random().toString(36).slice(2)}}))(t,"./ask"),t((function(e){function n(e){return e instanceof n?(this._={$:this}).$:this instanceof n?n.create(this._={$:this,opt:e}):new n(e)}n.is=function(e){return e instanceof n||e&&e._&&e===e._.$||!1},n.version=.202,n.chain=n.prototype,n.chain.toJSON=function(){},t("./shim"),n.valid=t("./valid"),n.state=t("./state"),n.on=t("./onto"),n.dup=t("./dup"),n.ask=t("./ask"),function(){function e(i){if(i)if(i.out!==e){var r,o=this.as,l=o.at||o,u=l.$,h=l.dup,c=i.DBG;if((r=i["#"])||(r=i["#"]=a(9)),!h.check(r)){if(h.track(r),r=i._,i._="function"==typeof r?r:function(){},i.$&&i.$===(i.$._||"").$||(i.$=u),i["@"]&&!i.put&&function(e){var t,i=e["@"]||"";(t=i._)&&(t.acks=(t.acks||0)+1,(t.err=e.err)&&(e["@"]=t["#"],s(t)),t.stop||t.crack||(t.crack=t.match&&t.match.push((function(){f(t)}))),f(t))}(i),!l.ask(i["@"],i)){if(c&&(c.u=+new Date),i.put)return void t(i);i.get&&n.on.get(i,u)}c&&(c.uc=+new Date),this.to.next(i),c&&(c.ua=+new Date),i.nts||i.NTS||(i.out=e,l.on("out",i),c&&(c.ue=+new Date))}}else this.to.next(i)}function t(t){if(t){var n=t._||"",o=n.root=((n.$=t.$||"")._||"").root;if(t["@"]&&n.faith&&!n.miss)return t.out=e,void o.on("out",t);n.latch=o.hatch,n.match=o.hatch=[];var a=t.put,h=n.DBG=t.DBG,c=+new Date;if(!a["#"]||!a["."]){h&&(h.p=c),n["#"]=t["#"],n.msg=t,n.all=0,n.stun=1;var d=Object.keys(a);console.STAT&&console.STAT(c,((h||n).pk=+new Date)-c,"put sort");var f,y,g,_,m,x,w,b=0;!function e(o){if(f!=b){if(f=b,!(g=d[b]))return console.STAT&&console.STAT(c,((h||n).pd=+new Date)-c,"put"),void s(n);(_=a[g])?(w=_._)?g!==w["#"]?x=p+v(g)+"soul not same.":(m=w[">"])||(x=p+v(g)+"no state."):x=p+v(g)+"no meta.":x=p+v(g)+"no node.",y=Object.keys(_||{})}if(x)return t.err=n.err=x,void s(n);var k,T=0;for(o=o||0;o++<9&&(k=y[T++]);)if("_"!==k){var E=_[k],A=m[k];if(r===A){x=p+v(k)+"on"+v(g)+"no state.";break}if(!u(E)){x=p+v(k)+"on"+v(g)+"bad "+typeof E+v(E);break}i(E,k,g,A,t)}(y=y.slice(T)).length?l(e):(++b,y=null,e(o))}()}}}function i(e,t,n,r,o){var s,a=o._||"",l=a.root,u=l.graph,c=u[n]||d,f=h(c,t,1),p=c[t],v=a.DBG;(s=console.STAT)&&(u[n]&&p||(s.has=(s.has||0)+1));var m=_();if(r>m)return setTimeout((function(){i(e,t,n,r,o)}),(s=r-m)>g?g:s),void(console.STAT&&console.STAT((v||a).Hf=+new Date,s,"future"));if((!(r<f)||a.miss)&&(a.faith||r!==f||!(e===p||y(e)<=y(p))||a.miss)){a.stun++;var x=o["#"]+a.all++,w={toString:function(){return x},_:a};w.toJSON=w.toString,v&&(v.ph=v.ph||+new Date),l.on("put",{"#":w,"@":o["@"],put:{"#":n,".":t,":":e,">":r},_:a})}}function o(e){var t;(t=(e._||"").DBG)&&(t.pa=+new Date,t.pm=t.pm||+new Date);var i,n=this.as,r=n.graph,o=e._,a=e.put,l=a["#"],u=a["."],h=a[":"],d=a[">"];e["#"],(i=o.msg)&&(i=i.put)&&(i=i[l])&&c(i,u,d,h,l),r[l]=c(r[l],u,d,h,l),(i=(n.next||"")[l])&&i.on("in",e),s(o),this.to.next(e)}function s(t,i){var n;if(!t.stop&&(t.err||!(0<--t.stun))&&(t.stop=1,n=t.root)){var r=t.match;r.end=1,r===n.hatch&&(!(r=t.latch)||r.end?delete n.hatch:n.hatch=r),t.hatch&&t.hatch(),setTimeout.each(t.match,(function(e){e&&e()})),!(i=t.msg)||t.err||i.err||(i.out=e,t.root.on("out",i))}}function f(e){e&&e.root&&(e.stun||e.acks!==e.all||e.root.on("in",{"@":e["#"],err:e.err,ok:e.err?r:{"":1}}))}n.create=function(t){t.root=t.root||t,t.graph=t.graph||{},t.on=t.on||n.on,t.ask=t.ask||n.ask,t.dup=t.dup||n.dup();var i=t.$.opt(t.opt);return t.once||(t.on("in",e,t),t.on("out",e,t),t.on("put",o,t),n.on("create",t),t.on("create",t)),t.once=1,i},n.on.put=t;var p="Error: Invalid graph!",v=function(e){return" '"+(""+e).slice(0,9)+"...' "},y=JSON.stringify,g=2147483647,_=n.state}(),function(){function e(e,t){var i=+new Date,n=e._||{},o=n.DBG=e.DBG,s=e["#"],l=a(9),u=Object.keys(t||"").sort(),d=((t||"")._||"")["#"],f=(u.length,e.$._.root),p=t===f.graph[d];console.STAT&&console.STAT(i,((o||n).gk=+new Date)-i,"got keys"),t&&function e(){i=+new Date;for(var n,v,y,g=0,_={};g<9&&(n=u[g++]);)c(_,n,h(t,n),t[n],d);u=u.slice(g),(v={})[d]=_,_=v,p&&((y=function(){}).ram=y.faith=!0),v=u.length,console.STAT&&console.STAT(i,-(i-(i=+new Date)),"got copied some"),o&&(o.ga=+new Date),f.on("in",{"@":s,"#":l,put:_,"%":v?l=a(9):r,$:f.$,_:y,DBG:o}),console.STAT&&console.STAT(i,+new Date-i,"got in"),v&&setTimeout.turn(e)}(),t||f.on("in",{"@":e["#"]})}n.on.get=function(t,i){var n=i._,o=t.get,s=o["#"],a=n.graph[s],l=o["."],u=((n.next||(n.next={}))[s],(t._||{}).DBG=t.DBG);if(u&&(u.g=+new Date),!a)return n.on("get",t);if(l){if("string"!=typeof l||r===a[l])return n.on("get",t);a=c({},l,h(a,l),a[l],s)}a&&e(t,a),n.on("get",t)},n.on.get.ack=e}(),n.chain.opt=function(e){e=e||{};var t=this._,i=e.peers||e;return Object.plain(e)||(e={}),Object.plain(t.opt)||(t.opt=e),"string"==typeof i&&(i=[i]),i instanceof Array&&(Object.plain(t.opt.peers)||(t.opt.peers={}),i.forEach((function(e){var i={};i.id=i.url=e,t.opt.peers[e]=t.opt.peers[e]||i}))),t.opt.peers=t.opt.peers||{},s(e,(function e(t){var i=this[t];this&&this.hasOwnProperty(t)||"string"==typeof i||Object.empty(i)?this[t]=i:(!i||i.constructor===Object||i instanceof Array)&&s(i,e)})),n.on("opt",t),t.opt.uuid=t.opt.uuid||function(e){return n.state().toString(36).replace(".","")+String.random(e||12)},this};var r,o,s=function(e,t){Object.keys(e).forEach(t,e)},a=String.random,l=setTimeout.turn,u=n.valid,h=n.state.is,c=n.state.ify,d={};n.log=function(){return!n.log.off&&o.log.apply(o,arguments),[].slice.call(arguments).join(" ")},n.log.once=function(e,t,i){return(i=n.log.once)[e]=i[e]||0,i[e]++||n.log(t)},"undefined"!=typeof window&&((window.GUN=window.Gun=n).window=window);try{void 0!==i&&(i.exports=n)}catch(e){}e.exports=n,(n.window||{}).console=(n.window||{}).console||{log:function(){}},(o=console).only=function(e,t){return o.only.i&&e===o.only.i&&o.only.i++&&(o.log.apply(o,arguments)||t)},n.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")}))(t,"./root"),t((function(e){t("./root").chain.back=function(e,t){if(-1===(e=e||1)||1/0===e)return this._.root.$;if(1===e)return(this._.back||this._).$;var r=this._;if("string"==typeof e&&(e=e.split(".")),e instanceof Array){for(var o=0,s=e.length,a=r;o<s;o++)a=(a||n)[e[o]];return i!==a?t?this:a:(a=r.back)?a.$.back(e,t):void 0}if("function"==typeof e){var l;for(a={back:r};(a=a.back)&&i===(l=e(a,t)););return l}return"number"==typeof e?(r.back||r).$.back(e-1):this};var i,n={}}))(t,"./back"),t((function(e){var i=t("./root");function n(e,t){if(t=t||this.as||e.$._,(!e.$$||this===i.on)&&e.put&&!t.soul){var n=e.put||"",r=n["="]||n[":"],o=t.root,s=o.$.get(n["#"]).get(n["."])._;if("string"==typeof(r=u(r))){if(!(s.echo||(s.echo={}))[t.id]||(o.pass||"")[t.id]){if(a=o.pass){if(a[r+t.id])return;a[r+t.id]=1}(s.echo||(s.echo={}))[t.id]=t,t.has&&(t.link=r);var a,l=o.$.get(s.link=r)._;(l.echo||(l.echo={}))[s.id]=s,((a=t.ask||"")[""]||t.lex)&&l.on("out",{get:{"#":r}}),setTimeout.each(Object.keys(a),(function(e,t){e&&(t=a[e])&&t.on("out",{get:{"#":r,".":e}})}),0,99)}}else this===i.on&&((s.echo||(s.echo={}))[t.id]=t)}}function r(e,t){var i,n,o=e.put||"",a=s!==o["="]?o["="]:o[":"],l=t.root;if(s===a){if(t.soul&&s!==t.put)return;if(n=(e.$$||e.$||"")._||"",e["@"]&&(s!==n.put||s!==t.put))return;return(i=t.link||e.linked)&&delete(l.$.get(i)._.echo||"")[t.id],t.has&&(t.link=null),t.put=s,void setTimeout.each(Object.keys(t.next||""),(function(e,n){(n=t.next[e])&&(i&&delete(l.$.get(i).get(e)._.echo||"")[n.id],n.on("in",{get:e,put:s,$:n.$}))}),0,99)}t.soul||e.$$||(i=u(a),n=e.$._||"",(i!==n.link&&(!t.has||n.link)||(l.pass||"")[t.id]&&"string"!=typeof i)&&(delete(n.echo||"")[t.id],r({get:t.get,put:s,$:e.$,linked:e.linked=e.linked||n.link},t)))}function o(e,t){var n=this.as,r=n.$._,o=(r.root,n.get||""),a=(e.put||"")[o["#"]]||"";if(!e.put||"string"==typeof o["."]&&s===a[o["."]]){if(s!==r.put)return;if(!r.soul&&!r.has)return;return r.ack=(r.ack||0)+1,void r.on("in",{get:r.get,put:r.put=s,$:r.$,"@":e["@"]})}(e._||{}).miss=1,i.on.put(e)}i.chain.chain=function(e){var t,n=this,r=n._,o=new(e||n).constructor(n),s=o._;return s.root=t=r.root,s.id=++t.once,s.back=n._,s.on=i.on,s.on("in",i.on.in,s),s.on("out",i.on.out,s),o},i.on.out=function(e){var t,i,n=this.as,r=n.back,a=n.root;if(e.$||(e.$=n.$),this.to.next(e),!n.err){if(t=e.get){if(a.pass&&(a.pass[n.id]=n),n.lex&&Object.keys(n.lex).forEach((function(e){i[e]=n.lex[e]}),i=e.get=e.get||{}),t["#"]||n.soul){if(t["#"]=t["#"]||n.soul,e["#"]||(e["#"]=l(9)),r=a.$.get(t["#"])._,t=t["."]){if(h(r.put,t)&&(i=r.ask&&r.ask[t],(r.ask||(r.ask={}))[t]=r.$.get(t)._,r.on("in",{get:t,put:{"#":r.soul,".":t,":":r.put[t],">":d(a.graph[r.soul],t)}}),i))return}else{if(i=r.ask&&r.ask[""],(r.ask||(r.ask={}))[""]=r,s!==r.put&&(r.on("in",r),i))return;e.$=r.$}return a.ask(o,e),a.on("in",e)}if(t["."])return n.get?(e={get:{".":n.get},$:n.$},(r.ask||(r.ask={}))[n.get]=e.$._,r.on("out",e)):(e={get:n.lex?e.get:{},$:n.$},r.on("out",e));if((n.ask||(n.ask={}))[""]=n,n.get)return t["."]=n.get,(r.ask||(r.ask={}))[n.get]=e.$._,r.on("out",e)}return r.on("out",e)}n.on("in",{put:n.put=s,$:n.$})},i.on.in=function(e,t){var i,o=(t=t||this.as).root,l=e.$||(e.$=t.$),h=(l||"")._||a,c=e.put||"",p=c["#"],v=c["."],y=s!==c["="]?c["="]:c[":"],g=c[">"]||-1/0;if(s!==e.put&&(s===c["#"]||s===c["."]||s===c[":"]&&s===c["="]||s===c[">"]))return u(c)?void t.on("in",{$:h.back.$,put:{"#":p=h.back.soul,".":v=h.has||h.get,"=":c,">":d(h.back.put,v)},via:e}):(p=((c||"")._||"")["#"])?(l=t.root.$.get(p),setTimeout.each(Object.keys(c).sort(),(function(i){"_"!=i&&s!==(g=d(c,i))&&t.on("in",{$:l,put:{"#":p,".":i,"=":c[i],">":g},VIA:e})}))):void console.log("chain not yet supported for",c,"...",e,t);(e.seen||"")[t.id]||((e.seen||(e.seen=function(){}))[t.id]=t,t!==h&&(Object.keys(e).forEach((function(t){c[t]=e[t]}),c={}),c.get=t.get||c.get,t.soul||t.has?h.soul&&(c.$=t.$,c.$$=c.$$||h.$):c.$$$=c.$$$||t.$,e=c),r(e,t),(t.soul||e.$$)&&g>=d(o.graph[p],v)&&((c=o.$.get(p)._).put=f(c.put,v,g,y,p)),!h.soul&&g>=d(o.graph[p],v)&&(i=(o.$.get(p)._.next||"")[v])&&(i.put=y,"string"==typeof(c=u(y))&&(i.put=o.$.get(c)._.put||y)),this.to&&this.to.next(e),t.any&&setTimeout.each(Object.keys(t.any),(function(i){(i=t.any[i])&&i(e)}),0,99),t.echo&&setTimeout.each(Object.keys(t.echo),(function(i){(i=t.echo[i])&&i.on("in",e)}),0,99),((e.$$||"")._||h).soul&&(i=t.next)&&(i=i[v])&&(c={},Object.keys(e).forEach((function(t){c[t]=e[t]})),c.$=(e.$$||e.$).get(c.get=v),delete c.$$,delete c.$$$,i.on("in",c)),n(e,t))},i.on.link=n,i.on.unlink=r;var s,a={},l=String.random,u=i.valid,h=function(e,t){return e&&Object.prototype.hasOwnProperty.call(e,t)},c=i.state,d=c.is,f=c.ify}))(t,"./chain"),t((function(e){var i=t("./root");function n(e){var t=this.at||this.on;if(!e||t.soul||t.has)return this.off();if(e=(e=(e=e.$||e)._||e).id){var i;if(t.map,(i=this.seen||(this.seen={}))[e])return!0;i[e]=!0}}i.chain.get=function(e,t,a){var l,u;if("string"==typeof e){if(0==e.length)return(l=this.chain())._.err={err:i.log("0 length key!",e)},t&&t.call(l,l._.err),l;(l=((c=this._).next||o)[e])||(l=e&&function(e,t){var i=t._,n=i.next,r=t.chain()._;return n||(n=i.next={}),n[r.get=e]=r,t===i.root.$?r.soul=e:(i.soul||i.has)&&(r.has=e),r}(e,this)),l=l&&l.$}else{if("function"==typeof e){if(!0===t)return function(e,t,n,o){var s,a=e._,l=0;(s=a.soul||a.link)?t(s,o,a):a.jam?a.jam.push([t,o]):(a.jam=[[t,o]],e.get((function(e,t){if(!(r===e.put&&!a.root.opt.super&&(s=Object.keys(a.root.opt.peers).length)&&++l<=s)){t.rid(e);var n,o=(o=e.$)&&o._||{},u=0;for(s=a.jam,delete a.jam;n=s[u++];){var h=n[0];n=n[1],h&&h(o.link||o.soul||i.valid(e.put)||((e.put||{})._||{})["#"],n,e,t)}}}),{out:{get:{".":!0}}}))}(this,e,0,a),this;var h,c=(l=this)._,d=t||{},f=c.root;d.at=c,d.ok=e;var p={};function v(e,t,n){if(!v.stun&&(!(o=f.pass)||o[h])){var o,s=e.$._,a=(e.$$||"")._,l=(a||s).put,u=!s.has&&!s.soul,y={};if((u||r===l)&&(l=r===((o=e.put)||"")["="]?r===(o||"")[":"]?o:o[":"]:o["="]),"string"==typeof(o=i.valid(l))&&(l=r===(o=f.$.get(o)._.put)?d.not?r:l:o),!d.not||r!==l){if(r===d.stun){if((o=f.stun)&&o.on&&(c.$.back((function(e){if(o.on(""+e.id,y={}),(y.run||0)<v.id)return y})),!y.run&&o.on(""+s.id,y={}),!y.run&&a&&o.on(""+a.id,y={}),v.id>y.run&&(y.stun&&!y.stun.end||(y.stun=o.on("stun"),y.stun=y.stun&&y.stun.last),y.stun&&!y.stun.end)))return void((y.stun.add||(y.stun.add={}))[h]=function(){v(e,t,1)});if(r===l&&(n=0),(o=f.hatch)&&!o.end&&r===d.hatch&&!n){if(p[s.$._.id])return;return p[s.$._.id]=1,void o.push((function(){v(e,t,1)}))}p={}}if(f.pass){if(f.pass[h+s.id])return;f.pass[h+s.id]=1}d.on?d.ok.call(s.$,l,s.get,e,t||v):d.v2020?d.ok(e,t||v):(Object.keys(e).forEach((function(t){o[t]=e[t]}),o={}),(e=o).put=l,d.ok.call(d.as,e,t||v))}}}return v.at=c,(c.any||(c.any={}))[h=String.random(7)]=v,v.off=function(){v.stun=1,c.any&&delete c.any[h]},v.rid=n,v.id=d.run||++f.once,u=f.pass,(f.pass={})[h]=1,d.out=d.out||{get:{}},c.on("out",d.out),f.pass=u,l}if("number"==typeof e)return this.get(""+e,t,a);if("string"==typeof(u=s(e)))return this.get(u,t,a);(u=this.get.next)&&(l=u(this,e))}return l?(t&&"function"==typeof t&&l.get(t,a),l):((l=this.chain())._.err={err:i.log("Invalid get request!",e)},t&&t.call(l,l._.err),l)};var r,o={},s=i.valid}))(t,"./get"),t((function(e){var i=t("./root");function n(e,t){if(t){t=(t._||"").id||t;var n,r=e.root.stun||(e.root.stun={on:i.on}),o={};e.stun||(e.stun=r.on("stun",(function(){}))),(n=r.on(""+t))&&n.the.last.next(o),o.run>=e.run||r.on(""+t,(function(t){if(e.stun.end)return this.off(),void this.to.next(t);t.run=t.run||e.run,t.stun=t.stun||e.stun}))}}function r(e){if(e.err)r.end(e.stun,e.root);else if(!e.todo.length&&!e.end&&Object.empty(e.wait)){e.end=1;var t,n=e.$.back(-1)._,o=n.root,s=n.ask((function(t){o.on("ack",t),t.err&&i.log(t),++a>(e.acks||0)&&this.off(),e.ack&&e.ack(t,this)}),e.opt),a=0,l=e.stun;(t=function(){l&&(r.end(l,o),setTimeout.each(Object.keys(l=l.add||""),(function(e){(e=l[e])&&e()})))}).hatch=t,e.via._.on("out",{put:e.out=e.graph,opt:e.opt,"#":s,_:t})}}i.chain.put=function(e,t,h){var c=this,d=c._,f=d.root;(h=h||{}).root=d.root,h.run||(h.run=f.once),n(h,d.id),h.ack=h.ack||t,h.via=h.via||c,h.data=h.data||e,h.soul||(h.soul=d.soul||"string"==typeof t&&t);var p=h.state=h.state||i.state();return"function"==typeof e?(e((function(e){h.data=e,c.put(o,o,h)})),c):h.soul?(h.$=f.$.get(h.soul),h.todo=[{it:h.data,ref:h.$}],h.turn=h.turn||a,h.ran=h.ran||r,function e(){var t,r,o,a,c,d=h.todo,f=d.pop(),v=f.it;if(f.ref&&f.ref._.id,n(h,f.ref),(a=f.todo)&&(v=v[r=a.pop()],a.length&&d.push(f)),r&&(d.path||(d.path=[])).push(r),!(t=l(v))&&!(c=i.is(v))){if(!Object.plain(v))return(h.ack||s).call(h,h.out={err:h.err=i.log("Invalid data: "+(v&&(a=v.constructor)&&a.name||typeof v)+" at "+(h.via.back((function(e){e.get&&a.push(e.get)}),a=[])||a.join("."))+"."+(d.path||[]).join("."))}),void h.ran(h);for(var y=h.seen||(h.seen=[]),g=y.length;g--;)if(v===(a=y[g]).it){t=v=a.link;break}}if(r&&t)f.node=u(f.node,r,p,v);else{h.seen.push(o={it:v,link:{},todo:c?[]:Object.keys(v).sort().reverse(),path:(d.path||[]).slice(),up:f}),f.node=u(f.node,r,p,o.link),!c&&o.todo.length&&d.push(o);var _=h.seen.length;function m(e,t){var i=o.link["#"];t&&(t.off(),t.rid(e));var r=i||e.soul||(a=(e.$$||e.$)._||"").soul||a.link||((a=a.put||"")._||"")["#"]||a["#"]||((a=e.put||"")&&e.$$?a["#"]:(a["="]||a[":"]||"")["#"]);!i&&n(h,e.$),r||f.link["#"]?(r||(r=[],(e.$$||e.$).back((function(e){if(a=e.soul||e.link)return r.push(a);r.push(e.get)})),r=r.reverse().join("/")),o.link["#"]=r,!c&&(((h.graph||(h.graph={}))[r]=o.node||(o.node={_:{}}))._["#"]=r),delete h.wait[_],o.wait&&setTimeout.each(o.wait,(function(e){e&&e()})),h.ran(h)):(f.wait||(f.wait=[])).push((function(){m(e,t)}))}(h.wait||(h.wait={}))[_]="",a=(o.ref=c?v:r?f.ref.get(r):f.ref)._,(a=v&&(v._||"")["#"]||a.soul||a.link)?m({soul:a}):o.ref.get(m,{run:h.run,v2020:1,out:{get:{".":" "}}})}if(!d.length)return h.ran(h);h.turn(e)}(),c):(function(e){var t,i=e.via._;e.via=e.via.back((function(i){if(i.soul||!i.get)return i.$;t=e.data,(e.data={})[i.get]=t})),e.via&&e.via._.soul||(e.via=i.root.$.get(((e.data||"")._||"")["#"]||i.$.back("opt.uuid")())),e.via.put(e.data,e.ack,e)}(h),c)},r.end=function(e,t){e.end=s,e.the.to===e&&e===e.the.last&&delete t.stun,e.off()};var o,s=function(){},a=setTimeout.turn,l=i.valid,u=i.state.ify}))(t,"./put"),t((function(e){var i=t("./root");t("./chain"),t("./back"),t("./put"),t("./get"),e.exports=i}))(t,"./index"),t((function(e){var i,n=t("./index");n.chain.on=function(e,t,i,n){var r,o=this,s=o._;if(s.root,"string"==typeof e)return t?(r=s.on(e,t,i||s,n),i&&i.$&&(i.subs||(i.subs=[])).push(r),o):s.on(e);var a=t;return(a=!0===a?{change:!0}:a||{}).not=1,a.on=1,o.get(e,a),o},n.chain.once=function(e,t){if(t=t||{},!e)return function(e,t,i){return n.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(i=e.chain())._.nix=e.once((function(e,t){i._.on("in",this._)})),i._.lex=e._.lex,i}(this);var r,o=this,s=o._,a=s.root,l=(s.put,String.random(7));return o.get((function(o,u,h,c){var d=this,f=d._,p=f.one||(f.one={});function v(){f.has||f.soul||(f={put:o,get:u}),i===(r=f.put)&&(r=((h.$$||"")._||"").put),"string"==typeof n.valid(r)&&(r=a.$.get(r)._.put)===i||c.stun||""!==p[l]&&(p[l]="",(s.soul||s.has)&&c.off(),e.call(d,r,f.get))}c.stun||""!==p[l]&&(!0!==(r=n.valid(o))?"string"!=typeof r&&(clearTimeout((s.one||"")[l]),clearTimeout(p[l]),p[l]=setTimeout(v,t.wait||99)):v())}),{on:1}),o},n.chain.off=function(){var e,t=this._,i=t.back;if(i)return t.ack=0,(e=i.next)&&e[t.get]&&delete e[t.get],(e=i.ask)&&delete e[t.get],(e=i.put)&&delete e[t.get],(e=t.soul)&&delete i.root.graph[e],(e=t.map)&&Object.keys(e).forEach((function(t,n){(n=e[t]).link&&i.root.$.get(n.link).off()})),(e=t.next)&&Object.keys(e).forEach((function(t,i){e[t].$.off()})),t.on("off",{}),this}}))(t,"./on"),t((function(e){var i=t("./index"),n=i.chain.get.next;function r(e){this.to.next(e);var t,n=this.as,r=e.$._,o=e.put;(r.soul||e.$$)&&((t=n.lex)&&!String.match(e.get||(o||"")["."],t["."]||t["#"]||t)||i.on.link(e,n))}i.chain.get.next=function(e,t){var i;return Object.plain(t)?(i=((i=t["#"])||"")["="]||i)?e.get(i):((i=e.chain()._).lex=t,e.on("in",(function(e){String.match(e.get||(e.put||"")["."],t["."]||t["#"]||t)&&i.on("in",e),this.to.next(e)})),i.$):(n||s)(e,t)},i.chain.map=function(e,t,n){var a,l,u=this,h=u._;return Object.plain(e)&&(a=e["."]?e:{".":e},e=o),e?(i.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),l=u.chain(),u.map().on((function(t,n,r,a){var u=(e||s).call(this,t,n,r,a);if(o!==u){if(t===u)return l._.on("in",r);if(i.is(u))return l._.on("in",u._);var h={};Object.keys(r.put).forEach((function(e){h[e]=r.put[e]}),h),h["="]=u,l._.on("in",{get:n,put:h})}})),l):((l=h.each)||((h.each=l=u.chain())._.lex=a||l._.lex||h.lex,l._.nix=u.back("nix"),u.on("in",r,l._)),l)};var o,s=function(){}}))(t,"./map"),t((function(e){var i=t("./index");i.chain.set=function(e,t,n){var r,o,s=this,a=s.back(-1);return t=t||function(){},(n=n||{}).item=n.item||e,(r=((e||"")._||"")["#"])&&((e={})["#"]=r),"string"==typeof(o=i.valid(e))?s.get(r=o).put(e,t,n):i.is(e)?(s.put((function(n){e.get((function(e,r,a){if(!e)return t.call(s,{err:i.log('Only a node can be linked! Not "'+a.put+'"!')});(o={})[e]={"#":e},n(o)}),!0)})),e):(Object.plain(e)&&(e=a.get(r=s.back("opt.uuid")()).put(e)),s.get(r||a.back("opt.uuid")(7)).put(e,t,n))}}))(t,"./set"),t((function(e){var i;t("./shim");try{e.exports=function(e){var t=function(){},n=e.opt||{};n.log=n.log||console.log,n.gap=n.gap||n.wait||0,n.max=n.max||.3*(n.memory?999*n.memory*999:3e8),n.pack=n.pack||.01*n.max*.01,n.puff=n.puff||9;var r=setTimeout.turn||setTimeout,o=JSON.parseAsync||function(e,t,i){try{t(void 0,JSON.parse(e,i))}catch(e){t(e)}},s=JSON.stringifyAsync||function(e,t,i,n){try{t(void 0,JSON.stringify(e,i,n))}catch(e){t(e)}},a=e.dup,l=a.check,u=a.track,h=(new Date,t.hear=function(e,i){if(e){if(n.max<=e.length)return t.say({dam:"!",err:"Message too big!"},i);t===this&&(h.d+=e.length||0,++h.c);var s,a=i.SH=+new Date,l=e[0];return"["===l?(o(e,(function(e,o){if(e||!o)return t.say({dam:"!",err:"DAM JSON parse error."},i);console.STAT&&console.STAT(+new Date,o.length,"# on hear batch");var s=n.puff;!function e(){for(var t,n=+new Date,a=0;a<s&&(t=o[a++]);)h(t,i);o=o.slice(a),console.STAT&&console.STAT(n,+new Date-n,"hear loop"),c(i),o.length&&r(e,0)}()})),void(e="")):"{"===l||(e["#"]||Object.plain(e))&&(s=e)?s?h.one(s,i,a):void o(e,(function(e,n){if(e||!n)return t.say({dam:"!",err:"DAM JSON parse error."},i);h.one(n,i,a)})):void 0}});function c(e){var t=e.batch,i="string"==typeof t;if(i&&(t+="]"),e.batch=e.tail=null,t&&!(i?3>t.length:!t.length)){if(!i)try{t=1===t.length?t[0]:JSON.stringify(t)}catch(e){return n.log("DAM JSON stringify error",e)}t&&d(t,e)}}function d(e,i){try{var n=i.wire;i.say?i.say(e):n.send&&n.send(e),t.say.d+=e.length||0,++t.say.c}catch(t){(i.queue=i.queue||[]).push(e)}}h.one=function(i,n,r){var o,s,h,c,d;if(i.DBG&&(i.DBG=d={DBG:i.DBG}),d&&(d.h=r),d&&(d.hp=+new Date),(o=i["#"])||(o=i["#"]=String.random(9)),!((h=l(o))||(s=i["##"])&&(h=i["@"]||i.get&&o)&&a.check(c=h+s))){if((i._=function(){}).via=t.leap=n,(h=i["><"])&&"string"==typeof h&&h.slice(0,99).split(",").forEach((function(e){this[e]=1}),i._.yo={}),h=i.dam)return(h=t.hear[h])&&h(i,n,e),void u(o);r=+new Date,d&&(d.is=r),n.SI=o,e.on("in",t.last=i),d&&(d.hd=+new Date),console.STAT&&console.STAT(r,+new Date-r,i.get?"msg get":i.put?"msg put":"msg"),(h=u(o)).via=n,i.get&&(h.it=i),c&&u(c),t.leap=t.last=null}},h.c=h.d=0,function(){var e,o=0;function h(e,t){var i;return t instanceof Object?(Object.keys(t).sort().forEach(f,{to:i={},on:t}),i):t}function f(e){this.to[e]=this.on[e]}t.hash=function(e,t){var i,n,o,a=+new Date;s(e.put,(function s(l,u){var h=(n||(n=o=u||"")).slice(0,32768);i=String.hash(h,i),(n=n.slice(32768))?r(s,0):(console.STAT&&console.STAT(a,+new Date-a,"say json+hash"),e._.$put=o,e["##"]=i,p(e,t),delete e._.$put)}),h)};var p=t.say=function(s,l){var h;if((h=this)&&(h=h.to)&&h.next&&h.next(s),!s)return!1;var f,v,y=s["@"],g=s._||(s._=function(){}),_=s.DBG,m=+new Date;if(g.y=g.y||m,l||_&&(_.y=m),(f=s["#"])||(f=s["#"]=String.random(9)),!e&&u(f),s.put&&(s.err||(a.s[f]||"").err))return!1;if(s["##"]||i===s.put||g.via||!y){if(!l&&y&&(l=(h=a.s[y])&&(h.via||(h=h.it)&&(h=h._)&&h.via)||(h=t.last)&&y===h["#"]&&t.leap),!l&&y){if(a.s[y])return;return console.STAT&&console.STAT(+new Date,++o,"total no peer to ack to"),!1}if(!l&&t.way)return t.way(s);if(_&&(_.yh=+new Date),v=g.raw){if(_&&(_.yr=+new Date),!l||!l.id){if(!Object.plain(l||n.peers))return!1;m=+new Date,n.puff;var x=n.peers,w=Object.keys(l||n.peers||{});return console.STAT&&console.STAT(m,+new Date-m,"peer keys"),void function t(){var i=+new Date;e=1;var n=g.raw;g.raw=v;for(var o,a=0;a<9&&(o=(w||"")[a++]);)(o=x[o])&&p(s,o);g.raw=n,e=0,w=w.slice(a),console.STAT&&console.STAT(i,+new Date-i,"say loop"),w.length&&(r(t,0),y&&u(y))}()}if(!l.wire&&t.wire&&t.wire(l),f!==l.last){if(l.last=f,l===g.via)return!1;if((h=g.yo)&&(h[l.url]||h[l.pid]||h[l.id]))return!1;if(console.STAT&&console.STAT(m,((_||g).yp=+new Date)-(g.y||m),"say prep"),!e&&y&&u(y),l.batch){if(l.tail=(h=l.tail||0)+v.length,l.tail<=n.pack)return void(l.batch+=(h?",":"")+v);c(l)}l.batch="[";var b=+new Date;setTimeout((function(){console.STAT&&console.STAT(b,+new Date-b,"0ms TO"),c(l)}),n.gap),d(v,l),console.STAT&&y===l.SI&&console.STAT(m,+new Date-l.SH,"say ack")}}else t.raw(s,l)}else t.hash(s,l)};t.say.c=t.say.d=0,t.raw=function(e,r){if(!e)return"";var o,u,h=e._||{};if(u=h.raw)return u;if("string"==typeof e)return e;var c=e["##"],d=e["@"];if(c&&d){if(!h.via&&l(d+c))return!1;if((u=(a.s[d]||"").it)||(u=t.last)&&d===u["#"]){if(c===u["##"])return!1;u["##"]||(u["##"]=c)}}if(!e.dam){var f=0,v=[];for(var y in u=n.peers){var g=u[y];if(v.push(g.url||g.pid||g.id),++f>6)break}f>1&&(e["><"]=v.join())}if(o=h.$put)return u={},Object.keys(e).forEach((function(t){u[t]=e[t]})),u.put=":])([:",void s(u,(function(e,t){if(!e){var n=+new Date;u=t.indexOf('"put":":])([:"'),_(i,t=t.slice(0,u+6)+o+t.slice(u+14)),console.STAT&&console.STAT(n,+new Date-n,"say slice")}}));function _(t,i){t||(h.raw=i,p(e,r))}s(e,_)}}(),t.hi=function(i){var r=i.wire||{};i.id?n.peers[i.url||i.id]=i:(r=i.id=i.id||String.random(9),t.say({dam:"?",pid:e.opt.pid},n.peers[r]=i),delete a.s[i.last]),i.met=i.met||+new Date,r.hied||e.on(r.hied="hi",i),r=i.queue,i.queue=[],setTimeout.each(r||[],(function(e){d(e,i)}),0,9)},t.bye=function(i){e.on("bye",i);var n=+new Date;n-=i.met||n,t.bye.time=((t.bye.time||n)+n)/2},t.hear["!"]=function(e,t){n.log("Error:",e.err)},t.hear["?"]=function(e,i){e.pid&&(i.pid||(i.pid=e.pid),e["@"])||(t.say({dam:"?",pid:n.pid,"@":e["#"]},i),delete a.s[i.last])},e.on("create",(function(e){e.opt.pid=e.opt.pid||String.random(9),this.to.next(e),e.on("out",t.say)})),e.on("bye",(function(e,t){e=n.peers[e.id||e]||e,this.to.next(e),e.bye?e.bye():(t=e.wire)&&t.close&&t.close(),delete n.peers[e.id],e.wire=null}));var f={};return e.on("bye",(function(e,t){this.to.next(e),(t=console.STAT)&&(t.peers=(t.peers||0)-1),(t=e.url)&&(f[t]=!0,setTimeout((function(){delete f[t]}),n.lack||9e3))})),e.on("hi",(function(i,r){this.to.next(i),(r=console.STAT)&&(r.peers=(r.peers||0)+1),(r=i.url)&&f[r]&&(delete f[r],n.super||setTimeout.each(Object.keys(e.next),(function(n){e.next[n],(r={})[n]=e.graph[n],r=String.hash(r),t.say({"##":r,get:{"#":n}},i)})))})),t}}catch(e){}}))(t,"./mesh"),t((function(e){var i=t("../index");i.Mesh=t("./mesh"),i.on("opt",(function(e){if(this.to.next(e),!e.once){var t=e.opt;if(!1!==t.WebSocket){var n=i.window||{},r=t.WebSocket||n.WebSocket||n.webkitWebSocket||n.mozWebSocket;if(r){t.WebSocket=r;var o=t.mesh=t.mesh||i.Mesh(e);o.wire||t.wire,o.wire=t.wire=l,setTimeout((function(){!t.super&&e.on("out",{dam:"hi"})}),1);var s=1998,a=""+void 0!=typeof document&&document}}}function l(e){try{if(!e||!e.url)return n&&n(e);var i=e.url.replace(/^http/,"ws"),n=e.wire=new t.WebSocket(i);return n.onclose=function(){t.mesh.bye(e),u(e)},n.onerror=function(t){u(e)},n.onopen=function(){t.mesh.hi(e)},n.onmessage=function(i){i&&t.mesh.hear(i.data||i,e)},n}catch(e){}}function u(e){clearTimeout(e.defer),a&&e.retry<=0||(e.retry=(e.retry||t.retry+1||60)-(-e.tried+(e.tried=+new Date)<7992?1:0),e.defer=setTimeout((function t(){if(a&&a.hidden)return setTimeout(t,s);l(e)}),s))}}))}))(t,"./websocket"),t((function(e){if("undefined"!=typeof Gun){var t;try{t=(Gun.window||function(){}).localStorage}catch(e){}t||(Gun.log("Warning: No localStorage exists to persist data to!"),t={setItem:function(e,t){this[e]=t},removeItem:function(e){delete this[e]},getItem:function(e){return this[e]}}),Gun.on("create",(function e(i){this.to.next(i);var n,r,o=i.opt,s=(i.graph,[]);if(!1!==o.localStorage){o.prefix=o.file||"gun/";try{n=e[o.prefix]=e[o.prefix]||JSON.parse(t.getItem(o.prefix))||{}}catch(t){n=e[o.prefix]={}}i.on("get",(function(e){this.to.next(e);var t,i,r,o=e.get;o&&(t=o["#"])&&((i=n[t]||void 0)&&(r=o["."])&&!Object.plain(r)&&(i=Gun.state.ify({},r,Gun.state.is(i,r),i[r],t)),Gun.on.get.ack(e,i))})),i.on("put",(function(e){this.to.next(e);var t=e.put,i=t["#"],l=t["."];n[i]=Gun.state.ify(n[i],l,t[">"],t[":"],i),e["@"]||s.push(e["#"]),r||(r=setTimeout(a,o.wait||1))}))}function a(){var e,a=s;clearTimeout(r),r=!1,s=[];try{t.setItem(o.prefix,JSON.stringify(n))}catch(t){Gun.log((e=t||"localStorage failure")+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),i.on("localStorage:error",{err:e,get:o.prefix,put:n})}(e||Object.empty(o.peers))&&setTimeout.each(a,(function(t){i.on("in",{"@":t,err:e,ok:0})}))}}))}}))(t,"./localStorage")}(),function(){if(""+b!=typeof Gun){var e=function(e){console.log("Warning! Deprecated internal utility will break in next version:",e)},t=Gun;t.fn=t.fn||{is:function(t){return e("fn"),!!t&&"function"==typeof t}},t.bi=t.bi||{is:function(t){return e("bi"),t instanceof Boolean||"boolean"==typeof t}},t.num=t.num||{is:function(t){return e("num"),!n(t)&&(t-parseFloat(t)+1>=0||1/0===t||-1/0===t)}},t.text=t.text||{is:function(t){return e("text"),"string"==typeof t}},t.text.ify=t.text.ify||function(i){return e("text.ify"),t.text.is(i)?i:"undefined"!=typeof JSON?JSON.stringify(i):i&&i.toString?i.toString():i},t.text.random=t.text.random||function(t,i){e("text.random");var n="";for(t=t||24,i=i||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";t>0;)n+=i.charAt(Math.floor(Math.random()*i.length)),t--;return n},t.text.match=t.text.match||function(t,i){var n,r;return e("text.match"),"string"==typeof t&&("string"==typeof i&&(i={"=":i}),t===(n=(i=i||{})["="]||i["*"]||i[">"]||i["<"])||r===i["="]&&(n=i["*"]||i[">"]||i["<"],t.slice(0,(n||"").length)===n||r===i["*"]&&(r!==i[">"]&&r!==i["<"]?t>=i[">"]&&t<=i["<"]:r!==i[">"]&&t>=i[">"]||r!==i["<"]&&t<=i["<"])))},t.text.hash=t.text.hash||function(t,i){if(e("text.hash"),"string"==typeof t){if(i=i||0,!t.length)return i;for(var n=0,r=t.length;n<r;++n)i=(i<<5)-i+t.charCodeAt(n),i|=0;return i}},t.list=t.list||{is:function(t){return e("list"),t instanceof Array}},t.list.slit=t.list.slit||Array.prototype.slice,t.list.sort=t.list.sort||function(t){return e("list.sort"),function(e,i){return e&&i?(e=e[t])<(i=i[t])?-1:e>i?1:0:0}},t.list.map=t.list.map||function(t,i,n){return e("list.map"),s(t,i,n)},t.list.index=1,t.obj=t.boj||{is:function(t){return e("obj"),!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])}},t.obj.put=t.obj.put||function(t,i,n){return e("obj.put"),(t||{})[i]=n,t},t.obj.has=t.obj.has||function(t,i){return e("obj.has"),t&&Object.prototype.hasOwnProperty.call(t,i)},t.obj.del=t.obj.del||function(t,i){if(e("obj.del"),t)return t[i]=null,delete t[i],t},t.obj.as=t.obj.as||function(t,i,n,r){return e("obj.as"),t[i]=t[i]||(r===n?{}:n)},t.obj.ify=t.obj.ify||function(t){if(e("obj.ify"),r(t))return t;try{t=JSON.parse(t)}catch(e){t={}}return t},function(){function i(e,t){o(this,t)&&void 0!==this[t]||(this[t]=e)}t.obj.to=t.obj.to||function(t,n){return e("obj.to"),s(t,i,n=n||{}),n}}(),t.obj.copy=t.obj.copy||function(t){return e("obj.copy"),t?JSON.parse(JSON.stringify(t)):t},function(){function i(e,t){var i=this.n;if(!i||!(t===i||r(i)&&o(i,t)))return void 0!==t||void 0}t.obj.empty=t.obj.empty||function(t,n){return e("obj.empty"),!t||!s(t,i,{n})}}(),function(){function i(e,t){if(2===arguments.length)return i.r=i.r||{},void(i.r[e]=t);i.r=i.r||[],i.r.push(e)}var s,a=Object.keys;Object.keys=Object.keys||function(e){return s(e,(function(e,t,i){i(t)}))},t.obj.map=s=t.obj.map||function(s,l,u){e("obj.map");var h,c,d,f,p,v=0,y="function"==typeof l;if(i.r=h,a&&r(s)&&(f=a(s),p=!0),u=u||{},n(s)||f)for(c=(f||s).length;v<c;v++){var g=v+t.list.index;if(y){if((d=p?l.call(u,s[f[v]],f[v],i):l.call(u,s[v],g,i))!==h)return d}else if(l===s[p?f[v]:v])return f?f[v]:g}else for(v in s)if(y){if(o(s,v)&&(d=u?l.call(u,s[v],v,i):l(s[v],v,i))!==h)return d}else if(l===s[v])return v;return y?i.r:t.list.index?0:-1}}(),t.time=t.time||{},t.time.is=t.time.is||function(t){return e("time"),t?t instanceof Date:+(new Date).getTime()};var i=t.fn.is,n=t.list.is,r=(w=t.obj).is,o=w.has,s=w.map,a={is:function(t){return e("val.is"),t!==b&&(null===t||t!==1/0&&(!!(c(t)||u(t)||h(t))||a.link.is(t)||!1))}};a.link=a.rel={_:"#"},function(){function t(e,t){var i=this;return i.id?i.id=!1:t==l&&c(e)?void(i.id=e):i.id=!1}a.link.is=function(i){if(e("val.link.is"),i&&i[l]&&!i._&&r(i)){var n={};if(s(i,t,n),n.id)return n.id}return!1}}(),a.link.ify=function(t){return e("val.link.ify"),d({},l,t)},t.obj.has._=".";var l=a.link._,u=t.bi.is,h=t.num.is,c=t.text.is,d=(r=(w=t.obj).is,w.put);s=w.map,t.val=t.val||a;var f={_:"_",soul:function(t,i){return e("node.soul"),t&&t._&&t._[i||y]}};f.soul.ify=function(t,i){return e("node.soul.ify"),i="string"==typeof i?{soul:i}:i||{},(t=t||{})._=t._||{},t._[y]=i.soul||t._[y]||v(),t},f.soul._=a.link._,function(){function t(e,t){if(t!==f._)return!a.is(e)||void(this.cb&&this.cb.call(this.as,e,t,this.n,this.s))}f.is=function(i,n,o){var a;return e("node.is"),!!r(i)&&!!(a=f.soul(i))&&!s(i,t,{as:o,cb:n,s:a,n:i})}}(),function(){function t(e,t){var i,n=this.o;n.map?void 0===(i=n.map.call(this.as,e,""+t,n.node))?p(n.node,t):n.node&&(n.node[t]=i):a.is(e)&&(n.node[t]=e)}f.ify=function(i,n,r){return e("node.ify"),n?"string"==typeof n?n={soul:n}:"function"==typeof n&&(n={map:n}):n={},n.map&&(n.node=n.map.call(r,i,b,n.node||{})),(n.node=f.soul.ify(n.node||{},n))&&s(i,t,{o:n,as:r}),n.node}}(),r=(w=t.obj).is;var p=w.del,v=(s=w.map,t.text.random),y=f.soul._;t.node=t.node||f;var g=t.state;g.lex=function(){return e("state.lex"),g().toString(36).replace(".","")},g.to=function(t,i,n){e("state.to");var o=(t||{})[i];return r(o)&&(o=_(o)),g.ify(n,i,g.is(t,i),o,f.soul(t))},function(){function t(e,t){m!==t&&g.ify(this.o,t,this.s)}g.map=function(n,a,l){var u;e("state.map");var c=r(c=n||a)?c:null;return n=i(n=n||a)?n:null,c&&!n?(a=h(a)?a:g(),c[m]=c[m]||{},s(c,t,{o:c,s:a}),c):(l=l||r(a)?a:u,a=h(a)?a:g(),function(e,i,r,s){if(!n)return t.call({o:r,s:a},e,i),e;n.call(l||this||{},e,i,r,s),o(r,i)&&u===r[i]||t.call({o:r,s:a},e,i)})}}(),(w=t.obj).as,o=w.has,r=w.is,s=w.map;var _=w.copy,m=(h=t.num.is,i=t.fn.is,f._),x={};!function(){function t(e,t){if(!e||t!==f.soul(e)||!f.is(e,this.fn,this.as))return!0;this.cb&&(i.n=e,i.as=this.as,this.cb.call(i.as,e,t,i))}function i(e){e&&f.is(i.n,e,i.as)}x.is=function(i,n,o,a){return e("graph.is"),!(!i||!r(i)||k(i)||s(i,t,{cb:n,fn:o,as:a}))}}(),function(){function i(e,t){var i;return(i=function(e,t){for(var i,n=e.seen,r=n.length;r--;)if(i=n[r],t.obj===i.obj)return i;n.push(t)}(e,t))?i:(t.env=e,t.soul=s,f.ify(t.obj,n,t)&&(t.link=t.link||a.link.ify(f.soul(t.node)),t.obj!==e.shell&&(e.graph[a.link.is(t.link)]=t.node)),t)}function n(e,t,n){var r,s,u=this,h=u.env;if(f._===t&&o(e,a.link._))return n._;if(r=l(e,t,n,u,h)){if(t||(u.node=u.node||n||{},o(e,f._)&&f.soul(e)&&(u.node._=_(e._)),u.node=f.soul.ify(u.node,a.link.is(u.link)),u.link=u.link||a.link.ify(f.soul(u.node))),(s=h.map)&&(s.call(h.as||{},e,t,n,u),o(n,t))){if(e=n[t],b===e)return void p(n,t);if(!(r=l(e,t,n,u,h)))return}if(!t)return u.node;if(!0===r)return e;if((s=i(h,{obj:e,path:u.path.concat(t)})).node)return s.link}}function s(e){var t=this,i=a.link.is(t.link),n=t.env.graph;t.link=t.link||a.link.ify(e),t.link[a.link._]=e,t.node&&t.node[f._]&&(t.node[f._][a.link._]=e),o(n,i)&&(n[e]=n[i],p(n,i))}function l(e,i,n,o,s){var u;return!!a.is(e)||(r(e)?1:(u=s.invalid)?l(e=u.call(s.as||{},e,i,n),i,n,o,s):(s.err="Invalid value at '"+o.path.concat(i).join(".")+"'!",void(t.list.is(e)&&(s.err+=" Use `.set(item)` instead of an Array."))))}x.ify=function(t,n,r){e("graph.ify");var o={path:[],obj:t};return n?"string"==typeof n?n={soul:n}:"function"==typeof n&&(n.map=n):n={},"string"==typeof r&&(n.soul=n.soul||r,r=b),n.soul&&(o.link=a.link.ify(n.soul)),n.shell=(r||{}).shell,n.graph=n.graph||{},n.seen=n.seen||[],n.as=n.as||r,i(n,o),n.root=o.node,n.graph}}(),x.node=function(t){e("graph.node");var i=f.soul(t);if(i)return d({},i,t)},function(){function t(e,t){var i,n;if(f._!==t)(i=a.link.is(e))?(n=this.opt.seen[i])?this.obj[t]=n:this.obj[t]=this.opt.seen[i]=x.to(this.graph,i,this.opt):this.obj[t]=e;else{if(k(e,a.link._))return;this.obj[t]=_(e)}}x.to=function(i,n,r){if(e("graph.to"),i){var o={};return r=r||{seen:{}},s(i[n],t,{obj:o,graph:i,opt:r}),o}}}(),i=t.fn.is,r=(w=t.obj).is,p=w.del,o=w.has;var w,b,k=w.empty;d=w.put,s=w.map,_=w.copy,t.graph=t.graph||x}}()},96:(e,t,i)=>{var n="Expected a function",r=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,l=parseInt,u="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,h="object"==typeof self&&self&&self.Object===Object&&self,c=u||h||Function("return this")(),d=Object.prototype.toString,f=Math.max,p=Math.min,v=function(){return c.Date.now()};function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function g(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==d.call(e)}(e))return NaN;if(y(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=y(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var i=s.test(e);return i||a.test(e)?l(e.slice(2),i?2:8):o.test(e)?NaN:+e}e.exports=function(e,t,i){var r=!0,o=!0;if("function"!=typeof e)throw new TypeError(n);return y(i)&&(r="leading"in i?!!i.leading:r,o="trailing"in i?!!i.trailing:o),function(e,t,i){var r,o,s,a,l,u,h=0,c=!1,d=!1,_=!0;if("function"!=typeof e)throw new TypeError(n);function m(t){var i=r,n=o;return r=o=void 0,h=t,a=e.apply(n,i)}function x(e){return h=e,l=setTimeout(b,t),c?m(e):a}function w(e){var i=e-u;return void 0===u||i>=t||i<0||d&&e-h>=s}function b(){var e=v();if(w(e))return k(e);l=setTimeout(b,function(e){var i=t-(e-u);return d?p(i,s-(e-h)):i}(e))}function k(e){return l=void 0,_&&r?m(e):(r=o=void 0,a)}function T(){var e=v(),i=w(e);if(r=arguments,o=this,u=e,i){if(void 0===l)return x(u);if(d)return l=setTimeout(b,t),m(u)}return void 0===l&&(l=setTimeout(b,t)),a}return t=g(t)||0,y(i)&&(c=!!i.leading,s=(d="maxWait"in i)?f(g(i.maxWait)||0,t):s,_="trailing"in i?!!i.trailing:_),T.cancel=function(){void 0!==l&&clearTimeout(l),h=0,r=u=o=l=void 0},T.flush=function(){return void 0===l?a:k(v())},T}(e,t,{leading:r,maxWait:t,trailing:o})}},379:e=>{"use strict";var t=[];function i(e){for(var i=-1,n=0;n<t.length;n++)if(t[n].identifier===e){i=n;break}return i}function n(e,n){for(var o={},s=[],a=0;a<e.length;a++){var l=e[a],u=n.base?l[0]+n.base:l[0],h=o[u]||0,c="".concat(u," ").concat(h);o[u]=h+1;var d=i(c),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(f);else{var p=r(f,n);n.byIndex=a,t.splice(a,0,{identifier:c,updater:p,references:1})}s.push(c)}return s}function r(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,r){var o=n(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var a=i(o[s]);t[a].references--}for(var l=n(e,r),u=0;u<o.length;u++){var h=i(o[u]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}o=l}}},569:e=>{"use strict";var t={};e.exports=function(e,i){var n=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,i)=>{"use strict";e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,r&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var o=i.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={id:e,exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{"use strict";var e=__webpack_require__(203),t=__webpack_require__(379),i=__webpack_require__.n(t),n=__webpack_require__(795),r=__webpack_require__.n(n),o=__webpack_require__(569),s=__webpack_require__.n(o),a=__webpack_require__(565),l=__webpack_require__.n(a),u=__webpack_require__(216),h=__webpack_require__.n(u),c=__webpack_require__(589),d=__webpack_require__.n(c),f=__webpack_require__(424),p={};function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t){return _=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_(e,t)}function m(e,t){if(t&&("object"===v(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}p.styleTagTransform=d(),p.setAttributes=l(),p.insert=s().bind(null,"head"),p.domAPI=r(),p.insertStyleElement=h(),i()(f.Z,p),f.Z&&f.Z.locals&&f.Z.locals;const w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}(s,e);var t,i,n,r,o=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=x(n);if(r){var i=x(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return m(this,e)});function s(){return y(this,s),o.apply(this,arguments)}return t=s,(i=[{key:"onResetEvent",value:function(){}},{key:"onDestroyEvent",value:function(){}}])&&g(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),s}(e.Hf);function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function k(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function T(e,t){return T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},T(e,t)}function E(e,t){if(t&&("object"===b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return A(e)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},S(e)}const C=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}(a,t);var i,n,r,o,s=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=S(r);if(o){var i=S(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return E(this,e)});function a(t,i,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=s.call(this,t,i,n)).anchorPoint.set(.5,.5),r.body=new e.uT(A(r)),r.body.addShape(new e.UL(0,0,r.width,r.height)),r.body.setMaxVelocity(10,10),r.body.setFriction(.8,.8),r.body.ignoreGravity=!0,r.alwaysUpdate=!0,r}return i=a,(n=[{key:"onCollision",value:function(e,t){return!1}}])&&k(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),a}(e.jy);var O={};const P=function(t,i,n){var r=O[t];r?(r.pos.x=i,r.pos.y=n,console.log(t,"updated peer location data",JSON.stringify({x:i,y:n}))):(r=new C(i,n,{name:"other-player-".concat(t),image:"pegah-avatar",width:309,height:396,framewidth:309,frameheight:396}),O[t]=r,e.H6.world.addChild(r,5),console.log("created an OtherPlayer",r))};var R=__webpack_require__(616),I=__webpack_require__.n(R)()("https://hypha-gun-relay.herokuapp.com/gun"),M="ME_KEY",L="location",D=I.get("artistas"),B=localStorage.getItem(M);B?console.log("second time use, this is my id: ",B):(B=Math.random().toString().split(".")[1],localStorage.setItem(M,B),console.log("first time to use, this is my id: ",B));var N=D.get(B);function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function F(e,t){return F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},F(e,t)}function G(e,t){if(t&&("object"===V(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function U(e){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},U(e)}const H=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&F(e,t)}(a,t);var i,n,r,o,s=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(r);if(o){var i=U(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return G(this,e)});function a(){return j(this,a),s.apply(this,arguments)}return i=a,(n=[{key:"onResetEvent",value:function(){e.fu.load("area01",{setViewportBounds:!0});var t,i=e.H6.world.getChildByName("mainPlayer")[0];e.H6.world.moveToTop(i),t=P,D.map((function(e,t){return t===B?void 0:e})).once((function(e,i){D.get(i).get(L).on((function(e){t(i,e.x,e.y)}))}))}}])&&z(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),a}(e.Hf);var $=__webpack_require__(96);function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function W(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Y(){return Y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=q(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(arguments.length<3?e:i):r.value}},Y.apply(this,arguments)}function q(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=J(e)););return e}function K(e,t){return K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},K(e,t)}function Z(e,t){if(t&&("object"===X(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function J(e){return J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},J(e)}var Q=__webpack_require__.n($)()((function(e,t){var i,n,r;N.put((r={x:e,y:t},(n=L)in(i={})?Object.defineProperty(i,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[n]=r,i))}),100);const ee=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K(e,t)}(a,t);var i,n,r,o,s=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=J(r);if(o){var i=J(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return Z(this,e)});function a(t,i,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=s.call(this,t,i,n)).anchorPoint.set(0,0),r.body.setMaxVelocity(10,10),r.body.setFriction(.8,.8),r.body.ignoreGravity=!0,e.H6.viewport.follow(r.pos,e.H6.viewport.AXIS.BOTH,.4),r.alwaysUpdate=!0,r.destination=null,r}return i=a,(n=[{key:"onActivateEvent",value:function(){e.qH.registerPointerEvent("pointerdown",e.H6.viewport,this.pointerDown.bind(this))}},{key:"onDeactivateEvent",value:function(){e.qH.releaseAllPointerEvents(this)}},{key:"pointerDown",value:function(t){var i=e.qH.globalToLocal(t.clientX,t.clientY),n=e.H6.viewport.localToWorld(i.x,i.y);this.destination={x:n.x-this.width/2,y:n.y-this.height/2}}},{key:"update",value:function(t){return e.qH.isKeyPressed("left")||e.qH.isKeyPressed("right")||e.qH.isKeyPressed("up")||e.qH.isKeyPressed("down")?(this.destination=null,e.qH.isKeyPressed("left")?this.body.force.x=-this.body.maxVel.x:e.qH.isKeyPressed("right")&&(this.body.force.x=this.body.maxVel.x),e.qH.isKeyPressed("up")?this.body.force.y=-this.body.maxVel.y:e.qH.isKeyPressed("down")&&(this.body.force.y=this.body.maxVel.y)):this.destination&&(this.destination.x||this.destination.y)?(this.destination.y&&(this.destination.y-this.pos.y>10?this.body.force.y=this.body.maxVel.y:this.destination.y-this.pos.y<-10?this.body.force.y=-this.body.maxVel.y:(this.body.force.y=0,this.pos.y=this.destination.y,this.destination.y=void 0)),this.destination.x&&(this.destination.x-this.pos.x>10?(console.log("positive x adjustment",this.destination.x-this.pos.x),this.body.force.x=this.body.maxVel.x):this.destination.x-this.pos.x<-10?(console.log("negative x adjustment",this.destination.x-this.pos.x),this.body.force.x=-this.body.maxVel.x):(console.log("resetting x adjustment",this.destination.x-this.pos.x),this.body.force.x=0,this.pos.x=this.destination.x,this.destination.x=void 0))):(this.destination=null,this.body.force.x=0,this.body.force.y=0),Q(this.pos.x,this.pos.y),Y(J(a.prototype),"update",this).call(this,t)||0!==this.body.vel.x||0!==this.body.vel.y}},{key:"onDestroyEvent",value:function(){}},{key:"onCollision",value:function(e,t){return"background"!==t.name}}])&&W(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),a}(e.JH),te=[{name:"PressStart2P",type:"image",src:"./data/fnt/PressStart2P.png"},{name:"PressStart2P",type:"binary",src:"./data/fnt/PressStart2P.fnt"},{name:"building",type:"image",src:"data/img/map/building.png"},{name:"pegah-avatar",type:"image",src:"data/img/sprite/pegah-avatar.png"},{name:"area01",type:"tmx",src:"data/map/area01.tmx"}];function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function ne(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function re(e,t){return re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},re(e,t)}function oe(e,t){if(t&&("object"===ie(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function se(e){return se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},se(e)}const ae=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&re(e,t)}(s,e);var t,i,n,r,o=(n=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=se(n);if(r){var i=se(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return oe(this,e)});function s(e,t,i){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this,e,t,i)).body.ignoreGravity=!0,n.renderable.addAnimation("normal",[0]),n.renderable.setCurrentAnimation("normal"),n}return t=s,(i=[{key:"onCollision",value:function(e,t){return!1}}])&&ne(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),s}(e.JH);e.Uh.onReady((function(){e.Rk.init(2700,2700,{parent:"screen",scale:"auto",scaleMethod:"flex-width"})?(e.n0.init("mp3,ogg"),e._m.crossOrigin="anonymous",e._m.preload(te,(function(){e.SB.set(e.SB.MENU,new w),e.SB.set(e.SB.PLAY,new H),e.d_.register("background",ae),e.d_.register("mainPlayer",ee),e.qH.bindKey(e.qH.KEY.LEFT,"left"),e.qH.bindKey(e.qH.KEY.RIGHT,"right"),e.qH.bindKey(e.qH.KEY.UP,"up"),e.qH.bindKey(e.qH.KEY.DOWN,"down"),e.SB.change(e.SB.PLAY)}))):alert("Your browser does not support HTML5 canvas.")}))})()})();