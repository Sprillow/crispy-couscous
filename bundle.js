/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var __webpack_modules__={203:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},_get.apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function trimLeft(e){return e.replace(/^\s+/,"")}function trimRight(e){return e.replace(/\s+$/,"")}function isNumeric(e){return"string"==typeof e&&(e=e.trim()),!isNaN(e)&&/[+-]?([0-9]*[.])?[0-9]+/.test(e)}function isBoolean(e){var t=e.trim();return"true"===t||"false"===t}function toHex$1(e){for(var t="",n=0;n<e.length;)t+=e.charCodeAt(n++).toString(16);return t}__webpack_require__.d(__webpack_exports__,{EY:()=>Vector2d,H6:()=>game,Hf:()=>Stage,JH:()=>Entity,Rk:()=>video,SB:()=>state,Uh:()=>device$1,_m:()=>loader,d_:()=>pool,fu:()=>level,qH:()=>input}),"undefined"!=typeof window&&void 0===window.console&&(window.console={},window.console.log=function(){},window.console.assert=function(){},window.console.warn=function(){},window.console.error=function(){alert(Array.prototype.slice.call(arguments).join(", "))});var stringUtils=Object.freeze({__proto__:null,capitalize,trimLeft,trimRight,isNumeric,isBoolean,toHex:toHex$1}),vendors$1=["ms","MS","moz","webkit","o"];function prefixed(e,t){if(e in(t=t||window))return t[e];var n,r=capitalize(e);return vendors$1.some((function(e){var i=e+r;return n=i in t?t[i]:void 0})),n}function setPrefixed(e,t,n){if(!(e in(n=n||window))){var r=capitalize(e);return vendors$1.some((function(e){var i=e+r;if(i in n)return n[i]=t,!0})),!1}n[e]=t}var agentUtils=Object.freeze({__proto__:null,prefixed,setPrefixed}),DEG_TO_RAD=Math.PI/180,RAD_TO_DEG=180/Math.PI,TAU=2*Math.PI,ETA=.5*Math.PI,EPSILON=1e-6;function isPowerOfTwo(e){return 0==(e&e-1)}function nextPowerOfTwo(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function degToRad(e){return e*DEG_TO_RAD}function radToDeg(e){return e*RAD_TO_DEG}function _clamp(e,t,n){return e<t?t:e>n?n:+e}function random$1(e,t){return~~(Math.random()*(t-e))+e}function randomFloat(e,t){return Math.random()*(t-e)+e}function weightedRandom$1(e,t){return~~(Math.pow(Math.random(),2)*(t-e))+e}function round(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Math.pow(10,t);return~~(.5+e*n)/n}function toBeCloseTo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return Math.abs(e-t)<Math.pow(10,-n)/2}var math=Object.freeze({__proto__:null,DEG_TO_RAD,RAD_TO_DEG,TAU,ETA,EPSILON,isPowerOfTwo,nextPowerOfTwo,degToRad,radToDeg,clamp:_clamp,random:random$1,randomFloat,weightedRandom:weightedRandom$1,round,toBeCloseTo});function _remove(e,t){var n=Array.prototype.indexOf.call(e,t);return-1!==n&&Array.prototype.splice.call(e,n,1),e}function random(e){return e[random$1(0,e.length)]}function weightedRandom(e){return e[weightedRandom$1(0,e.length)]}var arrayUtils=Object.freeze({__proto__:null,remove:_remove,random,weightedRandom}),REMOVE_PATH=/^.*(\\|\/|\:)/,REMOVE_EXT=/\.[^\.]*$/;function getBasename(e){return e.replace(REMOVE_PATH,"").replace(REMOVE_EXT,"")}function getExtension(e){return e.substring(e.lastIndexOf(".")+1,e.length)}var fileUtils=Object.freeze({__proto__:null,getBasename,getExtension});function defer(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return setTimeout.apply(void 0,[e.bind(t),.01].concat(r))}function throttle(e,t,n){var r,i=window.performance.now();return"boolean"!=typeof n&&(n=!1),function(){var o=window.performance.now(),a=o-i,s=arguments;if(!(a<t))return i=o,e.apply(null,s);!1===n&&(clearTimeout(r),r=setTimeout((function(){return i=o,e.apply(null,s)}),a))}}var fnUtils=Object.freeze({__proto__:null,defer,throttle}),objectClass={},instance_counter=0,pool={register:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t)throw new Error("Cannot register object '"+e+"', invalid class");objectClass[e]={class:t,pool:n?[]:void 0}},pull:function(e){for(var t=new Array(arguments.length),n=0;n<arguments.length;n++)t[n]=arguments[n];var r=objectClass[e];if(r){var i,o=r.class,a=r.pool;return a&&(i=a.pop())?(t.shift(),"function"==typeof i.onResetEvent&&i.onResetEvent.apply(i,t),instance_counter--):(t[0]=o,i=new(o.bind.apply(o,t)),a&&(i.className=e)),i}throw new Error("Cannot instantiate object of type '"+e+"'")},purge:function(){for(var e in objectClass)objectClass[e]&&(objectClass[e].pool=[]);instance_counter=0},push:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.poolable(e)){if(!0===t)throw new Error("me.pool: object "+e+" cannot be recycled");return!1}return objectClass[e.className].pool.push(e),instance_counter++,!0},exists:function(e){return e in objectClass},poolable:function(e){var t=e.className;return void 0!==t&&"function"==typeof e.onResetEvent&&t in objectClass&&"undefined"!==objectClass[t].pool},getInstanceCount:function(){return instance_counter}},Vector2d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,e),this.onResetEvent(t,n)}return _createClass(e,[{key:"onResetEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e,this.y=t,this}},{key:"_set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"set",value:function(e,t){if(e!==+e||t!==+t)throw new Error("invalid x,y parameters (not a number)");return this._set(e,t)}},{key:"setZero",value:function(){return this.set(0,0)}},{key:"setV",value:function(e){return this._set(e.x,e.y)}},{key:"add",value:function(e){return this._set(this.x+e.x,this.y+e.y)}},{key:"sub",value:function(e){return this._set(this.x-e.x,this.y-e.y)}},{key:"scale",value:function(e,t){return this._set(this.x*e,this.y*(void 0!==t?t:e))}},{key:"toIso",value:function(){return this._set(this.x-this.y,.5*(this.x+this.y))}},{key:"to2d",value:function(){return this._set(this.y+this.x/2,this.y-this.x/2)}},{key:"scaleV",value:function(e){return this._set(this.x*e.x,this.y*e.y)}},{key:"div",value:function(e){return this._set(this.x/e,this.y/e)}},{key:"abs",value:function(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)}},{key:"clamp",value:function(t,n){return new e(_clamp(this.x,t,n),_clamp(this.y,t,n))}},{key:"clampSelf",value:function(e,t){return this._set(_clamp(this.x,e,t),_clamp(this.y,e,t))}},{key:"minV",value:function(e){return this._set(this.x<e.x?this.x:e.x,this.y<e.y?this.y:e.y)}},{key:"maxV",value:function(e){return this._set(this.x>e.x?this.x:e.x,this.y>e.y?this.y:e.y)}},{key:"floor",value:function(){return new e(Math.floor(this.x),Math.floor(this.y))}},{key:"floorSelf",value:function(){return this._set(Math.floor(this.x),Math.floor(this.y))}},{key:"ceil",value:function(){return new e(Math.ceil(this.x),Math.ceil(this.y))}},{key:"ceilSelf",value:function(){return this._set(Math.ceil(this.x),Math.ceil(this.y))}},{key:"negate",value:function(){return new e(-this.x,-this.y)}},{key:"negateSelf",value:function(){return this._set(-this.x,-this.y)}},{key:"copy",value:function(e){return this._set(e.x,e.y)}},{key:"equals",value:function(){var e,t;return 2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.x===e&&this.y===t}},{key:"normalize",value:function(){return this.div(this.length()||1)}},{key:"perp",value:function(){return this._set(this.y,-this.x)}},{key:"rotate",value:function(e,t){var n=0,r=0;"object"===_typeof(t)&&(n=t.x,r=t.y);var i=this.x-n,o=this.y-r,a=Math.cos(e),s=Math.sin(e);return this._set(i*a-o*s+n,i*s+o*a+r)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"length2",value:function(){return this.dot(this)}},{key:"length",value:function(){return Math.sqrt(this.length2())}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"distance",value:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)}},{key:"angle",value:function(e){return Math.acos(_clamp(this.dot(e)/(this.length()*e.length()),-1,1))}},{key:"project",value:function(e){return this.scale(this.dot(e)/e.length2())}},{key:"projectN",value:function(e){return this.scale(this.dot(e))}},{key:"clone",value:function(){return pool.pull("Vector2d",this.x,this.y)}},{key:"toString",value:function(){return"x:"+this.x+",y:"+this.y}}]),e}(),_toHex=function(e){return"0123456789ABCDEF".charAt(e-e%16>>4)+"0123456789ABCDEF".charAt(e%16)},rgbaRx=/^rgba?\((\d+), ?(\d+), ?(\d+)(, ?([\d\.]+))?\)$/,hex3Rx=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,hex4Rx=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,hex6Rx=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,hex8Rx=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,cssToRGB=new Map;[["black",[0,0,0]],["silver",[192,192,129]],["gray",[128,128,128]],["white",[255,255,255]],["maroon",[128,0,0]],["red",[255,0,0]],["purple",[128,0,128]],["fuchsia",[255,0,255]],["green",[0,128,0]],["lime",[0,255,0]],["olive",[128,128,0]],["yellow",[255,255,0]],["navy",[0,0,128]],["blue",[0,0,255]],["teal",[0,128,128]],["aqua",[0,255,255]],["orange",[255,165,0]],["aliceblue",[240,248,245]],["antiquewhite",[250,235,215]],["aquamarine",[127,255,212]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["brown",[165,42,42]],["burlywood",[222,184,35]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["coral",[255,127,80]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray[*]",[169,169,169]],["darkgreen",[0,100,0]],["darkgrey[*]",[169,169,169]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,143]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkslategrey",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dimgrey",[105,105,105]],["dodgerblue",[30,144,255]],["firebrick",[178,34,34]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["greenyellow",[173,255,47]],["grey",[128,128,128]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["khaki",[240,230,140]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgray",[211,211,211]],["lightgreen",[144,238,144]],["lightgrey",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightslategrey",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["orchid",[218,112,214]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["pink",[255,192,203]],["plum",[221,160,221]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["salmon",[250,128,114]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["sienna",[160,82,45]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["slategrey",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["tomato",[255,99,71]],["turquoise",[64,224,208]],["violet",[238,130,238]],["wheat",[245,222,179]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]]].forEach((function(e){cssToRGB.set(e[0],e[1])}));var Color=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;_classCallCheck(this,e),this.onResetEvent(t,n,r,i)}return _createClass(e,[{key:"onResetEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return void 0===this.glArray&&(this.glArray=new Float32Array([0,0,0,1])),this.setColor(e,t,n,r)}},{key:"r",get:function(){return~~(255*this.glArray[0])},set:function(e){this.glArray[0]=_clamp(~~e||0,0,255)/255}},{key:"g",get:function(){return~~(255*this.glArray[1])},set:function(e){this.glArray[1]=_clamp(~~e||0,0,255)/255}},{key:"b",get:function(){return~~(255*this.glArray[2])},set:function(e){this.glArray[2]=_clamp(~~e||0,0,255)/255}},{key:"alpha",get:function(){return this.glArray[3]},set:function(e){this.glArray[3]=void 0===e?1:_clamp(+e,0,1)}},{key:"setColor",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this.r=e,this.g=t,this.b=n,this.alpha=r,this}},{key:"clone",value:function(){return pool.pull("Color").copy(this)}},{key:"copy",value:function(t){return t instanceof e?(this.glArray.set(t.glArray),this):this.parseCSS(t)}},{key:"add",value:function(e){return this.glArray[0]=_clamp(this.glArray[0]+e.glArray[0],0,1),this.glArray[1]=_clamp(this.glArray[1]+e.glArray[1],0,1),this.glArray[2]=_clamp(this.glArray[2]+e.glArray[2],0,1),this.glArray[3]=(this.glArray[3]+e.glArray[3])/2,this}},{key:"darken",value:function(e){return e=_clamp(e,0,1),this.glArray[0]*=e,this.glArray[1]*=e,this.glArray[2]*=e,this}},{key:"lerp",value:function(e,t){return t=_clamp(t,0,1),this.glArray[0]+=(e.glArray[0]-this.glArray[0])*t,this.glArray[1]+=(e.glArray[1]-this.glArray[1])*t,this.glArray[2]+=(e.glArray[2]-this.glArray[2])*t,this}},{key:"lighten",value:function(e){return e=_clamp(e,0,1),this.glArray[0]=_clamp(this.glArray[0]+(1-this.glArray[0])*e,0,1),this.glArray[1]=_clamp(this.glArray[1]+(1-this.glArray[1])*e,0,1),this.glArray[2]=_clamp(this.glArray[2]+(1-this.glArray[2])*e,0,1),this}},{key:"random",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return e<0&&(e=0),t>255&&(t=255),this.setColor(random$1(e,t),random$1(e,t),random$1(e,t),this.alpha)}},{key:"equals",value:function(e){return this.glArray[0]===e.glArray[0]&&this.glArray[1]===e.glArray[1]&&this.glArray[2]===e.glArray[2]&&this.glArray[3]===e.glArray[3]}},{key:"parseCSS",value:function(e){return cssToRGB.has(e)?this.setColor.apply(this,cssToRGB.get(e)):this.parseRGB(e)}},{key:"parseRGB",value:function(e){var t=rgbaRx.exec(e);return t?this.setColor(+t[1],+t[2],+t[3],+t[5]):this.parseHex(e)}},{key:"parseHex",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t=hex8Rx.exec(e))return this.setColor(parseInt(t[!1===n?1:2],16),parseInt(t[!1===n?2:3],16),parseInt(t[!1===n?3:4],16),(_clamp(parseInt(t[!1===n?4:1],16),0,255)/255).toFixed(1));if(t=hex6Rx.exec(e))return this.setColor(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16));if(t=hex4Rx.exec(e)){var r=t[!1===n?1:2],i=t[!1===n?2:3],o=t[!1===n?3:4],a=t[!1===n?4:1];return this.setColor(parseInt(r+r,16),parseInt(i+i,16),parseInt(o+o,16),(_clamp(parseInt(a+a,16),0,255)/255).toFixed(1))}if(t=hex3Rx.exec(e))return this.setColor(parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16));throw new Error("invalid parameter: "+e)}},{key:"toUint32",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,t=255&this.r,n=255&this.g,r=255&this.b,i=255*e&255;return(i<<24)+(t<<16)+(n<<8)+r}},{key:"toArray",value:function(){return this.glArray}},{key:"toHex",value:function(){return"#"+_toHex(this.r)+_toHex(this.g)+_toHex(this.b)}},{key:"toHex8",value:function(){return"#"+_toHex(this.r)+_toHex(this.g)+_toHex(this.b)+_toHex(255*this.alpha)}},{key:"toRGB",value:function(){return"rgb("+this.r+","+this.g+","+this.b+")"}},{key:"toRGBA",value:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.alpha+")"}}]),e}(),Matrix3d=function(){function e(){_classCallCheck(this,e),this.onResetEvent.apply(this,arguments)}return _createClass(e,[{key:"onResetEvent",value:function(){void 0===this.val&&(this.val=new Float32Array(16)),arguments.length&&arguments[0]instanceof e?this.copy(arguments[0]):16===arguments.length?this.setTransform.apply(this,arguments):this.identity()}},{key:"tx",get:function(){return this.val[12]}},{key:"ty",get:function(){return this.val[13]}},{key:"tz",get:function(){return this.val[14]}},{key:"identity",value:function(){return this.setTransform(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}},{key:"setTransform",value:function(e,t,n,r,i,o,a,s,c,u,l,h,d,f,p,v){var y=this.val;return y[0]=e,y[1]=t,y[2]=n,y[3]=r,y[4]=i,y[5]=o,y[6]=a,y[7]=s,y[8]=c,y[9]=u,y[10]=l,y[11]=h,y[12]=d,y[13]=f,y[14]=p,y[15]=v,this}},{key:"copy",value:function(e){return this.val.set(e.val),this}},{key:"fromMat2d",value:function(e){var t=e.val;return this.setTransform(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1)}},{key:"multiply",value:function(e){var t=this.val,n=e.val,r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],c=t[5],u=t[6],l=t[7],h=t[8],d=t[9],f=t[10],p=t[11],v=t[12],y=t[13],g=t[14],m=t[15],_=n[0],b=n[1],x=n[2],w=n[3];return t[0]=_*r+b*s+x*h+w*v,t[1]=_*i+b*c+x*d+w*y,t[2]=_*o+b*u+x*f+w*g,t[3]=_*a+b*l+x*p+w*m,_=n[4],b=n[5],x=n[6],w=n[7],t[4]=_*r+b*s+x*h+w*v,t[5]=_*i+b*c+x*d+w*y,t[6]=_*o+b*u+x*f+w*g,t[7]=_*a+b*l+x*p+w*m,_=n[8],b=n[9],x=n[10],w=n[11],t[8]=_*r+b*s+x*h+w*v,t[9]=_*i+b*c+x*d+w*y,t[10]=_*o+b*u+x*f+w*g,t[11]=_*a+b*l+x*p+w*m,_=n[12],b=n[13],x=n[14],w=n[15],t[12]=_*r+b*s+x*h+w*v,t[13]=_*i+b*c+x*d+w*y,t[14]=_*o+b*u+x*f+w*g,t[15]=_*a+b*l+x*p+w*m,this}},{key:"transpose",value:function(){var e=this.val,t=e[1],n=e[2],r=e[3],i=e[6],o=e[7],a=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=t,e[6]=e[9],e[7]=e[13],e[8]=n,e[9]=i,e[11]=e[14],e[12]=r,e[13]=o,e[14]=a,this}},{key:"invert",value:function(){var e=this.val,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],c=e[7],u=e[8],l=e[9],h=e[10],d=e[11],f=e[12],p=e[13],v=e[14],y=e[15],g=t*a-n*o,m=t*s-r*o,_=t*c-i*o,b=n*s-r*a,x=n*c-i*a,w=r*c-i*s,T=u*p-l*f,k=u*v-h*f,S=u*y-d*f,E=l*v-h*p,C=l*y-d*p,P=h*y-d*v,O=g*P-m*C+_*E+b*S-x*k+w*T;return O?(O=1/O,e[0]=(a*P-s*C+c*E)*O,e[1]=(r*C-n*P-i*E)*O,e[2]=(p*w-v*x+y*b)*O,e[3]=(h*x-l*w-d*b)*O,e[4]=(s*S-o*P-c*k)*O,e[5]=(t*P-r*S+i*k)*O,e[6]=(v*_-f*w-y*m)*O,e[7]=(u*w-h*_+d*m)*O,e[8]=(o*C-a*S+c*T)*O,e[9]=(n*S-t*C-i*T)*O,e[10]=(f*x-p*_+y*g)*O,e[11]=(l*_-u*x-d*g)*O,e[12]=(a*k-o*E-s*T)*O,e[13]=(t*E-n*k+r*T)*O,e[14]=(p*m-f*b-v*g)*O,e[15]=(u*b-l*m+h*g)*O,this):null}},{key:"apply",value:function(e){var t=this.val,n=e.x,r=e.y,i=void 0!==e.z?e.z:1,o=t[3]*n+t[7]*r+t[11]*i+t[15]||1;return e.x=(t[0]*n+t[4]*r+t[8]*i+t[12])/o,e.y=(t[1]*n+t[5]*r+t[9]*i+t[13])/o,void 0!==e.z&&(e.z=(t[2]*n+t[6]*r+t[10]*i+t[14])/o),e}},{key:"applyInverse",value:function(e){var t=pool.pull("Matrix3d",this).invert();return t.apply(e),pool.push(t),e}},{key:"ortho",value:function(e,t,n,r,i,o){var a=this.val,s=1/(e-t),c=1/(n-r),u=1/(i-o);return a[0]=-2*s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*c,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*u,a[11]=0,a[12]=(e+t)*s,a[13]=(r+n)*c,a[14]=(o+i)*u,a[15]=1,this}},{key:"scale",value:function(e,t,n){var r=this.val,i=e,o=void 0===t?i:t,a=void 0===n?0:n;return r[0]=r[0]*i,r[1]=r[1]*i,r[2]=r[2]*i,r[3]=r[3]*i,r[4]=r[4]*o,r[5]=r[5]*o,r[6]=r[6]*o,r[7]=r[7]*o,r[8]=r[8]*a,r[9]=r[9]*a,r[10]=r[10]*a,r[11]=r[11]*a,this}},{key:"scaleV",value:function(e){return this.scale(e.x,e.y,e.z)}},{key:"scaleX",value:function(e){return this.scale(e,1)}},{key:"scaleY",value:function(e){return this.scale(1,e)}},{key:"rotate",value:function(e,t){var n,r,i,o,a,s,c,u,l,h,d,f,p,v,y,g,m,_,b,x,w,T,k,S,E=this.val,C=t.x,P=t.y,O=t.z,R=Math.sqrt(C*C+P*P+O*O);return R<EPSILON?null:(C*=R=1/R,P*=R,O*=R,n=Math.sin(e),i=1-(r=Math.cos(e)),o=E[0],a=E[1],s=E[2],c=E[3],u=E[4],l=E[5],h=E[6],d=E[7],f=E[8],p=E[9],v=E[10],y=E[11],g=C*C*i+r,m=P*C*i+O*n,_=O*C*i-P*n,b=C*P*i-O*n,x=P*P*i+r,w=O*P*i+C*n,T=C*O*i+P*n,k=P*O*i-C*n,S=O*O*i+r,E[0]=o*g+u*m+f*_,E[1]=a*g+l*m+p*_,E[2]=s*g+h*m+v*_,E[3]=c*g+d*m+y*_,E[4]=o*b+u*x+f*w,E[5]=a*b+l*x+p*w,E[6]=s*b+h*x+v*w,E[7]=c*b+d*x+y*w,E[8]=o*T+u*k+f*S,E[9]=a*T+l*k+p*S,E[10]=s*T+h*k+v*S,E[11]=c*T+d*k+y*S,this)}},{key:"translate",value:function(){var e,t,n,r=this.val;return arguments.length>1?(e=arguments[0],t=arguments[1],n=void 0===arguments[2]?0:arguments[2]):(e=arguments[0].x,t=arguments[0].y,n=void 0===arguments[0].z?0:arguments[0].z),r[12]=r[0]*e+r[4]*t+r[8]*n+r[12],r[13]=r[1]*e+r[5]*t+r[9]*n+r[13],r[14]=r[2]*e+r[6]*t+r[10]*n+r[14],r[15]=r[3]*e+r[7]*t+r[11]*n+r[15],this}},{key:"isIdentity",value:function(){var e=this.val;return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]}},{key:"equals",value:function(e){var t=e.val,n=this.val;return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]}},{key:"clone",value:function(){return pool.pull("Matrix3d",this)}},{key:"toArray",value:function(){return this.val}},{key:"toString",value:function(){var e=this.val;return"me.Matrix3d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}}]),e}(),Matrix2d=function(){function e(){_classCallCheck(this,e),this.onResetEvent.apply(this,arguments)}return _createClass(e,[{key:"onResetEvent",value:function(){return void 0===this.val&&(this.val=new Float32Array(9)),arguments.length&&arguments[0]instanceof e?this.copy(arguments[0]):arguments.length&&arguments[0]instanceof Matrix3d?this.fromMat3d(arguments[0]):arguments.length>=6?this.setTransform.apply(this,arguments):this.identity(),this}},{key:"tx",get:function(){return this.val[6]}},{key:"ty",get:function(){return this.val[7]}},{key:"identity",value:function(){return this.setTransform(1,0,0,0,1,0,0,0,1),this}},{key:"setTransform",value:function(){var e=this.val;return 9===arguments.length?(e[0]=arguments[0],e[1]=arguments[1],e[2]=arguments[2],e[3]=arguments[3],e[4]=arguments[4],e[5]=arguments[5],e[6]=arguments[6],e[7]=arguments[7],e[8]=arguments[8]):6===arguments.length&&(e[0]=arguments[0],e[1]=arguments[2],e[2]=arguments[4],e[3]=arguments[1],e[4]=arguments[3],e[5]=arguments[5],e[6]=0,e[7]=0,e[8]=1),this}},{key:"copy",value:function(e){return this.val.set(e.val),this}},{key:"fromMat3d",value:function(e){var t=e.val,n=this.val;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],this}},{key:"multiply",value:function(e){var t=e.val,n=this.val,r=n[0],i=n[1],o=n[3],a=n[4],s=t[0],c=t[1],u=t[3],l=t[4],h=t[6],d=t[7];return n[0]=r*s+o*c,n[1]=i*s+a*c,n[3]=r*u+o*l,n[4]=i*u+a*l,n[6]+=r*h+o*d,n[7]+=i*h+a*d,this}},{key:"transpose",value:function(){var e=this.val,t=e[1],n=e[2],r=e[5];return e[1]=e[3],e[2]=e[6],e[3]=t,e[5]=e[7],e[6]=n,e[7]=r,this}},{key:"invert",value:function(){var e=this.val,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],c=e[7],u=e[8],l=u*o-a*c,h=a*s-u*i,d=c*i-o*s,f=t*l+n*h+r*d;return e[0]=l/f,e[1]=(r*c-u*n)/f,e[2]=(a*n-r*o)/f,e[3]=h/f,e[4]=(u*t-r*s)/f,e[5]=(r*i-a*t)/f,e[6]=d/f,e[7]=(n*s-c*t)/f,e[8]=(o*t-n*i)/f,this}},{key:"apply",value:function(e){var t=this.val,n=e.x,r=e.y;return e.x=n*t[0]+r*t[3]+t[6],e.y=n*t[1]+r*t[4]+t[7],e}},{key:"applyInverse",value:function(e){var t=this.val,n=e.x,r=e.y,i=1/(t[0]*t[4]+t[3]*-t[1]);return e.x=t[4]*i*n+-t[3]*i*r+(t[7]*t[3]-t[6]*t[4])*i,e.y=t[0]*i*r+-t[1]*i*n+(-t[7]*t[0]+t[6]*t[1])*i,e}},{key:"scale",value:function(e,t){var n=this.val,r=e,i=void 0===t?r:t;return n[0]*=r,n[1]*=r,n[3]*=i,n[4]*=i,this}},{key:"scaleV",value:function(e){return this.scale(e.x,e.y)}},{key:"scaleX",value:function(e){return this.scale(e,1)}},{key:"scaleY",value:function(e){return this.scale(1,e)}},{key:"rotate",value:function(e){if(0!==e){var t=this.val,n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=Math.sin(e),u=Math.cos(e);t[0]=u*n+c*o,t[1]=u*r+c*a,t[2]=u*i+c*s,t[3]=u*o-c*n,t[4]=u*a-c*r,t[5]=u*s-c*i}return this}},{key:"translate",value:function(){var e,t,n=this.val;return 2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),n[6]+=n[0]*e+n[3]*t,n[7]+=n[1]*e+n[4]*t,this}},{key:"isIdentity",value:function(){var e=this.val;return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&1===e[4]&&0===e[5]&&0===e[6]&&0===e[7]&&1===e[8]}},{key:"equals",value:function(e){var t=e.val,n=this.val;return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]}},{key:"clone",value:function(){return pool.pull("Matrix2d",this)}},{key:"toArray",value:function(){return this.val}},{key:"toString",value:function(){var e=this.val;return"me.Matrix2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}}]),e}(),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{},eventemitter3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,o),!0;case 6:return l.fn.call(l.context,t,r,i,o,a),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;case 4:l[u].fn.call(l[u].context,t,r,i);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||i&&!s[c].once||r&&s[c].context!==r)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(eventemitter3);var EventEmitter=eventemitter3.exports,eventEmitter=new EventEmitter,BOOT="me.boot",STATE_PAUSE="me.state.onPause",STATE_RESUME="me.state.onResume",STATE_STOP="me.state.onStop",STATE_RESTART="me.state.onRestart",VIDEO_INIT="me.video.onInit",GAME_INIT="me.game.onInit",GAME_RESET="me.game.onReset",GAME_BEFORE_UPDATE="me.game.beforeUpdate",GAME_AFTER_UPDATE="me.game.afterUpdate",GAME_UPDATE="me.game.onUpdate",GAME_BEFORE_DRAW="me.game.beforeDraw",GAME_AFTER_DRAW="me.game.afterDraw",LEVEL_LOADED="me.game.onLevelLoaded",LOADER_COMPLETE="me.loader.onload",LOADER_PROGRESS="me.loader.onProgress",KEYDOWN="me.input.keydown",KEYUP="me.input.keyup",GAMEPAD_CONNECTED="gamepad.connected",GAMEPAD_DISCONNECTED="gamepad.disconnected",GAMEPAD_UPDATE="gamepad.update",POINTERMOVE="me.event.pointermove",POINTERLOCKCHANGE="me.event.pointerlockChange",DRAGSTART="me.game.dragstart",DRAGEND="me.game.dragend",WINDOW_ONRESIZE="window.onresize",CANVAS_ONRESIZE="canvas.onresize",VIEWPORT_ONRESIZE="viewport.onresize",WINDOW_ONORIENTATION_CHANGE="window.orientationchange",WINDOW_ONSCROLL="window.onscroll",VIEWPORT_ONCHANGE="viewport.onchange",WEBGL_ONCONTEXT_LOST="renderer.webglcontextlost",WEBGL_ONCONTEXT_RESTORED="renderer.webglcontextrestored";function emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return eventEmitter.emit.apply(eventEmitter,[e].concat(n))}function on(e,t,n){return eventEmitter.on(e,t,n)}function once(e,t,n){return eventEmitter.once(e,t,n)}function off(e,t){return eventEmitter.off(e,t)}var event=Object.freeze({__proto__:null,BOOT,STATE_PAUSE,STATE_RESUME,STATE_STOP,STATE_RESTART,VIDEO_INIT,GAME_INIT,GAME_RESET,GAME_BEFORE_UPDATE,GAME_AFTER_UPDATE,GAME_UPDATE,GAME_BEFORE_DRAW,GAME_AFTER_DRAW,LEVEL_LOADED,LOADER_COMPLETE,LOADER_PROGRESS,KEYDOWN,KEYUP,GAMEPAD_CONNECTED,GAMEPAD_DISCONNECTED,GAMEPAD_UPDATE,POINTERMOVE,POINTERLOCKCHANGE,DRAGSTART,DRAGEND,WINDOW_ONRESIZE,CANVAS_ONRESIZE,VIEWPORT_ONRESIZE,WINDOW_ONORIENTATION_CHANGE,WINDOW_ONSCROLL,VIEWPORT_ONCHANGE,WEBGL_ONCONTEXT_LOST,WEBGL_ONCONTEXT_RESTORED,emit,on,once,off}),howler={},exports;exports=howler,function(){var e=function(){this.init()};e.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var n=this||t;if(e=parseFloat(e),n.ctx||u(),void 0!==e&&e>=0&&e<=1){if(n._volume=e,n._muted)return n;n.usingWebAudio&&n.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var r=0;r<n._howls.length;r++)if(!n._howls[r]._webAudio)for(var i=n._howls[r]._getSoundIds(),o=0;o<i.length;o++){var a=n._howls[r]._soundById(i[o]);a&&a._node&&(a._node.volume=a._volume*e)}return n}return n._volume},mute:function(e){var n=this||t;n.ctx||u(),n._muted=e,n.usingWebAudio&&n.masterGain.gain.setValueAtTime(e?0:n._volume,t.ctx.currentTime);for(var r=0;r<n._howls.length;r++)if(!n._howls[r]._webAudio)for(var i=n._howls[r]._getSoundIds(),o=0;o<i.length;o++){var a=n._howls[r]._soundById(i[o]);a&&a._node&&(a._node.muted=!!e||a._muted)}return n},stop:function(){for(var e=this||t,n=0;n<e._howls.length;n++)e._howls[n].stop();return e},unload:function(){for(var e=this||t,n=e._howls.length-1;n>=0;n--)e._howls[n].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,u()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,n=null;try{n="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!n||"function"!=typeof n.canPlayType)return e;var r=n.canPlayType("audio/mpeg;").replace(/^no$/,""),i=e._navigator?e._navigator.userAgent:"",o=i.match(/OPR\/([0-6].)/g),a=o&&parseInt(o[0].split("/")[1],10)<33,s=-1!==i.indexOf("Safari")&&-1===i.indexOf("Chrome"),c=i.match(/Version\/(.*?) /),u=s&&c&&parseInt(c[1],10)<15;return e._codecs={mp3:!(a||!r&&!n.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!r,opus:!!n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(n.canPlayType('audio/wav; codecs="1"')||n.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!n.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!n.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/m4a;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(n.canPlayType("audio/x-m4b;")||n.canPlayType("audio/m4b;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(n.canPlayType("audio/x-mp4;")||n.canPlayType("audio/mp4;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(u||!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(u||!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!n.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(n.canPlayType("audio/x-flac;")||n.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var n=function t(n){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var r=new Audio;r._unlocked=!0,e._releaseHtml5Audio(r)}catch(n){e.noAudio=!0;break}for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var o=e._howls[i]._getSoundIds(),a=0;a<o.length;a++){var s=e._howls[i]._soundById(o[a]);s&&s._node&&!s._node._unlocked&&(s._node._unlocked=!0,s._node.load())}e._autoResume();var c=e.ctx.createBufferSource();c.buffer=e._scratchBuffer,c.connect(e.ctx.destination),void 0===c.start?c.noteOn(0):c.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),c.onended=function(){c.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("click",n,!0),document.addEventListener("keydown",n,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var n=(new Audio).play();return n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)&&n.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var n=this||t;return e._unlocked&&n._html5AudioPool.push(e),n},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&t.usingWebAudio){for(var n=0;n<e._howls.length;n++)if(e._howls[n]._webAudio)for(var r=0;r<e._howls[n]._sounds.length;r++)if(!e._howls[n]._sounds[r]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&t.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var t=new e,n=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};n.prototype={init:function(e){var n=this;return t.ctx||u(),n._autoplay=e.autoplay||!1,n._format="string"!=typeof e.format?e.format:[e.format],n._html5=e.html5||!1,n._muted=e.mute||!1,n._loop=e.loop||!1,n._pool=e.pool||5,n._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,n._rate=e.rate||1,n._sprite=e.sprite||{},n._src="string"!=typeof e.src?e.src:[e.src],n._volume=void 0!==e.volume?e.volume:1,n._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},n._duration=0,n._state="unloaded",n._sounds=[],n._endTimers={},n._queue=[],n._playLock=!1,n._onend=e.onend?[{fn:e.onend}]:[],n._onfade=e.onfade?[{fn:e.onfade}]:[],n._onload=e.onload?[{fn:e.onload}]:[],n._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],n._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],n._onpause=e.onpause?[{fn:e.onpause}]:[],n._onplay=e.onplay?[{fn:e.onplay}]:[],n._onstop=e.onstop?[{fn:e.onstop}]:[],n._onmute=e.onmute?[{fn:e.onmute}]:[],n._onvolume=e.onvolume?[{fn:e.onvolume}]:[],n._onrate=e.onrate?[{fn:e.onrate}]:[],n._onseek=e.onseek?[{fn:e.onseek}]:[],n._onunlock=e.onunlock?[{fn:e.onunlock}]:[],n._onresume=[],n._webAudio=t.usingWebAudio&&!n._html5,void 0!==t.ctx&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(n),n._autoplay&&n._queue.push({event:"play",action:function(){n.play()}}),n._preload&&"none"!==n._preload&&n.load(),n},load:function(){var e=this,n=null;if(t.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var i=0;i<e._src.length;i++){var a,s;if(e._format&&e._format[i])a=e._format[i];else{if("string"!=typeof(s=e._src[i])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(a=/^data:audio\/([^;,]+);/i.exec(s))||(a=/\.([^.]+)$/.exec(s.split("?",1)[0])),a&&(a=a[1].toLowerCase())}if(a||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),a&&t.codecs(a)){n=e._src[i];break}}if(n)return e._src=n,e._state="loading","https:"===window.location.protocol&&"http:"===n.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new r(e),e._webAudio&&o(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,n){var r=this,i=null;if("number"==typeof e)i=e,e=null;else{if("string"==typeof e&&"loaded"===r._state&&!r._sprite[e])return null;if(void 0===e&&(e="__default",!r._playLock)){for(var o=0,a=0;a<r._sounds.length;a++)r._sounds[a]._paused&&!r._sounds[a]._ended&&(o++,i=r._sounds[a]._id);1===o?e=null:i=null}}var s=i?r._soundById(i):r._inactiveSound();if(!s)return null;if(i&&!e&&(e=s._sprite||"__default"),"loaded"!==r._state){s._sprite=e,s._ended=!1;var c=s._id;return r._queue.push({event:"play",action:function(){r.play(c)}}),c}if(i&&!s._paused)return n||r._loadQueue("play"),s._id;r._webAudio&&t._autoResume();var u=Math.max(0,s._seek>0?s._seek:r._sprite[e][0]/1e3),l=Math.max(0,(r._sprite[e][0]+r._sprite[e][1])/1e3-u),h=1e3*l/Math.abs(s._rate),d=r._sprite[e][0]/1e3,f=(r._sprite[e][0]+r._sprite[e][1])/1e3;s._sprite=e,s._ended=!1;var p=function(){s._paused=!1,s._seek=u,s._start=d,s._stop=f,s._loop=!(!s._loop&&!r._sprite[e][2])};if(!(u>=f)){var v=s._node;if(r._webAudio){var y=function(){r._playLock=!1,p(),r._refreshBuffer(s);var e=s._muted||r._muted?0:s._volume;v.gain.setValueAtTime(e,t.ctx.currentTime),s._playStart=t.ctx.currentTime,void 0===v.bufferSource.start?s._loop?v.bufferSource.noteGrainOn(0,u,86400):v.bufferSource.noteGrainOn(0,u,l):s._loop?v.bufferSource.start(0,u,86400):v.bufferSource.start(0,u,l),h!==1/0&&(r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),h)),n||setTimeout((function(){r._emit("play",s._id),r._loadQueue()}),0)};"running"===t.state&&"interrupted"!==t.ctx.state?y():(r._playLock=!0,r.once("resume",y),r._clearTimer(s._id))}else{var g=function(){v.currentTime=u,v.muted=s._muted||r._muted||t._muted||v.muted,v.volume=s._volume*t.volume(),v.playbackRate=s._rate;try{var i=v.play();if(i&&"undefined"!=typeof Promise&&(i instanceof Promise||"function"==typeof i.then)?(r._playLock=!0,p(),i.then((function(){r._playLock=!1,v._unlocked=!0,n?r._loadQueue():r._emit("play",s._id)})).catch((function(){r._playLock=!1,r._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0}))):n||(r._playLock=!1,p(),r._emit("play",s._id)),v.playbackRate=s._rate,v.paused)return void r._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||s._loop?r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),h):(r._endTimers[s._id]=function(){r._ended(s),v.removeEventListener("ended",r._endTimers[s._id],!1)},v.addEventListener("ended",r._endTimers[s._id],!1))}catch(e){r._emit("playerror",s._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===v.src&&(v.src=r._src,v.load());var m=window&&window.ejecta||!v.readyState&&t._navigator.isCocoonJS;v.readyState>=3||m?g():(r._playLock=!0,r._state="loading",v.addEventListener(t._canPlayEvent,(function e(){r._state="loaded",g(),v.removeEventListener(t._canPlayEvent,e,!1)}),!1),r._clearTimer(s._id))}return s._id}r._ended(s)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),r=0;r<n.length;r++){t._clearTimer(n[r]);var i=t._soundById(n[r]);if(i&&!i._paused&&(i._seek=t.seek(n[r]),i._rateSeek=0,i._paused=!0,t._stopFade(n[r]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var r=n._getSoundIds(e),i=0;i<r.length;i++){n._clearTimer(r[i]);var o=n._soundById(r[i]);o&&(o._seek=o._start||0,o._rateSeek=0,o._paused=!0,o._ended=!0,n._stopFade(r[i]),o._node&&(n._webAudio?o._node.bufferSource&&(void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),n._cleanBuffer(o._node)):isNaN(o._node.duration)&&o._node.duration!==1/0||(o._node.currentTime=o._start||0,o._node.pause(),o._node.duration===1/0&&n._clearSound(o._node))),t||n._emit("stop",o._id))}return n},mute:function(e,n){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"mute",action:function(){r.mute(e,n)}}),r;if(void 0===n){if("boolean"!=typeof e)return r._muted;r._muted=e}for(var i=r._getSoundIds(n),o=0;o<i.length;o++){var a=r._soundById(i[o]);a&&(a._muted=e,a._interval&&r._stopFade(a._id),r._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume,t.ctx.currentTime):a._node&&(a._node.muted=!!t._muted||e),r._emit("mute",a._id))}return r},volume:function(){var e,n,r,i=this,o=arguments;if(0===o.length)return i._volume;if(1===o.length||2===o.length&&void 0===o[1]){var a=i._getSoundIds(),s=a.indexOf(o[0]);s>=0?n=parseInt(o[0],10):e=parseFloat(o[0])}else o.length>=2&&(e=parseFloat(o[0]),n=parseInt(o[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(r=n?i._soundById(n):i._sounds[0])?r._volume:0;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,o)}}),i;void 0===n&&(i._volume=e),n=i._getSoundIds(n);for(var c=0;c<n.length;c++)(r=i._soundById(n[c]))&&(r._volume=e,o[2]||i._stopFade(n[c]),i._webAudio&&r._node&&!r._muted?r._node.gain.setValueAtTime(e,t.ctx.currentTime):r._node&&!r._muted&&(r._node.volume=e*t.volume()),i._emit("volume",r._id));return i},fade:function(e,n,r,i){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"fade",action:function(){o.fade(e,n,r,i)}}),o;e=Math.min(Math.max(0,parseFloat(e)),1),n=Math.min(Math.max(0,parseFloat(n)),1),r=parseFloat(r),o.volume(e,i);for(var a=o._getSoundIds(i),s=0;s<a.length;s++){var c=o._soundById(a[s]);if(c){if(i||o._stopFade(a[s]),o._webAudio&&!c._muted){var u=t.ctx.currentTime,l=u+r/1e3;c._volume=e,c._node.gain.setValueAtTime(e,u),c._node.gain.linearRampToValueAtTime(n,l)}o._startFadeInterval(c,e,n,r,a[s],void 0===i)}}return o},_startFadeInterval:function(e,t,n,r,i,o){var a=this,s=t,c=n-t,u=Math.abs(c/.01),l=Math.max(4,u>0?r/u:r),h=Date.now();e._fadeTo=n,e._interval=setInterval((function(){var i=(Date.now()-h)/r;h=Date.now(),s+=c*i,s=Math.round(100*s)/100,s=c<0?Math.max(n,s):Math.min(n,s),a._webAudio?e._volume=s:a.volume(s,e._id,!0),o&&(a._volume=s),(n<t&&s<=n||n>t&&s>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,a.volume(n,e._id),a._emit("fade",e._id))}),l)},_stopFade:function(e){var n=this,r=n._soundById(e);return r&&r._interval&&(n._webAudio&&r._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(r._interval),r._interval=null,n.volume(r._fadeTo,e),r._fadeTo=null,n._emit("fade",e)),n},loop:function(){var e,t,n,r=this,i=arguments;if(0===i.length)return r._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(n=r._soundById(parseInt(i[0],10)))&&n._loop;e=i[0],r._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var o=r._getSoundIds(t),a=0;a<o.length;a++)(n=r._soundById(o[a]))&&(n._loop=e,r._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop,r.playing(o[a])&&(r.pause(o[a],!0),r.play(o[a],!0)))));return r},rate:function(){var e,n,r,i=this,o=arguments;if(0===o.length)n=i._sounds[0]._id;else if(1===o.length){var a=i._getSoundIds(),s=a.indexOf(o[0]);s>=0?n=parseInt(o[0],10):e=parseFloat(o[0])}else 2===o.length&&(e=parseFloat(o[0]),n=parseInt(o[1],10));if("number"!=typeof e)return(r=i._soundById(n))?r._rate:i._rate;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,o)}}),i;void 0===n&&(i._rate=e),n=i._getSoundIds(n);for(var c=0;c<n.length;c++)if(r=i._soundById(n[c])){i.playing(n[c])&&(r._rateSeek=i.seek(n[c]),r._playStart=i._webAudio?t.ctx.currentTime:r._playStart),r._rate=e,i._webAudio&&r._node&&r._node.bufferSource?r._node.bufferSource.playbackRate.setValueAtTime(e,t.ctx.currentTime):r._node&&(r._node.playbackRate=e);var u=i.seek(n[c]),l=(i._sprite[r._sprite][0]+i._sprite[r._sprite][1])/1e3-u,h=1e3*l/Math.abs(r._rate);!i._endTimers[n[c]]&&r._paused||(i._clearTimer(n[c]),i._endTimers[n[c]]=setTimeout(i._ended.bind(i,r),h)),i._emit("rate",r._id)}return i},seek:function(){var e,n,r=this,i=arguments;if(0===i.length)r._sounds.length&&(n=r._sounds[0]._id);else if(1===i.length){var o=r._getSoundIds(),a=o.indexOf(i[0]);a>=0?n=parseInt(i[0],10):r._sounds.length&&(n=r._sounds[0]._id,e=parseFloat(i[0]))}else 2===i.length&&(e=parseFloat(i[0]),n=parseInt(i[1],10));if(void 0===n)return 0;if("number"==typeof e&&("loaded"!==r._state||r._playLock))return r._queue.push({event:"seek",action:function(){r.seek.apply(r,i)}}),r;var s=r._soundById(n);if(s){if(!("number"==typeof e&&e>=0)){if(r._webAudio){var c=r.playing(n)?t.ctx.currentTime-s._playStart:0,u=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(u+c*Math.abs(s._rate))}return s._node.currentTime}var l=r.playing(n);l&&r.pause(n,!0),s._seek=e,s._ended=!1,r._clearTimer(n),r._webAudio||!s._node||isNaN(s._node.duration)||(s._node.currentTime=e);var h=function(){l&&r.play(n,!0),r._emit("seek",n)};if(l&&!r._webAudio){var d=function e(){r._playLock?setTimeout(e,0):h()};setTimeout(d,0)}else h()}return r},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var r=0;r<t._sounds.length;r++)if(!t._sounds[r]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,r=t._soundById(e);return r&&(n=t._sprite[r._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,n=e._sounds,r=0;r<n.length;r++)n[r]._paused||e.stop(n[r]._id),e._webAudio||(e._clearSound(n[r]._node),n[r]._node.removeEventListener("error",n[r]._errorFn,!1),n[r]._node.removeEventListener(t._canPlayEvent,n[r]._loadFn,!1),n[r]._node.removeEventListener("ended",n[r]._endFn,!1),t._releaseHtml5Audio(n[r]._node)),delete n[r]._node,e._clearTimer(n[r]._id);var o=t._howls.indexOf(e);o>=0&&t._howls.splice(o,1);var a=!0;for(r=0;r<t._howls.length;r++)if(t._howls[r]._src===e._src||e._src.indexOf(t._howls[r]._src)>=0){a=!1;break}return i&&a&&delete i[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,r){var i=this["_on"+e];return"function"==typeof t&&i.push(r?{id:n,fn:t,once:r}:{id:n,fn:t}),this},off:function(e,t,n){var r=this,i=r["_on"+e],o=0;if("number"==typeof t&&(n=t,t=null),t||n)for(o=0;o<i.length;o++){var a=n===i[o].id;if(t===i[o].fn&&a||!t&&a){i.splice(o,1);break}}else if(e)r["_on"+e]=[];else{var s=Object.keys(r);for(o=0;o<s.length;o++)0===s[o].indexOf("_on")&&Array.isArray(r[s[o]])&&(r[s[o]]=[])}return r},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var r=this,i=r["_on"+e],o=i.length-1;o>=0;o--)i[o].id&&i[o].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(r,i[o].fn),0),i[o].once&&r.off(e,i[o].fn,i[o].id));return r._loadQueue(e),r},_loadQueue:function(e){var t=this;if(t._queue.length>0){var n=t._queue[0];n.event===e&&(t._queue.shift(),t._loadQueue()),e||n.action()}return t},_ended:function(e){var n=this,r=e._sprite;if(!n._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(n._ended.bind(n,e),100),n;var i=!(!e._loop&&!n._sprite[r][2]);if(n._emit("end",e._id),!n._webAudio&&i&&n.stop(e._id,!0).play(e._id),n._webAudio&&i){n._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var o=1e3*(e._stop-e._start)/Math.abs(e._rate);n._endTimers[e._id]=setTimeout(n._ended.bind(n,e),o)}return n._webAudio&&!i&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,n._clearTimer(e._id),n._cleanBuffer(e._node),t._autoSuspend()),n._webAudio||i||n.stop(e._id,!0),n},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var n=t._soundById(e);n&&n._node&&n._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new r(e)},_drain:function(){var e=this,t=e._pool,n=0,r=0;if(!(e._sounds.length<t)){for(r=0;r<e._sounds.length;r++)e._sounds[r]._ended&&n++;for(r=e._sounds.length-1;r>=0;r--){if(n<=t)return;e._sounds[r]._ended&&(e._webAudio&&e._sounds[r]._node&&e._sounds[r]._node.disconnect(0),e._sounds.splice(r,1),n--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=i[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),this},_cleanBuffer:function(e){var n=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),n))try{e.bufferSource.buffer=t._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(e){this._parent=e,this.init()};r.prototype={init:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._rate=n._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,n._sounds.push(e),e.create(),e},create:function(){var e=this,n=e._parent,r=t._muted||e._muted||e._parent._muted?0:e._volume;return n._webAudio?(e._node=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(r,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=n._src,e._node.preload=!0===n._preload?"auto":n._preload,e._node.volume=r*t.volume(),e._node.load()),e},reset:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._rate=n._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,n=e._parent;n._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(n._sprite).length&&(n._sprite={__default:[0,1e3*n._duration]}),"loaded"!==n._state&&(n._state="loaded",n._emit("load"),n._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var i={},o=function(e){var t=e._src;if(i[t])return e._duration=i[t].duration,void c(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);s(r.buffer,e)}else{var u=new XMLHttpRequest;u.open(e._xhr.method,t,!0),u.withCredentials=e._xhr.withCredentials,u.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){u.setRequestHeader(t,e._xhr.headers[t])})),u.onload=function(){var t=(u.status+"")[0];"0"===t||"2"===t||"3"===t?s(u.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+u.status+".")},u.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete i[t],e.load())},a(u)}},a=function(e){try{e.send()}catch(t){e.onerror()}},s=function(e,n){var r=function(){n._emit("loaderror",null,"Decoding audio data failed.")},o=function(e){e&&n._sounds.length>0?(i[n._src]=e,c(n,e)):r()};"undefined"!=typeof Promise&&1===t.ctx.decodeAudioData.length?t.ctx.decodeAudioData(e).then(o).catch(r):t.ctx.decodeAudioData(e,o,r)},c=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},u=function(){if(t.usingWebAudio){try{"undefined"!=typeof AudioContext?t.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch(e){t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),n=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=n?parseInt(n[1],10):null;if(e&&r&&r<9){var i=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!i&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};exports.Howler=t,exports.Howl=n,void 0!==commonjsGlobal?(commonjsGlobal.HowlerGlobal=e,commonjsGlobal.Howler=t,commonjsGlobal.Howl=n,commonjsGlobal.Sound=r):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=r)}(),function(){var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;n>=0;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var r=this;return r.ctx&&r.ctx.listener?(t="number"!=typeof t?r._pos[1]:t,n="number"!=typeof n?r._pos[2]:n,"number"!=typeof e?r._pos:(r._pos=[e,t,n],void 0!==r.ctx.listener.positionX?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],Howler.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],Howler.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],Howler.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},HowlerGlobal.prototype.orientation=function(e,t,n,r,i,o){var a=this;if(!a.ctx||!a.ctx.listener)return a;var s=a._orientation;return t="number"!=typeof t?s[1]:t,n="number"!=typeof n?s[2]:n,r="number"!=typeof r?s[3]:r,i="number"!=typeof i?s[4]:i,o="number"!=typeof o?s[5]:o,"number"!=typeof e?s:(a._orientation=[e,t,n,r,i,o],void 0!==a.ctx.listener.forwardX?(a.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(i,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(e,t,n,r,i,o),a)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._stereo=t.stereo||null,n._pos=t.pos||null,n._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},n._onstereo=t.onstereo?[{fn:t.onstereo}]:[],n._onpos=t.onpos?[{fn:t.onpos}]:[],n._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,n){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(e,n)}}),r;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof e)return r._stereo;r._stereo=e,r._pos=[e,0,0]}for(var o=r._getSoundIds(n),a=0;a<o.length;a++){var s=r._soundById(o[a]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||t(s,i),"spatial"===i?void 0!==s._panner.positionX?(s._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),r._emit("stereo",s._id)}}return r},Howl.prototype.pos=function(e,n,r,i){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"pos",action:function(){o.pos(e,n,r,i)}}),o;if(n="number"!=typeof n?0:n,r="number"!=typeof r?-.5:r,void 0===i){if("number"!=typeof e)return o._pos;o._pos=[e,n,r]}for(var a=o._getSoundIds(i),s=0;s<a.length;s++){var c=o._soundById(a[s]);if(c){if("number"!=typeof e)return c._pos;c._pos=[e,n,r],c._node&&(c._panner&&!c._panner.pan||t(c,"spatial"),void 0!==c._panner.positionX?(c._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):c._panner.setPosition(e,n,r)),o._emit("pos",c._id)}}return o},Howl.prototype.orientation=function(e,n,r,i){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"orientation",action:function(){o.orientation(e,n,r,i)}}),o;if(n="number"!=typeof n?o._orientation[1]:n,r="number"!=typeof r?o._orientation[2]:r,void 0===i){if("number"!=typeof e)return o._orientation;o._orientation=[e,n,r]}for(var a=o._getSoundIds(i),s=0;s<a.length;s++){var c=o._soundById(a[s]);if(c){if("number"!=typeof e)return c._orientation;c._orientation=[e,n,r],c._node&&(c._panner||(c._pos||(c._pos=o._pos||[0,0,-.5]),t(c,"spatial")),void 0!==c._panner.orientationX?(c._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),c._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),c._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):c._panner.setOrientation(e,n,r)),o._emit("orientation",c._id)}}return o},Howl.prototype.pannerAttr=function(){var e,n,r,i=this,o=arguments;if(!i._webAudio)return i;if(0===o.length)return i._pannerAttr;if(1===o.length){if("object"!==_typeof(o[0]))return(r=i._soundById(parseInt(o[0],10)))?r._pannerAttr:i._pannerAttr;e=o[0],void 0===n&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===o.length&&(e=o[0],n=parseInt(o[1],10));for(var a=i._getSoundIds(n),s=0;s<a.length;s++)if(r=i._soundById(a[s])){var c=r._pannerAttr;c={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:c.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:c.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:c.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:c.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:c.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:c.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:c.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:c.panningModel};var u=r._panner;u?(u.coneInnerAngle=c.coneInnerAngle,u.coneOuterAngle=c.coneOuterAngle,u.coneOuterGain=c.coneOuterGain,u.distanceModel=c.distanceModel,u.maxDistance=c.maxDistance,u.refDistance=c.refDistance,u.rolloffFactor=c.rolloffFactor,u.panningModel=c.panningModel):(r._pos||(r._pos=i._pos||[0,0,-.5]),t(r,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent;t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this),t._stereo?n.stereo(t._stereo):t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,t._stereo?n.stereo(t._stereo):t._pos?n.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,n._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}();var ObservableVector2d=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(_classCallCheck(this,n),e=t.call(this,r,i),void 0===o)throw new Error("undefined `onUpdate` callback");return e.setCallback(o.onUpdate,o.scope),e}return _createClass(n,[{key:"onResetEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return this.setMuted(e,t),void 0!==n&&this.setCallback(n.onUpdate,n.scope),this}},{key:"x",get:function(){return this._x},set:function(e){var t=this.onUpdate.call(this.scope,e,this._y,this._x,this._y);this._x=t&&"x"in t?t.x:e}},{key:"y",get:function(){return this._y},set:function(e){var t=this.onUpdate.call(this.scope,this._x,e,this._x,this._y);this._y=t&&"y"in t?t.y:e}},{key:"_set",value:function(e,t){var n=this.onUpdate.call(this.scope,e,t,this._x,this._y);return n&&"x"in n&&"y"in n?(this._x=n.x,this._y=n.y):(this._x=e,this._y=t),this}},{key:"setMuted",value:function(e,t){return this._x=e,this._y=t,this}},{key:"setCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("function"!=typeof e)throw new Error("invalid `onUpdate` callback");return this.onUpdate=e,this.scope=t,this}},{key:"add",value:function(e){return this._set(this._x+e.x,this._y+e.y)}},{key:"sub",value:function(e){return this._set(this._x-e.x,this._y-e.y)}},{key:"scale",value:function(e,t){return this._set(this._x*e,this._y*(void 0!==t?t:e))}},{key:"scaleV",value:function(e){return this._set(this._x*e.x,this._y*e.y)}},{key:"div",value:function(e){return this._set(this._x/e,this._y/e)}},{key:"abs",value:function(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y)}},{key:"clamp",value:function(e,t){return new n(_clamp(this.x,e,t),_clamp(this.y,e,t),{onUpdate:this.onUpdate,scope:this.scope})}},{key:"clampSelf",value:function(e,t){return this._set(_clamp(this._x,e,t),_clamp(this._y,e,t))}},{key:"minV",value:function(e){return this._set(this._x<e.x?this._x:e.x,this._y<e.y?this._y:e.y)}},{key:"maxV",value:function(e){return this._set(this._x>e.x?this._x:e.x,this._y>e.y?this._y:e.y)}},{key:"floor",value:function(){return new n(Math.floor(this._x),Math.floor(this._y),{onUpdate:this.onUpdate,scope:this.scope})}},{key:"floorSelf",value:function(){return this._set(Math.floor(this._x),Math.floor(this._y))}},{key:"ceil",value:function(){return new n(Math.ceil(this._x),Math.ceil(this._y),{onUpdate:this.onUpdate,scope:this.scope})}},{key:"ceilSelf",value:function(){return this._set(Math.ceil(this._x),Math.ceil(this._y))}},{key:"negate",value:function(){return new n(-this._x,-this._y,{onUpdate:this.onUpdate,scope:this.scope})}},{key:"negateSelf",value:function(){return this._set(-this._x,-this._y)}},{key:"copy",value:function(e){return this._set(e.x,e.y)}},{key:"equals",value:function(e){return this._x===e.x&&this._y===e.y}},{key:"perp",value:function(){return this._set(this._y,-this._x)}},{key:"rotate",value:function(e,t){var n=0,r=0;"object"===_typeof(t)&&(n=t.x,r=t.y);var i=this._x-n,o=this._y-r,a=Math.cos(e),s=Math.sin(e);return this._set(i*a-o*s+n,i*s+o*a+r)}},{key:"dot",value:function(e){return this._x*e.x+this._y*e.y}},{key:"cross",value:function(e){return this._x*e.y-this._y*e.x}},{key:"lerp",value:function(e,t){return this._x+=(e.x-this._x)*t,this._y+=(e.y-this._y)*t,this}},{key:"distance",value:function(e){return Math.sqrt((this._x-e.x)*(this._x-e.x)+(this._y-e.y)*(this._y-e.y))}},{key:"clone",value:function(){return pool.pull("ObservableVector2d",this._x,this._y,{onUpdate:this.onUpdate,scope:this.scope})}},{key:"toVector2d",value:function(){return pool.pull("Vector2d",this._x,this._y)}},{key:"toString",value:function(){return"x:"+this._x+",y:"+this._y}}]),n}(Vector2d),Vector3d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,e),this.onResetEvent(t,n,r)}return _createClass(e,[{key:"onResetEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.x=e,this.y=t,this.z=n,this}},{key:"_set",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.x=e,this.y=t,this.z=n,this}},{key:"set",value:function(e,t,n){if(e!==+e||t!==+t||void 0!==n&&n!==+n)throw new Error("invalid x, y, z parameters (not a number)");return this._set(e,t,n)}},{key:"setZero",value:function(){return this.set(0,0,0)}},{key:"setV",value:function(e){return this._set(e.x,e.y,e.z)}},{key:"add",value:function(e){return this._set(this.x+e.x,this.y+e.y,this.z+(e.z||0))}},{key:"sub",value:function(e){return this._set(this.x-e.x,this.y-e.y,this.z-(e.z||0))}},{key:"scale",value:function(e,t,n){return t=void 0!==t?t:e,this._set(this.x*e,this.y*t,this.z*(n||1))}},{key:"scaleV",value:function(e){return this.scale(e.x,e.y,e.z)}},{key:"toIso",value:function(){return this._set(this.x-this.y,.5*(this.x+this.y),this.z)}},{key:"to2d",value:function(){return this._set(this.y+this.x/2,this.y-this.x/2,this.z)}},{key:"div",value:function(e){return this._set(this.x/e,this.y/e,this.z/e)}},{key:"abs",value:function(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)}},{key:"clamp",value:function(t,n){return new e(_clamp(this.x,t,n),_clamp(this.y,t,n),_clamp(this.z,t,n))}},{key:"clampSelf",value:function(e,t){return this._set(_clamp(this.x,e,t),_clamp(this.y,e,t),_clamp(this.z,e,t))}},{key:"minV",value:function(e){var t=e.z||0;return this._set(this.x<e.x?this.x:e.x,this.y<e.y?this.y:e.y,this.z<t?this.z:t)}},{key:"maxV",value:function(e){var t=e.z||0;return this._set(this.x>e.x?this.x:e.x,this.y>e.y?this.y:e.y,this.z>t?this.z:t)}},{key:"floor",value:function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}},{key:"floorSelf",value:function(){return this._set(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}},{key:"ceil",value:function(){return new e(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}},{key:"ceilSelf",value:function(){return this._set(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}},{key:"negate",value:function(){return new e(-this.x,-this.y,-this.z)}},{key:"negateSelf",value:function(){return this._set(-this.x,-this.y,-this.z)}},{key:"copy",value:function(e){return this._set(e.x,e.y,e.z||0)}},{key:"equals",value:function(){var e,t,n;return arguments.length>=2?(e=arguments[0],t=arguments[1],n=arguments[2]):(e=arguments[0].x,t=arguments[0].y,n=arguments[0].z),void 0===n&&(n=this.z),this.x===e&&this.y===t&&this.z===n}},{key:"normalize",value:function(){return this.div(this.length()||1)}},{key:"perp",value:function(){return this._set(this.y,-this.x,this.z)}},{key:"rotate",value:function(e,t){var n=0,r=0;"object"===_typeof(t)&&(n=t.x,r=t.y);var i=this.x-n,o=this.y-r,a=Math.cos(e),s=Math.sin(e);return this._set(i*a-o*s+n,i*s+o*a+r,this.z)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*(void 0!==e.z?e.z:this.z)}},{key:"cross",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,a=e.z;return this.x=n*a-r*o,this.y=r*i-t*a,this.z=t*o-n*i,this}},{key:"length2",value:function(){return this.dot(this)}},{key:"length",value:function(){return Math.sqrt(this.length2())}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"distance",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-(e.z||0);return Math.sqrt(t*t+n*n+r*r)}},{key:"angle",value:function(e){return Math.acos(_clamp(this.dot(e)/(this.length()*e.length()),-1,1))}},{key:"project",value:function(e){var t=this.dot(e)/e.length2();return this.scale(t,t,t)}},{key:"projectN",value:function(e){var t=this.dot(e)/e.length2();return this.scale(t,t,t)}},{key:"clone",value:function(){return pool.pull("Vector3d",this.x,this.y,this.z)}},{key:"toString",value:function(){return"x:"+this.x+",y:"+this.y+",z:"+this.z}}]),e}(),ObservableVector3d=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;if(_classCallCheck(this,n),e=t.call(this,r,i,o),void 0===a)throw new Error("undefined `onUpdate` callback");return e.setCallback(a.onUpdate,a.scope),e}return _createClass(n,[{key:"onResetEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;return this.setMuted(e,t,n),void 0!==r&&this.setCallback(r.onUpdate,r.scope),this}},{key:"x",get:function(){return this._x},set:function(e){var t=this.onUpdate.call(this.scope,e,this._y,this._z,this._x,this._y,this._z);this._x=t&&"x"in t?t.x:e}},{key:"y",get:function(){return this._y},set:function(e){var t=this.onUpdate.call(this.scope,this._x,e,this._z,this._x,this._y,this._z);this._y=t&&"y"in t?t.y:e}},{key:"z",get:function(){return this._z},set:function(e){var t=this.onUpdate.call(this.scope,this._x,this._y,e,this._x,this._y,this._z);this._z=t&&"z"in t?t.z:e}},{key:"_set",value:function(e,t,n){var r=this.onUpdate.call(this.scope,e,t,n,this._x,this._y,this._z);return r&&"x"in r&&"y"in r&&"z"in r?(this._x=r.x,this._y=r.y,this._z=r.z):(this._x=e,this._y=t,this._z=n||0),this}},{key:"setMuted",value:function(e,t,n){return this._x=e,this._y=t,this._z=n||0,this}},{key:"setCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("function"!=typeof e)throw new Error("invalid `onUpdate` callback");return this.onUpdate=e,this.scope=t,this}},{key:"add",value:function(e){return this._set(this._x+e.x,this._y+e.y,this._z+(e.z||0))}},{key:"sub",value:function(e){return this._set(this._x-e.x,this._y-e.y,this._z-(e.z||0))}},{key:"scale",value:function(e,t,n){return t=void 0!==t?t:e,this._set(this._x*e,this._y*t,this._z*(n||1))}},{key:"scaleV",value:function(e){return this._set(this._x*e.x,this._y*e.y,this._z*(e.z||1))}},{key:"div",value:function(e){return this._set(this._x/e,this._y/e,this._z/e)}},{key:"abs",value:function(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y,this._Z<0?-this._z:this._z)}},{key:"clamp",value:function(e,t){return new n(_clamp(this._x,e,t),_clamp(this._y,e,t),_clamp(this._z,e,t),{onUpdate:this.onUpdate,scope:this.scope})}},{key:"clampSelf",value:function(e,t){return this._set(_clamp(this._x,e,t),_clamp(this._y,e,t),_clamp(this._z,e,t))}},{key:"minV",value:function(e){var t=e.z||0;return this._set(this._x<e.x?this._x:e.x,this._y<e.y?this._y:e.y,this._z<t?this._z:t)}},{key:"maxV",value:function(e){var t=e.z||0;return this._set(this._x>e.x?this._x:e.x,this._y>e.y?this._y:e.y,this._z>t?this._z:t)}},{key:"floor",value:function(){return new n(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),{onUpdate:this.onUpdate,scope:this.scope})}},{key:"floorSelf",value:function(){return this._set(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}},{key:"ceil",value:function(){return new n(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z),{onUpdate:this.onUpdate,scope:this.scope})}},{key:"ceilSelf",value:function(){return this._set(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z))}},{key:"negate",value:function(){return new n(-this._x,-this._y,-this._z,{onUpdate:this.onUpdate,scope:this.scope})}},{key:"negateSelf",value:function(){return this._set(-this._x,-this._y,-this._z)}},{key:"copy",value:function(e){return this._set(e.x,e.y,e.z||0)}},{key:"equals",value:function(e){return this._x===e.x&&this._y===e.y&&this._z===(e.z||this._z)}},{key:"perp",value:function(){return this._set(this._y,-this._x,this._z)}},{key:"rotate",value:function(e,t){var n=0,r=0;"object"===_typeof(t)&&(n=t.x,r=t.y);var i=this.x-n,o=this.y-r,a=Math.cos(e),s=Math.sin(e);return this._set(i*a-o*s+n,i*s+o*a+r,this.z)}},{key:"dot",value:function(e){return this._x*e.x+this._y*e.y+this._z*(e.z||1)}},{key:"cross",value:function(e){var t=this._x,n=this._y,r=this._z,i=e.x,o=e.y,a=e.z;return this._set(n*a-r*o,r*i-t*a,t*o-n*i)}},{key:"lerp",value:function(e,t){return this._x+=(e.x-this._x)*t,this._y+=(e.y-this._y)*t,this._z+=(e.z-this._z)*t,this}},{key:"distance",value:function(e){var t=this._x-e.x,n=this._y-e.y,r=this._z-(e.z||0);return Math.sqrt(t*t+n*n+r*r)}},{key:"clone",value:function(){return pool.pull("ObservableVector3d",this._x,this._y,this._z,{onUpdate:this.onUpdate})}},{key:"toVector3d",value:function(){return pool.pull("Vector3d",this._x,this._y,this._z)}},{key:"toString",value:function(){return"x:"+this._x+",y:"+this._y+",z:"+this._z}}]),n}(Vector3d),earcut$2={exports:{}};function earcut(e,t,n){n=n||2;var r,i,o,a,s,c,u,l=t&&t.length,h=l?t[0]*n:e.length,d=linkedList(e,0,h,n,!0),f=[];if(!d||d.next===d.prev)return f;if(l&&(d=eliminateHoles(e,t,d,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var p=n;p<h;p+=n)(s=e[p])<r&&(r=s),(c=e[p+1])<i&&(i=c),s>o&&(o=s),c>a&&(a=c);u=0!==(u=Math.max(o-r,a-i))?1/u:0}return earcutLinked(d,f,n,r,i,u),f}function linkedList(e,t,n,r,i){var o,a;if(i===signedArea(e,t,n,r)>0)for(o=t;o<n;o+=r)a=insertNode(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=insertNode(o,e[o],e[o+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function earcutLinked(e,t,n,r,i,o,a){if(e){!a&&o&&indexCurve(e,r,i,o);for(var s,c,u=e;e.prev!==e.next;)if(s=e.prev,c=e.next,o?isEarHashed(e,r,i,o):isEar(e))t.push(s.i/n),t.push(e.i/n),t.push(c.i/n),removeNode(e),e=c.next,u=c.next;else if((e=c)===u){a?1===a?earcutLinked(e=cureLocalIntersections(filterPoints(e),t,n),t,n,r,i,o,2):2===a&&splitEarcut(e,t,n,r,i,o):earcutLinked(filterPoints(e),t,n,r,i,o,1);break}}}function isEar(e){var t=e.prev,n=e,r=e.next;if(area(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(pointInTriangle(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function isEarHashed(e,t,n,r){var i=e.prev,o=e,a=e.next;if(area(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,c=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,u=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=zOrder(s,c,t,n,r),d=zOrder(u,l,t,n,r),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&pointInTriangle(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&pointInTriangle(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function cureLocalIntersections(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!equals(i,o)&&intersects(i,r,r.next,o)&&locallyInside(i,o)&&locallyInside(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),removeNode(r),removeNode(r.next),r=e=o),r=r.next}while(r!==e);return filterPoints(r)}function splitEarcut(e,t,n,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&isValidDiagonal(a,s)){var c=splitPolygon(a,s);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,t,n,r,i,o),void earcutLinked(c,t,n,r,i,o)}s=s.next}a=a.next}while(a!==e)}function eliminateHoles(e,t,n,r){var i,o,a,s=[];for(i=0,o=t.length;i<o;i++)(a=linkedList(e,t[i]*r,i<o-1?t[i+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),s.push(getLeftmost(a));for(s.sort(compareX),i=0;i<s.length;i++)n=filterPoints(n=eliminateHole(s[i],n),n.next);return n}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){var n=findHoleBridge(e,t);if(!n)return t;var r=splitPolygon(n,e),i=filterPoints(n,n.next);return filterPoints(r,r.next),t===n?i:t}function findHoleBridge(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n;var c,u=n,l=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&pointInTriangle(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&(c=Math.abs(o-r.y)/(i-r.x),locallyInside(r,e)&&(c<d||c===d&&(r.x>n.x||r.x===n.x&&sectorContainsSector(n,r)))&&(n=r,d=c)),r=r.next}while(r!==u);return n}function sectorContainsSector(e,t){return area(e.prev,e,t.prev)<0&&area(t.next,e,e.next)<0}function indexCurve(e,t,n,r){var i=e;do{null===i.z&&(i.z=zOrder(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,sortLinked(i)}function sortLinked(e){var t,n,r,i,o,a,s,c,u=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(c=u;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(a>1);return e}function zOrder(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function pointInTriangle(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&(locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)&&(area(e.prev,e,t.prev)||area(e,t.prev,t))||equals(e,t)&&area(e.prev,e,e.next)>0&&area(t.prev,t,t.next)>0)}function area(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,n,r){var i=sign(area(e,t,n)),o=sign(area(e,t,r)),a=sign(area(n,r,e)),s=sign(area(n,r,t));return i!==o&&a!==s||!(0!==i||!onSegment(e,n,t))||!(0!==o||!onSegment(e,r,t))||!(0!==a||!onSegment(n,e,r))||!(0!==s||!onSegment(n,t,r))}function onSegment(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function sign(e){return e>0?1:e<0?-1:0}function intersectsPolygon(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&intersects(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}function splitPolygon(e,t){var n=new Node$1(e.i,e.x,e.y),r=new Node$1(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function insertNode(e,t,n,r){var i=new Node$1(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node$1(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}earcut$2.exports=earcut,earcut$2.exports.default=earcut,earcut.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(signedArea(e,0,o,n));if(i)for(var s=0,c=t.length;s<c;s++){var u=t[s]*n,l=s<c-1?t[s+1]*n:e.length;a-=Math.abs(signedArea(e,u,l,n))}var h=0;for(s=0;s<r.length;s+=3){var d=r[s]*n,f=r[s+1]*n,p=r[s+2]*n;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},earcut.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n};var earcut$1=earcut$2.exports,Polygon=function(){function e(t,n,r){_classCallCheck(this,e),this.pos=new Vector2d,this._bounds,this.points=[],this.edges=[],this.indices=[],this.normals=[],this.shapeType="Polygon",this.setShape(t,n,r)}return _createClass(e,[{key:"onResetEvent",value:function(e,t,n){this.setShape(e,t,n)}},{key:"setShape",value:function(e,t,n){return this.pos.set(e,t),this.setVertices(n),this}},{key:"setVertices",value:function(e){var t=this;if(!Array.isArray(e))return this;if(e[0]instanceof Vector2d)this.points=e;else if(this.points.length=0,"object"===_typeof(e[0]))e.forEach((function(e){t.points.push(new Vector2d(e.x,e.y))}));else for(var n=0;n<e.length;n+=2)this.points.push(new Vector2d(e[n],e[n+1]));return this.recalc(),this.updateBounds(),this}},{key:"transform",value:function(e){for(var t=this.points,n=t.length,r=0;r<n;r++)e.apply(t[r]);return this.recalc(),this.updateBounds(),this}},{key:"toIso",value:function(){return this.rotate(Math.PI/4).scale(Math.SQRT2,Math.SQRT1_2)}},{key:"to2d",value:function(){return this.scale(Math.SQRT1_2,Math.SQRT2).rotate(-Math.PI/4)}},{key:"rotate",value:function(e,t){if(0!==e){for(var n=this.points,r=n.length,i=0;i<r;i++)n[i].rotate(e,t);this.recalc(),this.updateBounds()}return this}},{key:"scale",value:function(e,t){t=void 0!==t?t:e;for(var n=this.points,r=n.length,i=0;i<r;i++)n[i].scale(e,t);return this.recalc(),this.updateBounds(),this}},{key:"scaleV",value:function(e){return this.scale(e.x,e.y)}},{key:"recalc",value:function(){var e,t=this.edges,n=this.normals,r=this.indices,i=this.points,o=i.length;if(o<3)throw new Error("Requires at least 3 points");for(e=0;e<o;e++)void 0===t[e]&&(t[e]=new Vector2d),t[e].copy(i[(e+1)%o]).sub(i[e]),void 0===n[e]&&(n[e]=new Vector2d),n[e].copy(t[e]).perp().normalize();return t.length=o,n.length=o,r.length=0,this}},{key:"getIndices",value:function(){return 0===this.indices.length&&(this.indices=earcut$1(this.points.flatMap((function(e){return[e.x,e.y]})))),this.indices}},{key:"isConvex",value:function(){var e,t,n,r,i=0,o=this.points,a=o.length;if(a<3)return null;for(e=0;e<a;e++)if(n=(e+2)%a,r=(o[t=(e+1)%a].x-o[e].x)*(o[n].y-o[t].y),(r-=(o[t].y-o[e].y)*(o[n].x-o[t].x))<0?i|=1:r>0&&(i|=2),3===i)return!1;return 0!==i||null}},{key:"translate",value:function(){var e,t;return 2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.pos.x+=e,this.pos.y+=t,this.getBounds().translate(e,t),this}},{key:"shift",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.pos.x=e,this.pos.y=t,this.updateBounds()}},{key:"contains",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y);for(var n=!1,r=this.pos.x,i=this.pos.y,o=this.points,a=o.length,s=0,c=a-1;s<a;c=s++){var u=o[s].y+i,l=o[s].x+r,h=o[c].y+i,d=o[c].x+r;u>t!=h>t&&e<(d-l)*(t-u)/(h-u)+l&&(n=!n)}return n}},{key:"getBounds",value:function(){return void 0===this._bounds&&(this._bounds=pool.pull("Bounds")),this._bounds}},{key:"updateBounds",value:function(){var e=this.getBounds();return e.update(this.points),e.translate(this.pos),e}},{key:"clone",value:function(){var t=[];return this.points.forEach((function(e){t.push(e.clone())})),new e(this.pos.x,this.pos.y,t)}}]),e}(),Rect=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,e,r,[new Vector2d(0,0),new Vector2d(i,0),new Vector2d(i,o),new Vector2d(0,o)])).shapeType="Rectangle",a}return _createClass(n,[{key:"onResetEvent",value:function(e,t,n,r){this.setShape(e,t,n,r)}},{key:"setShape",value:function(e,t,n,r){var i=n;return this.pos.set(e,t),4===arguments.length&&((i=this.points)[0].set(0,0),i[1].set(n,0),i[2].set(n,r),i[3].set(0,r)),this.setVertices(i),this}},{key:"left",get:function(){return this.pos.x}},{key:"right",get:function(){var e=this.width;return this.pos.x+e||e}},{key:"top",get:function(){return this.pos.y}},{key:"bottom",get:function(){var e=this.height;return this.pos.y+e||e}},{key:"width",get:function(){return this.points[2].x},set:function(e){this.points[1].x=this.points[2].x=e,this.recalc(),this.updateBounds()}},{key:"height",get:function(){return this.points[2].y},set:function(e){this.points[2].y=this.points[3].y=e,this.recalc(),this.updateBounds()}},{key:"centerX",get:function(){return isFinite(this.width)?this.pos.x+this.width/2:this.width},set:function(e){this.pos.x=e-this.width/2}},{key:"centerY",get:function(){return isFinite(this.height)?this.pos.y+this.height/2:this.height},set:function(e){this.pos.y=e-this.height/2}},{key:"resize",value:function(e,t){return this.width=e,this.height=t,this}},{key:"scale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this.width*=e,this.height*=t,this}},{key:"clone",value:function(){return new n(this.pos.x,this.pos.y,this.width,this.height)}},{key:"copy",value:function(e){return this.setShape(e.pos.x,e.pos.y,e.width,e.height)}},{key:"union",value:function(e){var t=Math.min(this.left,e.left),n=Math.min(this.top,e.top);return this.resize(Math.max(this.right,e.right)-t,Math.max(this.bottom,e.bottom)-n),this.pos.set(t,n),this}},{key:"overlaps",value:function(e){return this.left<e.right&&e.left<this.right&&this.top<e.bottom&&e.top<this.bottom}},{key:"contains",value:function(){var e,t,r,i,o=arguments[0];return 2===arguments.length?(e=t=o,r=i=arguments[1]):o instanceof n?(e=o.left,t=o.right,r=o.top,i=o.bottom):(e=t=o.x,r=i=o.y),e>=this.left&&t<=this.right&&r>=this.top&&i<=this.bottom}},{key:"equals",value:function(e){return e.left===this.left&&e.right===this.right&&e.top===this.top&&e.bottom===this.bottom}},{key:"isFinite",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return isFinite(this.pos.x)&&isFinite(this.pos.y)&&isFinite(this.width)&&isFinite(this.height)}))},{key:"toPolygon",value:function(){return new Polygon(this.pos.x,this.pos.y,this.points)}}]),n}(Polygon),_keyStatus={},_keyLock={},_keyLocked={},_keyRefs={},_preventDefaultForKeys={},_keyBindings={},keyDownEvent=function(e,t,n){t=t||e.keyCode||e.button;var r=_keyBindings[t];if(emit(KEYDOWN,r,t,!r||!_keyLocked[r]),r){if(!_keyLocked[r]){var i=void 0!==n?n:t;_keyRefs[r][i]||(_keyStatus[r]++,_keyRefs[r][i]=!0)}return!_preventDefaultForKeys[t]||"function"!=typeof e.preventDefault||e.preventDefault()}return!0},keyUpEvent=function(e,t,n){t=t||e.keyCode||e.button;var r=_keyBindings[t];if(emit(KEYUP,r,t),r){var i=void 0!==n?n:t;return _keyRefs[r][i]=void 0,_keyStatus[r]>0&&_keyStatus[r]--,_keyLocked[r]=!1,!_preventDefaultForKeys[t]||"function"!=typeof e.preventDefault||e.preventDefault()}return!0},keyBoardEventTarget=null,KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOW_KEY:91,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,TILDE:126,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWAND_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222};function initKeyboardEvent(){null===keyBoardEventTarget&&!1===device$1.isMobile&&((keyBoardEventTarget=window).addEventListener("keydown",keyDownEvent,!1),keyBoardEventTarget.addEventListener("keyup",keyUpEvent,!1))}function isKeyPressed(e){return!(!_keyStatus[e]||_keyLocked[e]||(_keyLock[e]&&(_keyLocked[e]=!0),0))}function keyStatus(e){return _keyStatus[e]>0}function triggerKeyEvent(e,t,n){!0===t?keyDownEvent({},e,n):keyUpEvent({},e,n)}function bindKey(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:preventDefault;_keyBindings[e]=t,_preventDefaultForKeys[e]=r,_keyStatus[t]=0,_keyLock[t]=n||!1,_keyLocked[t]=!1,_keyRefs[t]={}}function getBindingKey(e){return _keyBindings[e]}function unlockKey(e){_keyLocked[e]=!1}function unbindKey(e){var t=_keyBindings[e];_keyStatus[t]=0,_keyLock[t]=!1,_keyRefs[t]={},_keyBindings[e]=null,_preventDefaultForKeys[e]=null}var Bounds$1=function(){function e(t){_classCallCheck(this,e),this.onResetEvent(t)}return _createClass(e,[{key:"onResetEvent",value:function(e){void 0===this.min?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),void 0!==e&&this.update(e),this._center=new Vector2d}},{key:"clear",value:function(){this.setMinMax(1/0,1/0,-1/0,-1/0)}},{key:"setMinMax",value:function(e,t,n,r){this.min.x=e,this.min.y=t,this.max.x=n,this.max.y=r}},{key:"x",get:function(){return this.min.x},set:function(e){var t=this.max.x-this.min.x;this.min.x=e,this.max.x=e+t}},{key:"y",get:function(){return this.min.y},set:function(e){var t=this.max.y-this.min.y;this.min.y=e,this.max.y=e+t}},{key:"width",get:function(){return this.max.x-this.min.x},set:function(e){this.max.x=this.min.x+e}},{key:"height",get:function(){return this.max.y-this.min.y},set:function(e){this.max.y=this.min.y+e}},{key:"left",get:function(){return this.min.x}},{key:"right",get:function(){return this.max.x}},{key:"top",get:function(){return this.min.y}},{key:"bottom",get:function(){return this.max.y}},{key:"centerX",get:function(){return this.min.x+this.width/2}},{key:"centerY",get:function(){return this.min.y+this.height/2}},{key:"center",get:function(){return this._center.set(this.centerX,this.centerY)}},{key:"update",value:function(e){this.add(e,!0)}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t&&this.clear();for(var n=0;n<e.length;n++){var r=e[n];r.x>this.max.x&&(this.max.x=r.x),r.x<this.min.x&&(this.min.x=r.x),r.y>this.max.y&&(this.max.y=r.y),r.y<this.min.y&&(this.min.y=r.y)}}},{key:"addBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t&&this.clear(),e.max.x>this.max.x&&(this.max.x=e.max.x),e.min.x<this.min.x&&(this.min.x=e.min.x),e.max.y>this.max.y&&(this.max.y=e.max.y),e.min.y<this.min.y&&(this.min.y=e.min.y)}},{key:"addPoint",value:function(e,t){void 0!==t&&(e=t.apply(e)),this.min.x=Math.min(this.min.x,e.x),this.max.x=Math.max(this.max.x,e.x),this.min.y=Math.min(this.min.y,e.y),this.max.y=Math.max(this.max.y,e.y)}},{key:"addFrame",value:function(e,t,n,r,i){var o=me.pool.pull("Vector2d");this.addPoint(o.set(e,t),i),this.addPoint(o.set(n,t),i),this.addPoint(o.set(e,r),i),this.addPoint(o.set(n,r),i),me.pool.push(o)}},{key:"contains",value:function(){var t,n,r,i,o=arguments[0];return 2===arguments.length?(t=n=o,r=i=arguments[1]):o instanceof e?(t=o.min.x,n=o.max.x,r=o.min.y,i=o.max.y):(t=n=o.x,r=i=o.y),t>=this.min.x&&n<=this.max.x&&r>=this.min.y&&i<=this.max.y}},{key:"overlaps",value:function(e){return!(this.right<e.left||this.left>e.right||this.bottom<e.top||this.top>e.bottom)}},{key:"isFinite",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}))},{key:"translate",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.min.x+=e,this.max.x+=e,this.min.y+=t,this.max.y+=t}},{key:"shift",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y);var n=this.max.x-this.min.x,r=this.max.y-this.min.y;this.min.x=e,this.max.x=e+n,this.min.y=t,this.max.y=t+r}},{key:"clone",value:function(){var t=new e;return t.addBounds(this),t}},{key:"toPolygon",value:function(){return new Polygon(this.x,this.y,[new Vector2d(0,0),new Vector2d(this.width,0),new Vector2d(this.width,this.height),new Vector2d(0,this.height)])}}]),e}(),tmpVec=new Vector2d,Pointer=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return _classCallCheck(this,n),(e=t.call(this)).setMinMax(r,i,r+o,i+a),e.LEFT=0,e.MIDDLE=1,e.RIGHT=2,e.event=void 0,e.type=void 0,e.button=0,e.isPrimary=!1,e.pageX=0,e.pageY=0,e.clientX=0,e.clientY=0,e.movementX=0,e.movementY=0,e.deltaMode=0,e.deltaX=0,e.deltaY=0,e.deltaZ=0,e.gameX=0,e.gameY=0,e.gameScreenX=0,e.gameScreenY=0,e.gameWorldX=0,e.gameWorldY=0,e.gameLocalX=0,e.gameLocalY=0,e.pointerId=void 0,e.isNormalized=!1,e.locked=!1,e.bind=[0,0,0],e}return _createClass(n,[{key:"setEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;this.event=e,this.pageX=t,this.pageY=n,this.clientX=r,this.clientY=i,globalToLocal(this.pageX,this.pageY,tmpVec),this.gameScreenX=this.x=tmpVec.x,this.gameScreenY=this.y=tmpVec.y,this.isNormalized=!device$1.PointerEvent||device$1.PointerEvent&&!(e instanceof window.PointerEvent),this.locked=locked,this.movementX=e.movementX||0,this.movementY=e.movementY||0,"wheel"===e.type?(this.deltaMode=e.deltaMode||0,this.deltaX=e.deltaX||0,this.deltaY=e.deltaY||0,this.deltaZ=e.deltaZ||0):(this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0),this.pointerId=o,this.isPrimary=void 0===e.isPrimary||e.isPrimary,this.button=e.button||0,this.type=e.type,void 0!==viewport&&viewport.localToWorld(this.gameScreenX,this.gameScreenY,tmpVec),this.gameWorldX=tmpVec.x,this.gameWorldY=tmpVec.y,!1===this.isNormalized?(this.width=e.width||1,this.height=e.height||1):"number"==typeof e.radiusX?(this.width=2*e.radiusX||1,this.height=2*e.radiusY||1):this.width=this.height=1}}]),n}(Bounds$1),T_POINTERS=[],eventHandlers=new Map,currentPointer,pointerInitialized=!1,lastTimeStamp=0,activeEventList=[],WHEEL=["wheel"],POINTER_MOVE=["pointermove","mousemove","touchmove"],POINTER_DOWN=["pointerdown","mousedown","touchstart"],POINTER_UP=["pointerup","mouseup","touchend"],POINTER_CANCEL=["pointercancel","mousecancel","touchcancel"],POINTER_ENTER=["pointerenter","mouseenter","touchenter"],POINTER_OVER=["pointerover","mouseover","touchover"],POINTER_LEAVE=["pointerleave","mouseleave","touchleave"],pointerEventList=[WHEEL[0],POINTER_MOVE[0],POINTER_DOWN[0],POINTER_UP[0],POINTER_CANCEL[0],POINTER_ENTER[0],POINTER_OVER[0],POINTER_LEAVE[0]],mouseEventList=[WHEEL[0],POINTER_MOVE[1],POINTER_DOWN[1],POINTER_UP[1],POINTER_CANCEL[1],POINTER_ENTER[1],POINTER_OVER[1],POINTER_LEAVE[1]],touchEventList=[POINTER_MOVE[2],POINTER_DOWN[2],POINTER_UP[2],POINTER_CANCEL[2],POINTER_ENTER[2],POINTER_OVER[2],POINTER_LEAVE[2]],pointerEventMap={wheel:WHEEL,pointermove:POINTER_MOVE,pointerdown:POINTER_DOWN,pointerup:POINTER_UP,pointercancel:POINTER_CANCEL,pointerenter:POINTER_ENTER,pointerover:POINTER_OVER,pointerleave:POINTER_LEAVE},normalizedEvents=[];function registerEventListener(e,t){for(var n=0;n<e.length;n++)-1===POINTER_MOVE.indexOf(e[n])&&pointerEventTarget.addEventListener(e[n],t,{passive:!1===preventDefault})}function enablePointerEvent(){if(!pointerInitialized){currentPointer=new Rect(0,0,1,1);for(var e=0;e<device$1.maxTouchPoints;e++)T_POINTERS.push(new Pointer);var t;null===pointerEventTarget&&(pointerEventTarget=renderer.getScreenCanvas()),activeEventList=device$1.PointerEvent?pointerEventList:mouseEventList,device$1.touch&&!device$1.PointerEvent&&(activeEventList=activeEventList.concat(touchEventList)),registerEventListener(activeEventList,onPointerEvent),void 0===throttlingInterval&&(throttlingInterval=~~(1e3/timer$1.maxfps)),!0===device$1.autoFocus&&(device$1.focus(),pointerEventTarget.addEventListener(activeEventList[2],(function(){device$1.focus()}),{passive:!1===preventDefault}));var n=findAllActiveEvents(activeEventList,POINTER_MOVE);if(throttlingInterval<17)for(t=0;t<n.length;t++)-1!==activeEventList.indexOf(n[t])&&pointerEventTarget.addEventListener(n[t],onMoveEvent,{passive:!0});else for(t=0;t<n.length;t++)-1!==activeEventList.indexOf(n[t])&&pointerEventTarget.addEventListener(n[t],throttle(onMoveEvent,throttlingInterval,!1),{passive:!0});setTouchAction(pointerEventTarget),device$1.hasPointerLockSupport&&document.addEventListener("pointerlockchange",(function(){locked=document.pointerLockElement===getParent(),emit(POINTERLOCKCHANGE,locked)}),!0),pointerInitialized=!0}}function findActiveEvent(e,t){for(var n=0;n<t.length;n++)if(-1!==e.indexOf(t[n]))return t[n]}function findAllActiveEvents(e,t){for(var n=[],r=0;r<t.length;r++)-1!==e.indexOf(t[r])&&n.push(t[r]);return n}function triggerEvent(e,t,n,r){var i;if(e.callbacks[t]){e.pointerId=r;for(var o=e.callbacks[t].length-1;o>=0&&(i=e.callbacks[t][o]);o--)if(!1===i(n))return!0}return!1}function dispatchEvent(e){for(var t=!1;e.length>0;){var n=e.pop();if(T_POINTERS.push(n),void 0!==n.event.timeStamp){if(n.event.timeStamp<lastTimeStamp)continue;lastTimeStamp=n.event.timeStamp}currentPointer.setShape(n.gameWorldX,n.gameWorldY,n.width,n.height),POINTER_MOVE.includes(n.type)&&(n.gameX=n.gameLocalX=n.gameScreenX,n.gameY=n.gameLocalY=n.gameScreenY,emit(POINTERMOVE,n));for(var r,i=world.broadphase.retrieve(currentPointer,Container.prototype._sortReverseZ),o=(i=i.concat([viewport])).length;r=i[--o];){if(eventHandlers.has(r)&&!0!==r.isKinematic){var a,s=eventHandlers.get(r),c=s.region,u=c.ancestor,l=c.getBounds();if(!0===c.isFloating?(n.gameX=n.gameLocalX=n.gameScreenX,n.gameY=n.gameLocalY=n.gameScreenY):(n.gameX=n.gameLocalX=n.gameWorldX,n.gameY=n.gameLocalY=n.gameWorldY),void 0!==u){var h=u.getBounds();n.gameLocalX=n.gameX-h.x,n.gameLocalY=n.gameY-h.y}var d=n.gameX,f=n.gameY;if(void 0!==c.currentTransform&&!c.currentTransform.isIdentity()){var p=c.currentTransform.applyInverse(pool.pull("Vector2d",d,f));d=p.x,f=p.y,pool.push(p)}switch(a=l.contains(d,f),n.type){case POINTER_MOVE[0]:case POINTER_MOVE[1]:case POINTER_MOVE[2]:case POINTER_MOVE[3]:if(s.pointerId!==n.pointerId||a){if(null===s.pointerId&&a&&triggerEvent(s,findActiveEvent(activeEventList,POINTER_ENTER),n,n.pointerId)){t=!0;break}}else if(triggerEvent(s,findActiveEvent(activeEventList,POINTER_LEAVE),n,null)){t=!0;break}if(a&&triggerEvent(s,n.type,n,n.pointerId)){t=!0;break}break;case POINTER_UP[0]:case POINTER_UP[1]:case POINTER_UP[2]:case POINTER_UP[3]:if(s.pointerId===n.pointerId&&a&&triggerEvent(s,n.type,n,null)){t=!0;break}break;case POINTER_CANCEL[0]:case POINTER_CANCEL[1]:case POINTER_CANCEL[2]:case POINTER_CANCEL[3]:if(s.pointerId===n.pointerId&&triggerEvent(s,n.type,n,null)){t=!0;break}break;default:if(a&&triggerEvent(s,n.type,n,n.pointerId)){t=!0;break}}}if(!0===t)break}}return t}function normalizeEvent(e){var t;if(device$1.TouchEvent&&e.changedTouches)for(var n=0,r=e.changedTouches.length;n<r;n++){var i=e.changedTouches[n];(t=T_POINTERS.pop()).setEvent(e,i.pageX,i.pageY,i.clientX,i.clientY,i.identifier),normalizedEvents.push(t)}else(t=T_POINTERS.pop()).setEvent(e,e.pageX,e.pageY,e.clientX,e.clientY,e.pointerId),normalizedEvents.push(t);return!1===e.isPrimary||(normalizedEvents[0].isPrimary=!0,Object.assign(pointer,normalizedEvents[0])),normalizedEvents}function onMoveEvent(e){dispatchEvent(normalizeEvent(e))}function onPointerEvent(e){normalizeEvent(e);var t=normalizedEvents[0].button;(dispatchEvent(normalizedEvents)||"wheel"===e.type)&&e.preventDefault();var n=pointer.bind[t];n&&triggerKeyEvent(n,POINTER_DOWN.includes(e.type),t+1)}var pointerEventTarget=null,pointer=new Pointer(0,0,1,1),locked=!1,throttlingInterval;function globalToLocal(e,t,n){n=n||pool.pull("Vector2d");var r=device$1.getElementBounds(renderer.getScreenCanvas()),i=device$1.devicePixelRatio;e-=r.left+(window.pageXOffset||0),t-=r.top+(window.pageYOffset||0);var o=scaleRatio;return 1===o.x&&1===o.y||(e/=o.x,t/=o.y),n.set(e*i,t*i)}function setTouchAction(e,t){e.style["touch-action"]=t||"none"}function bindPointer(){var e=arguments.length<2?pointer.LEFT:arguments[0],t=arguments.length<2?arguments[0]:arguments[1];if(enablePointerEvent(),!getBindingKey(t))throw new Error("no action defined for keycode "+t);pointer.bind[e]=t}function unbindPointer(e){pointer.bind[void 0===e?pointer.LEFT:e]=null}function registerPointerEvent(e,t,n){if(enablePointerEvent(),-1===pointerEventList.indexOf(e))throw new Error("invalid event type : "+e);if(void 0===t)throw new Error("registerPointerEvent: region for "+toString(t)+" event is undefined ");var r=findAllActiveEvents(activeEventList,pointerEventMap[e]);eventHandlers.has(t)||eventHandlers.set(t,{region:t,callbacks:{},pointerId:null});for(var i=eventHandlers.get(t),o=0;o<r.length;o++)e=r[o],i.callbacks[e]?i.callbacks[e].push(n):i.callbacks[e]=[n]}function releasePointerEvent(e,t,n){if(-1===pointerEventList.indexOf(e))throw new Error("invalid event type : "+e);var r=findAllActiveEvents(activeEventList,pointerEventMap[e]),i=eventHandlers.get(t);if(void 0!==i){for(var o=0;o<r.length;o++)if(e=r[o],i.callbacks[e]){if(void 0!==n)_remove(i.callbacks[e],n);else for(;i.callbacks[e].length>0;)i.callbacks[e].pop();0===i.callbacks[e].length&&delete i.callbacks[e]}0===Object.keys(i.callbacks).length&&eventHandlers.delete(t)}}function releaseAllPointerEvents(e){if(eventHandlers.has(e))for(var t=0;t<pointerEventList.length;t++)releasePointerEvent(pointerEventList[t],e)}function requestPointerLock(){return!!device$1.hasPointerLockSupport&&(getParent().requestPointerLock(),!0)}function exitPointerLock(){return!!device$1.hasPointerLockSupport&&(document.exitPointerLock(),!0)}var deadzone=.1;function wiredXbox360NormalizeFn(e,t,n){return n===this.GAMEPAD.BUTTONS.L2||n===this.GAMEPAD.BUTTONS.R2?(e+1)/2:e}function ouyaNormalizeFn(e,t,n){return e>0?n===this.GAMEPAD.BUTTONS.L2?Math.max(0,e-2e4)/111070:(e-1)/131070:(65536+e)/131070+.5}var vendorProductRE=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-/i,leadingZeroRE=/^0+/;function addMapping(e,t){var n=e.replace(vendorProductRE,(function(e,t,n){return"000".substr(t.length-1)+t+"-"+"000".substr(n.length-1)+n+"-"})),r=e.replace(vendorProductRE,(function(e,t,n){return t.replace(leadingZeroRE,"")+"-"+n.replace(leadingZeroRE,"")+"-"}));t.analog=t.analog||t.buttons.map((function(){return-1})),t.normalize_fn=t.normalize_fn||function(e){return e},remap.set(n,t),remap.set(r,t)}var bindings={},remap=new Map,updateEventHandler;[["45e-28e-Xbox 360 Wired Controller",{axes:[0,1,3,4],buttons:[11,12,13,14,8,9,-1,-1,5,4,6,7,0,1,2,3,10],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:wiredXbox360NormalizeFn}],["54c-268-PLAYSTATION(R)3 Controller",{axes:[0,1,2,3],buttons:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]}],["54c-5c4-Wireless Controller",{axes:[0,1,2,3],buttons:[1,0,2,3,4,5,6,7,8,9,10,11,14,15,16,17,12,13]}],["2836-1-OUYA Game Controller",{axes:[0,3,7,9],buttons:[3,6,4,5,7,8,15,16,-1,-1,9,10,11,12,13,14,-1],analog:[-1,-1,-1,-1,-1,-1,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:ouyaNormalizeFn}],["OUYA Game Controller (Vendor: 2836 Product: 0001)",{axes:[0,1,3,4],buttons:[0,3,1,2,4,5,12,13,-1,-1,6,7,8,9,10,11,-1],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:ouyaNormalizeFn}]].forEach((function(e){addMapping(e[0],e[1])}));var updateGamepads=function(){var e=navigator.getGamepads();Object.keys(bindings).forEach((function(t){var n=e[t];if(n){var r=null;"standard"!==n.mapping&&(r=remap.get(n.id));var i=bindings[t];Object.keys(i.buttons).forEach((function(e){var o=i.buttons[e],a=e,s=-1;if(!(r&&(a=r.buttons[e],s=r.analog[e],a<0&&s<0))){var c=n.buttons[a]||{};if(r&&s>=0){var u=r.normalize_fn(n.axes[s],-1,+e);c={value:u,pressed:c.pressed||Math.abs(u)>=deadzone}}emit(GAMEPAD_UPDATE,t,"buttons",+e,c),!o.pressed&&c.pressed?triggerKeyEvent(o.keyCode,!0,a+256):o.pressed&&!c.pressed&&triggerKeyEvent(o.keyCode,!1,a+256),o.value=c.value,o.pressed=c.pressed}})),Object.keys(i.axes).forEach((function(e){var o=i.axes[e],a=e;if(!(r&&(a=r.axes[e])<0)){var s=n.axes[a];if(void 0!==s){r&&(s=r.normalize_fn(s,+e,-1));var c=Math.sign(s)||1;if(0!==o[c].keyCode){var u=Math.abs(s)>=deadzone+Math.abs(o[c].threshold);emit(GAMEPAD_UPDATE,t,"axes",+e,s),!o[c].pressed&&u?(o[-c].pressed&&(triggerKeyEvent(o[-c].keyCode,!1,a+256),o[-c].value=0,o[-c].pressed=!1),triggerKeyEvent(o[c].keyCode,!0,a+256)):!o[c].pressed&&!o[-c].pressed||u||triggerKeyEvent(o[c=o[c].pressed?c:-c].keyCode,!1,a+256),o[c].value=s,o[c].pressed=u}}}}))}}))};window.addEventListener("gamepadconnected",(function(e){emit(GAMEPAD_CONNECTED,e.gamepad)}),!1),window.addEventListener("gamepaddisconnected",(function(e){emit(GAMEPAD_DISCONNECTED,e.gamepad)}),!1);var GAMEPAD={AXES:{LX:0,LY:1,RX:2,RY:3,EXTRA_1:4,EXTRA_2:5,EXTRA_3:6,EXTRA_4:7},BUTTONS:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,BACK:8,START:9,FORWARD:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16,EXTRA_1:17,EXTRA_2:18,EXTRA_3:19,EXTRA_4:20}};function bindGamepad(e,t,n){if(!getBindingKey(n))throw new Error("no action defined for keycode "+n);void 0===updateEventHandler&&"function"==typeof navigator.getGamepads&&(updateEventHandler=on(GAME_BEFORE_UPDATE,updateGamepads)),bindings[e]||(bindings[e]={axes:{},buttons:{}});var r={keyCode:n,value:0,pressed:!1,threshold:t.threshold},i=bindings[e][t.type];if("buttons"===t.type)i[t.code]=r;else if("axes"===t.type){var o=Math.sign(t.threshold)||1;i[t.code]||(i[t.code]={});var a=i[t.code];a[o]=r,a[-o]||(a[-o]={keyCode:0,value:0,pressed:!1,threshold:-o})}}function unbindGamepad(e,t){if(!bindings[e])throw new Error("no bindings for gamepad "+e);bindings[e].buttons[t]={}}function setGamepadDeadzone(e){deadzone=e}for(var setGamepadMapping=addMapping,preventDefault=!0,input=Object.freeze({__proto__:null,preventDefault,get pointerEventTarget(){return pointerEventTarget},pointer,get locked(){return locked},get throttlingInterval(){return throttlingInterval},globalToLocal,setTouchAction,bindPointer,unbindPointer,registerPointerEvent,releasePointerEvent,releaseAllPointerEvents,requestPointerLock,exitPointerLock,get keyBoardEventTarget(){return keyBoardEventTarget},KEY,initKeyboardEvent,isKeyPressed,keyStatus,triggerKeyEvent,bindKey,getBindingKey,unlockKey,unbindKey,GAMEPAD,bindGamepad,unbindGamepad,setGamepadDeadzone,setGamepadMapping}),Renderable=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,e,r,i,o)).isRenderable=!0,a.isKinematic=!0,a.body=void 0,void 0===a.currentTransform&&(a.currentTransform=pool.pull("Matrix2d")),a.currentTransform.identity(),a.GUID=void 0,a.onVisibilityChange=void 0,a.alwaysUpdate=!1,a.updateWhenPaused=!1,a.isPersistent=!1,a.floating=!1,a.anchorPoint instanceof ObservableVector2d?a.anchorPoint.setMuted(.5,.5).setCallback(a.onAnchorUpdate,_assertThisInitialized(a)):a.anchorPoint=pool.pull("ObservableVector2d",.5,.5,{onUpdate:a.onAnchorUpdate,scope:_assertThisInitialized(a)}),a.autoTransform=!0,a.alpha=1,a.ancestor=void 0,a.mask=void 0,a.tint=pool.pull("Color",255,255,255,1),a.name="",a.pos instanceof ObservableVector3d?a.pos.setMuted(e,r,0).setCallback(a.updateBoundsPos,_assertThisInitialized(a)):a.pos=pool.pull("ObservableVector3d",e,r,0,{onUpdate:a.updateBoundsPos,scope:_assertThisInitialized(a)}),a.isDirty=!1,a._flip={x:!1,y:!1},a._inViewport=!1,a.setOpacity(1),a}return _createClass(n,[{key:"isFloating",get:function(){return!0===this.floating||void 0!==this.ancestor&&!0===this.ancestor.floating}},{key:"inViewport",get:function(){return this._inViewport},set:function(e){this._inViewport!==e&&(this._inViewport=e,"function"==typeof this.onVisibilityChange&&this.onVisibilityChange.call(this,e))}},{key:"isFlippedX",get:function(){return!0===this._flip.x}},{key:"isFlippedY",get:function(){return!0===this._flip.y}},{key:"getBounds",value:function(){return void 0===this._bounds&&(_get(_getPrototypeOf(n.prototype),"getBounds",this).call(this),this.isFinite()?this._bounds.setMinMax(this.pos.x,this.pos.y,this.pos.x+this.width,this.pos.y+this.height):this._bounds.setMinMax(this.pos.x,this.pos.y,this.width,this.height)),this._bounds}},{key:"getOpacity",value:function(){return this.alpha}},{key:"setOpacity",value:function(e){"number"==typeof e&&(this.alpha=_clamp(e,0,1),isNaN(this.alpha)&&(this.alpha=1),this.isDirty=!0)}},{key:"flipX",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._flip.x=!!e,this.isDirty=!0,this}},{key:"flipY",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._flip.y=!!e,this.isDirty=!0,this}},{key:"transform",value:function(e){return this.currentTransform.multiply(e),this.updateBoundsPos(this.pos.x,this.pos.y),this.isDirty=!0,this}},{key:"angleTo",value:function(e){var t,r,i=this.getBounds();if(e instanceof n){var o=e.getBounds();t=o.centerX-i.centerX,r=o.centerY-i.centerY}else t=e.x-i.centerX,r=e.y-i.centerY;return Math.atan2(r,t)}},{key:"distanceTo",value:function(e){var t,r,i=this.getBounds();if(e instanceof n){var o=e.getBounds();t=i.centerX-o.centerX,r=i.centerY-o.centerY}else t=i.centerX-e.x,r=i.centerY-e.y;return Math.sqrt(t*t+r*r)}},{key:"lookAt",value:function(e){var t;t=e instanceof n?e.pos:e;var r=this.angleTo(t);return this.rotate(r),this}},{key:"rotate",value:function(e,t){return isNaN(e)||(this.currentTransform.rotate(e,t),this.isDirty=!0),this}},{key:"scale",value:function(e,t){return this.currentTransform.scale(e,t),_get(_getPrototypeOf(n.prototype),"scale",this).call(this,e,t),this.isDirty=!0,this}},{key:"scaleV",value:function(e){return this.scale(e.x,e.y),this}},{key:"update",value:function(e){return this.isDirty}},{key:"updateBounds",value:function(){return _get(_getPrototypeOf(n.prototype),"updateBounds",this).call(this),this.updateBoundsPos(this.pos.x,this.pos.y),this.getBounds()}},{key:"updateBoundsPos",value:function(e,t){var n=this.getBounds();n.shift(e,t),void 0!==this.anchorPoint&&n.isFinite()&&n.translate(-this.anchorPoint.x*n.width,-this.anchorPoint.y*n.height),this.ancestor instanceof Container&&!0!==this.floating&&n.translate(this.ancestor.getAbsolutePosition())}},{key:"getAbsolutePosition",value:function(){return void 0===this._absPos&&(this._absPos=pool.pull("Vector2d")),this._absPos.set(this.pos.x,this.pos.y),this.ancestor instanceof Container&&!0!==this.floating&&this._absPos.add(this.ancestor.getAbsolutePosition()),this._absPos}},{key:"onAnchorUpdate",value:function(e,t){this.anchorPoint.setMuted(e,t),this.updateBoundsPos(this.pos.x,this.pos.y)}},{key:"preDraw",value:function(e){var t=this.getBounds(),n=t.width*this.anchorPoint.x,r=t.height*this.anchorPoint.y;if(e.save(),e.setGlobalAlpha(e.globalAlpha()*this.getOpacity()),this._flip.x||this._flip.y){var i=this._flip.x?this.centerX-n:0,o=this._flip.y?this.centerY-r:0;e.translate(i,o),e.scale(this._flip.x?-1:1,this._flip.y?-1:1),e.translate(-i,-o)}void 0!==this.mask&&(e.translate(this.pos.x,this.pos.y),e.setMask(this.mask),e.translate(-this.pos.x,-this.pos.y)),!0!==this.autoTransform||this.currentTransform.isIdentity()||(e.translate(this.pos.x,this.pos.y),e.transform(this.currentTransform),e.translate(-this.pos.x,-this.pos.y)),e.translate(-n,-r),e.setTint(this.tint,this.getOpacity())}},{key:"draw",value:function(e){}},{key:"postDraw",value:function(e){e.clearTint(),void 0!==this.mask&&e.clearMask(),e.restore(),this.isDirty=!1}},{key:"onCollision",value:function(){return!1}},{key:"destroy",value:function(){pool.push(this.currentTransform),this.currentTransform=void 0,pool.push(this.anchorPoint),this.anchorPoint=void 0,pool.push(this.pos),this.pos=void 0,void 0!==this._absPos&&(pool.push(this._absPos),this._absPos=void 0),pool.push(this._bounds),this._bounds=void 0,this.onVisibilityChange=void 0,void 0!==this.mask&&(pool.push(this.mask),this.mask=void 0),void 0!==this.tint&&(pool.push(this.tint),this.tint=void 0),this.ancestor=void 0,void 0!==this.body&&(this.body.destroy.apply(this.body,arguments),this.body=void 0),releaseAllPointerEvents(this),this.onDestroyEvent.apply(this,arguments)}},{key:"onDestroyEvent",value:function(){}}]),n}(Rect),Ellipse=function(){function e(t,n,r,i){_classCallCheck(this,e),this.pos=new Vector2d,this._bounds=void 0,this.radius=NaN,this.radiusV=new Vector2d,this.radiusSq=new Vector2d,this.ratio=new Vector2d,this.shapeType="Ellipse",this.setShape(t,n,r,i)}return _createClass(e,[{key:"onResetEvent",value:function(e,t,n,r){this.setShape(e,t,n,r)}},{key:"setShape",value:function(e,t,n,r){var i=n/2,o=r/2;this.pos.set(e,t),this.radius=Math.max(i,o),this.ratio.set(i/this.radius,o/this.radius),this.radiusV.set(this.radius,this.radius).scaleV(this.ratio);var a=this.radius*this.radius;return this.radiusSq.set(a,a).scaleV(this.ratio),this.getBounds().setMinMax(e,t,e+n,e+r),this.getBounds().translate(-this.radiusV.x,-this.radiusV.y),this}},{key:"rotate",value:function(e,t){return this.pos.rotate(e,t),this.getBounds().shift(this.pos),this.getBounds().translate(-this.radiusV.x,-this.radiusV.y),this}},{key:"scale",value:function(e,t){return t=void 0!==t?t:e,this.setShape(this.pos.x,this.pos.y,2*this.radiusV.x*e,2*this.radiusV.y*t)}},{key:"scaleV",value:function(e){return this.scale(e.x,e.y)}},{key:"transform",value:function(){return this}},{key:"translate",value:function(){var e,t;return 2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.pos.x+=e,this.pos.y+=t,this.getBounds().translate(e,t),this}},{key:"contains",value:function(){var e,t;return 2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),e-=this.pos.x,t-=this.pos.y,e*e/this.radiusSq.x+t*t/this.radiusSq.y<=1}},{key:"getBounds",value:function(){return void 0===this._bounds&&(this._bounds=pool.pull("Bounds")),this._bounds}},{key:"clone",value:function(){return new e(this.pos.x,this.pos.y,2*this.radiusV.x,2*this.radiusV.y)}}]),e}(),LEFT_VORNOI_REGION=-1,MIDDLE_VORNOI_REGION=0,RIGHT_VORNOI_REGION=1,T_VECTORS=[],v=0;v<10;v++)T_VECTORS.push(new Vector2d);for(var T_ARRAYS=[],a=0;a<5;a++)T_ARRAYS.push([]);function flattenPointsOn(e,t,n){for(var r=Number.MAX_VALUE,i=-Number.MAX_VALUE,o=e.length,a=0;a<o;a++){var s=e[a].dot(t);s<r&&(r=s),s>i&&(i=s)}n[0]=r,n[1]=i}function isSeparatingAxis(e,t,n,r,i,o){var a=T_ARRAYS.pop(),s=T_ARRAYS.pop(),c=T_VECTORS.pop().copy(t).sub(e),u=c.dot(i);if(flattenPointsOn(n,i,a),flattenPointsOn(r,i,s),s[0]+=u,s[1]+=u,a[0]>s[1]||s[0]>a[1])return T_VECTORS.push(c),T_ARRAYS.push(a),T_ARRAYS.push(s),!0;if(o){var l=0;if(a[0]<s[0])if(o.aInB=!1,a[1]<s[1])l=a[1]-s[0],o.bInA=!1;else{var h=a[1]-s[0],d=s[1]-a[0];l=h<d?h:-d}else if(o.bInA=!1,a[1]>s[1])l=a[0]-s[1],o.aInB=!1;else{var f=a[1]-s[0],p=s[1]-a[0];l=f<p?f:-p}var v=Math.abs(l);v<o.overlap&&(o.overlap=v,o.overlapN.copy(i),l<0&&o.overlapN.negateSelf())}return T_VECTORS.push(c),T_ARRAYS.push(a),T_ARRAYS.push(s),!1}function vornoiRegion(e,t){var n=e.length2(),r=t.dot(e);return r<0?LEFT_VORNOI_REGION:r>n?RIGHT_VORNOI_REGION:MIDDLE_VORNOI_REGION}function testPolygonPolygon(e,t,n,r,i){var o,a=t.points,s=t.normals,c=s.length,u=r.points,l=r.normals,h=l.length,d=T_VECTORS.pop().copy(e.pos).add(e.ancestor.getAbsolutePosition()).add(t.pos),f=T_VECTORS.pop().copy(n.pos).add(n.ancestor.getAbsolutePosition()).add(r.pos);for(o=0;o<c;o++)if(isSeparatingAxis(d,f,a,u,s[o],i))return T_VECTORS.push(d),T_VECTORS.push(f),!1;for(o=0;o<h;o++)if(isSeparatingAxis(d,f,a,u,l[o],i))return T_VECTORS.push(d),T_VECTORS.push(f),!1;return i&&(i.a=e,i.b=n,i.overlapV.copy(i.overlapN).scale(i.overlap)),T_VECTORS.push(d),T_VECTORS.push(f),!0}function testEllipseEllipse(e,t,n,r,i){var o=T_VECTORS.pop().copy(n.pos).add(n.ancestor.getAbsolutePosition()).add(r.pos).sub(e.pos).add(e.ancestor.getAbsolutePosition()).sub(t.pos),a=t.radius,s=r.radius,c=a+s,u=c*c,l=o.length2();if(l>u)return T_VECTORS.push(o),!1;if(i){var h=Math.sqrt(l);i.a=e,i.b=n,i.overlap=c-h,i.overlapN.copy(o.normalize()),i.overlapV.copy(o).scale(i.overlap),i.aInB=a<=s&&h<=s-a,i.bInA=s<=a&&h<=a-s}return T_VECTORS.push(o),!0}function testPolygonEllipse(e,t,n,r,i){for(var o=T_VECTORS.pop().copy(n.pos).add(n.ancestor.getAbsolutePosition()).add(r.pos).sub(e.pos).add(e.ancestor.getAbsolutePosition()).sub(t.pos),a=r.radius,s=a*a,c=t.points,u=t.edges,l=u.length,h=T_VECTORS.pop(),d=T_VECTORS.pop(),f=T_VECTORS.pop(),p=0,v=0;v<l;v++){var y=v===l-1?0:v+1,g=0===v?l-1:v-1,m=0,_=null;h.copy(u[v]),f.copy(o).sub(c[v]),i&&f.length2()>s&&(i.aInB=!1);var b=vornoiRegion(h,f),x=!0;if(b===LEFT_VORNOI_REGION){var w=null;if(l>1&&(h.copy(u[g]),(b=vornoiRegion(h,w=T_VECTORS.pop().copy(o).sub(c[g])))!==RIGHT_VORNOI_REGION&&(x=!1)),x){if((p=f.length())>a)return T_VECTORS.push(o),T_VECTORS.push(h),T_VECTORS.push(d),T_VECTORS.push(f),w&&T_VECTORS.push(w),!1;i&&(i.bInA=!1,_=f.normalize(),m=a-p)}w&&T_VECTORS.push(w)}else if(b===RIGHT_VORNOI_REGION){if(l>1&&(h.copy(u[y]),f.copy(o).sub(c[y]),(b=vornoiRegion(h,f))!==LEFT_VORNOI_REGION&&(x=!1)),x){if((p=f.length())>a)return T_VECTORS.push(o),T_VECTORS.push(h),T_VECTORS.push(d),T_VECTORS.push(f),!1;i&&(i.bInA=!1,_=f.normalize(),m=a-p)}}else{d.copy(t.normals[v]),p=f.dot(d);var T=Math.abs(p);if((1===l||p>0)&&T>a)return T_VECTORS.push(o),T_VECTORS.push(h),T_VECTORS.push(d),T_VECTORS.push(f),!1;i&&(_=d,m=a-p,(p>=0||m<2*a)&&(i.bInA=!1))}_&&i&&Math.abs(m)<Math.abs(i.overlap)&&(i.overlap=m,i.overlapN.copy(_))}return i&&(i.a=e,i.b=n,i.overlapV.copy(i.overlapN).scale(i.overlap)),T_VECTORS.push(o),T_VECTORS.push(h),T_VECTORS.push(d),T_VECTORS.push(f),!0}function testEllipsePolygon(e,t,n,r,i){var o=this.testPolygonEllipse(n,r,e,t,i);if(o&&i){var a=i.a,s=i.aInB;i.overlapN.negateSelf(),i.overlapV.negateSelf(),i.a=i.b,i.b=a,i.aInB=i.bInA,i.bInA=s}return o}var SAT=Object.freeze({__proto__:null,testPolygonPolygon,testEllipseEllipse,testPolygonEllipse,testEllipsePolygon}),dummyObj={pos:new Vector2d(0,0),ancestor:{_absPos:new Vector2d(0,0),getAbsolutePosition:function(){return this._absPos}}};function shouldCollide(e,t){return!0!==e.isKinematic&&!0!==t.isKinematic&&"object"===_typeof(e.body)&&"object"===_typeof(t.body)&&!(!0===e.body.isStatic&&!0===t.body.isStatic)&&0!=(e.body.collisionMask&t.body.collisionType)&&0!=(e.body.collisionType&t.body.collisionMask)}var ResponseObject=function(){function e(){_classCallCheck(this,e),this.a=null,this.b=null,this.overlapN=new Vector2d,this.overlapV=new Vector2d,this.aInB=!0,this.bInA=!0,this.indexShapeA=-1,this.indexShapeB=-1,this.overlap=Number.MAX_VALUE}return _createClass(e,[{key:"clear",value:function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.indexShapeA=-1,this.indexShapeB=-1,this}}]),e}(),globalResponse=new ResponseObject;function collisionCheck(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:globalResponse,r=0,i=world.broadphase.retrieve(e),o=i.length;t=i[--o];)if(t!==e&&shouldCollide(e,t)&&e.body.getBounds().overlaps(t.body.getBounds())){var a=e.body.shapes.length,s=t.body.shapes.length;if(0===a||0===s)continue;var c=0;do{var u=e.body.getShape(c),l=0;do{var h=t.body.getShape(l);!0===SAT["test"+u.shapeType+h.shapeType].call(this,e,u,t,h,n.clear())&&(r++,n.indexShapeA=c,n.indexShapeB=l,e.onCollision&&!1!==e.onCollision(n,t)&&!1===e.body.isStatic&&e.body.respondToCollision.call(e.body,n),t.onCollision&&!1!==t.onCollision(n,e)&&!1===t.body.isStatic&&t.body.respondToCollision.call(t.body,n)),l++}while(l<s);c++}while(c<a)}return r>0}function _rayCast(e){for(var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=0,i=world.broadphase.retrieve(e),o=i.length;t=i[--o];)if(t.body&&e.getBounds().overlaps(t.getBounds())){var a=t.body.shapes.length;if(0===t.body.shapes.length)continue;var s=e,c=0;do{var u=t.body.getShape(c);SAT["test"+s.shapeType+u.shapeType].call(this,dummyObj,s,t,u)&&(n[r]=t,r++),c++}while(c<a)}return n.length=r,n}var collision={maxChildren:8,maxDepth:4,types:{NO_OBJECT:0,PLAYER_OBJECT:1,NPC_OBJECT:2,ENEMY_OBJECT:4,COLLECTABLE_OBJECT:8,ACTION_OBJECT:16,PROJECTILE_OBJECT:32,WORLD_SHAPE:64,USER:128,ALL_OBJECT:4294967295},response:globalResponse,rayCast:function(e,t){return _rayCast(e,t)}},Body=function(){function e(t,n,r){if(_classCallCheck(this,e),this.ancestor=t,void 0===this.bounds&&(this.bounds=new Bounds$1),void 0===this.shapes&&(this.shapes=[]),this.collisionMask=collision.types.ALL_OBJECT,this.collisionType=collision.types.ENEMY_OBJECT,void 0===this.vel&&(this.vel=new Vector2d),this.vel.set(0,0),void 0===this.force&&(this.force=new Vector2d),this.force.set(0,0),void 0===this.friction&&(this.friction=new Vector2d),this.friction.set(0,0),this.bounce=0,this.mass=1,void 0===this.maxVel&&(this.maxVel=new Vector2d),this.maxVel.set(490,490),this.isStatic=!1,this.gravityScale=1,this.ignoreGravity=!1,this.falling=!1,this.jumping=!1,"function"==typeof r&&(this.onBodyUpdate=r),this.bounds.clear(),void 0!==n)if(Array.isArray(n))for(var i=0;i<n.length;i++)this.addShape(n[i]);else this.addShape(n);this.ancestor.isKinematic=!1}return _createClass(e,[{key:"setStatic",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isStatic=!0===e}},{key:"addShape",value:function(e){if(e instanceof Rect||e instanceof Bounds$1){var t=e.toPolygon();this.shapes.push(t),this.bounds.add(t.points),this.bounds.translate(t.pos)}else e instanceof Ellipse?(this.shapes.includes(e)||this.shapes.push(e),this.bounds.addBounds(e.getBounds()),this.bounds.translate(e.getBounds().x,e.getBounds().y)):e instanceof Polygon?(this.shapes.includes(e)||this.shapes.push(e),this.bounds.add(e.points),this.bounds.translate(e.pos)):this.fromJSON(e);return"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this),this.shapes.length}},{key:"setVertices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.getShape(t);r instanceof Polygon?r.setShape(0,0,e):this.shapes[t]=new Polygon(0,0,e),this.bounds.add(this.shapes[t].points,n),"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this)}},{key:"addVertices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.setVertices(e,t,!1)}},{key:"fromJSON",value:function(e,t){var n=e;if(void 0!==t&&(n=e[t]),void 0===n)throw new Error("Identifier ("+t+") undefined for the given JSON object)");if(n.length){for(var r=0;r<n.length;r++)this.addVertices(n[r].shape,r);this.mass=n[0].density||0,this.friction.set(n[0].friction||0,n[0].friction||0),this.bounce=n[0].bounce||0}return n.length}},{key:"getShape",value:function(e){return this.shapes[e||0]}},{key:"getBounds",value:function(){return this.bounds}},{key:"removeShape",value:function(e){this.bounds.clear(),_remove(this.shapes,e);for(var t=0;t<this.shapes.length;t++)this.addShape(this.shapes[t]);return this.shapes.length}},{key:"removeShapeAt",value:function(e){return this.removeShape(this.getShape(e))}},{key:"setCollisionMask",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:collision.types.ALL_OBJECT;this.collisionMask=e}},{key:"setCollisionType",value:function(e){if(void 0!==e){if(void 0===collision.types[e])throw new Error("Invalid value for the collisionType property");this.collisionType=collision.types[e]}}},{key:"respondToCollision",value:function(e){var t=e.overlapV;if(this.ancestor.pos.sub(t),0!==t.x&&(this.vel.x=~~(.5+this.vel.x-t.x)||0,this.bounce>0&&(this.vel.x*=-this.bounce)),0!==t.y){this.vel.y=~~(.5+this.vel.y-t.y)||0,this.bounce>0&&(this.vel.y*=-this.bounce);var n=Math.sign(world.gravity.y*this.gravityScale)||1;this.falling=t.y>=n,this.jumping=t.y<=-n}}},{key:"forEach",value:function(e,t){var n=this,r=0,i=this.shapes,o=i.length;if("function"!=typeof e)throw new Error(e+" is not a function");for(arguments.length>1&&(n=t);r<o;)e.call(n,i[r],r,i),r++}},{key:"contains",value:function(){var e,t;if(2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.getBounds().contains(e,t))for(var n,r=this.shapes.length;r--,n=this.shapes[r];)if(n.contains(e,t))return!0;return!1}},{key:"rotate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getBounds().center;return this.bounds.clear(),this.forEach((function(r){r.rotate(e,n),t.bounds.addBounds(r.getBounds()),r instanceof Ellipse?t.bounds.translate(r.getBounds().x,r.getBounds().y):t.bounds.translate(r.pos)})),this}},{key:"setMaxVelocity",value:function(e,t){this.maxVel.x=e,this.maxVel.y=t}},{key:"setFriction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.friction.x=e,this.friction.y=t}},{key:"computeVelocity",value:function(){var e=timer$1.tick;if(!this.ignoreGravity){var t=world.gravity;this.vel.x+=t.x*this.gravityScale*e,this.vel.y+=t.y*this.gravityScale*e,this.falling=this.vel.y*Math.sign(t.y*this.gravityScale)>0,this.jumping=!this.falling&&this.jumping}if(0!==this.force.x&&(this.vel.x+=this.force.x*e),0!==this.force.y&&(this.vel.y+=this.force.y*e),this.friction.x>0){var n=this.friction.x*e,r=this.vel.x+n,i=this.vel.x-n;this.vel.x=r<0?r:i>0?i:0}if(this.friction.y>0){var o=this.friction.y*e,a=this.vel.y+o,s=this.vel.y-o;this.vel.y=a<0?a:s>0?s:0}0!==this.vel.y&&(this.vel.y=_clamp(this.vel.y,-this.maxVel.y,this.maxVel.y)),0!==this.vel.x&&(this.vel.x=_clamp(this.vel.x,-this.maxVel.x,this.maxVel.x))}},{key:"update",value:function(e){return this.computeVelocity(e),this.ancestor.pos.add(this.vel),0!==this.vel.x||0!==this.vel.y}},{key:"destroy",value:function(){this.onBodyUpdate=void 0,this.ancestor=void 0,this.bounds=void 0,this.setStatic(!1),this.shapes.length=0}}]),e}(),deferredRemove=function(e,t){this.removeChildNow(e,t)},globalFloatingCounter=0,Container=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:viewport.width,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:viewport.height,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return _classCallCheck(this,n),(e=t.call(this,r,i,o,a)).pendingSort=null,e.root=s,e.children=void 0,e.sortOn=sortOn,e.autoSort=!0,e.autoDepth=!0,e.clipping=!1,e.onChildChange=function(){},e.enableChildBoundsUpdate=!1,e.backgroundColor=pool.pull("Color",0,0,0,0),e.drawCount=0,e.autoTransform=!0,e.isKinematic=!1,e.anchorPoint.set(0,0),!0===e.root&&on(CANVAS_ONRESIZE,e.updateBounds.bind(_assertThisInitialized(e),!0)),e}return _createClass(n,[{key:"reset",value:function(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);for(var e,t=this.getChildren(),n=t.length;n>=0;e=t[--n])e&&!0!==e.isPersistent&&this.removeChildNow(e);void 0!==this.currentTransform&&this.currentTransform.identity(),this.backgroundColor.setColor(0,0,0,0)}},{key:"addChild",value:function(e,t){return e.ancestor instanceof n?e.ancestor.removeChildNow(e):e.isRenderable&&(e.GUID=utils.createGUID(e.id)),e.ancestor=this,this.getChildren().push(e),void 0!==e.pos&&("number"==typeof t?e.pos.z=t:!0===this.autoDepth&&(e.pos.z=this.getChildren().length)),!0===this.autoSort&&this.sort(),"function"==typeof e.onActivateEvent&&this.isAttachedToRoot()&&e.onActivateEvent(),!0===this.isAttachedToRoot()&&repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),e.body instanceof Body&&world.addBody(e.body),this.onChildChange.call(this,this.getChildren().length-1),e}},{key:"addChildAt",value:function(e,t){if(t>=0&&t<this.getChildren().length)return e.ancestor instanceof n?e.ancestor.removeChildNow(e):e.isRenderable&&(e.GUID=utils.createGUID()),e.ancestor=this,this.getChildren().splice(t,0,e),"function"==typeof e.onActivateEvent&&this.isAttachedToRoot()&&e.onActivateEvent(),!0===this.isAttachedToRoot()&&repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),e.body instanceof Body&&world.addBody(e.body),this.onChildChange.call(this,t),e;throw new Error("Index ("+t+") Out Of Bounds for addChildAt()")}},{key:"forEach",value:function(e,t){var n=this,r=0,i=this.getChildren(),o=i.length;if("function"!=typeof e)throw new Error(e+" is not a function");for(arguments.length>1&&(n=t);r<o;)e.call(n,i[r],r,i),r++}},{key:"swapChildren",value:function(e,t){var n=this.getChildIndex(e),r=this.getChildIndex(t);if(-1===n||-1===r)throw new Error(e+" Both the supplied childs must be a child of the caller "+this);var i=e.pos.z;e.pos.z=t.pos.z,t.pos.z=i,this.getChildren()[n]=t,this.getChildren()[r]=e}},{key:"getChildAt",value:function(e){if(e>=0&&e<this.getChildren().length)return this.getChildren()[e];throw new Error("Index ("+e+") Out Of Bounds for getChildAt()")}},{key:"getChildIndex",value:function(e){return this.getChildren().indexOf(e)}},{key:"getNextChild",value:function(e){var t=this.getChildren().indexOf(e)-1;if(t>=0&&t<this.getChildren().length)return this.getChildAt(t)}},{key:"hasChild",value:function(e){return this===e.ancestor}},{key:"getChildByProp",value:function(e,t){var r=[];return this.forEach((function(i){!function(e,n){var i=e[n];t instanceof RegExp&&"string"==typeof i?t.test(i)&&r.push(e):i===t&&r.push(e)}(i,e),i instanceof n&&(r=r.concat(i.getChildByProp(e,t)))})),r}},{key:"getChildByType",value:function(e){var t=[];return this.forEach((function(r){r instanceof e&&t.push(r),r instanceof n&&(t=t.concat(r.getChildByType(e)))})),t}},{key:"getChildByName",value:function(e){return this.getChildByProp("name",e)}},{key:"getChildByGUID",value:function(e){var t=this.getChildByProp("GUID",e);return t.length>0?t[0]:null}},{key:"getChildren",value:function(){return void 0===this.children&&(this.children=[]),this.children}},{key:"updateBounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_get(_getPrototypeOf(n.prototype),"updateBounds",this).call(this);var t=this.getBounds();return!0!==e&&!0!==this.enableChildBoundsUpdate||this.forEach((function(e){e.isRenderable&&e.getBounds().isFinite()&&t.addBounds(e.getBounds())})),t}},{key:"isAttachedToRoot",value:function(){if(!0===this.root)return!0;for(var e=this.ancestor;e;){if(!0===e.root)return!0;e=e.ancestor}return!1}},{key:"updateBoundsPos",value:function(e,t){var r=this;return _get(_getPrototypeOf(n.prototype),"updateBoundsPos",this).call(this,e,t),this.forEach((function(n){n.isRenderable&&n.updateBoundsPos(n.pos.x+e-r.pos.x,n.pos.y+t-r.pos.y)})),this.getBounds()}},{key:"onActivateEvent",value:function(){this.forEach((function(e){"function"==typeof e.onActivateEvent&&e.onActivateEvent()}))}},{key:"removeChild",value:function(e,t){if(!this.hasChild(e))throw new Error("Child is not mine.");utils.function.defer(deferredRemove,this,e,t)}},{key:"removeChildNow",value:function(e,t){if(this.hasChild(e)&&this.getChildIndex(e)>=0){"function"==typeof e.onDeactivateEvent&&e.onDeactivateEvent(),e.body instanceof Body&&world.removeBody(e.body),t||!1===pool.push(e,!1)&&"function"==typeof e.destroy&&e.destroy();var n=this.getChildIndex(e);n>=0&&(this.getChildren().splice(n,1),e.ancestor=void 0),!0===this.isAttachedToRoot()&&repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),this.onChildChange.call(this,n)}}},{key:"setChildsProperty",value:function(e,t,r){this.forEach((function(i){!0===r&&i instanceof n&&i.setChildsProperty(e,t,r),i[e]=t}))}},{key:"moveUp",value:function(e){var t=this.getChildIndex(e);t-1>=0&&this.swapChildren(e,this.getChildAt(t-1))}},{key:"moveDown",value:function(e){var t=this.getChildIndex(e);t>=0&&t+1<this.getChildren().length&&this.swapChildren(e,this.getChildAt(t+1))}},{key:"moveToTop",value:function(e){var t=this.getChildIndex(e);if(t>0){var n=this.getChildren();n.splice(0,0,n.splice(t,1)[0]),e.pos.z=n[1].pos.z+1}}},{key:"moveToBottom",value:function(e){var t=this.getChildIndex(e),n=this.getChildren();t>=0&&t<n.length-1&&(n.splice(n.length-1,0,n.splice(t,1)[0]),e.pos.z=n[n.length-2].pos.z-1)}},{key:"sort",value:function(e){this.pendingSort||(!0===e&&this.forEach((function(t){t instanceof n&&t.sort(e)})),this.pendingSort=utils.function.defer((function(){this.getChildren().sort(this["_sort"+this.sortOn.toUpperCase()]),this.pendingSort=null,repaint()}),this))}},{key:"onDeactivateEvent",value:function(){this.forEach((function(e){"function"==typeof e.onDeactivateEvent&&e.onDeactivateEvent()}))}},{key:"_sortZ",value:function(e,t){return t.pos&&e.pos?t.pos.z-e.pos.z:e.pos?-1/0:1/0}},{key:"_sortReverseZ",value:function(e,t){return e.pos&&t.pos?e.pos.z-t.pos.z:e.pos?1/0:-1/0}},{key:"_sortX",value:function(e,t){return t.pos&&e.pos?t.pos.z-e.pos.z||t.pos.x-e.pos.x:e.pos?-1/0:1/0}},{key:"_sortY",value:function(e,t){return t.pos&&e.pos?t.pos.z-e.pos.z||t.pos.y-e.pos.y:e.pos?-1/0:1/0}},{key:"destroy",value:function(){this.reset(),_get(_getPrototypeOf(n.prototype),"destroy",this).call(this,arguments)}},{key:"update",value:function(e){for(var t,r=!1,i=state.isPaused(),o=this.getChildren(),a=o.length;a--,t=o[a];)i&&!t.updateWhenPaused||(t.isRenderable?((r=globalFloatingCounter>0||t.floating)&&globalFloatingCounter++,t.inViewport=!1,state.current().cameras.forEach((function(e){e.isVisible(t,r)&&(t.inViewport=!0)})),this.isDirty|=(t.inViewport||t.alwaysUpdate)&&t.update(e),globalFloatingCounter>0&&globalFloatingCounter--):this.isDirty|=t.update(e));return _get(_getPrototypeOf(n.prototype),"update",this).call(this,e)}},{key:"draw",value:function(e,t){var n=!1,r=this.getBounds();this.drawCount=0,!1===this.root&&!0===this.clipping&&!0===r.isFinite()&&e.clipRect(r.left,r.top,r.width,r.height),e.translate(this.pos.x,this.pos.y),this.backgroundColor.alpha>1/255&&e.clearColor(this.backgroundColor);for(var i,o=this.getChildren(),a=o.length;i=o[--a];)i.isRenderable&&(n=!0===i.floating,(i.inViewport||n)&&(n&&(e.save(),e.resetTransform()),i.preDraw(e),i.draw(e,t),i.postDraw(e),n&&e.restore(),this.drawCount++))}}]),n}(Renderable),QT_ARRAY=[];function QT_ARRAY_POP(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(QT_ARRAY.length>0){var i=QT_ARRAY.pop();return i.bounds=e,i.max_objects=t,i.max_levels=n,i.level=r,i}return new QuadTree(e,t,n,r)}function QT_ARRAY_PUSH(e){QT_ARRAY.push(e)}var QT_VECTOR=new Vector2d,QuadTree=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;_classCallCheck(this,e),this.max_objects=n,this.max_levels=r,this.level=i,this.bounds=t,this.objects=[],this.nodes=[]}return _createClass(e,[{key:"split",value:function(){var e=this.level+1,t=this.bounds.width/2,n=this.bounds.height/2,r=this.bounds.left,i=this.bounds.top;this.nodes[0]=QT_ARRAY_POP({left:r+t,top:i,width:t,height:n},this.max_objects,this.max_levels,e),this.nodes[1]=QT_ARRAY_POP({left:r,top:i,width:t,height:n},this.max_objects,this.max_levels,e),this.nodes[2]=QT_ARRAY_POP({left:r,top:i+n,width:t,height:n},this.max_objects,this.max_levels,e),this.nodes[3]=QT_ARRAY_POP({left:r+t,top:i+n,width:t,height:n},this.max_objects,this.max_levels,e)}},{key:"getIndex",value:function(e){var t,n=e.getBounds(),r=-1,i=(t=!0===e.isFloating?viewport.localToWorld(n.left,n.top,QT_VECTOR):QT_VECTOR.set(e.left,e.top)).x,o=t.y,a=n.width,s=n.height,c=this.bounds.left+this.bounds.width/2,u=this.bounds.top+this.bounds.height/2,l=o<u&&o+s<u,h=o>u;return i<c&&i+a<c?l?r=1:h&&(r=2):i>c&&(l?r=0:h&&(r=3)),r}},{key:"insertContainer",value:function(e){for(var t,n=e.children.length;n--,t=e.children[n];)!0!==t.isKinematic&&(t instanceof Container?("rootContainer"!==t.name&&this.insert(t),this.insertContainer(t)):"function"==typeof t.getBounds&&this.insert(t))}},{key:"insert",value:function(e){var t=-1;if(this.nodes.length>0&&-1!==(t=this.getIndex(e)))this.nodes[t].insert(e);else if(this.objects.push(e),this.objects.length>this.max_objects&&this.level<this.max_levels){0===this.nodes.length&&this.split();for(var n=0;n<this.objects.length;)-1!==(t=this.getIndex(this.objects[n]))?this.nodes[t].insert(this.objects.splice(n,1)[0]):n+=1}}},{key:"retrieve",value:function(e,t){var n=this.objects;if(this.nodes.length>0){var r=this.getIndex(e);if(-1!==r)n=n.concat(this.nodes[r].retrieve(e));else for(var i=0;i<this.nodes.length;i+=1)n=n.concat(this.nodes[i].retrieve(e))}return"function"==typeof t&&n.sort(t),n}},{key:"remove",value:function(e){var t=!1;if(void 0===e.getBounds)return!1;if(this.nodes.length>0){var n=this.getIndex(e);-1!==n&&(t=_remove(this.nodes[n],e))&&this.nodes[n].isPrunable()&&this.nodes.splice(n,1)}return!1===t&&-1!==this.objects.indexOf(e)&&(_remove(this.objects,e),t=!0),t}},{key:"isPrunable",value:function(){return!(this.hasChildren()||this.objects.length>0)}},{key:"hasChildren",value:function(){for(var e=0;e<this.nodes.length;e+=1){var t=this.nodes[e];if(t.length>0||t.objects.length>0)return!0}return!1}},{key:"clear",value:function(e){this.objects.length=0;for(var t=0;t<this.nodes.length;t++)this.nodes[t].clear(),QT_ARRAY_PUSH(this.nodes[t]);this.nodes.length=0,void 0!==e&&this.bounds.setMinMax(e.min.x,e.min.y,e.max.x,e.max.y)}}]),e}(),World=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return _classCallCheck(this,n),(e=t.call(this,r,i,o,a,!0)).name="rootContainer",e.anchorPoint.set(0,0),e.fps=60,e.gravity=new Vector2d(0,.98),e.preRender=!1,e.bodies=new Set,e.broadphase=new QuadTree(e.getBounds().clone(),collision.maxChildren,collision.maxDepth),on(GAME_RESET,e.reset,_assertThisInitialized(e)),on(LEVEL_LOADED,(function(){e.broadphase.clear(e.getBounds())})),e}return _createClass(n,[{key:"reset",value:function(){this.broadphase.clear(),this.anchorPoint.set(0,0),_get(_getPrototypeOf(n.prototype),"reset",this).call(this),this.bodies.clear()}},{key:"addBody",value:function(e){return this.bodies.add(e),this}},{key:"removeBody",value:function(e){return this.bodies.delete(e),this}},{key:"update",value:function(e){var t=state.isPaused();return this.broadphase.clear(),this.broadphase.insertContainer(this),this.bodies.forEach((function(n){if(!n.isStatic){var r=n.ancestor;t&&!r.updateWhenPaused||!r.inViewport&&!r.alwaysUpdate||(!0===n.update(e)&&(r.isDirty=!0),collisionCheck(r))}})),_get(_getPrototypeOf(n.prototype),"update",this).call(this,e)}}]),n}(Container),isDirty=!0,isAlwaysDirty=!1,frameCounter=0,frameRate=1,accumulator=0,accumulatorMax=0,accumulatorUpdateDelta=0,stepSize=1e3/60,updateDelta=0,lastUpdateStart=null,updateAverageDelta=0,viewport,world;on(BOOT,(function(){world=new World,emit(GAME_INIT)}));var mergeGroup=!0,sortOn="z",lastUpdate=window.performance.now();function onLevelLoaded(){}function _reset(){var e=state.current();void 0!==e&&(viewport=e.cameras.get("default")),emit(GAME_RESET),updateFrameRate()}function updateFrameRate(){frameCounter=0,frameRate=~~(.5+60/timer$1.maxfps),stepSize=1e3/world.fps,accumulator=0,accumulatorMax=10*stepSize,isAlwaysDirty=timer$1.maxfps>world.fps}function getParentContainer(e){return e.ancestor}function repaint(){isDirty=!0}function update$1(e,t){if(++frameCounter%frameRate==0){for(frameCounter=0,emit(GAME_BEFORE_UPDATE,e),accumulator+=timer$1.getDelta(),accumulator=Math.min(accumulator,accumulatorMax),updateDelta=timer$1.interpolation?timer$1.getDelta():stepSize,accumulatorUpdateDelta=timer$1.interpolation?updateDelta:Math.max(updateDelta,updateAverageDelta);accumulator>=accumulatorUpdateDelta||timer$1.interpolation;)if(lastUpdateStart=window.performance.now(),!0!==state.isPaused()&&emit(GAME_UPDATE,e),isDirty=t.update(updateDelta)||isDirty,lastUpdate=window.performance.now(),updateAverageDelta=lastUpdate-lastUpdateStart,accumulator-=accumulatorUpdateDelta,timer$1.interpolation){accumulator=0;break}emit(GAME_AFTER_UPDATE,lastUpdate)}}function draw(e){!0===renderer.isContextValid&&(isDirty||isAlwaysDirty)&&(emit(GAME_BEFORE_DRAW,window.performance.now()),renderer.clear(),e.draw(renderer),isDirty=!1,renderer.flush(),emit(GAME_AFTER_DRAW,window.performance.now()))}var game=Object.freeze({__proto__:null,get viewport(){return viewport},get world(){return world},mergeGroup,sortOn,get lastUpdate(){return lastUpdate},onLevelLoaded,reset:_reset,updateFrameRate,getParentContainer,repaint,update:update$1,draw}),MIN=Math.min,MAX=Math.max,targetV=new Vector2d,Camera2d=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,e,r,i-e,o-r)).AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},a.bounds=pool.pull("Bounds"),a.smoothFollow=!0,a.damping=1,a.near=-1e3,a.far=1e3,a.projectionMatrix=new Matrix3d,a.invCurrentTransform=new Matrix2d,a.offset=new Vector2d,a.target=null,a.follow_axis=a.AXIS.NONE,a._shake={intensity:0,duration:0,axis:a.AXIS.BOTH,onComplete:null},a._fadeOut={color:null,tween:null},a._fadeIn={color:null,tween:null},a.name="default",a.setDeadzone(a.width/6,a.height/6),a.anchorPoint.set(0,0),a.isKinematic=!1,a.bounds.setMinMax(e,r,i,o),a._updateProjectionMatrix(),on(GAME_RESET,a.reset,_assertThisInitialized(a)),on(CANVAS_ONRESIZE,a.resize,_assertThisInitialized(a)),a}return _createClass(n,[{key:"_updateProjectionMatrix",value:function(){this.projectionMatrix.ortho(0,this.width,this.height,0,this.near,this.far)}},{key:"_followH",value:function(e){var t=this.pos.x;return e.x-this.pos.x>this.deadzone.right?t=MIN(e.x-this.deadzone.right,this.bounds.width-this.width):e.x-this.pos.x<this.deadzone.pos.x&&(t=MAX(e.x-this.deadzone.pos.x,this.bounds.left)),t}},{key:"_followV",value:function(e){var t=this.pos.y;return e.y-this.pos.y>this.deadzone.bottom?t=MIN(e.y-this.deadzone.bottom,this.bounds.height-this.height):e.y-this.pos.y<this.deadzone.pos.y&&(t=MAX(e.y-this.deadzone.pos.y,this.bounds.top)),t}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.pos.x=e,this.pos.y=t,this.unfollow(),this.smoothFollow=!0,this.damping=1,this.currentTransform.identity(),this.invCurrentTransform.identity().invert(),this._updateProjectionMatrix()}},{key:"setDeadzone",value:function(e,t){void 0===this.deadzone&&(this.deadzone=new Rect(0,0,0,0)),this.deadzone.pos.set(~~((this.width-e)/2),~~((this.height-t)/2-.25*t)),this.deadzone.resize(e,t),this.smoothFollow=!1,this.updateTarget(),this.smoothFollow=!0}},{key:"resize",value:function(e,t){return _get(_getPrototypeOf(n.prototype),"resize",this).call(this,e,t),this.smoothFollow=!1,this.setBounds(0,0,e,t),this.setDeadzone(e/6,t/6),this.update(),this.smoothFollow=!0,this._updateProjectionMatrix(),emit(VIEWPORT_ONRESIZE,this.width,this.height),this}},{key:"setBounds",value:function(e,t,n,r){this.smoothFollow=!1,this.bounds.setMinMax(e,t,n+e,r+t),this.moveTo(this.pos.x,this.pos.y),this.update(),this.smoothFollow=!0}},{key:"follow",value:function(e,t,n){if(e instanceof Renderable)this.target=e.pos;else{if(!(e instanceof Vector2d||e instanceof Vector3d||e instanceof ObservableVector2d||e instanceof ObservableVector3d))throw new Error("invalid target for me.Camera2d.follow");this.target=e}this.follow_axis=void 0===t?this.AXIS.BOTH:t,this.smoothFollow=!1,this.damping="number"!=typeof n?1:_clamp(n,0,1),this.updateTarget(),this.smoothFollow=!0}},{key:"unfollow",value:function(){this.target=null,this.follow_axis=this.AXIS.NONE}},{key:"move",value:function(e,t){this.moveTo(this.pos.x+e,this.pos.y+t)}},{key:"moveTo",value:function(e,t){var n=this.pos.x,r=this.pos.y;this.pos.x=_clamp(e,this.bounds.left,this.bounds.width),this.pos.y=_clamp(t,this.bounds.top,this.bounds.height),n===this.pos.x&&r===this.pos.y||emit(VIEWPORT_ONCHANGE,this.pos)}},{key:"updateTarget",value:function(){if(this.target){switch(targetV.setV(this.pos),this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:targetV.x=this._followH(this.target);break;case this.AXIS.VERTICAL:targetV.y=this._followV(this.target);break;case this.AXIS.BOTH:targetV.x=this._followH(this.target),targetV.y=this._followV(this.target)}if(!this.pos.equals(targetV)){if(!0===this.smoothFollow&&this.damping<1){if(toBeCloseTo(targetV.x,this.pos.x,2)&&toBeCloseTo(targetV.y,this.pos.y,2))return this.pos.setV(targetV),!1;this.pos.lerp(targetV,this.damping)}else this.pos.setV(targetV);return!0}}return!1}},{key:"update",value:function(e){var t=this.updateTarget(e);return this._shake.duration>0&&(this._shake.duration-=e,this._shake.duration<=0?(this._shake.duration=0,this.offset.setZero(),"function"==typeof this._shake.onComplete&&this._shake.onComplete()):(this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.HORIZONTAL||(this.offset.x=(Math.random()-.5)*this._shake.intensity),this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.VERTICAL||(this.offset.y=(Math.random()-.5)*this._shake.intensity)),t=!0),!0===t&&emit(VIEWPORT_ONCHANGE,this.pos),null==this._fadeIn.tween&&null==this._fadeOut.tween||(t=!0),this.currentTransform.isIdentity()?this.invCurrentTransform.identity():this.invCurrentTransform.copy(this.currentTransform).invert(),t}},{key:"shake",value:function(e,t,n,r,i){0!==this._shake.duration&&!0!==i||(this._shake.intensity=e,this._shake.duration=t,this._shake.axis=n||this.AXIS.BOTH,this._shake.onComplete="function"==typeof r?r:void 0)}},{key:"fadeOut",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2?arguments[2]:void 0;this._fadeOut.color=pool.pull("Color").copy(e),this._fadeOut.tween=pool.pull("Tween",this._fadeOut.color).to({alpha:0},t).onComplete(n||null),this._fadeOut.tween.isPersistent=!0,this._fadeOut.tween.start()}},{key:"fadeIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2?arguments[2]:void 0;this._fadeIn.color=pool.pull("Color").copy(e);var r=this._fadeIn.color.alpha;this._fadeIn.color.alpha=0,this._fadeIn.tween=pool.pull("Tween",this._fadeIn.color).to({alpha:r},t).onComplete(n||null),this._fadeIn.tween.isPersistent=!0,this._fadeIn.tween.start()}},{key:"focusOn",value:function(e){var t=e.getBounds();this.moveTo(e.pos.x+t.left+t.width/2,e.pos.y+t.top+t.height/2)}},{key:"isVisible",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.floating;return!0===t||!0===e.floating?renderer.overlaps(e.getBounds()):e.getBounds().overlaps(this)}},{key:"localToWorld",value:function(e,t,n){return(n=n||pool.pull("Vector2d")).set(e,t).add(this.pos).sub(world.pos),this.currentTransform.isIdentity()||this.invCurrentTransform.apply(n),n}},{key:"worldToLocal",value:function(e,t,n){return(n=n||pool.pull("Vector2d")).set(e,t),this.currentTransform.isIdentity()||this.currentTransform.apply(n),n.sub(this.pos).add(world.pos)}},{key:"drawFX",value:function(e){this._fadeIn.tween&&(e.save(),e.resetTransform(),e.setColor(this._fadeIn.color),e.fillRect(0,0,this.width,this.height),e.restore(),1===this._fadeIn.color.alpha&&(this._fadeIn.tween=null,pool.push(this._fadeIn.color),this._fadeIn.color=null)),this._fadeOut.tween&&(e.save(),e.resetTransform(),e.setColor(this._fadeOut.color),e.fillRect(0,0,this.width,this.height),e.restore(),0===this._fadeOut.color.alpha&&(this._fadeOut.tween=null,pool.push(this._fadeOut.color),this._fadeOut.color=null))}},{key:"draw",value:function(e,t){var n=this.pos.x+this.offset.x,r=this.pos.y+this.offset.y;t.currentTransform.translate(-n,-r),e.setProjection(this.projectionMatrix),e.clipRect(0,0,this.width,this.height),this.preDraw(e),t.preDraw(e),t.draw(e,this),this.drawFX(e),t.postDraw(e),this.postDraw(e),t.currentTransform.translate(n,r)}}]),n}(Renderable),default_camera,default_settings={cameras:[]},Stage=function(){function e(t){_classCallCheck(this,e),this.cameras=new Map,this.settings=Object.assign(default_settings,t||{})}return _createClass(e,[{key:"reset",value:function(){var e=this;if(this.settings.cameras.forEach((function(t){e.cameras.set(t.name,t)})),!1===this.cameras.has("default")){if(void 0===default_camera){var t=renderer.getWidth(),n=renderer.getHeight();default_camera=new Camera2d(0,0,t,n)}this.cameras.set("default",default_camera)}_reset(),this.onResetEvent.apply(this,arguments)}},{key:"update",value:function(e){var t=world.update(e);return this.cameras.forEach((function(n){n.update(e)&&(t=!0)})),t}},{key:"draw",value:function(e){this.cameras.forEach((function(t){t.draw(e,world)}))}},{key:"destroy",value:function(){this.cameras.clear(),this.onDestroyEvent.apply(this,arguments)}},{key:"onResetEvent",value:function(){"function"==typeof this.settings.onResetEvent&&this.settings.onResetEvent.apply(this,arguments)}},{key:"onDestroyEvent",value:function(){"function"==typeof this.settings.onDestroyEvent&&this.settings.onDestroyEvent.apply(this,arguments)}}]),e}(),ProgressBar=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,e,r,i,o)).barHeight=o,a.anchorPoint.set(0,0),on(LOADER_PROGRESS,a.onProgressUpdate,_assertThisInitialized(a)),on(VIEWPORT_ONRESIZE,a.resize,_assertThisInitialized(a)),a.anchorPoint.set(0,0),a.progress=0,a}return _createClass(n,[{key:"onProgressUpdate",value:function(e){this.progress=~~(e*this.width),this.isDirty=!0}},{key:"draw",value:function(e){e.setColor("black"),e.fillRect(this.pos.x,viewport.centerY,e.getWidth(),this.barHeight/2),e.setColor("#55aa00"),e.fillRect(this.pos.x,viewport.centerY,this.progress,this.barHeight/2)}},{key:"onDestroyEvent",value:function(){off(LOADER_PROGRESS,this.onProgressUpdate),off(VIEWPORT_ONRESIZE,this.resize)}}]),n}(Renderable),IconLogo=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;_classCallCheck(this,n),(i=t.call(this,e,r,100,85)).iconCanvas=createCanvas(renderer.WebGLVersion>1?i.width:nextPowerOfTwo(i.width),renderer.WebGLVersion>1?i.height:nextPowerOfTwo(i.height),!1);var o=renderer.getContext2d(i.iconCanvas);return o.beginPath(),o.moveTo(.7,48.9),o.bezierCurveTo(10.8,68.9,38.4,75.8,62.2,64.5),o.bezierCurveTo(86.1,53.1,97.2,27.7,87,7.7),o.lineTo(87,7.7),o.bezierCurveTo(89.9,15.4,73.9,30.2,50.5,41.4),o.bezierCurveTo(27.1,52.5,5.2,55.8,.7,48.9),o.lineTo(.7,48.9),o.closePath(),o.fillStyle="rgb(255, 255, 255)",o.fill(),o.beginPath(),o.moveTo(84,7),o.bezierCurveTo(87.6,14.7,72.5,30.2,50.2,41.6),o.bezierCurveTo(27.9,53,6.9,55.9,3.2,48.2),o.bezierCurveTo(-.5,40.4,14.6,24.9,36.9,13.5),o.bezierCurveTo(59.2,2.2,80.3,-.8,84,7),o.lineTo(84,7),o.closePath(),o.lineWidth=5.3,o.strokeStyle="rgb(255, 255, 255)",o.lineJoin="miter",o.miterLimit=4,o.stroke(),i.anchorPoint.set(.5,.5),i}return _createClass(n,[{key:"draw",value:function(e){e.drawImage(this.iconCanvas,e.getWidth()/2,this.pos.y)}}]),n}(Renderable),DefaultLoadingScreen=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"onResetEvent",value:function(){world.backgroundColor.parseCSS("#202020"),world.addChild(new ProgressBar(0,renderer.getHeight()/2,renderer.getWidth(),8),1),world.addChild(new IconLogo(renderer.getWidth()/2,renderer.getHeight()/2-16-35),2);var e=pool.pull("Text",renderer.getWidth()/2,renderer.getHeight()/2+16,{font:"century gothic",size:32,fillStyle:"white",textAlign:"left",textBaseline:"top",text:"melon",offScreenCanvas:renderer.WebGLVersion>=1});e.anchorPoint.set(0,0);var t=pool.pull("Text",renderer.getWidth()/2,renderer.getHeight()/2+16,{font:"century gothic",size:32,fillStyle:"#55aa00",textAlign:"left",textBaseline:"top",bold:!0,text:"JS",offScreenCanvas:renderer.WebGLVersion>=1});t.anchorPoint.set(0,0);var n=e.getBounds().width+t.getBounds().width;e.pos.x=renderer.getWidth()/2-n/2,t.pos.x=e.pos.x+e.getBounds().width,world.addChild(e,2),world.addChild(t,2)}}]),n}(Stage),_state=-1,_animFrameId=-1,_isPaused=!1,_stages={},_fade={color:"",duration:0},_onSwitchComplete=null,_extraArgs=null,_pauseTime=0;function _startRunLoop(){-1===_animFrameId&&-1!==_state&&(timer$1.reset(),_animFrameId=window.requestAnimationFrame(_renderFrame))}function _resumeRunLoop(){_isPaused&&-1!==_state&&(timer$1.reset(),_isPaused=!1)}function _pauseRunLoop(){_isPaused=!0}function _renderFrame(e){var t=_stages[_state].stage;update$1(e,t),draw(t),-1!==_animFrameId&&(_animFrameId=window.requestAnimationFrame(_renderFrame))}function _stopRunLoop(){window.cancelAnimationFrame(_animFrameId),_animFrameId=-1}function _switchState(e){_stopRunLoop(),_stages[_state]&&_stages[_state].stage.destroy(),_stages[e]&&(_stages[_state=e].stage.reset.apply(_stages[_state].stage,_extraArgs),_startRunLoop(),_onSwitchComplete&&_onSwitchComplete(),repaint())}on(BOOT,(function(){state.set(state.LOADING,new DefaultLoadingScreen),state.set(state.DEFAULT,new Stage),on(VIDEO_INIT,(function(){state.change(state.DEFAULT,!0)}))}));var state={LOADING:0,MENU:1,READY:2,PLAY:3,GAMEOVER:4,GAME_END:5,SCORE:6,CREDITS:7,SETTINGS:8,DEFAULT:9,USER:100,stop:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_state!==this.LOADING&&this.isRunning()&&(_stopRunLoop(),!0===e&&e(),_pauseTime=window.performance.now(),emit(STATE_STOP))},pause:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_state===this.LOADING||this.isPaused()||(_pauseRunLoop(),!0===e&&pauseTrack(),_pauseTime=window.performance.now(),emit(STATE_PAUSE))},restart:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isRunning()||(_startRunLoop(),!0===e&&resumeTrack(),_pauseTime=window.performance.now()-_pauseTime,repaint(),emit(STATE_RESTART,_pauseTime))},resume:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isPaused()&&(_resumeRunLoop(),!0===e&&resumeTrack(),_pauseTime=window.performance.now()-_pauseTime,emit(STATE_RESUME,_pauseTime))},isRunning:function(){return-1!==_animFrameId},isPaused:function(){return _isPaused},set:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(t instanceof Stage))throw new Error(t+" is not an instance of me.Stage");_stages[e]={},_stages[e].stage=t,_stages[e].transition=!0,!0===n&&this.change(e)},current:function(){if(void 0!==_stages[_state])return _stages[_state].stage},transition:function(e,t,n){"fade"===e&&(_fade.color=t,_fade.duration=n)},setTransition:function(e,t){_stages[e].transition=t},change:function(e,t){if(void 0===_stages[e])throw new Error("Undefined Stage for state '"+e+"'");this.isCurrent(e)||(_extraArgs=null,arguments.length>1&&(_extraArgs=Array.prototype.slice.call(arguments,1)),_fade.duration&&_stages[e].transition?(_onSwitchComplete=function(){viewport.fadeOut(_fade.color,_fade.duration)},viewport.fadeIn(_fade.color,_fade.duration,(function(){defer(_switchState,this,e)}))):!0===t?_switchState(e):defer(_switchState,this,e))},isCurrent:function(e){return _state===e}};function setTMXValue(name,type,value){var match;if("string"!=typeof value)return value;switch(type){case"int":case"float":value=Number(value);break;case"bool":value="true"===value;break;default:if(!value||isBoolean(value))value=!value||"true"===value;else if(isNumeric(value))value=Number(value);else if(0===value.search(/^json:/i)){match=value.split(/^json:/i)[1];try{value=JSON.parse(match)}catch(e){throw new Error("Unable to parse JSON: "+match)}}else if(0===value.search(/^eval:/i)){match=value.split(/^eval:/i)[1];try{value=eval(match)}catch(e){throw new Error("Unable to evaluate: "+match)}}else((match=value.match(/^#([\da-fA-F])([\da-fA-F]{3})$/))||(match=value.match(/^#([\da-fA-F]{2})([\da-fA-F]{6})$/)))&&(value="#"+match[2]+match[1]);0===name.search(/^(ratio|anchorPoint)$/)&&"number"==typeof value&&(value={x:value,y:value})}return value}function parseAttributes(e,t){if(t.attributes&&t.attributes.length>0)for(var n=0;n<t.attributes.length;n++){var r=t.attributes.item(n);void 0!==r.name?e[r.name]=r.value:e[r.nodeName]=r.nodeValue}}function decompress(){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}function decodeCSV(e){for(var t=e.replace("\n","").trim().split(","),n=[],r=0;r<t.length;r++)n.push(+t[r]);return n}function decodeBase64AsArray(e,t){var n,r,i;t=t||1;var o=window.atob(e.replace(/[^A-Za-z0-9\+\/\=]/g,"")),a=new Uint32Array(o.length/t);for(n=0,i=o.length/t;n<i;n++)for(a[n]=0,r=t-1;r>=0;--r)a[n]+=o.charCodeAt(n*t+r)<<(r<<3);return a}function decode(e,t,n){switch(n=n||"none",t=t||"none"){case"csv":return decodeCSV(e);case"base64":var r=decodeBase64AsArray(e,4);return"none"===n?r:decompress();case"none":return e;case"xml":throw new Error("XML encoding is deprecated, use base64 instead");default:throw new Error("Unknown layer encoding: "+t)}}function normalize(e,t){var n=t.nodeName;switch(n){case"data":var r=parse(t);r.text=r.text||r.chunk.text,r.encoding=r.encoding||"xml",e.data=decode(r.text,r.encoding,r.compression),e.encoding="none";break;case"imagelayer":case"layer":case"objectgroup":case"group":var i=parse(t);i.type="layer"===n?"tilelayer":n,i.image&&(i.image=i.image.source),e.layers=e.layers||[],e.layers.push(i);break;case"animation":e.animation=parse(t).frames;break;case"frame":case"object":var o=n+"s";e[o]=e[o]||[],e[o].push(parse(t));break;case"tile":var a=parse(t);a.image&&(a.imagewidth=a.image.width,a.imageheight=a.image.height,a.image=a.image.source),e.tiles=e.tiles||{},e.tiles[a.id]=a;break;case"tileset":var s=parse(t);s.image&&(s.imagewidth=s.image.width,s.imageheight=s.image.height,s.image=s.image.source),e.tilesets=e.tilesets||[],e.tilesets.push(s);break;case"polygon":case"polyline":e[n]=[];for(var c,u=parse(t).points.split(" "),l=0;l<u.length;l++)c=u[l].split(","),e[n].push({x:+c[0],y:+c[1]});break;case"properties":e.properties=parse(t);break;case"property":var h=parse(t),d=void 0!==h.value?h.value:h.text;e[h.name]=setTMXValue(h.name,h.type||"string",d);break;default:e[n]=parse(t)}}function parse(e){var t={},n="";if(1===e.nodeType&&parseAttributes(t,e),e.hasChildNodes())for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes.item(r);switch(i.nodeType){case 1:normalize(t,i);break;case 3:n+=i.nodeValue.trim()}}return n&&(t.text=n),t}function applyTMXProperties(e,t){var n=t.properties,r=t.propertytypes;if(void 0!==n)for(var i in n)if(n.hasOwnProperty(i)){var o="string",a=i,s=n[i];void 0!==n[i].name&&(a=n[i].name),void 0!==r?o=r[i]:void 0!==n[i].type&&(o=n[i].type),void 0!==n[i].value&&(s=n[i].value),e[a]=setTMXValue(a,o,s)}}var src={},arraymultimap={},multimap={},__generator=commonjsGlobal&&commonjsGlobal.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},__values=commonjsGlobal&&commonjsGlobal.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=commonjsGlobal&&commonjsGlobal.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(multimap,"__esModule",{value:!0}),multimap.Multimap=void 0;var Multimap=function(){function e(e,t){var n,r;if(this.size_=0,this.map=new Map,this.operator=e,t)try{for(var i=__values(t),o=i.next();!o.done;o=i.next()){var a=__read(o.value,2),s=a[0],c=a[1];this.put(s,c)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return this}return Object.defineProperty(e.prototype,"size",{get:function(){return this.size_},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=this.map.get(e);return t?this.operator.clone(t):this.operator.create()},e.prototype.put=function(e,t){var n=this.map.get(e);return n||(n=this.operator.create()),!!this.operator.add(t,n)&&(this.map.set(e,n),this.size_++,!0)},e.prototype.putAll=function(t,n){var r,i,o,a,s=0;if(n){var c=t,u=n;try{for(var l=__values(u),h=l.next();!h.done;h=l.next()){var d=h.value;this.put(c,d),s++}}catch(e){r={error:e}}finally{try{h&&!h.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}}else{if(!(t instanceof e))throw new TypeError("unexpected arguments");try{for(var f=__values(t.entries()),p=f.next();!p.done;p=f.next()){var v=__read(p.value,2);c=v[0],d=v[1],this.put(c,d),s++}}catch(e){o={error:e}}finally{try{p&&!p.done&&(a=f.return)&&a.call(f)}finally{if(o)throw o.error}}}return s>0},e.prototype.has=function(e){return this.map.has(e)},e.prototype.hasEntry=function(e,t){return this.operator.has(t,this.get(e))},e.prototype.delete=function(e){return this.size_-=this.operator.size(this.get(e)),this.map.delete(e)},e.prototype.deleteEntry=function(e,t){var n=this.get(e);return!!this.operator.delete(t,n)&&(this.map.set(e,n),this.size_--,!0)},e.prototype.clear=function(){this.map.clear(),this.size_=0},e.prototype.keys=function(){return this.map.keys()},e.prototype.entries=function(){var e=this;return function(){var t,n,r,i,o,a,s,c,u,l,h,d,f,p;return __generator(this,(function(v){switch(v.label){case 0:v.trys.push([0,11,12,13]),t=__values(e.map.entries()),n=t.next(),v.label=1;case 1:if(n.done)return[3,10];r=__read(n.value,2),i=r[0],o=r[1],v.label=2;case 2:v.trys.push([2,7,8,9]),f=void 0,a=__values(o),s=a.next(),v.label=3;case 3:return s.done?[3,6]:(c=s.value,[4,[i,c]]);case 4:v.sent(),v.label=5;case 5:return s=a.next(),[3,3];case 6:return[3,9];case 7:return u=v.sent(),f={error:u},[3,9];case 8:try{s&&!s.done&&(p=a.return)&&p.call(a)}finally{if(f)throw f.error}return[7];case 9:return n=t.next(),[3,1];case 10:return[3,13];case 11:return l=v.sent(),h={error:l},[3,13];case 12:try{n&&!n.done&&(d=t.return)&&d.call(t)}finally{if(h)throw h.error}return[7];case 13:return[2]}}))}()},e.prototype.values=function(){var e=this;return function(){var t,n,r,i,o;return __generator(this,(function(a){switch(a.label){case 0:a.trys.push([0,5,6,7]),t=__values(e.entries()),n=t.next(),a.label=1;case 1:return n.done?[3,4]:[4,__read(n.value,2)[1]];case 2:a.sent(),a.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return r=a.sent(),i={error:r},[3,7];case 6:try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(i)throw i.error}return[7];case 7:return[2]}}))}()},e.prototype.forEach=function(e,t){var n,r;try{for(var i=__values(this.entries()),o=i.next();!o.done;o=i.next()){var a=__read(o.value,2),s=a[0],c=a[1];e.call(void 0===t?this:t,c,s,this)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype[Symbol.iterator]=function(){return this.entries()},e.prototype.asMap=function(){var e,t,n=new Map;try{for(var r=__values(this.keys()),i=r.next();!i.done;i=r.next()){var o=i.value;n.set(o,this.operator.clone(this.get(o)))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},e}();multimap.Multimap=Multimap;var __extends$1=commonjsGlobal&&commonjsGlobal.__extends||(_extendStatics=function(e,t){return _extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},_extendStatics(e,t)},function(e,t){function n(){this.constructor=e}_extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),_extendStatics;Object.defineProperty(arraymultimap,"__esModule",{value:!0}),arraymultimap.ArrayMultimap=void 0;var multimap_1$1=multimap,ArrayMultimap=function(e){function t(t){return e.call(this,new ArrayOperator,t)||this}return __extends$1(t,e),Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return"ArrayMultimap"},enumerable:!1,configurable:!0}),t}(multimap_1$1.Multimap);arraymultimap.ArrayMultimap=ArrayMultimap;var ArrayOperator=function(){function e(){}return e.prototype.create=function(){return[]},e.prototype.clone=function(e){return e.slice()},e.prototype.add=function(e,t){return t.push(e),!0},e.prototype.size=function(e){return e.length},e.prototype.delete=function(e,t){var n=t.indexOf(e);return n>-1&&(t.splice(n,1),!0)},e.prototype.has=function(e,t){return t.includes(e)},e}(),setmultimap={},__extends=commonjsGlobal&&commonjsGlobal.__extends||(_extendStatics2=function(e,t){return _extendStatics2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},_extendStatics2(e,t)},function(e,t){function n(){this.constructor=e}_extendStatics2(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),_extendStatics2;Object.defineProperty(setmultimap,"__esModule",{value:!0}),setmultimap.SetMultimap=void 0;var multimap_1=multimap,SetMultimap=function(e){function t(t){return e.call(this,new SetOperator,t)||this}return __extends(t,e),Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return"SetMultimap"},enumerable:!1,configurable:!0}),t}(multimap_1.Multimap);setmultimap.SetMultimap=SetMultimap;var SetOperator=function(){function e(){}return e.prototype.create=function(){return new Set},e.prototype.clone=function(e){return new Set(e)},e.prototype.add=function(e,t){var n=t.size;return t.add(e),n!==t.size},e.prototype.size=function(e){return e.size},e.prototype.delete=function(e,t){return t.delete(e)},e.prototype.has=function(e,t){return t.has(e)},e}();!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SetMultimap=e.ArrayMultimap=void 0;var t=arraymultimap;Object.defineProperty(e,"ArrayMultimap",{enumerable:!0,get:function(){return t.ArrayMultimap}});var n=setmultimap;Object.defineProperty(e,"SetMultimap",{enumerable:!0,get:function(){return n.SetMultimap}})}(src);var TextureCache=function(){function e(t){_classCallCheck(this,e),this.cache=new src.ArrayMultimap,this.tinted=new Map,this.units=new Map,this.max_size=t||1/0,this.clear()}return _createClass(e,[{key:"clear",value:function(){this.cache.clear(),this.tinted.clear(),this.units.clear(),this.length=0}},{key:"validate",value:function(){if(this.length>=this.max_size)throw new Error("Texture cache overflow: "+this.max_size+" texture units available for this GPU.")}},{key:"get",value:function(e,t){var n;return void 0===t?n=this.cache.get(e)[0]:this.cache.forEach((function(r,i){var o=r.getAtlas();i===e&&o[0].width===t.framewidth&&o[0].height===t.frameheight&&(n=r)})),void 0===n&&(t||(t=createAtlas(e.width,e.height,e.src?getBasename(e.src):void 0)),n=new TextureAtlas(t,e,!1),this.set(e,n)),n}},{key:"delete",value:function(e){this.cache.has(e)||this.cache.delete(e)}},{key:"tint",value:function(e,t){var n=this.tinted.get(e);return void 0===n&&(n=this.tinted.set(e,new Map)),n.has(t)||n.set(t,renderer.tint(e,t,"multiply")),n.get(t)}},{key:"set",value:function(e,t){var n=e.width,r=e.height;if(!(1!==renderer.WebGLVersion||isPowerOfTwo(n)&&isPowerOfTwo(r))){var i=void 0!==e.src?e.src:e;console.warn("[Texture] "+i+" is not a POT texture ("+n+"x"+r+")")}return this.cache.put(e,t)}},{key:"getUnit",value:function(e){return this.units.has(e)||(this.validate(),this.units.set(e,this.length++)),this.units.get(e)}}]),e}();function createAtlas(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"no-repeat";return{meta:{app:"melonJS",size:{w:e,h:t},repeat:r,image:"default"},frames:[{filename:n,frame:{x:0,y:0,w:e,h:t}}]}}var TextureAtlas=function(){function e(t,n,r){var i=this;if(_classCallCheck(this,e),this.format=null,this.sources=new Map,this.atlases=new Map,void 0!==t)for(var o in t=Array.isArray(t)?t:[t]){var a=t[o];if(void 0!==a.meta){if(a.meta.app.includes("texturepacker")||a.meta.app.includes("free-tex-packer")){if(this.format="texturepacker",void 0===n){var s=loader.getImage(a.meta.image);if(!s)throw new Error("Atlas texture '"+s+"' not found");this.sources.set(a.meta.image,s)}else this.sources.set(a.meta.image||"default","string"==typeof n?loader.getImage(n):n);this.repeat="no-repeat"}else if(a.meta.app.includes("ShoeBox")){if(!a.meta.exporter||!a.meta.exporter.includes("melonJS"))throw new Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx");this.format="ShoeBox",this.repeat="no-repeat",this.sources.set("default","string"==typeof n?loader.getImage(n):n)}else a.meta.app.includes("melonJS")&&(this.format="melonJS",this.repeat=a.meta.repeat||"no-repeat",this.sources.set("default","string"==typeof n?loader.getImage(n):n));this.atlases.set(a.meta.image||"default",this.parse(a))}else void 0!==a.framewidth&&void 0!==a.frameheight&&(this.format="Spritesheet (fixed cell size)",this.repeat="no-repeat",void 0!==n&&(a.image="string"==typeof n?loader.getImage(n):n),this.atlases.set("default",this.parseFromSpriteSheet(a)),this.sources.set("default",a.image))}if(0===this.atlases.length)throw new Error("texture atlas format not supported");!1!==r&&this.sources.forEach((function(e){r instanceof TextureCache?r.set(e,i):renderer.cache.set(e,i)}))}return _createClass(e,[{key:"parse",value:function(e){var t=this,n={};return e.frames.forEach((function(r){if(r.hasOwnProperty("filename")){var i,o,a=r.frame,s=r.spriteSourceSize&&r.sourceSize&&r.pivot;s&&(i=r.sourceSize.w*r.pivot.x-(r.trimmed?r.spriteSourceSize.x:0),o=r.sourceSize.h*r.pivot.y-(r.trimmed?r.spriteSourceSize.y:0)),n[r.filename]={name:r.filename,texture:e.meta.image||"default",offset:new Vector2d(a.x,a.y),anchorPoint:s?new Vector2d(i/a.w,o/a.h):null,trimmed:!!r.trimmed,width:a.w,height:a.h,angle:!0===r.rotated?-ETA:0},t.addUVs(n,r.filename,e.meta.size.w,e.meta.size.h)}})),n}},{key:"parseFromSpriteSheet",value:function(e){var t={},n=e.image,r=e.spacing||0,i=e.margin||0,o=n.width,a=n.height,s=pool.pull("Vector2d",~~((o-i+r)/(e.framewidth+r)),~~((a-i+r)/(e.frameheight+r)));if(o%(e.framewidth+r)!=0||a%(e.frameheight+r)!=0){var c=s.x*(e.framewidth+r),u=s.y*(e.frameheight+r);c-o!==r&&u-a!==r&&(o=c,a=u,console.warn("Spritesheet Texture for image: "+n.src+" is not divisible by "+(e.framewidth+r)+"x"+(e.frameheight+r)+", truncating effective size to "+o+"x"+a))}for(var l=0,h=s.x*s.y;l<h;l++){var d=""+l;t[d]={name:d,texture:"default",offset:new Vector2d(i+(r+e.framewidth)*(l%s.x),i+(r+e.frameheight)*~~(l/s.x)),anchorPoint:e.anchorPoint||null,trimmed:!1,width:e.framewidth,height:e.frameheight,angle:0},this.addUVs(t,d,o,a)}return pool.push(s),t}},{key:"getAtlas",value:function(e){return"string"==typeof e?this.atlases.get(e):this.atlases.values().next().value}},{key:"getFormat",value:function(){return this.format}},{key:"getTexture",value:function(e){return"object"===_typeof(e)&&"string"==typeof e.texture?this.sources.get(e.texture):this.sources.values().next().value}},{key:"addRegion",value:function(e,t,n,r,i){!0===renderer.settings.verbose&&console.warn("Adding texture region",e,"for texture",this);var o=this.getTexture(),a=this.getAtlas(),s=o.width,c=o.height;return a[e]={name:e,offset:new Vector2d(t,n),width:r,height:i,angle:0},this.addUVs(a,e,s,c),a[e]}},{key:"getRegion",value:function(e,t){var n;return"string"==typeof t?n=this.getAtlas(t)[e]:this.atlases.forEach((function(t){void 0!==t[e]&&(n=t[e])})),n}},{key:"getUVs",value:function(e){var t=this.getRegion(e);if(void 0===t){var n=e.split(","),r=+n[0],i=+n[1],o=+n[2],a=+n[3];t=this.addRegion(e,r,i,o,a)}return t.uvs}},{key:"addUVs",value:function(e,t,n,r){if(renderer instanceof WebGLRenderer){var i=e[t].offset,o=e[t].width,a=e[t].height;e[t].uvs=new Float32Array([i.x/n,i.y/r,(i.x+o)/n,(i.y+a)/r]),e[i.x+","+i.y+","+n+","+r]=e[t]}return e[t].uvs}},{key:"createSpriteFromName",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return pool.pull(!0===n?"me.NineSliceSprite":"me.Sprite",0,0,Object.assign({image:this,region:e},t||{}))}},{key:"createAnimationFromName",value:function(e,t){for(var n,r=[],i={},o=0,a=0,s=0;s<e.length;++s){if(null==(n=this.getRegion(e[s])))throw new Error("Texture - region for "+e[s]+" not found");r[s]=n,i[e[s]]=s,o=Math.max(n.width,o),a=Math.max(n.height,a)}return new Sprite(0,0,Object.assign({image:this,framewidth:o,frameheight:a,margin:0,spacing:0,atlas:r,atlasIndices:i},t||{}))}}]),e}(),Sprite=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;if(_classCallCheck(this,n),(o=t.call(this,e,r,0,0)).animationpause=!1,o.animationspeed=100,o.offset=pool.pull("Vector2d",0,0),o.source=null,o.anim={},o.resetAnim=void 0,o.current={name:"default",length:0,offset:new Vector2d,width:0,height:0,angle:0,idx:0},o.dt=0,o._flicker={isFlickering:!1,duration:0,callback:null,state:!1},i.image instanceof TextureAtlas){if(o.source=i.image,o.image=o.source.getTexture(),o.textureAtlas=i.image,void 0!==i.region){var a=o.source.getRegion(i.region);if(!a)throw new Error("Texture - region for "+i.region+" not found");o.setRegion(a),o.current.width=i.framewidth||a.width,o.current.height=i.frameheight||a.height}}else{if(o.image="object"===_typeof(i.image)?i.image:loader.getImage(i.image),!o.image)throw new Error("me.Sprite: '"+i.image+"' image/texture not found!");o.current.width=i.framewidth=i.framewidth||o.image.width,o.current.height=i.frameheight=i.frameheight||o.image.height,o.source=renderer.cache.get(o.image,i),o.textureAtlas=o.source.getAtlas()}return void 0!==i.atlas&&(o.textureAtlas=i.atlas,o.atlasIndices=i.atlasIndices),o.width=o.current.width,o.height=o.current.height,void 0!==i.flipX&&o.flipX(!!i.flipX),void 0!==i.flipY&&o.flipY(!!i.flipY),void 0!==i.rotation&&o.rotate(i.rotation),i.anchorPoint&&o.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y),void 0!==i.tint&&o.tint.setColor(i.tint),"string"==typeof i.name&&(o.name=i.name),void 0!==i.z&&(o.pos.z=i.z),0!==o.addAnimation("default",null)&&o.setCurrentAnimation("default"),o.autoTransform=!0,o}return _createClass(n,[{key:"isFlickering",value:function(){return this._flicker.isFlickering}},{key:"flicker",value:function(e,t){return this._flicker.duration=e,this._flicker.duration<=0?(this._flicker.isFlickering=!1,this._flicker.callback=null):this._flicker.isFlickering||(this._flicker.callback=t,this._flicker.isFlickering=!0),this}},{key:"addAnimation",value:function(e,t,n){this.anim[e]={name:e,frames:[],idx:0,length:0};var r=0;if("object"!==_typeof(this.textureAtlas))return 0;null==t&&(t=[],Object.keys(this.textureAtlas).forEach((function(e,n){t[n]=n})));for(var i=0,o=t.length;i<o;i++){var a,s=t[i],c=(a="number"==typeof s||"string"==typeof s?{name:s,delay:n||this.animationspeed}:s).name;if("number"==typeof c)void 0!==this.textureAtlas[c]&&(this.anim[e].frames[i]=Object.assign({},this.textureAtlas[c],a),r++);else{if(this.source.getFormat().includes("Spritesheet"))throw new Error("string parameters for addAnimation are not allowed for standard spritesheet based Texture");this.anim[e].frames[i]=Object.assign({},this.textureAtlas[this.atlasIndices[c]],a),r++}}return this.anim[e].length=r,r}},{key:"setCurrentAnimation",value:function(e,t,n){if(!this.anim[e])throw new Error("animation id '"+e+"' not defined");return this.current.name=e,this.current.length=this.anim[this.current.name].length,this.resetAnim="string"==typeof t?this.setCurrentAnimation.bind(this,t,null,!0):"function"==typeof t?t:void 0,this.setAnimationFrame(this.current.idx),n||(this.dt=0),this.isDirty=!0,this}},{key:"reverseAnimation",value:function(e){return void 0!==e&&void 0!==this.anim[e]?this.anim[e].frames.reverse():this.anim[this.current.name].frames.reverse(),this.isDirty=!0,this}},{key:"isCurrentAnimation",value:function(e){return this.current.name===e}},{key:"setRegion",value:function(e){return this.image=this.source.getTexture(e),this.current.offset.setV(e.offset),this.current.angle=e.angle,this.width=this.current.width=e.width,this.height=this.current.height=e.height,e.anchorPoint&&this.anchorPoint.set(this._flip.x&&!0===e.trimmed?1-e.anchorPoint.x:e.anchorPoint.x,this._flip.y&&!0===e.trimmed?1-e.anchorPoint.y:e.anchorPoint.y),this.isDirty=!0,this}},{key:"setAnimationFrame",value:function(e){return this.current.idx=(e||0)%this.current.length,this.setRegion(this.getAnimationFrameObjectByIndex(this.current.idx))}},{key:"getCurrentAnimationFrame",value:function(){return this.current.idx}},{key:"getAnimationFrameObjectByIndex",value:function(e){return this.anim[this.current.name].frames[e]}},{key:"update",value:function(e){if(!this.animationpause&&this.current&&this.current.length>0){var t=this.getAnimationFrameObjectByIndex(this.current.idx).delay;for(this.dt+=e;this.dt>=t;){this.isDirty=!0,this.dt-=t;var n=this.current.length>1?this.current.idx+1:this.current.idx;if(this.setAnimationFrame(n),0===this.current.idx&&"function"==typeof this.resetAnim&&!1===this.resetAnim()){this.setAnimationFrame(this.current.length-1),this.dt%=t;break}t=this.getAnimationFrameObjectByIndex(this.current.idx).delay}}return this._flicker.isFlickering&&(this._flicker.duration-=e,this._flicker.duration<0&&("function"==typeof this._flicker.callback&&this._flicker.callback(),this.flicker(-1)),this.isDirty=!0),this.isDirty}},{key:"destroy",value:function(){pool.push(this.offset),this.offset=void 0,_get(_getPrototypeOf(n.prototype),"destroy",this).call(this)}},{key:"draw",value:function(e){if(!this._flicker.isFlickering||(this._flicker.state=!this._flicker.state,this._flicker.state)){var t=this.current,n=this.pos.x,r=this.pos.y,i=t.width,o=t.height,a=t.offset,s=this.offset;0!==t.angle&&(e.translate(-n,-r),e.rotate(t.angle),n-=o,i=t.height,o=t.width),e.drawImage(this.image,s.x+a.x,s.y+a.y,i,o,n,r,i,o)}}}]),n}(Renderable),TMX_FLIP_H=2147483648,TMX_FLIP_V=1073741824,TMX_FLIP_AD=536870912,TMX_CLEAR_BIT_MASK$1=536870911,Tile=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a,s,c;if(_classCallCheck(this,n),a=t.call(this),o.isCollection){var u=o.getTileImage(i&TMX_CLEAR_BIT_MASK$1);s=u.width,c=u.height}else s=o.tilewidth,c=o.tileheight;return a.setMinMax(0,0,s,c),a.tileset=o,a.currentTransform=null,a.col=e,a.row=r,a.tileId=i,a.flippedX=0!=(a.tileId&TMX_FLIP_H),a.flippedY=0!=(a.tileId&TMX_FLIP_V),a.flippedAD=0!=(a.tileId&TMX_FLIP_AD),a.flipped=a.flippedX||a.flippedY||a.flippedAD,!0===a.flipped&&(null===a.currentTransform&&(a.currentTransform=new Matrix2d),a.setTileTransform(a.currentTransform.identity())),a.tileId&=TMX_CLEAR_BIT_MASK$1,a}return _createClass(n,[{key:"setTileTransform",value:function(e){e.translate(this.width/2,this.height/2),this.flippedAD&&(e.rotate(-90*Math.PI/180),e.scale(-1,1)),this.flippedX&&e.scale(this.flippedAD?1:-1,this.flippedAD?-1:1),this.flippedY&&e.scale(this.flippedAD?-1:1,this.flippedAD?1:-1),e.translate(-this.width/2,-this.height/2)}},{key:"getRenderable",value:function(e){var t,n=this.tileset;if(n.animations.has(this.tileId)){var r=[],i=[];n.animations.get(this.tileId).frames.forEach((function(e){i.push(e.tileid),r.push({name:""+e.tileid,delay:e.duration})})),(t=n.texture.createAnimationFromName(i,e)).addAnimation(this.tileId-n.firstgid,r),t.setCurrentAnimation(this.tileId-n.firstgid)}else if(!0===n.isCollection){var o=n.getTileImage(this.tileId);(t=new Sprite(0,0,Object.assign({image:o}))).anchorPoint.set(0,0),t.scale(e.width/this.width,e.height/this.height),void 0!==e.rotation&&(t.anchorPoint.set(.5,.5),t.currentTransform.rotate(e.rotation),t.currentTransform.translate(e.width/2,e.height/2),e.rotation=void 0)}else(t=n.texture.createSpriteFromName(this.tileId-n.firstgid,e)).anchorPoint.set(0,0);return this.setTileTransform(t.currentTransform),t}}]),n}(Bounds$1),Line=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"contains",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),e-=this.pos.x,t-=this.pos.y;var n=this.points[0],r=this.points[1];return(t-n.y)*(r.x-n.x)==(r.y-n.y)*(e-n.x)}},{key:"recalc",value:function(){var e=this.edges,t=this.normals,n=this.indices,r=this.points;if(2!==r.length)throw new Error("Requires exactly 2 points");return void 0===e[0]&&(e[0]=new Vector2d),e[0].copy(r[1]).sub(r[0]),void 0===t[0]&&(t[0]=new Vector2d),t[0].copy(e[0]).perp().normalize(),n.length=0,this}},{key:"clone",value:function(){var e=[];return this.points.forEach((function(t){e.push(t.clone())})),new n(this.pos.x,this.pos.y,e)}}]),n}(Polygon),Renderer=function(){function e(t){return _classCallCheck(this,e),this.settings=t,this.isContextValid=!0,this.currentScissor=new Int32Array([0,0,this.settings.width,this.settings.height]),this.currentBlendMode="normal",!0===device$1.ejecta?this.canvas=document.getElementById("canvas"):void 0!==window.canvas?this.canvas=window.canvas:void 0!==this.settings.canvas?this.canvas=this.settings.canvas:this.canvas=createCanvas(this.settings.zoomX,this.settings.zoomY),this.backBufferCanvas=this.canvas,this.context=null,this.currentColor=new Color(0,0,0,1),this.currentTint=new Color(255,255,255,1),this.projectionMatrix=new Matrix3d,this.uvOffset=0,on(GAME_RESET,(function(){renderer.reset()})),this}return _createClass(e,[{key:"clear",value:function(){}},{key:"reset",value:function(){this.resetTransform(),this.setBlendMode(this.settings.blendMode),this.setColor("#000000"),this.clearTint(),this.cache.clear(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.backBufferCanvas.width,this.currentScissor[3]=this.backBufferCanvas.height}},{key:"getCanvas",value:function(){return this.backBufferCanvas}},{key:"getScreenCanvas",value:function(){return this.canvas}},{key:"getScreenContext",value:function(){return this.context}},{key:"getBlendMode",value:function(){return this.currentBlendMode}},{key:"getContext2d",value:function(e,t){if(null==e)throw new Error("You must pass a canvas element in order to create a 2d context");if(void 0===e.getContext)throw new Error("Your browser does not support HTML5 canvas.");"boolean"!=typeof t&&(t=!0);var n=e.getContext("2d",{alpha:t});return n.canvas||(n.canvas=e),this.setAntiAlias(n,this.settings.antiAlias),n}},{key:"getWidth",value:function(){return this.backBufferCanvas.width}},{key:"getHeight",value:function(){return this.backBufferCanvas.height}},{key:"getColor",value:function(){return this.currentColor}},{key:"globalAlpha",value:function(){return this.currentColor.glArray[3]}},{key:"overlaps",value:function(e){return e.left<=this.getWidth()&&e.right>=0&&e.top<=this.getHeight()&&e.bottom>=0}},{key:"resize",value:function(e,t){e===this.backBufferCanvas.width&&t===this.backBufferCanvas.height||(this.canvas.width=this.backBufferCanvas.width=e,this.canvas.height=this.backBufferCanvas.height=t,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=e,this.currentScissor[3]=t,emit(CANVAS_ONRESIZE,e,t))}},{key:"setAntiAlias",value:function(e,t){var n=e.canvas;setPrefixed("imageSmoothingEnabled",!0===t,e),!0!==t?(n.style["image-rendering"]="optimizeSpeed",n.style["image-rendering"]="-moz-crisp-edges",n.style["image-rendering"]="-o-crisp-edges",n.style["image-rendering"]="-webkit-optimize-contrast",n.style["image-rendering"]="optimize-contrast",n.style["image-rendering"]="crisp-edges",n.style["image-rendering"]="pixelated",n.style.msInterpolationMode="nearest-neighbor"):n.style["image-rendering"]="auto"}},{key:"setProjection",value:function(e){this.projectionMatrix.copy(e)}},{key:"stroke",value:function(e,t){e instanceof Rect||e instanceof Bounds$1?this.strokeRect(e.left,e.top,e.width,e.height,t):e instanceof Line||e instanceof Polygon?this.strokePolygon(e,t):e instanceof Ellipse&&this.strokeEllipse(e.pos.x,e.pos.y,e.radiusV.x,e.radiusV.y,t)}},{key:"tint",value:function(e,t,n){var r=createCanvas(e.width,e.height,!0),i=this.getContext2d(r);return i.save(),i.fillStyle=t instanceof Color?t.toRGB():t,i.fillRect(0,0,e.width,e.height),i.globalCompositeOperation=n||"multiply",i.drawImage(e,0,0),i.globalCompositeOperation="destination-atop",i.drawImage(e,0,0),i.restore(),r}},{key:"fill",value:function(e){this.stroke(e,!0)}},{key:"setMask",value:function(e){}},{key:"clearMask",value:function(){}},{key:"setTint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.alpha;this.currentTint.copy(e),this.currentTint.alpha*=t}},{key:"clearTint",value:function(){this.currentTint.setColor(255,255,255,1)}},{key:"drawFont",value:function(){}}]),e}(),CanvasRenderer=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).context=r.getContext2d(r.getScreenCanvas(),r.settings.transparent),r.settings.doubleBuffering?(r.backBufferCanvas=createCanvas(r.settings.width,r.settings.height,!0),r.backBufferContext2D=r.getContext2d(r.backBufferCanvas)):(r.backBufferCanvas=r.getScreenCanvas(),r.backBufferContext2D=r.context),r.setBlendMode(r.settings.blendMode),r.setColor(r.currentColor),r.cache=new TextureCache,!1===r.settings.textureSeamFix||r.settings.antiAlias||(r.uvOffset=1),_possibleConstructorReturn(r,_assertThisInitialized(r))}return _createClass(n,[{key:"reset",value:function(){_get(_getPrototypeOf(n.prototype),"reset",this).call(this),this.clearColor(this.currentColor,!0!==this.settings.transparent)}},{key:"resetTransform",value:function(){this.backBufferContext2D.setTransform(1,0,0,1,0,0)}},{key:"setBlendMode",value:function(e,t){t=t||this.getContext(),this.currentBlendMode=e,"multiply"===e?t.globalCompositeOperation="multiply":(t.globalCompositeOperation="source-over",this.currentBlendMode="normal"),this.settings.doubleBuffering&&this.settings.transparent&&(this.context.globalCompositeOperation="copy")}},{key:"clear",value:function(){this.settings.transparent&&this.clearColor("rgba(0,0,0,0)",!0)}},{key:"flush",value:function(){this.settings.doubleBuffering&&this.context.drawImage(this.backBufferCanvas,0,0)}},{key:"clearColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#000000",t=arguments.length>1?arguments[1]:void 0;this.save(),this.resetTransform(),this.backBufferContext2D.globalCompositeOperation=t?"copy":"source-over",this.backBufferContext2D.fillStyle=e instanceof Color?e.toRGBA():e,this.fillRect(0,0,this.backBufferCanvas.width,this.backBufferCanvas.height),this.restore()}},{key:"clearRect",value:function(e,t,n,r){this.backBufferContext2D.clearRect(e,t,n,r)}},{key:"createPattern",value:function(e,t){return this.backBufferContext2D.createPattern(e,t)}},{key:"drawImage",value:function(e,t,n,r,i,o,a,s,c){if(!(this.backBufferContext2D.globalAlpha<1/255)){void 0===r?(r=s=e.width,i=c=e.height,o=t,a=n,t=0,n=0):void 0===o&&(o=t,a=n,s=r,c=i,r=e.width,i=e.height,t=0,n=0),!1===this.settings.subPixel&&(o=~~o,a=~~a);var u=e,l=this.currentTint.toArray();1===l[0]&&1===l[1]&&1===l[2]||(u=this.cache.tint(e,this.currentTint.toRGB())),this.backBufferContext2D.drawImage(u,t,n,r,i,o,a,s,c)}}},{key:"drawPattern",value:function(e,t,n,r,i){if(!(this.backBufferContext2D.globalAlpha<1/255)){var o=this.backBufferContext2D.fillStyle;this.backBufferContext2D.fillStyle=e,this.backBufferContext2D.fillRect(t,n,r,i),this.backBufferContext2D.fillStyle=o}}},{key:"strokeArc",value:function(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=this.backBufferContext2D;s.globalAlpha<1/255||(s.translate(e,t),s.beginPath(),s.arc(0,0,n,r,i,o||!1),s[!0===a?"fill":"stroke"](),s.translate(-e,-t))}},{key:"fillArc",value:function(e,t,n,r,i,o){this.strokeArc(e,t,n,r,i,o||!1,!0)}},{key:"strokeEllipse",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.backBufferContext2D;if(!(o.globalAlpha<1/255)){var a=n,s=r,c=e-a,u=e+a,l=t-s,h=t+s,d=.551784*a,f=.551784*s,p=e-d,v=e+d,y=t-f,g=t+f;o.beginPath(),o.moveTo(e,l),o.bezierCurveTo(v,l,u,y,u,t),o.bezierCurveTo(u,g,v,h,e,h),o.bezierCurveTo(p,h,c,g,c,t),o.bezierCurveTo(c,y,p,l,e,l),o[!0===i?"fill":"stroke"](),o.closePath()}}},{key:"fillEllipse",value:function(e,t,n,r){this.strokeEllipse(e,t,n,r,!0)}},{key:"strokeLine",value:function(e,t,n,r){var i=this.backBufferContext2D;i<1/255||(i.beginPath(),i.moveTo(e,t),i.lineTo(n,r),i.stroke())}},{key:"fillLine",value:function(e,t,n,r){this.strokeLine(e,t,n,r)}},{key:"strokePolygon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.backBufferContext2D;if(!(n.globalAlpha<1/255)){var r;this.translate(e.pos.x,e.pos.y),n.beginPath(),n.moveTo(e.points[0].x,e.points[0].y);for(var i=1;i<e.points.length;i++)r=e.points[i],n.lineTo(r.x,r.y);n.lineTo(e.points[0].x,e.points[0].y),n[!0===t?"fill":"stroke"](),n.closePath(),this.translate(-e.pos.x,-e.pos.y)}}},{key:"fillPolygon",value:function(e){this.strokePolygon(e,!0)}},{key:"strokeRect",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!0===i)this.fillRect(e,t,n,r);else{if(this.backBufferContext2D.globalAlpha<1/255)return;this.backBufferContext2D.strokeRect(e,t,n,r)}}},{key:"fillRect",value:function(e,t,n,r){this.backBufferContext2D.globalAlpha<1/255||this.backBufferContext2D.fillRect(e,t,n,r)}},{key:"getContext",value:function(){return this.backBufferContext2D}},{key:"getFontContext",value:function(){return this.getContext()}},{key:"save",value:function(){this.backBufferContext2D.save()}},{key:"restore",value:function(){this.backBufferContext2D.restore(),this.currentColor.glArray[3]=this.backBufferContext2D.globalAlpha,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.backBufferCanvas.width,this.currentScissor[3]=this.backBufferCanvas.height}},{key:"rotate",value:function(e){this.backBufferContext2D.rotate(e)}},{key:"scale",value:function(e,t){this.backBufferContext2D.scale(e,t)}},{key:"setColor",value:function(e){this.backBufferContext2D.strokeStyle=this.backBufferContext2D.fillStyle=e instanceof Color?e.toRGBA():e}},{key:"setGlobalAlpha",value:function(e){this.backBufferContext2D.globalAlpha=this.currentColor.glArray[3]=e}},{key:"setLineWidth",value:function(e){this.backBufferContext2D.lineWidth=e}},{key:"setTransform",value:function(e){this.resetTransform(),this.transform(e)}},{key:"transform",value:function(e){var t=e.toArray(),n=t[0],r=t[1],i=t[3],o=t[4],a=t[6],s=t[7];!1===this.settings.subPixel&&(a|=0,s|=0),this.backBufferContext2D.transform(n,r,i,o,a,s)}},{key:"translate",value:function(e,t){!1===this.settings.subPixel?this.backBufferContext2D.translate(~~e,~~t):this.backBufferContext2D.translate(e,t)}},{key:"clipRect",value:function(e,t,n,r){var i=this.backBufferCanvas;if(0!==e||0!==t||n!==i.width||r!==i.height){var o=this.currentScissor;if(o[0]!==e||o[1]!==t||o[2]!==n||o[3]!==r){var a=this.backBufferContext2D;a.beginPath(),a.rect(e,t,n,r),a.clip(),o[0]=e,o[1]=t,o[2]=n,o[3]=r}}}},{key:"setMask",value:function(e){var t=this.backBufferContext2D,n=e.pos.x,r=e.pos.y;if(t.save(),e instanceof Ellipse){var i=e.radiusV.x,o=e.radiusV.y,a=n-i,s=n+i,c=r-o,u=r+o,l=.551784*i,h=.551784*o,d=n-l,f=n+l,p=r-h,v=r+h;t.beginPath(),t.moveTo(n,c),t.bezierCurveTo(f,c,s,p,s,r),t.bezierCurveTo(s,v,f,u,n,u),t.bezierCurveTo(d,u,a,v,a,r),t.bezierCurveTo(a,p,d,c,n,c)}else{var y;t.beginPath(),t.moveTo(n+e.points[0].x,r+e.points[0].y);for(var g=1;g<e.points.length;g++)y=e.points[g],t.lineTo(n+y.x,r+y.y)}t.clip()}},{key:"clearMask",value:function(){this.backBufferContext2D.restore()}}]),n}(Renderer);function initArray(e){e.layerData=new Array(e.cols);for(var t=0;t<e.cols;t++){e.layerData[t]=new Array(e.rows);for(var n=0;n<e.rows;n++)e.layerData[t][n]=null}}function setLayerData(e,t){var n=0;initArray(e);for(var r=0;r<e.rows;r++)for(var i=0;i<e.cols;i++){var o=t[n++];0!==o&&(e.layerData[i][r]=e.getTileById(o,i,r))}}function preRenderLayer(e,t){for(var n=0;n<e.rows;n++)for(var r=0;r<e.cols;r++){var i=e.layerData[r][n];i instanceof Tile&&e.getRenderer().drawTile(t,r,n,i)}}var TMXLayer=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o,a,s,c){var u;_classCallCheck(this,n),(u=t.call(this,0,0,0,0)).tilewidth=r.tilewidth||i,u.tileheight=r.tileheight||o,u.orientation=a,u.tilesets=s,u.tileset=u.tilesets?u.tilesets.getTilesetByIndex(0):null,u.maxTileSize={width:0,height:0};for(var l=0;l<u.tilesets.length;l++){var h=u.tilesets.getTilesetByIndex(l);u.maxTileSize.width=Math.max(u.maxTileSize.width,h.tilewidth),u.maxTileSize.height=Math.max(u.maxTileSize.height,h.tileheight)}u.animatedTilesets=[],u.isAnimated=!1,u.renderorder=r.renderorder||"right-down",u.pos.z=c,u.anchorPoint.set(0,0),u.name=r.name,u.cols=+r.width,u.rows=+r.height;var d=void 0!==r.visible?+r.visible:1;return u.setOpacity(d?+r.opacity:0),"string"==typeof r.tintcolor&&u.tint.parseHex(r.tintcolor,!0),"isometric"===u.orientation?(u.width=(u.cols+u.rows)*(u.tilewidth/2),u.height=(u.cols+u.rows)*(u.tileheight/2)):(u.width=u.cols*u.tilewidth,u.height=u.rows*u.tileheight),applyTMXProperties(_assertThisInitialized(u),r),void 0===u.preRender&&(u.preRender=world.preRender),u.setRenderer(e.getRenderer()),setLayerData(_assertThisInitialized(u),decode(r.data,r.encoding,r.compression)),u}return _createClass(n,[{key:"onActivateEvent",value:function(){if(void 0===this.animatedTilesets&&(this.animatedTilesets=[]),this.tilesets)for(var e=this.tilesets.tilesets,t=0;t<e.length;t++)e[t].isAnimated&&this.animatedTilesets.push(e[t]);this.isAnimated=this.animatedTilesets.length>0,this.isAnimated&&(this.preRender=!1),this.getBounds().addBounds(this.getRenderer().getBounds(),!0),this.getBounds().shift(this.pos),!0!==this.preRender||this.canvasRenderer||(this.canvasRenderer=new CanvasRenderer({canvas:createCanvas(this.width,this.height),widht:this.width,heigth:this.height,transparent:!0}),preRenderLayer(this,this.canvasRenderer))}},{key:"onDeactivateEvent",value:function(){this.animatedTilesets=void 0}},{key:"setRenderer",value:function(e){this.renderer=e}},{key:"getRenderer",value:function(){return this.renderer}},{key:"getTileId",value:function(e,t){var n=this.getTile(e,t);return n?n.tileId:null}},{key:"getTile",value:function(e,t){var n=null;if(this.contains(e,t)){var r=this.getRenderer().pixelToTileCoords(e,t,pool.pull("Vector2d"));n=this.cellAt(r.x,r.y),pool.push(r)}return n}},{key:"setTile",value:function(e,t,n){return this.layerData[t][n]=e,e}},{key:"getTileById",value:function(e,t,n){return this.tileset.contains(e)||(this.tileset=this.tilesets.getTilesetByGid(e)),new Tile(t,n,e,this.tileset)}},{key:"cellAt",value:function(e,t,n){var r=~~e,i=~~t,o=this.getRenderer();return!1===n||r>=0&&r<o.cols&&i>=0&&i<o.rows?this.layerData[r][i]:null}},{key:"clearTile",value:function(e,t){this.layerData[e][t]=null,this.preRender&&this.canvasRenderer.clearRect(e*this.tilewidth,t*this.tileheight,this.tilewidth,this.tileheight)}},{key:"update",value:function(e){if(this.isAnimated){for(var t=!1,n=0;n<this.animatedTilesets.length;n++)t=this.animatedTilesets[n].update(e)||t;return t}return!1}},{key:"draw",value:function(e,t){if(this.preRender){var n=Math.min(t.width,this.width),r=Math.min(t.height,this.height);e.drawImage(this.canvasRenderer.getCanvas(),t.pos.x,t.pos.y,n,r,t.pos.x,t.pos.y,n,r)}else this.getRenderer().drawTileLayer(e,this,t)}}]),n}(Renderable),Bounds=function(){function e(t){_classCallCheck(this,e),this.onResetEvent(t)}return _createClass(e,[{key:"onResetEvent",value:function(e){void 0===this.min?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),void 0!==e&&this.update(e),this._center=new Vector2d}},{key:"clear",value:function(){this.setMinMax(1/0,1/0,-1/0,-1/0)}},{key:"setMinMax",value:function(e,t,n,r){this.min.x=e,this.min.y=t,this.max.x=n,this.max.y=r}},{key:"x",get:function(){return this.min.x},set:function(e){var t=this.max.x-this.min.x;this.min.x=e,this.max.x=e+t}},{key:"y",get:function(){return this.min.y},set:function(e){var t=this.max.y-this.min.y;this.min.y=e,this.max.y=e+t}},{key:"width",get:function(){return this.max.x-this.min.x},set:function(e){this.max.x=this.min.x+e}},{key:"height",get:function(){return this.max.y-this.min.y},set:function(e){this.max.y=this.min.y+e}},{key:"left",get:function(){return this.min.x}},{key:"right",get:function(){return this.max.x}},{key:"top",get:function(){return this.min.y}},{key:"bottom",get:function(){return this.max.y}},{key:"centerX",get:function(){return this.min.x+this.width/2}},{key:"centerY",get:function(){return this.min.y+this.height/2}},{key:"center",get:function(){return this._center.set(this.centerX,this.centerY)}},{key:"update",value:function(e){this.add(e,!0)}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t&&this.clear();for(var n=0;n<e.length;n++){var r=e[n];r.x>this.max.x&&(this.max.x=r.x),r.x<this.min.x&&(this.min.x=r.x),r.y>this.max.y&&(this.max.y=r.y),r.y<this.min.y&&(this.min.y=r.y)}}},{key:"addBounds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t&&this.clear(),e.max.x>this.max.x&&(this.max.x=e.max.x),e.min.x<this.min.x&&(this.min.x=e.min.x),e.max.y>this.max.y&&(this.max.y=e.max.y),e.min.y<this.min.y&&(this.min.y=e.min.y)}},{key:"addPoint",value:function(e,t){void 0!==t&&(e=t.apply(e)),this.min.x=Math.min(this.min.x,e.x),this.max.x=Math.max(this.max.x,e.x),this.min.y=Math.min(this.min.y,e.y),this.max.y=Math.max(this.max.y,e.y)}},{key:"addFrame",value:function(e,t,n,r,i){var o=me.pool.pull("Vector2d");this.addPoint(o.set(e,t),i),this.addPoint(o.set(n,t),i),this.addPoint(o.set(e,r),i),this.addPoint(o.set(n,r),i),me.pool.push(o)}},{key:"contains",value:function(){var t,n,r,i,o=arguments[0];return 2===arguments.length?(t=n=o,r=i=arguments[1]):o instanceof e?(t=o.min.x,n=o.max.x,r=o.min.y,i=o.max.y):(t=n=o.x,r=i=o.y),t>=this.min.x&&n<=this.max.x&&r>=this.min.y&&i<=this.max.y}},{key:"overlaps",value:function(e){return!(this.right<e.left||this.left>e.right||this.bottom<e.top||this.top>e.bottom)}},{key:"isFinite",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}))},{key:"translate",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y),this.min.x+=e,this.max.x+=e,this.min.y+=t,this.max.y+=t}},{key:"shift",value:function(){var e,t;2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0].x,t=arguments[0].y);var n=this.max.x-this.min.x,r=this.max.y-this.min.y;this.min.x=e,this.max.x=e+n,this.min.y=t,this.max.y=t+r}},{key:"clone",value:function(){var t=new e;return t.addBounds(this),t}},{key:"toPolygon",value:function(){return new Polygon(this.x,this.y,[new Vector2d(0,0),new Vector2d(this.width,0),new Vector2d(this.width,this.height),new Vector2d(0,this.height)])}}]),e}(),TMXRenderer=function(){function e(t,n,r,i){_classCallCheck(this,e),this.cols=t,this.rows=n,this.tilewidth=r,this.tileheight=i,this.bounds=new Bounds}return _createClass(e,[{key:"canRender",value:function(e){return this.tilewidth===e.tilewidth&&this.tileheight===e.tileheight}},{key:"getBounds",value:function(e){var t=e instanceof TMXLayer?pool.pull("Bounds"):this.bounds;return t.setMinMax(0,0,this.cols*this.tilewidth,this.rows*this.tileheight),t}},{key:"pixelToTileCoords",value:function(e,t,n){return n}},{key:"tileToPixelCoords",value:function(e,t,n){return n}},{key:"drawTile",value:function(e,t,n,r){}},{key:"drawTileLayer",value:function(e,t,n){}}]),e}(),TMXOrthogonalRenderer=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e.cols,e.rows,e.tilewidth,e.tileheight)}return _createClass(n,[{key:"canRender",value:function(e){return"orthogonal"===e.orientation&&_get(_getPrototypeOf(n.prototype),"canRender",this).call(this,e)}},{key:"pixelToTileCoords",value:function(e,t,n){return(n||new Vector2d).set(e/this.tilewidth,t/this.tileheight)}},{key:"tileToPixelCoords",value:function(e,t,n){return(n||new Vector2d).set(e*this.tilewidth,t*this.tileheight)}},{key:"adjustPosition",value:function(e){"number"==typeof e.gid&&(e.y-=e.height)}},{key:"drawTile",value:function(e,t,n,r){var i=r.tileset;i.drawTile(e,i.tileoffset.x+t*this.tilewidth,i.tileoffset.y+(n+1)*this.tileheight-i.tileheight,r)}},{key:"drawTileLayer",value:function(e,t,n){var r=1,i=1,o=this.pixelToTileCoords(Math.max(n.pos.x-(t.maxTileSize.width-t.tilewidth),0),Math.max(n.pos.y-(t.maxTileSize.height-t.tileheight),0),pool.pull("Vector2d")).floorSelf(),a=this.pixelToTileCoords(n.pos.x+n.width+this.tilewidth,n.pos.y+n.height+this.tileheight,pool.pull("Vector2d")).ceilSelf();switch(a.x=a.x>this.cols?this.cols:a.x,a.y=a.y>this.rows?this.rows:a.y,t.renderorder){case"right-up":a.y=o.y+(o.y=a.y)-a.y,i=-1;break;case"left-down":a.x=o.x+(o.x=a.x)-a.x,r=-1;break;case"left-up":a.x=o.x+(o.x=a.x)-a.x,a.y=o.y+(o.y=a.y)-a.y,r=-1,i=-1}for(var s=o.y;s!==a.y;s+=i)for(var c=o.x;c!==a.x;c+=r){var u=t.cellAt(c,s,!1);u&&this.drawTile(e,c,s,u)}pool.push(o),pool.push(a)}}]),n}(TMXRenderer),TMXIsometricRenderer=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e.cols,e.rows,e.tilewidth,e.tileheight)).hTilewidth=r.tilewidth/2,r.hTileheight=r.tileheight/2,r.originX=r.rows*r.hTilewidth,r}return _createClass(n,[{key:"canRender",value:function(e){return"isometric"===e.orientation&&_get(_getPrototypeOf(n.prototype),"canRender",this).call(this,e)}},{key:"getBounds",value:function(e){var t=e instanceof TMXLayer?pool.pull("Bounds"):this.bounds;return t.setMinMax(0,0,(this.cols+this.rows)*(this.tilewidth/2),(this.cols+this.rows)*(this.tileheight/2)),t}},{key:"pixelToTileCoords",value:function(e,t,n){return(n||new Vector2d).set(t/this.tileheight+(e-this.originX)/this.tilewidth,t/this.tileheight-(e-this.originX)/this.tilewidth)}},{key:"tileToPixelCoords",value:function(e,t,n){return(n||new Vector2d).set((e-t)*this.hTilewidth+this.originX,(e+t)*this.hTileheight)}},{key:"adjustPosition",value:function(e){var t=e.x/this.hTilewidth,n=e.y/this.tileheight,r=pool.pull("Vector2d");this.tileToPixelCoords(t,n,r),e.x=r.x,e.y=r.y,pool.push(r)}},{key:"drawTile",value:function(e,t,n,r){var i=r.tileset;i.drawTile(e,(this.cols-1)*i.tilewidth+(t-n)*i.tilewidth>>1,-i.tilewidth+(t+n)*i.tileheight>>2,r)}},{key:"drawTileLayer",value:function(e,t,n){var r=t.tileset,i=this.pixelToTileCoords(n.pos.x-r.tilewidth,n.pos.y-r.tileheight,pool.pull("Vector2d")).floorSelf(),o=this.pixelToTileCoords(n.pos.x+n.width+r.tilewidth,n.pos.y+n.height+r.tileheight,pool.pull("Vector2d")).ceilSelf(),a=this.tileToPixelCoords(o.x,o.y,pool.pull("Vector2d")),s=this.tileToPixelCoords(i.x,i.y,pool.pull("Vector2d"));s.x-=this.hTilewidth,s.y+=this.tileheight;var c=s.y-n.pos.y>this.hTileheight,u=n.pos.x-s.x<this.hTilewidth;c&&(u?(i.x--,s.x-=this.hTilewidth):(i.y--,s.x+=this.hTilewidth),s.y-=this.hTileheight);for(var l=c^u,h=i.clone(),d=2*s.y;d-2*this.tileheight<2*a.y;d+=this.tileheight){h.setV(i);for(var f=s.x;f<a.x;f+=this.tilewidth){var p=t.cellAt(h.x,h.y);if(p){var v=(r=p.tileset).tileoffset;r.drawTile(e,v.x+f,v.y+d/2-r.tileheight,p)}h.x++,h.y--}l?(i.y++,s.x-=this.hTilewidth,l=!1):(i.x++,s.x+=this.hTilewidth,l=!0)}pool.push(h),pool.push(i),pool.push(o),pool.push(a),pool.push(s)}}]),n}(TMXRenderer),offsetsStaggerX=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],offsetsStaggerY=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}],TMXHexagonalRenderer=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e.cols,e.rows,-2&e.tilewidth,-2&e.tileheight)).hexsidelength=e.hexsidelength||0,r.staggerX="x"===e.staggeraxis,r.staggerEven="even"===e.staggerindex,r.sidelengthx=0,r.sidelengthy=0,"hexagonal"===e.orientation&&(r.staggerX?r.sidelengthx=r.hexsidelength:r.sidelengthy=r.hexsidelength),r.sideoffsetx=(r.tilewidth-r.sidelengthx)/2,r.sideoffsety=(r.tileheight-r.sidelengthy)/2,r.columnwidth=r.sideoffsetx+r.sidelengthx,r.rowheight=r.sideoffsety+r.sidelengthy,r.centers=[new Vector2d,new Vector2d,new Vector2d,new Vector2d],r}return _createClass(n,[{key:"canRender",value:function(e){return"hexagonal"===e.orientation&&_get(_getPrototypeOf(n.prototype),"canRender",this).call(this,e)}},{key:"getBounds",value:function(e){var t=e instanceof TMXLayer?pool.pull("Bounds"):this.bounds;return this.staggerX?(t.setMinMax(0,0,this.cols*this.columnwidth+this.sideoffsetx,this.rows*(this.tileheight+this.sidelengthy)),t.width>1&&(t.height+=this.rowheight)):(t.setMinMax(0,0,this.cols*(this.tilewidth+this.sidelengthx),this.rows*this.rowheight+this.sideoffsety),t.height>1&&(t.width+=this.columnwidth)),t}},{key:"doStaggerX",value:function(e){return this.staggerX&&1&e^this.staggerEven}},{key:"doStaggerY",value:function(e){return!this.staggerX&&1&e^this.staggerEven}},{key:"topLeft",value:function(e,t,n){var r=n||new Vector2d;return this.staggerX?1&e^this.staggerEven?r.set(e-1,t):r.set(e-1,t-1):1&t^this.staggerEven?r.set(e,t-1):r.set(e-1,t-1),r}},{key:"topRight",value:function(e,t,n){var r=n||new Vector2d;return this.staggerX?1&e^this.staggerEven?r.set(e+1,t):r.set(e+1,t-1):1&t^this.staggerEven?r.set(e+1,t-1):r.set(e,t-1),r}},{key:"bottomLeft",value:function(e,t,n){var r=n||new Vector2d;return this.staggerX?1&e^this.staggerEven?r.set(e-1,t+1):r.set(e-1,t):1&t^this.staggerEven?r.set(e,t+1):r.set(e-1,t+1),r}},{key:"bottomRight",value:function(e,t,n){var r=n||new Vector2d;return this.staggerX?1&e^this.staggerEven?r.set(e+1,t+1):r.set(e+1,t):1&t^this.staggerEven?r.set(e+1,t+1):r.set(e,t+1),r}},{key:"pixelToTileCoords",value:function(e,t,n){var r=n||new Vector2d;this.staggerX?e-=this.staggerEven?this.tilewidth:this.sideoffsetx:t-=this.staggerEven?this.tileheight:this.sideoffsety;var i,o,a,s,c=pool.pull("Vector2d",Math.floor(e/(2*this.columnwidth)),Math.floor(t/(2*this.rowheight))),u=pool.pull("Vector2d",e-c.x*(2*this.columnwidth),t-c.y*(2*this.rowheight));this.staggerX?(c.x=2*c.x,this.staggerEven&&++c.x):(c.y=2*c.y,this.staggerEven&&++c.y),this.staggerX?(a=(i=this.sidelengthx/2)+this.columnwidth,s=this.tileheight/2,this.centers[0].set(i,s),this.centers[1].set(a,s-this.rowheight),this.centers[2].set(a,s+this.rowheight),this.centers[3].set(a+this.columnwidth,s)):(o=this.sidelengthy/2,a=this.tilewidth/2,s=o+this.rowheight,this.centers[0].set(a,o),this.centers[1].set(a-this.columnwidth,s),this.centers[2].set(a+this.columnwidth,s),this.centers[3].set(a,s+this.rowheight));for(var l=0,h=Number.MAX_VALUE,d=0;d<4;++d){var f=this.centers[d].sub(u).length2();f<h&&(h=f,l=d)}var p=this.staggerX?offsetsStaggerX:offsetsStaggerY;return r.set(c.x+p[l].x,c.y+p[l].y),pool.push(c),pool.push(u),r}},{key:"tileToPixelCoords",value:function(e,t,n){var r=Math.floor(e),i=Math.floor(t),o=n||new Vector2d;return this.staggerX?(o.y=i*(this.tileheight+this.sidelengthy),this.doStaggerX(r)&&(o.y+=this.rowheight),o.x=r*this.columnwidth):(o.x=r*(this.tilewidth+this.sidelengthx),this.doStaggerY(i)&&(o.x+=this.columnwidth),o.y=i*this.rowheight),o}},{key:"adjustPosition",value:function(e){"number"==typeof e.gid&&(e.y-=e.height)}},{key:"drawTile",value:function(e,t,n,r){var i=r.tileset,o=this.tileToPixelCoords(t,n,pool.pull("Vector2d"));i.drawTile(e,i.tileoffset.x+o.x,i.tileoffset.y+o.y+(this.tileheight-i.tileheight),r),pool.push(o)}},{key:"drawTileLayer",value:function(e,t,n){var r,i=this.pixelToTileCoords(n.pos.x,n.pos.y,pool.pull("Vector2d"));i.sub(t.pos);var o=this.tileToPixelCoords(i.x+t.pos.x,i.y+t.pos.y,pool.pull("Vector2d")),a=i.clone(),s=o.clone(),c=n.pos.y-o.y<this.sideoffsety,u=n.pos.x-o.x<this.sideoffsetx;c&&i.y--,u&&i.x--;var l=t.cols,h=t.rows;if(this.staggerX){i.x=Math.max(0,i.x),i.y=Math.max(0,i.y),o=this.tileToPixelCoords(i.x+t.pos.x,i.y+t.pos.y);for(var d=this.doStaggerX(i.x+t.pos.x);o.y<n.bottom&&i.y<h;){for(a.setV(i),s.setV(o);s.x<n.right&&a.x<l;a.x+=2)(r=t.cellAt(a.x,a.y,!1))&&r.tileset.drawTile(e,s.x,s.y,r),s.x+=this.tilewidth+this.sidelengthx;d?(i.x-=1,i.y+=1,o.x-=this.columnwidth,d=!1):(i.x+=1,o.x+=this.columnwidth,d=!0),o.y+=this.rowheight}pool.push(a),pool.push(s)}else{for(i.x=Math.max(0,i.x),i.y=Math.max(0,i.y),o=this.tileToPixelCoords(i.x+t.pos.x,i.y+t.pos.y),this.doStaggerY(i.y)&&(o.x-=this.columnwidth);o.y<n.bottom&&i.y<h;i.y++){for(a.setV(i),s.setV(o),this.doStaggerY(i.y)&&(s.x+=this.columnwidth);s.x<n.right&&a.x<l;a.x++)(r=t.cellAt(a.x,a.y,!1))&&r.tileset.drawTile(e,s.x,s.y,r),s.x+=this.tilewidth+this.sidelengthx;o.y+=this.rowheight}pool.push(a),pool.push(s)}pool.push(i),pool.push(o)}}]),n}(TMXRenderer),TMXStaggeredRenderer=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"canRender",value:function(e){return"staggered"===e.orientation&&_get(_getPrototypeOf(n.prototype),"canRender",this).call(this,e)}},{key:"pixelToTileCoords",value:function(e,t,n){var r=n||new Vector2d,i=e,o=t;this.staggerX?i-=this.staggerEven?this.sideoffsetx:0:o-=this.staggerEven?this.sideoffsety:0;var a=pool.pull("Vector2d",Math.floor(i/this.tilewidth),Math.floor(o/this.tileheight));this.staggerX?(a.x=2*a.x,this.staggerEven&&++a.x):(a.y=2*a.y,this.staggerEven&&++a.y);var s=pool.pull("Vector2d",i-a.x*this.tilewidth,o-a.y*this.tileheight),c=s.x*(this.tileheight/this.tilewidth);return this.sideoffsety-c>s.y&&(a=this.topLeft(a.x,a.y,a)),-this.sideoffsety+c>s.y&&(a=this.topRight(a.x,a.y,a)),this.sideoffsety+c<s.y&&(a=this.bottomLeft(a.x,a.y,a)),3*this.sideoffsety-c<s.y&&(a=this.bottomRight(a.x,a.y,a)),(r=this.tileToPixelCoords(a.x,a.y,r)).set(e-r.x,t-r.y),r.set(r.x-this.tilewidth/2,r.y*(this.tilewidth/this.tileheight)),r.div(this.tilewidth/Math.sqrt(2)).rotate(degToRad(-45)).add(a),pool.push(a),pool.push(s),r}}]),n}(TMXHexagonalRenderer),TMXTileset=function(){function e(t){_classCallCheck(this,e);var n=0;if(this.TileProperties=[],this.imageCollection=[],this.firstgid=this.lastgid=+t.firstgid,void 0!==t.source){var r=t.source,i=getExtension(r);if(("tsx"===i||"json"===i)&&!(t=loader.getTMX(getBasename(r))))throw new Error(r+" external TSX/JSON tileset not found")}this.name=t.name,this.tilewidth=+t.tilewidth,this.tileheight=+t.tileheight,this.spacing=+t.spacing||0,this.margin=+t.margin||0,this.tileoffset=new Vector2d,this.isAnimated=!1,this.isCollection=!1,this.animations=new Map,this._lastUpdate=0;var o=t.tiles;for(n in o)if(o.hasOwnProperty(n)){if("animation"in o[n]&&(this.isAnimated=!0,this.animations.set(o[+n].animation[0].tileid,{dt:0,idx:0,frames:o[+n].animation,cur:o[+n].animation[0]})),"properties"in o[n])if(Array.isArray(o[n].properties)){var a={};for(var s in o[n].properties)a[o[n].properties[s].name]=o[n].properties[s].value;this.setTileProperty(+o[n].id+this.firstgid,a)}else this.setTileProperty(+n+this.firstgid,o[n].properties);if("image"in o[n]){var c=loader.getImage(o[n].image);if(!c)throw new Error("melonJS: '"+o[n].image+"' file for tile '"+(+n+this.firstgid)+"' not found!");this.imageCollection[+n+this.firstgid]=c}}this.isCollection=this.imageCollection.length>0;var u=t.tileoffset;u&&(this.tileoffset.x=+u.x,this.tileoffset.y=+u.y);var l=t.tileproperties;if(l)for(n in l)l.hasOwnProperty(n)&&this.setTileProperty(+n+this.firstgid,l[n]);if(!1===this.isCollection){if(this.image=loader.getImage(t.image),!this.image)throw new Error("melonJS: '"+t.image+"' file for tileset '"+this.name+"' not found!");this.texture=renderer.cache.get(this.image,{framewidth:this.tilewidth,frameheight:this.tileheight,margin:this.margin,spacing:this.spacing}),this.atlas=this.texture.getAtlas();var h=+t.columns||Math.round(this.image.width/(this.tilewidth+this.spacing)),d=Math.round(this.image.height/(this.tileheight+this.spacing));t.tilecount%h>0&&++d,this.lastgid=this.firstgid+(h*d-1||0),t.tilecount&&this.lastgid-this.firstgid+1!=+t.tilecount&&console.warn("Computed tilecount ("+(this.lastgid-this.firstgid+1)+") does not match expected tilecount ("+t.tilecount+")")}}return _createClass(e,[{key:"getTileImage",value:function(e){return this.imageCollection[e]}},{key:"setTileProperty",value:function(e,t){this.TileProperties[e]=t}},{key:"contains",value:function(e){return e>=this.firstgid&&e<=this.lastgid}},{key:"getViewTileId",value:function(e){var t=e-this.firstgid;return this.animations.has(t)?this.animations.get(t).cur.tileid:t}},{key:"getTileProperties",value:function(e){return this.TileProperties[e]}},{key:"update",value:function(e){var t=0,n=timer$1.getTime(),r=!1;return this._lastUpdate!==n&&(this._lastUpdate=n,this.animations.forEach((function(n){for(n.dt+=e,t=n.cur.duration;n.dt>=t;)n.dt-=t,n.idx=(n.idx+1)%n.frames.length,n.cur=n.frames[n.idx],t=n.cur.duration,r=!0}))),r}},{key:"drawTile",value:function(e,t,n,r){if(r.flipped&&(e.save(),e.translate(t,n),e.transform(r.currentTransform),t=n=0),!0===this.isCollection)e.drawImage(this.imageCollection[r.tileId],0,0,r.width,r.height,t,n,r.width,r.height);else{var i=this.atlas[this.getViewTileId(r.tileId)].offset;e.drawImage(this.image,i.x,i.y,this.tilewidth,this.tileheight,t,n,this.tilewidth+e.uvOffset,this.tileheight+e.uvOffset)}r.flipped&&e.restore()}}]),e}(),TMX_CLEAR_BIT_MASK=536870911,TMXTilesetGroup=function(){function e(){_classCallCheck(this,e),this.tilesets=[],this.length=0}return _createClass(e,[{key:"add",value:function(e){this.tilesets.push(e),this.length++}},{key:"getTilesetByIndex",value:function(e){return this.tilesets[e]}},{key:"getTilesetByGid",value:function(e){var t=-1;e&=TMX_CLEAR_BIT_MASK;for(var n=0,r=this.tilesets.length;n<r;n++){if(this.tilesets[n].contains(e))return this.tilesets[n];this.tilesets[n].firstgid===this.tilesets[n].lastgid&&e>=this.tilesets[n].firstgid&&(t=n)}if(-1!==t)return this.tilesets[t];throw new Error("no matching tileset found for gid "+e)}}]),e}(),TMXObject=function(){function e(t,n,r){_classCallCheck(this,e),this.points=void 0,this.name=n.name,this.x=+n.x,this.y=+n.y,this.z=+r,this.width=+n.width||0,this.height=+n.height||0,this.gid=+n.gid||null,this.tintcolor=n.tintcolor,this.type=n.type,this.type=n.type,this.rotation=degToRad(+n.rotation||0),this.id=+n.id||void 0,this.orientation=t.orientation,this.shapes=void 0,this.isEllipse=!1,this.isPolygon=!1,this.isPolyLine=!1,"number"==typeof this.gid?this.setTile(t.tilesets):void 0!==n.ellipse?this.isEllipse=!0:void 0!==n.polygon?(this.points=n.polygon,this.isPolygon=!0):void 0!==n.polyline&&(this.points=n.polyline,this.isPolyLine=!0),void 0!==n.text?(this.text=n.text,this.text.font=n.text.fontfamily||"sans-serif",this.text.size=n.text.pixelsize||16,this.text.fillStyle=n.text.color||"#000000",this.text.textAlign=n.text.halign||"left",this.text.textBaseline=n.text.valign||"top",this.text.width=this.width,this.text.height=this.height,applyTMXProperties(this.text,n)):(applyTMXProperties(this,n),this.shapes||(this.shapes=this.parseTMXShapes())),t.isEditor||t.getRenderer().adjustPosition(this)}return _createClass(e,[{key:"setTile",value:function(e){var t=e.getTilesetByGid(this.gid);!1===t.isCollection&&(this.width=this.framewidth=t.tilewidth,this.height=this.frameheight=t.tileheight),this.tile=new Tile(this.x,this.y,this.gid,t)}},{key:"parseTMXShapes",value:function(){var e=0,t=[];if(!0===this.isEllipse)t.push(new Ellipse(this.width/2,this.height/2,this.width,this.height).rotate(this.rotation));else if(!0===this.isPolygon){var n=new Polygon(0,0,this.points);if(!1===n.isConvex())throw new Error("collision polygones in Tiled should be defined as Convex");t.push(n.rotate(this.rotation))}else if(!0===this.isPolyLine){var r,i,o=this.points,a=o.length-1;for(e=0;e<a;e++)r=new Vector2d(o[e].x,o[e].y),i=new Vector2d(o[e+1].x,o[e+1].y),0!==this.rotation&&(r=r.rotate(this.rotation),i=i.rotate(this.rotation)),t.push(new Line(0,0,[r,i]))}else t.push(new Polygon(0,0,[new Vector2d,new Vector2d(this.width,0),new Vector2d(this.width,this.height),new Vector2d(0,this.height)]).rotate(this.rotation));if("isometric"===this.orientation)for(e=0;e<t.length;e++)t[e].toIso();return t}},{key:"getObjectPropertyByName",value:function(e){return this[e]}}]),e}(),TMXGroup=function(){function e(t,n,r){var i=this;_classCallCheck(this,e),this.name=n.name,this.width=n.width||0,this.height=n.height||0,this.tintcolor=n.tintcolor,this.z=r,this.objects=[];var o=void 0===n.visible||n.visible;this.opacity=!0===o?_clamp(+n.opacity||1,0,1):0,applyTMXProperties(this,n),n.objects&&n.objects.forEach((function(e){e.tintcolor=i.tintcolor,i.objects.push(new TMXObject(t,e,r))})),n.layers&&n.layers.forEach((function(e){var n=new TMXLayer(t,e,t.tilewidth,t.tileheight,t.orientation,t.tilesets,r++);n.setRenderer(t.getRenderer()),i.width=Math.max(i.width,n.width),i.height=Math.max(i.height,n.height),i.objects.push(n)}))}return _createClass(e,[{key:"destroy",value:function(){this.objects=null}},{key:"getObjectCount",value:function(){return this.objects.length}},{key:"getObjectByIndex",value:function(e){return this.objects[e]}}]),e}(),COLLISION_GROUP="collision";function getNewDefaultRenderer(e){switch(e.orientation){case"orthogonal":return new TMXOrthogonalRenderer(e);case"isometric":return new TMXIsometricRenderer(e);case"hexagonal":return new TMXHexagonalRenderer(e);case"staggered":return new TMXStaggeredRenderer(e);default:throw new Error(e.orientation+" type TMX Tile Map not supported!")}}function readLayer(e,t,n){return new TMXLayer(e,t,e.tilewidth,e.tileheight,e.orientation,e.tilesets,n)}function readImageLayer(e,t,n){applyTMXProperties(t.properties,t);var r=pool.pull("ImageLayer",+t.offsetx||+t.x||0,+t.offsety||+t.y||0,Object.assign({name:t.name,image:t.image,ratio:pool.pull("Vector2d",+t.parallaxx||1,+t.parallaxy||1),tint:void 0!==t.tintcolor?pool.pull("Color").parseHex(t.tintcolor,!0):void 0,z:n},t.properties)),i=void 0===t.visible||t.visible;return r.setOpacity(i?+t.opacity:0),r}function readTileset(e){return new TMXTileset(e)}function readObjectGroup(e,t,n){return new TMXGroup(e,t,n)}var TMXTileMap=function(){function e(t,n){if(_classCallCheck(this,e),this.data=n,this.name=t,this.cols=+n.width,this.rows=+n.height,this.tilewidth=+n.tilewidth,this.tileheight=+n.tileheight,this.infinite=+n.infinite,this.orientation=n.orientation,this.renderorder=n.renderorder||"right-down",this.version=n.version,this.tiledversion=n.tiledversion,this.tilesets=null,void 0===this.layers&&(this.layers=[]),void 0===this.objectGroups&&(this.objectGroups=[]),this.isEditor="melon-editor"===n.editor,this.nextobjectid=+n.nextobjectid||void 0,this.hexsidelength=+n.hexsidelength,this.staggeraxis=n.staggeraxis,this.staggerindex=n.staggerindex,this.bounds=this.getRenderer().getBounds().clone(),this.width=this.bounds.width,this.height=this.bounds.height,this.backgroundcolor=n.backgroundcolor,applyTMXProperties(this,n),this.initialized=!1,1===this.infinite)throw new Error("Tiled Infinite Map not supported!")}return _createClass(e,[{key:"getRenderer",value:function(){return void 0!==this.renderer&&this.renderer.canRender(this)||(this.renderer=getNewDefaultRenderer(this)),this.renderer}},{key:"getBounds",value:function(){return this.bounds}},{key:"readMapObjects",value:function(e){var t=this;if(!0!==this.initialized){var n=0;this.tilesets||(this.tilesets=new TMXTilesetGroup),void 0!==e.tilesets&&e.tilesets.forEach((function(e){t.tilesets.add(readTileset(e))})),this.background_image&&this.layers.push(pool.pull("ImageLayer",0,0,{name:"background_image",image:this.background_image,z:n++})),e.layers.forEach((function(e){switch(e.type){case"imagelayer":t.layers.push(readImageLayer(t,e,n++));break;case"tilelayer":t.layers.push(readLayer(t,e,n++));break;case"objectgroup":case"group":t.objectGroups.push(readObjectGroup(t,e,n++))}})),this.initialized=!0}}},{key:"addTo",value:function(e,t,n){var r=e.autoSort,i=e.autoDepth,o=this.getBounds();function a(t,n){viewport.setBounds(0,0,Math.max(o.width,t),Math.max(o.height,n)),e.pos.set(Math.max(0,~~((t-o.width)/2)),Math.max(0,~~((n-o.height)/2)),e.pos.z)}e.autoSort=!1,e.autoDepth=!1,this.backgroundcolor&&e.backgroundColor.parseCSS(this.backgroundcolor),this.getLayers().forEach((function(t){e.addChild(t)})),this.getObjects(t).forEach((function(t){e.addChild(t)})),e.resize(this.bounds.width,this.bounds.height),e.sort(!0),!0===n&&(off(VIEWPORT_ONRESIZE,a),a(viewport.width,viewport.height),on(VIEWPORT_ONRESIZE,a,this)),e.autoSort=r,e.autoDepth=i}},{key:"getObjects",value:function(e){var t,n=[],r=!1;this.readMapObjects(this.data);for(var i=0;i<this.objectGroups.length;i++){var o=this.objectGroups[i];r=o.name.toLowerCase().includes(COLLISION_GROUP),!1===e&&((t=new Container(0,0,this.width,this.height)).anchorPoint.set(0,0),t.name=o.name,t.pos.z=o.z,t.setOpacity(o.opacity),t.autoSort=!1,t.autoDepth=!1);for(var a=0;a<o.objects.length;a++){var s,c=o.objects[a];void 0===c.anchorPoint&&(c.anchorPoint={x:0,y:0}),void 0!==c.tintcolor&&(c.tint=pool.pull("Color"),c.tint.parseHex(c.tintcolor,!0)),c instanceof TMXLayer?s=c:"object"===_typeof(c.text)?(void 0===c.text.anchorPoint&&(c.text.anchorPoint=c.anchorPoint),(s=!0===c.text.bitmap?pool.pull("BitmapText",c.x,c.y,c.text):pool.pull("Text",c.x,c.y,c.text)).pos.z=c.z):"object"===_typeof(c.tile)?((s=c.tile.getRenderable(c)).body=new Body(s,c.shapes||new Rect(0,0,this.width,this.height)),s.body.setStatic(!0),s.pos.setMuted(c.x,c.y,c.z)):(void 0!==c.name&&""!==c.name?s=pool.pull(c.name,c.x,c.y,c):((s=pool.pull("Renderable",c.x,c.y,c.width,c.height)).anchorPoint.set(0,0),s.name=c.name,s.type=c.type,s.id=c.id,s.body=new Body(s,c.shapes||new Rect(0,0,s.width,s.height)),s.body.setStatic(!0),s.resize(s.body.getBounds().width,s.body.getBounds().height)),s.pos.z=c.z),r&&!c.name&&s.body&&(s.body.collisionType=collision.types.WORLD_SHAPE,s.body.isStatic=!0),!1!==e?(!0===s.isRenderable&&(s.setOpacity(s.getOpacity()*o.opacity),s.renderable instanceof Renderable&&s.renderable.setOpacity(s.renderable.getOpacity()*o.opacity)),n.push(s)):t.addChild(s)}!1===e&&t.children.length>0&&(t.autoSort=!0,t.autoDepth=!0,n.push(t))}return n}},{key:"getLayers",value:function(){return this.readMapObjects(this.data),this.layers}},{key:"destroy",value:function(){this.tilesets=void 0,this.layers.length=0,this.objectGroups.length=0,this.initialized=!1}}]),e}(),levels={},levelIdx=[],currentLevelIdx=0;function safeLoadLevel(e,t,n){t.container.reset(),_reset(),levels[level.getCurrentLevelId()]&&levels[level.getCurrentLevelId()].destroy(),currentLevelIdx=levelIdx.indexOf(e),loadTMXLevel(e,t.container,t.flatten,t.setViewportBounds),emit(LEVEL_LOADED,e),t.onLoaded(e),n&&state.restart()}function loadTMXLevel(e,t,n,r){var i=levels[e];utils.resetGUID(e,i.nextobjectid),t.anchorPoint.set(0,0),i.addTo(t,n,r)}var level={add:function(e,t,n){if("tmx"===e)return null==levels[t]&&(levels[t]=new TMXTileMap(t,loader.getTMX(t)),levelIdx.push(t),n&&n(),!0);throw new Error("no level loader defined for format "+e)},load:function(e,t){if(t=Object.assign({container:world,onLoaded:onLevelLoaded,flatten:mergeGroup,setViewportBounds:!0},t||{}),void 0===levels[e])throw new Error("level "+e+" not found");if(!(levels[e]instanceof TMXTileMap))throw new Error("no level loader defined");return state.isRunning()?(state.stop(),utils.function.defer(safeLoadLevel,this,e,t,!0)):safeLoadLevel(e,t),!0},getCurrentLevelId:function(){return levelIdx[currentLevelIdx]},getCurrentLevel:function(){return levels[this.getCurrentLevelId()]},reload:function(e){return this.load(this.getCurrentLevelId(),e)},next:function(e){return currentLevelIdx+1<levelIdx.length&&this.load(levelIdx[currentLevelIdx+1],e)},previous:function(e){return currentLevelIdx-1>=0&&this.load(levelIdx[currentLevelIdx-1],e)},levelCount:function(){return levelIdx.length}},imgList={},tmxList={},binList={},jsonList={},baseURL={},resourceCount=0,loadCount=0,timerId$1=0;function checkLoadStatus(e){if(loadCount===resourceCount){if(!e&&!loader.onload)throw new Error("no load callback defined");clearTimeout(timerId$1);var t=e||loader.onload;setTimeout((function(){t(),emit(LOADER_COMPLETE)}),300)}else timerId$1=setTimeout((function(){checkLoadStatus(e)}),100)}function preloadImage(e,t,n){imgList[e.name]=new Image,imgList[e.name].onload=t,imgList[e.name].onerror=n,"string"==typeof loader.crossOrigin&&(imgList[e.name].crossOrigin=loader.crossOrigin),imgList[e.name].src=e.src+loader.nocache}function preloadFontFace(e,t,n){var r=new FontFace(e.name,e.src);r.load().then((function(){document.fonts.add(r),document.body.style.fontFamily=e.name,t()}),(function(){n(e.name)}))}function preloadTMX(e,t,n){function r(t){tmxList[e.name]=t,"tmx"===e.type&&level.add(e.type,e.name)}if(e.data)return r(e.data),void t();var i=new XMLHttpRequest,o=getExtension(e.src);i.overrideMimeType&&("json"===o?i.overrideMimeType("application/json"):i.overrideMimeType("text/xml")),i.open("GET",e.src+loader.nocache,!0),i.withCredentials=loader.withCredentials,i.ontimeout=n,i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status||0===i.status&&i.responseText){var a=null;switch(o){case"xml":case"tmx":case"tsx":if(device$1.ua.match(/msie/i)||!i.responseXML){if(!window.DOMParser)throw new Error("XML file format loading not supported, use the JSON file format instead");a=(new DOMParser).parseFromString(i.responseText,"text/xml")}else a=i.responseXML;var s=parse(a);switch(o){case"tmx":a=s.map;break;case"tsx":a=s.tilesets[0]}break;case"json":a=JSON.parse(i.responseText);break;default:throw new Error("TMX file format "+o+"not supported !")}r(a),t()}else n(e.name)},i.send()}function preloadJSON(e,t,n){var r=new XMLHttpRequest;r.overrideMimeType&&r.overrideMimeType("application/json"),r.open("GET",e.src+loader.nocache,!0),r.withCredentials=loader.withCredentials,r.ontimeout=n,r.onreadystatechange=function(){4===r.readyState&&(200===r.status||0===r.status&&r.responseText?(jsonList[e.name]=JSON.parse(r.responseText),t()):n(e.name))},r.send()}function preloadBinary(e,t,n){var r=new XMLHttpRequest;r.open("GET",e.src+loader.nocache,!0),r.withCredentials=loader.withCredentials,r.responseType="arraybuffer",r.onerror=n,r.onload=function(){var n=r.response;if(n){for(var i=new Uint8Array(n),o=[],a=0;a<i.byteLength;a++)o[a]=String.fromCharCode(i[a]);binList[e.name]=o.join(""),t()}},r.send()}function preloadJavascript(e,t,n){var r=document.createElement("script");r.src=e.src,r.type="text/javascript","string"==typeof loader.crossOrigin&&(r.crossOrigin=loader.crossOrigin),r.defer=!0,r.onload=function(){t()},r.onerror=function(){n(e.name)},document.getElementsByTagName("body")[0].appendChild(r)}var loader={nocache:"",onload:void 0,onProgress:void 0,crossOrigin:void 0,withCredentials:!1,onResourceLoaded:function(e){var t=++loadCount/resourceCount;this.onProgress&&this.onProgress(t,e),emit(LOADER_PROGRESS,t,e)},onLoadingError:function(e){throw new Error("Failed loading resource "+e.src)},setNocache:function(e){this.nocache=e?"?"+~~(1e7*Math.random()):""},setBaseURL:function(e,t){"*"!==e?baseURL[e]=t:(baseURL.audio=t,baseURL.binary=t,baseURL.image=t,baseURL.json=t,baseURL.js=t,baseURL.tmx=t,baseURL.tsx=t)},preload:function(e,t){for(var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=0;r<e.length;r++)resourceCount+=this.load(e[r],this.onResourceLoaded.bind(this,e[r]),this.onLoadingError.bind(this,e[r]));void 0!==t&&(this.onload=t),!0===n&&state.change(state.LOADING),checkLoadStatus(t)},load:function(e,t,n){switch(void 0!==baseURL[e.type]&&(e.src=baseURL[e.type]+e.src),e.type){case"binary":return preloadBinary.call(this,e,t,n),1;case"image":return preloadImage.call(this,e,t,n),1;case"json":return preloadJSON.call(this,e,t,n),1;case"js":return preloadJavascript.call(this,e,t,n),1;case"tmx":case"tsx":return preloadTMX.call(this,e,t,n),1;case"audio":return _load(e,!!e.stream,t,n),1;case"fontface":return preloadFontFace.call(this,e,t,n),1;default:throw new Error("load : unknown or invalid resource type : "+e.type)}},unload:function(e){switch(e.type){case"binary":return e.name in binList&&(delete binList[e.name],!0);case"image":return e.name in imgList&&(delete imgList[e.name],!0);case"json":return e.name in jsonList&&(delete jsonList[e.name],!0);case"js":case"fontface":return!0;case"tmx":case"tsx":return e.name in tmxList&&(delete tmxList[e.name],!0);case"audio":return _unload(e.name);default:throw new Error("unload : unknown or invalid resource type : "+e.type)}},unloadAll:function(){var e;for(e in binList)binList.hasOwnProperty(e)&&this.unload({name:e,type:"binary"});for(e in imgList)imgList.hasOwnProperty(e)&&this.unload({name:e,type:"image"});for(e in tmxList)tmxList.hasOwnProperty(e)&&this.unload({name:e,type:"tmx"});for(e in jsonList)jsonList.hasOwnProperty(e)&&this.unload({name:e,type:"json"});_unloadAll()},getTMX:function(e){return(e=""+e)in tmxList?tmxList[e]:null},getBinary:function(e){return(e=""+e)in binList?binList[e]:null},getImage:function(e){return(e=getBasename(""+e))in imgList?imgList[e]:null},getJSON:function(e){return(e=""+e)in jsonList?jsonList[e]:null}},audioTracks={},current_track_id=null,retry_counter=0,audioExts=[],soundLoadError=function(e,t){if(retry_counter++>3)throw new Error("melonJS: failed loading "+e);audioTracks[e].load()},stopOnAudioError=!0;function init$1(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mp3";return audioExts=e.split(","),!howler.Howler.noAudio}function hasFormat(e){return hasAudio()&&howler.Howler.codecs(e)}function hasAudio(){return!howler.Howler.noAudio}function enable(){unmuteAll()}function disable(){muteAll()}function _load(e,t,n,r){var i=[];if(0===audioExts.length)throw new Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.");for(var o=0;o<audioExts.length;o++)i.push(e.src+e.name+"."+audioExts[o]+loader.nocache);return audioTracks[e.name]=new howler.Howl({src:i,volume:howler.Howler.volume(),html5:!0===t,xhrWithCredentials:loader.withCredentials,onloaderror:function(){soundLoadError.call(this,e.name,r)},onload:function(){retry_counter=0,n&&n()}}),1}function play(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=audioTracks[e];if(i&&void 0!==i){var o=i.play();return"boolean"==typeof t&&i.loop(t,o),i.volume("number"==typeof r?_clamp(r,0,1):howler.Howler.volume(),o),"function"==typeof n&&(!0===t?i.on("end",n,o):i.once("end",n,o)),o}throw new Error("audio clip "+e+" does not exist")}function fade(e,t,n,r,i){var o=audioTracks[e];if(!o||void 0===o)throw new Error("audio clip "+e+" does not exist");o.fade(t,n,r,i)}function seek(e){var t=audioTracks[e];if(t&&void 0!==t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.seek.apply(t,r)}throw new Error("audio clip "+e+" does not exist")}function rate(e){var t=audioTracks[e];if(t&&void 0!==t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.rate.apply(t,r)}throw new Error("audio clip "+e+" does not exist")}function stop(e,t){if(void 0!==e){var n=audioTracks[e];if(!n||void 0===n)throw new Error("audio clip "+e+" does not exist");n.stop(t),n.off("end",void 0,t)}else howler.Howler.stop()}function pause(e,t){var n=audioTracks[e];if(!n||void 0===n)throw new Error("audio clip "+e+" does not exist");n.pause(t)}function resume(e,t){var n=audioTracks[e];if(!n||void 0===n)throw new Error("audio clip "+e+" does not exist");n.play(t)}function playTrack(e,t){return play(current_track_id=e,!0,null,t)}function stopTrack(){null!==current_track_id&&(audioTracks[current_track_id].stop(),current_track_id=null)}function pauseTrack(){null!==current_track_id&&audioTracks[current_track_id].pause()}function resumeTrack(){null!==current_track_id&&audioTracks[current_track_id].play()}function getCurrentTrack(){return current_track_id}function setVolume(e){howler.Howler.volume(e)}function getVolume(){return howler.Howler.volume()}function mute(e,t,n){n=void 0===n||!!n;var r=audioTracks[e];if(!r||void 0===r)throw new Error("audio clip "+e+" does not exist");r.mute(n,t)}function unmute(e,t){mute(e,t,!1)}function muteAll(){howler.Howler.mute(!0)}function unmuteAll(){howler.Howler.mute(!1)}function muted(){return howler.Howler._muted}function _unload(e){return e in audioTracks&&(audioTracks[e].unload(),delete audioTracks[e],!0)}function _unloadAll(){for(var e in audioTracks)audioTracks.hasOwnProperty(e)&&_unload(e)}var audio=Object.freeze({__proto__:null,stopOnAudioError,init:init$1,hasFormat,hasAudio,enable,disable,load:_load,play,fade,seek,rate,stop,pause,resume,playTrack,stopTrack,pauseTrack,resumeTrack,getCurrentTrack,setVolume,getVolume,mute,unmute,muteAll,unmuteAll,muted,unload:_unload,unloadAll:_unloadAll}),data={};function isReserved(e){return"add"===e||"remove"===e}on(BOOT,(function(){if(!0===device$1.localStorage){var e=localStorage.getItem("me.save");"string"==typeof e&&e.length>0&&(JSON.parse(e)||[]).forEach((function(e){data[e]=JSON.parse(localStorage.getItem("me.save."+e))}))}}));var save={add:function(e){var t=save;Object.keys(e).forEach((function(n){var r;isReserved(n)||(r=n,Object.defineProperty(t,r,{configurable:!0,enumerable:!0,get:function(){return data[r]},set:function(e){data[r]=e,!0===device$1.localStorage&&localStorage.setItem("me.save."+r,JSON.stringify(e))}}),n in data||(t[n]=e[n]))})),!0===device$1.localStorage&&localStorage.setItem("me.save",JSON.stringify(Object.keys(data)))},remove:function(e){isReserved(e)||void 0!==data[e]&&(delete data[e],!0===device$1.localStorage&&(localStorage.removeItem("me.save."+e),localStorage.setItem("me.save",JSON.stringify(Object.keys(data)))))}},accelInitialized=!1,deviceOrientationInitialized=!1,swipeEnabled=!0;function _disableSwipeFn(e){return e.preventDefault(),"function"==typeof window.scroll&&window.scroll(0,0),!1}var readyBound=!1,isReady=!1,readyList=[];function _domReady(){if(!isReady){if(!document.body)return setTimeout(_domReady,13);for(document.removeEventListener&&document.removeEventListener("DOMContentLoaded",this._domReady,!1),window.removeEventListener("load",_domReady,!1);readyList.length;)readyList.shift().call(window,[]);isReady=!0}}var _domRect={left:0,top:0,x:0,y:0,width:0,height:0,right:0,bottom:0};function _detectDevice(){device.iOS=/iPhone|iPad|iPod/i.test(device.ua),device.android=/Android/i.test(device.ua),device.android2=/Android 2/i.test(device.ua),device.linux=/Linux/i.test(device.ua),device.chromeOS=/CrOS/.test(device.ua),device.wp=/Windows Phone/i.test(device.ua),device.BlackBerry=/BlackBerry/i.test(device.ua),device.Kindle=/Kindle|Silk.*Mobile Safari/i.test(device.ua),device.isMobile=/Mobi/i.test(device.ua)||device.iOS||device.android||device.wp||device.BlackBerry||device.Kindle||!1,device.ejecta=void 0!==window.ejecta,device.isWeixin=/MicroMessenger/i.test(device.ua)}function _checkCapabilities(){_detectDevice(),device.isMobile&&device.enableSwipe(!1),device.TouchEvent=!!("ontouchstart"in window),device.PointerEvent=!!window.PointerEvent,window.gesture=prefixed("gesture"),device.touch=device.TouchEvent||device.PointerEvent,device.maxTouchPoints=device.touch?device.PointerEvent?navigator.maxTouchPoints||1:10:1,device.wheel="onwheel"in document.createElement("div"),device.hasPointerLockSupport=void 0!==document.pointerLockElement,device.hasDeviceOrientation=!!window.DeviceOrientationEvent,device.hasAccelerometer=!!window.DeviceMotionEvent,device.ScreenOrientation="undefined"!=typeof screen&&void 0!==screen.orientation,device.hasFullscreenSupport=prefixed("fullscreenEnabled",document)||document.mozFullScreenEnabled,document.exitFullscreen=prefixed("cancelFullScreen",document)||prefixed("exitFullscreen",document),navigator.vibrate=prefixed("vibrate",navigator),device.hasWebAudio=!(!window.AudioContext&&!window.webkitAudioContext);try{device.localStorage=!!window.localStorage}catch(e){device.localStorage=!1}try{device.OffscreenCanvas=void 0!==window.OffscreenCanvas&&null!==new OffscreenCanvas(0,0).getContext("2d")}catch(e){device.OffscreenCanvas=!1}var e,t;window.addEventListener("blur",(function(){device.stopOnBlur&&state.stop(!0),device.pauseOnBlur&&state.pause(!0)}),!1),window.addEventListener("focus",(function(){device.stopOnBlur&&state.restart(!0),device.resumeOnFocus&&state.resume(!0),device.autoFocus&&device.focus()}),!1),void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),"string"==typeof t&&document.addEventListener(t,(function(){document[e]?(device.stopOnBlur&&state.stop(!0),device.pauseOnBlur&&state.pause(!0)):(device.stopOnBlur&&state.restart(!0),device.resumeOnFocus&&state.resume(!0))}),!1)}on(BOOT,(function(){_checkCapabilities()}));var device={ua:navigator.userAgent,localStorage:!1,hasAccelerometer:!1,hasDeviceOrientation:!1,ScreenOrientation:!1,hasFullscreenSupport:!1,hasPointerLockSupport:!1,hasWebAudio:!1,nativeBase64:"function"==typeof window.atob,maxTouchPoints:1,touch:!1,wheel:!1,isMobile:!1,iOS:!1,android:!1,android2:!1,linux:!1,ejecta:!1,isWeixin:!1,chromeOS:!1,wp:!1,BlackBerry:!1,Kindle:!1,accelerationX:0,accelerationY:0,accelerationZ:0,gamma:0,beta:0,alpha:0,language:navigator.language||navigator.browserLanguage||navigator.userLanguage||"en",pauseOnBlur:!0,resumeOnFocus:!0,autoFocus:!0,stopOnBlur:!1,OffscreenCanvas:!1,onReady:function(e){isReady?e.call(window,[]):(readyList.push(e),readyBound||("complete"===document.readyState?window.setTimeout(_domReady,0):(document.addEventListener&&document.addEventListener("DOMContentLoaded",_domReady,!1),window.addEventListener("load",_domReady,!1)),readyBound=!0))},enableSwipe:function(e){!1!==e?!1===swipeEnabled&&(window.document.removeEventListener("touchmove",_disableSwipeFn,!1),swipeEnabled=!0):!0===swipeEnabled&&(window.document.addEventListener("touchmove",_disableSwipeFn,!1),swipeEnabled=!1)},requestFullscreen:function(e){this.hasFullscreenSupport&&((e=e||getParent()).requestFullscreen=prefixed("requestFullscreen",e)||e.mozRequestFullScreen,e.requestFullscreen())},exitFullscreen:function(){this.hasFullscreenSupport&&document.exitFullscreen()},getScreenOrientation:function(){var e="portrait",t="landscape",n=window.screen;if(!0===this.ScreenOrientation){var r=prefixed("orientation",n);if(void 0!==r&&"string"==typeof r.type)return r.type;if("string"==typeof r)return r}return"number"==typeof window.orientation?90===Math.abs(window.orientation)?t:e:window.outerWidth>window.outerHeight?t:e},lockOrientation:function(e){var t=window.screen;if(void 0!==t){var n=prefixed("lockOrientation",t);if(void 0!==n)return n(e)}return!1},unlockOrientation:function(){var e=window.screen;if(void 0!==e){var t=prefixed("unlockOrientation",e);if(void 0!==t)return t()}return!1},isPortrait:function(){return this.getScreenOrientation().includes("portrait")},isLandscape:function(){return this.getScreenOrientation().includes("landscape")},getStorage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"local";if("local"===e)return save;throw new Error("storage type "+e+" not supported")},getParentElement:function(e){var t=this.getElement(e);return null!==t.parentNode&&(t=t.parentNode),t},getElement:function(e){var t=null;return"undefined"!==e&&("string"==typeof e?t=document.getElementById(e):"object"===_typeof(e)&&e.nodeType===Node.ELEMENT_NODE&&(t=e)),t||(t=document.body),t},getElementBounds:function(e){return"object"===_typeof(e)&&e!==document.body&&void 0!==e.getBoundingClientRect?e.getBoundingClientRect():(_domRect.width=_domRect.right=window.innerWidth,_domRect.height=_domRect.bottom=window.innerHeight,_domRect)},getParentBounds:function(e){return this.getElementBounds(this.getParentElement(e))},isWebGLSupported:function(e){var t=!1;try{var n=document.createElement("canvas"),r={stencil:!0,failIfMajorPerformanceCaveat:e.failIfMajorPerformanceCaveat};t=!(!window.WebGLRenderingContext||!n.getContext("webgl",r)&&!n.getContext("experimental-webgl",r))}catch(e){t=!1}return t},getMaxShaderPrecision:function(e){return e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0?"highp":e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"},focus:function(){"function"==typeof window.focus&&window.focus()},onDeviceMotion:function(e){this.accelerationX=e.accelerationIncludingGravity.x,this.accelerationY=e.accelerationIncludingGravity.y,this.accelerationZ=e.accelerationIncludingGravity.z},onDeviceRotate:function(e){this.gamma=e.gamma,this.beta=e.beta,this.alpha=e.alpha},watchAccelerometer:function(){var e=this;return this.hasAccelerometer&&!accelInitialized&&(DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"===t&&(window.addEventListener("devicemotion",e.onDeviceMotion,!1),accelInitialized=!0)})).catch(console.error):(window.addEventListener("devicemotion",this.onDeviceMotion,!1),accelInitialized=!0)),accelInitialized},unwatchAccelerometer:function(){accelInitialized&&(window.removeEventListener("devicemotion",this.onDeviceMotion,!1),accelInitialized=!1)},watchDeviceOrientation:function(){var e=this;return this.hasDeviceOrientation&&!deviceOrientationInitialized&&("function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"===t&&(window.addEventListener("deviceorientation",e.onDeviceRotate,!1),deviceOrientationInitialized=!0)})).catch(console.error):(window.addEventListener("deviceorientation",this.onDeviceRotate,!1),deviceOrientationInitialized=!0)),deviceOrientationInitialized},unwatchDeviceOrientation:function(){deviceOrientationInitialized&&(window.removeEventListener("deviceorientation",this.onDeviceRotate,!1),deviceOrientationInitialized=!1)},vibrate:function(e){navigator.vibrate&&navigator.vibrate(e)}};Object.defineProperty(device,"devicePixelRatio",{get:function(){return window.devicePixelRatio||1}}),Object.defineProperty(device,"isFullscreen",{get:function(){return!(!this.hasFullscreenSupport||!prefixed("fullscreenElement",document)&&!document.mozFullScreenElement)}}),Object.defineProperty(device,"sound",{get:function(){return hasAudio()}});var device$1=device;function extractUniforms(e,t){var n,r={},i=/uniform\s+(\w+)\s+(\w+)/g,o={},a={},s={};return[t.vertex,t.fragment].forEach((function(e){for(;n=i.exec(e);)o[n[2]]=n[1]})),Object.keys(o).forEach((function(n){var r=o[n];s[n]=e.getUniformLocation(t.program,n),a[n]={get:function(e){return function(){return s[e]}}(n),set:function(t,n,r){return 0===n.indexOf("mat")?function(n){e[r](s[t],!1,n)}:function(n){var i=r;n.length&&"v"!==r.substr(-1)&&(i+="v"),e[i](s[t],n)}}(n,r,"uniform"+fnHash[r])}})),Object.defineProperties(r,a),r}function extractAttributes(e,t){for(var n,r={},i=/attribute\s+\w+\s+(\w+)/g,o=0;n=i.exec(t.vertex);)r[n[1]]=o++;return r}function compileShader(e,t,n){var r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(r));return r}function compileProgram(e,t,n,r){var i=compileShader(e,e.VERTEX_SHADER,t),o=compileShader(e,e.FRAGMENT_SHADER,n),a=e.createProgram();for(var s in e.attachShader(a,i),e.attachShader(a,o),r)e.bindAttribLocation(a,r[s],s);if(e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){var c="Error initializing Shader "+this+"\ngl.VALIDATE_STATUS: "+e.getProgramParameter(a,e.VALIDATE_STATUS)+"\ngl.getError()"+e.getError()+"\ngl.getProgramInfoLog()"+e.getProgramInfoLog(a);throw e.deleteProgram(a),a=null,new Error(c)}return e.useProgram(a),e.deleteShader(i),e.deleteShader(o),a}var fnHash={bool:"1i",int:"1i",float:"1f",vec2:"2fv",vec3:"3fv",vec4:"4fv",bvec2:"2iv",bvec3:"3iv",bvec4:"4iv",ivec2:"2iv",ivec3:"3iv",ivec4:"4iv",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler2D:"1i"};function setPrecision(e,t){return"precision"!==e.substring(0,9)?"precision "+t+" float;"+e:e}function minify(e){return(e=(e=(e=e.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1")).replace(/(\\n\s+)|(\s+\\n)/g,"")).replace(/(\\r|\\n)+/g,"")).replace(/\s*([;,[\](){}\\\/\-+*|^&!=<>?~%])\s*/g,"$1")}var GLShader=function(){function e(t,n,r,i){return _classCallCheck(this,e),this.gl=t,this.vertex=setPrecision(minify(n),i||device$1.getMaxShaderPrecision(this.gl)),this.fragment=setPrecision(minify(r),i||device$1.getMaxShaderPrecision(this.gl)),this.attributes=extractAttributes(this.gl,this),this.program=compileProgram(this.gl,this.vertex,this.fragment,this.attributes),this.uniforms=extractUniforms(this.gl,this),on(WEBGL_ONCONTEXT_LOST,this.destroy,this),this}return _createClass(e,[{key:"bind",value:function(){this.gl.useProgram(this.program)}},{key:"getAttribLocation",value:function(e){var t=this.attributes[e];return void 0!==t?t:-1}},{key:"setUniform",value:function(e,t){var n=this.uniforms;if(void 0===n[e])throw new Error("undefined ("+e+") uniform for shader "+this);"object"===_typeof(t)&&"function"==typeof t.toArray?n[e]=t.toArray():n[e]=t}},{key:"destroy",value:function(){this.uniforms=null,this.attributes=null,this.gl.deleteProgram(this.program),this.vertex=null,this.fragment=null}}]),e}(),VertexArrayBuffer=function(){function e(t,n){return _classCallCheck(this,e),this.vertexSize=t,this.quadSize=n,this.maxVertex=256,this.vertexCount=0,this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.quadSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer),this}return _createClass(e,[{key:"clear",value:function(){this.vertexCount=0}},{key:"isFull",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.quadSize;return this.vertexCount+e>=this.maxVertex}},{key:"resize",value:function(){this.maxVertex<<=1;var e=this.bufferF32;return this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.quadSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer),this.bufferF32.set(e),this}},{key:"push",value:function(e,t,n,r,i){var o=this.vertexCount*this.vertexSize;return this.vertexCount>=this.maxVertex&&this.resize(),this.bufferF32[o+0]=e,this.bufferF32[o+1]=t,void 0!==n&&(this.bufferF32[o+2]=n,this.bufferF32[o+3]=r),void 0!==i&&(this.bufferU32[o+4]=i),this.vertexCount++,this}},{key:"toFloat32",value:function(e,t){return void 0!==t?this.bufferF32.subarray(e,t):this.bufferF32}},{key:"toUint32",value:function(e,t){return void 0!==t?this.bufferU32.subarray(e,t):this.bufferU32}},{key:"length",value:function(){return this.vertexCount}},{key:"isEmpty",value:function(){return 0===this.vertexCount}}]),e}(),primitiveVertex="// Current vertex point\nattribute vec2 aVertex;\n\n// Projection matrix\nuniform mat4 uProjectionMatrix;\n\n// Vertex color\nuniform vec4 uColor;\n\n// Fragment color\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(uColor.rgb * uColor.a, uColor.a);\n}\n",primitiveFragment="varying vec4 vColor;\n\nvoid main(void) {\n    gl_FragColor = vColor;\n}\n",quadVertex="attribute vec2 aVertex;\nattribute vec2 aRegion;\nattribute vec4 aColor;\n\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vRegion;\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n     gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(aColor.bgr * aColor.a, aColor.a);\n    vRegion = aRegion;\n}\n",quadFragment="uniform sampler2D uSampler;\nvarying vec4 vColor;\nvarying vec2 vRegion;\n\nvoid main(void) {\n    gl_FragColor = texture2D(uSampler, vRegion) * vColor;\n}\n",V_ARRAY=[new Vector2d,new Vector2d,new Vector2d,new Vector2d],WebGLCompositor=function(){function e(t){_classCallCheck(this,e),this.init(t)}return _createClass(e,[{key:"init",value:function(e){var t=this,n=e.gl;this.currentTextureUnit=-1,this.boundTextures=[],this.renderer=e,this.gl=e.gl,this.color=e.currentColor,this.viewMatrix=e.currentTransform,this.activeShader=null,this.mode=n.TRIANGLES,this.attributes=[],this.vertexByteSize=0,this.vertexSize=0,this.primitiveShader=new GLShader(this.gl,primitiveVertex,primitiveFragment),this.quadShader=new GLShader(this.gl,quadVertex,quadFragment),this.addAttribute("aVertex",2,n.FLOAT,!1,0*Float32Array.BYTES_PER_ELEMENT),this.addAttribute("aRegion",2,n.FLOAT,!1,2*Float32Array.BYTES_PER_ELEMENT),this.addAttribute("aColor",4,n.UNSIGNED_BYTE,!0,4*Float32Array.BYTES_PER_ELEMENT),this.vertexBuffer=new VertexArrayBuffer(this.vertexSize,6),n.bindBuffer(n.ARRAY_BUFFER,n.createBuffer()),n.bufferData(n.ARRAY_BUFFER,this.vertexBuffer.buffer,n.STREAM_DRAW),on(CANVAS_ONRESIZE,(function(e,n){t.flush(),t.setViewport(0,0,e,n)}))}},{key:"reset",value:function(){this.gl=this.renderer.gl,this.flush(),this.setViewport(0,0,this.renderer.getScreenCanvas().width,this.renderer.getScreenCanvas().height),this.clearColor(0,0,0,0);for(var e=0;e<this.renderer.maxTextures;e++){var t=this.getTexture2D(e);void 0!==t&&this.deleteTexture2D(t)}this.currentTextureUnit=-1,this.useShader(this.quadShader)}},{key:"addAttribute",value:function(e,t,n,r,i){switch(this.attributes.push({name:e,size:t,type:n,normalized:r,offset:i}),n){case this.gl.BYTE:this.vertexByteSize+=t*Int8Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_BYTE:this.vertexByteSize+=t*Uint8Array.BYTES_PER_ELEMENT;break;case this.gl.SHORT:this.vertexByteSize+=t*Int16Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_SHORT:this.vertexByteSize+=t*Uint16Array.BYTES_PER_ELEMENT;break;case this.gl.INT:this.vertexByteSize+=t*Int32Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_INT:this.vertexByteSize+=t*Uint32Array.BYTES_PER_ELEMENT;break;case this.gl.FLOAT:this.vertexByteSize+=t*Float32Array.BYTES_PER_ELEMENT;break;default:throw new Error("Invalid GL Attribute type")}this.vertexSize=this.vertexByteSize/Float32Array.BYTES_PER_ELEMENT}},{key:"setViewport",value:function(e,t,n,r){this.gl.viewport(e,t,n,r)}},{key:"createTexture2D",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"no-repeat",i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],u=this.gl,l=isPowerOfTwo(i||t.width)&&isPowerOfTwo(o||t.height),h=u.createTexture(),d=0===r.search(/^repeat(-x)?$/)&&(l||this.renderer.WebGLVersion>1)?u.REPEAT:u.CLAMP_TO_EDGE,f=0===r.search(/^repeat(-y)?$/)&&(l||this.renderer.WebGLVersion>1)?u.REPEAT:u.CLAMP_TO_EDGE;return this.bindTexture2D(h,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,d),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,f),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,n),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),i||o||a?u.texImage2D(u.TEXTURE_2D,0,u.RGBA,i,o,a,u.RGBA,u.UNSIGNED_BYTE,t):u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,t),l&&!1!==c&&u.generateMipmap(u.TEXTURE_2D),h}},{key:"deleteTexture2D",value:function(e){this.gl.deleteTexture(e),this.unbindTexture2D(e)}},{key:"getTexture2D",value:function(e){return this.boundTextures[e]}},{key:"bindTexture2D",value:function(e,t){var n=this.gl;e!==this.boundTextures[t]?(this.flush(),this.currentTextureUnit!==t&&(this.currentTextureUnit=t,n.activeTexture(n.TEXTURE0+t)),n.bindTexture(n.TEXTURE_2D,e),this.boundTextures[t]=e):this.currentTextureUnit!==t&&(this.flush(),this.currentTextureUnit=t,n.activeTexture(n.TEXTURE0+t))}},{key:"unbindTexture2D",value:function(e,t){return void 0===t&&(t=this.boundTextures.indexOf(e)),-1!==t&&(delete this.boundTextures[t],t===this.currentTextureUnit&&(this.currentTextureUnit=-1)),t}},{key:"uploadTexture",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.renderer.cache.getUnit(e),a=this.boundTextures[o];return void 0===a||i?this.createTexture2D(o,e.getTexture(),this.renderer.settings.antiAlias?this.gl.LINEAR:this.gl.NEAREST,e.repeat,t,n,r,e.premultipliedAlpha):this.bindTexture2D(a,o),this.currentTextureUnit}},{key:"setProjection",value:function(e){this.activeShader.setUniform("uProjectionMatrix",e)}},{key:"useShader",value:function(e){if(this.activeShader!==e){this.flush(),this.activeShader=e,this.activeShader.bind(),this.activeShader.setUniform("uProjectionMatrix",this.renderer.projectionMatrix);for(var t=0;t<this.attributes.length;++t){var n=this.gl,r=this.attributes[t],i=this.activeShader.getAttribLocation(r.name);-1!==i?(n.enableVertexAttribArray(i),n.vertexAttribPointer(i,r.size,r.type,r.normalized,this.vertexByteSize,r.offset)):n.disableVertexAttribArray(t)}}}},{key:"addQuad",value:function(e,t,n,r,i,o,a,s,c,u){if(!(this.color.alpha<1/255)){this.useShader(this.quadShader),this.vertexBuffer.isFull(6)&&this.flush();var l=this.uploadTexture(e);this.quadShader.setUniform("uSampler",l);var h=this.viewMatrix,d=V_ARRAY[0].set(t,n),f=V_ARRAY[1].set(t+r,n),p=V_ARRAY[2].set(t,n+i),v=V_ARRAY[3].set(t+r,n+i);h.isIdentity()||(h.apply(d),h.apply(f),h.apply(p),h.apply(v)),this.vertexBuffer.push(d.x,d.y,o,a,u),this.vertexBuffer.push(f.x,f.y,s,a,u),this.vertexBuffer.push(p.x,p.y,o,c,u),this.vertexBuffer.push(p.x,p.y,o,c,u),this.vertexBuffer.push(f.x,f.y,s,a,u),this.vertexBuffer.push(v.x,v.y,s,c,u)}}},{key:"flush",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mode,t=this.vertexBuffer,n=t.vertexCount;if(n>0){var r=this.gl,i=t.vertexSize;this.renderer.WebGLVersion>1?r.bufferData(r.ARRAY_BUFFER,t.toFloat32(),r.STREAM_DRAW,0,n*i):r.bufferData(r.ARRAY_BUFFER,t.toFloat32(0,n*i),r.STREAM_DRAW),r.drawArrays(e,0,n),t.clear()}}},{key:"drawVertices",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length;this.useShader(this.primitiveShader),this.primitiveShader.setUniform("uColor",this.color);for(var r=this.viewMatrix,i=this.vertexBuffer,o=r.isIdentity(),a=0;a<n;a++)o||r.apply(t[a]),i.push(t[a].x,t[a].y);this.flush(e)}},{key:"clearColor",value:function(e,t,n,r){this.gl.clearColor(e,t,n,r)}},{key:"clear",value:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}]),e}(),WebGLRenderer=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;_classCallCheck(this,n),(r=t.call(this,e)).WebGLVersion=1,r.GPUVendor=null,r.GPURenderer=null,r.context=r.gl=r.getContextGL(r.getScreenCanvas(),e.transparent),r.maxTextures=r.gl.getParameter(r.gl.MAX_TEXTURE_IMAGE_UNITS),r._colorStack=[],r._matrixStack=[],r._scissorStack=[],r._glPoints=[new Vector2d,new Vector2d,new Vector2d,new Vector2d],r.currentTransform=new Matrix2d,r.currentCompositor=null,r.compositors=new Map;var i=new(r.settings.compositor||WebGLCompositor)(_assertThisInitialized(r));r.compositors.set("default",i),r.setCompositor(i),r.gl.disable(r.gl.DEPTH_TEST),r.gl.disable(r.gl.SCISSOR_TEST),r.gl.enable(r.gl.BLEND),r.setBlendMode(r.settings.blendMode);var o=r.gl.getExtension("WEBGL_debug_renderer_info");return null!==o&&(r.GPUVendor=r.gl.getParameter(o.UNMASKED_VENDOR_WEBGL),r.GPURenderer=r.gl.getParameter(o.UNMASKED_RENDERER_WEBGL)),r.cache=new TextureCache(r.maxTextures),r.getScreenCanvas().addEventListener("webglcontextlost",(function(e){e.preventDefault(),r.isContextValid=!1,emit(WEBGL_ONCONTEXT_LOST,_assertThisInitialized(r))}),!1),r.getScreenCanvas().addEventListener("webglcontextrestored",(function(){r.reset(),r.isContextValid=!0,emit(WEBGL_ONCONTEXT_RESTORED,_assertThisInitialized(r))}),!1),_possibleConstructorReturn(r,_assertThisInitialized(r))}return _createClass(n,[{key:"reset",value:function(){var e=this;_get(_getPrototypeOf(n.prototype),"reset",this).call(this),this.compositors.forEach((function(t){!1===e.isContextValid?t.init(e):t.reset()})),this.gl.disable(this.gl.SCISSOR_TEST),void 0!==this.fontContext2D&&this.createFontTexture(this.cache)}},{key:"setCompositor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";if("string"==typeof e&&(e=this.compositors.get(e)),void 0===e)throw new Error("Invalid WebGL Compositor");this.currentCompositor!==e&&(null!==this.currentCompositor&&this.currentCompositor.flush(),this.currentCompositor=e)}},{key:"resetTransform",value:function(){this.currentTransform.identity()}},{key:"createFontTexture",value:function(e){if(void 0===this.fontTexture){var t=this.backBufferCanvas,n=t.width,r=t.height;1===this.WebGLVersion&&(isPowerOfTwo(n)||(n=nextPowerOfTwo(t.width)),isPowerOfTwo(r)||(r=nextPowerOfTwo(t.height)));var i=createCanvas(n,r,!0);this.fontContext2D=this.getContext2d(i),this.fontTexture=new TextureAtlas(createAtlas(t.width,t.height,"fontTexture"),i,e),this.currentCompositor.uploadTexture(this.fontTexture,0,0,0)}else e.set(this.fontContext2D.canvas,this.fontTexture)}},{key:"createPattern",value:function(e,t){if(!(1!==renderer.WebGLVersion||isPowerOfTwo(e.width)&&isPowerOfTwo(e.height))){var n=void 0!==e.src?e.src:e;throw new Error("[WebGL Renderer] "+n+" is not a POT texture ("+e.width+"x"+e.height+")")}var r=new TextureAtlas(createAtlas(e.width,e.height,"pattern",t),e);return this.currentCompositor.uploadTexture(r),r}},{key:"flush",value:function(){this.currentCompositor.flush()}},{key:"setProjection",value:function(e){_get(_getPrototypeOf(n.prototype),"setProjection",this).call(this,e),this.currentCompositor.setProjection(e)}},{key:"clearColor",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#000000",n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t instanceof Color)e=t.toArray();else{var r=pool.pull("me.Color");e=r.parseCSS(t).toArray(),pool.push(r)}this.currentCompositor.clearColor(e[0],e[1],e[2],!0===n?1:e[3]),this.currentCompositor.clear(),this.currentCompositor.clearColor(0,0,0,0)}},{key:"clearRect",value:function(e,t,n,r){this.save(),this.clipRect(e,t,n,r),this.clearColor(),this.restore()}},{key:"drawFont",value:function(e){var t=this.getFontContext();this.currentCompositor.uploadTexture(this.fontTexture,0,0,0,!0);var n=this.fontTexture.getUVs(e.left+","+e.top+","+e.width+","+e.height);this.currentCompositor.addQuad(this.fontTexture,e.left,e.top,e.width,e.height,n[0],n[1],n[2],n[3],this.currentTint.toUint32()),t.clearRect(e.left,e.top,e.width,e.height)}},{key:"drawImage",value:function(e,t,n,r,i,o,a,s,c){void 0===r?(r=s=e.width,i=c=e.height,o=t,a=n,t=0,n=0):void 0===o&&(o=t,a=n,s=r,c=i,r=e.width,i=e.height,t=0,n=0),!1===this.settings.subPixel&&(o|=0,a|=0);var u=this.cache.get(e),l=u.getUVs(t+","+n+","+r+","+i);this.currentCompositor.addQuad(u,o,a,s,c,l[0],l[1],l[2],l[3],this.currentTint.toUint32())}},{key:"drawPattern",value:function(e,t,n,r,i){var o=e.getUVs("0,0,"+r+","+i);this.currentCompositor.addQuad(e,t,n,r,i,o[0],o[1],o[2],o[3],this.currentTint.toUint32())}},{key:"getScreenContext",value:function(){return this.gl}},{key:"getContextGL",value:function(e,t){if(null==e)throw new Error("You must pass a canvas element in order to create a GL context");"boolean"!=typeof t&&(t=!0);var n,r={alpha:t,antialias:this.settings.antiAlias,depth:!1,stencil:!0,preserveDrawingBuffer:!1,premultipliedAlpha:t,powerPreference:this.settings.powerPreference,failIfMajorPerformanceCaveat:this.settings.failIfMajorPerformanceCaveat};if(!1===this.settings.preferWebGL1&&(n=e.getContext("webgl2",r))&&(this.WebGLVersion=2),n||(this.WebGLVersion=1,n=e.getContext("webgl",r)||e.getContext("experimental-webgl",r)),!n)throw new Error("A WebGL context could not be created.");return n}},{key:"getContext",value:function(){return this.gl}},{key:"setBlendMode",value:function(e,t){(t=t||this.gl).enable(t.BLEND),"multiply"===e?(t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.currentBlendMode=e):(t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.currentBlendMode="normal")}},{key:"getFontContext",value:function(){return void 0===this.fontContext2D&&(console.warn("[WebGL Renderer] WARNING : Using Standard me.Text with WebGL will severly impact performances !"),this.createFontTexture(this.cache)),this.fontContext2D}},{key:"restore",value:function(){if(0!==this._matrixStack.length){var e=this._colorStack.pop(),t=this._matrixStack.pop();this.currentColor.copy(e),this.currentTransform.copy(t),pool.push(e),pool.push(t)}0!==this._scissorStack.length?this.currentScissor.set(this._scissorStack.pop()):(this.gl.disable(this.gl.SCISSOR_TEST),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.backBufferCanvas.width,this.currentScissor[3]=this.backBufferCanvas.height)}},{key:"save",value:function(){this._colorStack.push(this.currentColor.clone()),this._matrixStack.push(this.currentTransform.clone()),this.gl.isEnabled(this.gl.SCISSOR_TEST)&&this._scissorStack.push(this.currentScissor.slice())}},{key:"rotate",value:function(e){this.currentTransform.rotate(e)}},{key:"scale",value:function(e,t){this.currentTransform.scale(e,t)}},{key:"setAntiAlias",value:function(e,t){_get(_getPrototypeOf(n.prototype),"setAntiAlias",this).call(this,e,t)}},{key:"setGlobalAlpha",value:function(e){this.currentColor.alpha=e}},{key:"setColor",value:function(e){var t=this.currentColor.alpha;this.currentColor.copy(e),this.currentColor.alpha*=t}},{key:"setLineWidth",value:function(e){this.getScreenContext().lineWidth(e)}},{key:"strokeArc",value:function(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6?arguments[6]:void 0;if(!0===a)this.fillArc(e,t,n,r,i,o);else{var s,c=this._glPoints,u=Math.floor(24*Math.sqrt(2*n)),l=(i-r)/(2*u),h=2*l,d=Math.cos(l),f=Math.sin(l);for(s=c.length;s<u+1;s++)c.push(new Vector2d);for(s=0;s<u;s++){var p=l+r+h*s,v=Math.cos(p),y=-Math.sin(p);c[s].x=e+(d*v+f*y)*n,c[s].y=t+(d*-y+f*v)*n}this.currentCompositor.drawVertices(this.gl.LINE_STRIP,c,u)}}},{key:"fillArc",value:function(e,t,n,r,i){var o,a=this._glPoints,s=0,c=Math.floor(24*Math.sqrt(2*n)),u=(i-r)/(2*c),l=2*u,h=Math.cos(u),d=Math.sin(u);for(o=a.length;o<2*c;o++)a.push(new Vector2d);for(o=0;o<c-1;o++){var f=u+r+l*o,p=Math.cos(f),v=-Math.sin(f);a[s++].set(e,t),a[s++].set(e-(h*p+d*v)*n,t-(h*-v+d*p)*n)}this.currentCompositor.drawVertices(this.gl.TRIANGLE_STRIP,a,s)}},{key:"strokeEllipse",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!0===i)this.fillEllipse(e,t,n,r);else{var o,a=Math.floor(24*Math.sqrt(n))||Math.floor(12*Math.sqrt(n+r)),s=TAU/a,c=this._glPoints;for(o=c.length;o<a;o++)c.push(new Vector2d);for(o=0;o<a;o++)c[o].x=e+Math.sin(s*-o)*n,c[o].y=t+Math.cos(s*-o)*r;this.currentCompositor.drawVertices(this.gl.LINE_LOOP,c,a)}}},{key:"fillEllipse",value:function(e,t,n,r){var i,o=Math.floor(24*Math.sqrt(n))||Math.floor(12*Math.sqrt(n+r)),a=TAU/o,s=this._glPoints,c=0;for(i=s.length;i<2*(o+1);i++)s.push(new Vector2d);for(i=0;i<o+1;i++)s[c++].set(e,t),s[c++].set(e+Math.sin(a*i)*n,t+Math.cos(a*i)*r);this.currentCompositor.drawVertices(this.gl.TRIANGLE_STRIP,s,c)}},{key:"strokeLine",value:function(e,t,n,r){var i=this._glPoints;i[0].x=e,i[0].y=t,i[1].x=n,i[1].y=r,this.currentCompositor.drawVertices(this.gl.LINE_STRIP,i,2)}},{key:"fillLine",value:function(e,t,n,r){this.strokeLine(e,t,n,r)}},{key:"strokePolygon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!0===t)this.fillPolygon(e);else{var n,r=e.points.length,i=this._glPoints;for(n=i.length;n<r;n++)i.push(new Vector2d);for(n=0;n<r;n++)i[n].x=e.pos.x+e.points[n].x,i[n].y=e.pos.y+e.points[n].y;this.currentCompositor.drawVertices(this.gl.LINE_LOOP,i,r)}}},{key:"fillPolygon",value:function(e){var t,n=e.points,r=this._glPoints,i=e.getIndices(),o=e.pos.x,a=e.pos.y;for(t=r.length;t<i.length;t++)r.push(new Vector2d);for(t=0;t<i.length;t++)r[t].set(o+n[i[t]].x,a+n[i[t]].y);this.currentCompositor.drawVertices(this.gl.TRIANGLES,r,i.length)}},{key:"strokeRect",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!0===i)this.fillRect(e,t,n,r);else{var o=this._glPoints;o[0].x=e,o[0].y=t,o[1].x=e+n,o[1].y=t,o[2].x=e+n,o[2].y=t+r,o[3].x=e,o[3].y=t+r,this.currentCompositor.drawVertices(this.gl.LINE_LOOP,o,4)}}},{key:"fillRect",value:function(e,t,n,r){var i=this._glPoints;i[0].x=e+n,i[0].y=t,i[1].x=e,i[1].y=t,i[2].x=e+n,i[2].y=t+r,i[3].x=e,i[3].y=t+r,this.currentCompositor.drawVertices(this.gl.TRIANGLE_STRIP,i,4)}},{key:"setTransform",value:function(e){this.resetTransform(),this.transform(e)}},{key:"transform",value:function(e){var t=this.currentTransform;if(t.multiply(e),!1===this.settings.subPixel){var n=t.toArray();n[6]|=0,n[7]|=0}}},{key:"translate",value:function(e,t){var n=this.currentTransform;if(n.translate(e,t),!1===this.settings.subPixel){var r=n.toArray();r[6]|=0,r[7]|=0}}},{key:"clipRect",value:function(e,t,n,r){var i=this.backBufferCanvas,o=this.gl;if(0!==e||0!==t||n!==i.width||r!==i.height){var a=this.currentScissor;if(o.isEnabled(o.SCISSOR_TEST)&&a[0]===e&&a[1]===t&&a[2]===n&&a[3]===r)return;this.flush(),o.enable(this.gl.SCISSOR_TEST),o.scissor(e+this.currentTransform.tx,i.height-r-t-this.currentTransform.ty,n,r),a[0]=e,a[1]=t,a[2]=n,a[3]=r}else o.disable(o.SCISSOR_TEST)}},{key:"setMask",value:function(e){var t=this.gl;this.flush(),t.enable(t.STENCIL_TEST),t.clear(t.STENCIL_BUFFER_BIT),t.colorMask(!1,!1,!1,!1),t.stencilFunc(t.NOTEQUAL,1,1),t.stencilOp(t.REPLACE,t.REPLACE,t.REPLACE),this.fill(e),this.flush(),t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,1,1),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}},{key:"clearMask",value:function(){this.flush(),this.gl.disable(this.gl.STENCIL_TEST)}}]),n}(Renderer),designRatio=1,designWidth=0,designHeight=0,settings={parent:document.body,renderer:2,doubleBuffering:!1,autoScale:!1,scale:1,scaleMethod:"fit",transparent:!1,blendMode:"normal",antiAlias:!1,failIfMajorPerformanceCaveat:!0,subPixel:!1,preferWebGL1:!1,powerPreference:"default",verbose:!1,consoleHeader:!0};function autoDetectRenderer(e){try{if(device$1.isWebGLSupported(e))return new WebGLRenderer(e)}catch(e){console.log("Error creating WebGL renderer :"+e.message)}return new CanvasRenderer(e)}function onresize(){var e=renderer.settings,t=1,n=1;if(e.autoScale){var r=1/0,i=1/0;if(window.getComputedStyle){var o=window.getComputedStyle(renderer.getScreenCanvas(),null);r=parseInt(o.maxWidth,10)||1/0,i=parseInt(o.maxHeight,10)||1/0}var a=device$1.getParentBounds(getParent()),s=Math.min(r,a.width),c=Math.min(i,a.height),u=s/c;if("fill-min"===e.scaleMethod&&u>designRatio||"fill-max"===e.scaleMethod&&u<designRatio||"flex-width"===e.scaleMethod){var l=Math.min(r,designHeight*u);t=n=s/l,renderer.resize(Math.floor(l),designHeight)}else if("fill-min"===e.scaleMethod&&u<designRatio||"fill-max"===e.scaleMethod&&u>designRatio||"flex-height"===e.scaleMethod){var h=Math.min(i,designWidth*(c/s));t=n=c/h,renderer.resize(designWidth,Math.floor(h))}else"flex"===e.scaleMethod?renderer.resize(Math.floor(s),Math.floor(c)):"stretch"===e.scaleMethod?(t=s/designWidth,n=c/designHeight):t=n=u<designRatio?s/designWidth:c/designHeight;scale(t,n)}}var CANVAS=0,WEBGL=1,AUTO=2,parent=null,scaleRatio=new Vector2d(1,1),renderer=null;function init(e,t,n){if(!initialized)throw new Error("me.video.init() called before engine initialization.");(settings=Object.assign(settings,n||{})).width=e,settings.height=t,settings.doubleBuffering=!!settings.doubleBuffering,settings.transparent=!!settings.transparent,settings.antiAlias=!!settings.antiAlias,settings.failIfMajorPerformanceCaveat=!!settings.failIfMajorPerformanceCaveat,settings.subPixel=!!settings.subPixel,settings.verbose=!!settings.verbose,-1!==settings.scaleMethod.search(/^(fill-(min|max)|fit|flex(-(width|height))?|stretch)$/)?settings.autoScale="auto"===settings.scale||!0:(settings.scaleMethod="fit",settings.autoScale="auto"===settings.scale||!1),!1!==settings.consoleHeader&&console.log("melonJS 2 (v"+version+") | http://melonjs.org");var r=utils.getUriFragment();!0!==r.webgl&&!0!==r.webgl1&&!0!==r.webgl2||(settings.renderer=WEBGL,!0===r.webgl1&&(settings.preferWebGL1=!0)),settings.scale=settings.autoScale?1:+settings.scale||1,scaleRatio.set(settings.scale,settings.scale),(settings.autoScale||1!==settings.scale)&&(settings.doubleBuffering=!0),designRatio=e/t,designWidth=e,designHeight=t,settings.zoomX=e*scaleRatio.x,settings.zoomY=t*scaleRatio.y,window.addEventListener("resize",utils.function.throttle((function(e){emit(WINDOW_ONRESIZE,e)}),100),!1),window.addEventListener("orientationchange",(function(e){emit(WINDOW_ONORIENTATION_CHANGE,e)}),!1),window.addEventListener("onmozorientationchange",(function(e){emit(WINDOW_ONORIENTATION_CHANGE,e)}),!1),!0===device$1.ScreenOrientation&&(window.screen.orientation.onchange=function(e){emit(WINDOW_ONORIENTATION_CHANGE,e)}),window.addEventListener("scroll",utils.function.throttle((function(e){emit(WINDOW_ONSCROLL,e)}),100),!1),on(WINDOW_ONRESIZE,onresize,this),on(WINDOW_ONORIENTATION_CHANGE,onresize,this);try{switch(settings.renderer){case AUTO:case WEBGL:renderer=autoDetectRenderer(settings);break;default:renderer=new CanvasRenderer(settings)}}catch(e){return console(e.message),!1}if((parent=device$1.getElement(settings.parent)).appendChild(renderer.getScreenCanvas()),onresize(),"MutationObserver"in window&&new MutationObserver(onresize.bind(this)).observe(parent,{attributes:!1,childList:!0,subtree:!0}),!1!==settings.consoleHeader){var i=renderer instanceof CanvasRenderer?"CANVAS":"WebGL"+renderer.WebGLVersion,o=device$1.hasWebAudio?"Web Audio":"HTML5 Audio",a="string"==typeof renderer.GPURenderer?" ("+renderer.GPURenderer+")":"";console.log(i+" renderer"+a+" | "+o+" | pixel ratio "+device$1.devicePixelRatio+" | "+(device$1.isMobile?"mobile":"desktop")+" | "+device$1.getScreenOrientation()+" | "+device$1.language),console.log("resolution: requested "+e+"x"+t+", got "+renderer.getWidth()+"x"+renderer.getHeight())}return emit(VIDEO_INIT),!0}function createCanvas(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e||0===t)throw new Error("width or height was zero, Canvas could not be initialized !");return!0===device$1.OffscreenCanvas&&!0===r?void 0===(n=new OffscreenCanvas(0,0)).style&&(n.style={}):n=document.createElement("canvas"),n.width=e,n.height=t,n}function getParent(){return parent}function scale(e,t){var n=renderer.getScreenCanvas(),r=renderer.getScreenContext(),i=renderer.settings,o=device$1.devicePixelRatio,a=i.zoomX=n.width*e*o,s=i.zoomY=n.height*t*o;scaleRatio.set(e*o,t*o),n.style.width=a/o+"px",n.style.height=s/o+"px",renderer.setAntiAlias(r,i.antiAlias),renderer.setBlendMode(i.blendMode,r),repaint()}var video=Object.freeze({__proto__:null,CANVAS,WEBGL,AUTO,get parent(){return parent},scaleRatio,get renderer(){return renderer},init,createCanvas,getParent,scale}),GUID_base="",GUID_index=0,utils={agent:agentUtils,array:arrayUtils,file:fileUtils,string:stringUtils,function:fnUtils,getPixels:function(e){if(e instanceof HTMLImageElement){var t=CanvasRenderer.getContext2d(createCanvas(e.width,e.height));return t.drawImage(e,0,0),t.getImageData(0,0,e.width,e.height)}return e.getContext("2d").getImageData(0,0,e.width,e.height)},checkVersion:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:version,n=e.split("."),r=t.split("."),i=Math.min(n.length,r.length),o=0,a=0;a<i&&!(o=+n[a]-+r[a]);a++);return o||n.length-r.length},getUriFragment:function(e){var t={};if(void 0===e){var n=document.location;if(!n||!n.hash)return t;e=n.hash}else{var r=e.indexOf("#");if(-1===r)return t;e=e.substr(r,e.length)}return e.substr(1).split("&").filter((function(e){return""!==e})).forEach((function(e){var n=e.split("="),r=n.shift(),i=n.join("=");t[r]=i||!0})),t},resetGUID:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;GUID_base=toHex$1(e.toString().toUpperCase()),GUID_index=t},createGUID:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return GUID_index+=e,GUID_base+"-"+(e||GUID_index)}},framecount=0,framedelta=0,last=0,now=0,delta=0,step=0,minstep=0,timers=[],timerId=0;function update(e){last=now,(delta=(now=e)-last)<0&&(delta=0),timer.tick=delta>minstep&&timer.interpolation?delta/step:1,updateTimers()}function clearTimer(e){for(var t=0,n=timers.length;t<n;t++)if(timers[t].timerId===e){timers.splice(t,1);break}}function updateTimers(){for(var e=0,t=timers.length;e<t;e++){var n=timers[e];n.pauseable&&state.isPaused()||(n.elapsed+=delta),n.elapsed>=n.delay&&(n.fn.apply(null,n.args),!0===n.repeat?n.elapsed-=n.delay:timer.clearTimeout(n.timerId))}}on(BOOT,(function(){timer.reset(),now=last=0,on(GAME_BEFORE_UPDATE,update)}));var timer={tick:1,fps:0,maxfps:60,interpolation:!1,reset:function(){last=now=window.performance.now(),delta=0,framedelta=0,framecount=0,step=Math.ceil(1e3/this.maxfps),minstep=1e3/this.maxfps*1.25},setTimeout:function(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];return timers.push({fn:e,delay:t,elapsed:0,repeat:!1,timerId:++timerId,pauseable:!0===n||!0,args:i}),timerId},setInterval:function(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];return timers.push({fn:e,delay:t,elapsed:0,repeat:!0,timerId:++timerId,pauseable:!0===n||!0,args:i}),timerId},clearTimeout:function(e){utils.function.defer(clearTimer,this,e)},clearInterval:function(e){utils.function.defer(clearTimer,this,e)},getTime:function(){return now},getDelta:function(){return delta},countFPS:function(){framecount++,framedelta+=delta,framecount%10==0&&(this.fps=_clamp(Math.round(1e3*framecount/framedelta),0,this.maxfps),framedelta=0,framecount=0)}},timer$1=timer,lastTime=0,vendors=["ms","moz","webkit","o"],x,requestAnimationFrame=window.requestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame;for(x=0;x<vendors.length&&!requestAnimationFrame;++x)requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];for(x=0;x<vendors.length&&!cancelAnimationFrame;++x)cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];requestAnimationFrame&&cancelAnimationFrame||(requestAnimationFrame=function(e){var t=window.performance.now(),n=Math.max(0,1e3/timer$1.maxfps-(t-lastTime)),r=window.setTimeout((function(){e(t+n)}),n);return lastTime=t+n,r},cancelAnimationFrame=function(e){window.clearTimeout(e)},window.requestAnimationFrame=requestAnimationFrame,window.cancelAnimationFrame=cancelAnimationFrame);var plugins={},BasePlugin=_createClass((function e(){_classCallCheck(this,e),this.version="10.5.2"})),plugin={Base:BasePlugin,patch:function(e,t,n){if(void 0!==e.prototype&&(e=e.prototype),"function"!=typeof e[t])throw new Error(t+" is not an existing function");var r=e[t];Object.defineProperty(e,t,{configurable:!0,value:function(e,t){return function(){this._patched=r;var e=t.apply(this,arguments);return this._patched=null,e}}(0,n)})},register:function(e,t){if(plugins[t])throw new Error("plugin "+t+" already registered");var n=[];arguments.length>2&&(n=Array.prototype.slice.call(arguments,1)),n[0]=e;var r=new(e.bind.apply(e,n));if(void 0===r||!(r instanceof plugin.Base))throw new Error("Plugin should extend the me.plugin.Base Class !");if(utils.checkVersion(r.version)>0)throw new Error("Plugin version mismatch, expected: "+r.version+", got: "+version);plugins[t]=r}},Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*Easing.Bounce.In(2*e):.5*Easing.Bounce.Out(2*e-1)+.5}}},Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),o=Interpolation.Utils.Linear;return t<0?o(e[0],e[1],r):t>1?o(e[n],e[n-1],n-r):o(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){var n,r=0,i=e.length-1,o=Math.pow,a=Interpolation.Utils.Bernstein;for(n=0;n<=i;n++)r+=o(1-t,i-n)*o(t,n)*e[n]*a(i,n);return r},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),o=Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),o(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(o(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):o(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n,r=1;if(e[t])return e[t];for(n=t;n>1;n--)r*=n;return e[t]=r,r}}(),CatmullRom:function(e,t,n,r,i){var o=.5*(n-e),a=.5*(r-t),s=i*i;return(2*t-2*n+o+a)*(i*s)+(-3*t+3*n-2*o-a)*s+o*i+t}}},Tween=function(){function e(t){_classCallCheck(this,e),this.setProperties(t)}return _createClass(e,[{key:"onResetEvent",value:function(e){this.setProperties(e)}},{key:"setProperties",value:function(e){for(var t in this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=Easing.Linear.None,this._interpolationFunction=Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._tweenTimeTracker=lastUpdate,this.isPersistent=!1,this.updateWhenPaused=!1,this.isRenderable=!1,e)"object"!==_typeof(e)&&(this._valuesStart[t]=parseFloat(e[t]))}},{key:"_resumeCallback",value:function(e){this._startTime&&(this._startTime+=e)}},{key:"onActivateEvent",value:function(){on(STATE_RESUME,this._resumeCallback,this)}},{key:"onDeactivateEvent",value:function(){off(STATE_RESUME,this._resumeCallback)}},{key:"to",value:function(e,t){return this._valuesEnd=e,void 0!==t&&("number"==typeof t?this._duration=t:"object"===_typeof(t)&&(t.duration&&(this._duration=t.duration),t.yoyo&&this.yoyo(t.yoyo),t.easing&&this.easing(t.easing),t.repeat&&this.repeat(t.repeat),t.delay&&this.delay(t.delay),t.interpolation&&this.interpolation(t.interpolation),t.autoStart&&this.start())),this}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:timer$1.getTime();for(var t in this._onStartCallbackFired=!1,world.addChild(this),this._startTime=e+this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0}return this}},{key:"stop",value:function(){return world.removeChildNow(this),this}},{key:"delay",value:function(e){return this._delayTime=e,this}},{key:"repeat",value:function(e){return this._repeat=e,this}},{key:"yoyo",value:function(e){return this._yoyo=e,this}},{key:"easing",value:function(e){if("function"!=typeof e)throw new Error("invalid easing function for me.Tween.easing()");return this._easingFunction=e,this}},{key:"interpolation",value:function(e){return this._interpolationFunction=e,this}},{key:"chain",value:function(){return this._chainedTweens=arguments,this}},{key:"onStart",value:function(e){return this._onStartCallback=e,this}},{key:"onUpdate",value:function(e){return this._onUpdateCallback=e,this}},{key:"onComplete",value:function(e){return this._onCompleteCallback=e,this}},{key:"update",value:function(e){this._tweenTimeTracker=lastUpdate>this._tweenTimeTracker?lastUpdate:this._tweenTimeTracker+e;var t,n=this._tweenTimeTracker;if(n<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback.call(this._object),this._onStartCallbackFired=!0);var r=(n-this._startTime)/this._duration;r=r>1?1:r;var i=this._easingFunction(r);for(t in this._valuesEnd){var o=this._valuesStart[t]||0,a=this._valuesEnd[t];a instanceof Array?this._object[t]=this._interpolationFunction(a,i):("string"==typeof a&&(a=o+parseFloat(a)),"number"==typeof a&&(this._object[t]=o+(a-o)*i))}if(null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._object,i),1===r){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var s=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=s}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=n+this._delayTime,!0}world.removeChildNow(this),null!==this._onCompleteCallback&&this._onCompleteCallback.call(this._object);for(var c=0,u=this._chainedTweens.length;c<u;c++)this._chainedTweens[c].start(n);return!1}return!0}}],[{key:"Easing",get:function(){return Easing}},{key:"Interpolation",get:function(){return Interpolation}}]),e}(),runits=["ex","em","pt","px"],toPX=[12,24,.75,1],setContextStyle=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.font=t.font,e.fillStyle=t.fillStyle.toRGBA(),!0===n&&(e.strokeStyle=t.strokeStyle.toRGBA(),e.lineWidth=t.lineWidth),e.textAlign=t.textAlign,e.textBaseline=t.textBaseline},Text=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r,i.width||0,i.height||0)).onResetEvent(e,r,i),o}return _createClass(n,[{key:"onResetEvent",value:function(e,t,n){void 0!==n.fillStyle?n.fillStyle instanceof Color?this.fillStyle=n.fillStyle:this.fillStyle=pool.pull("Color").parseCSS(n.fillStyle):this.fillStyle=pool.pull("Color",0,0,0),void 0!==n.strokeStyle?n.strokeStyle instanceof Color?this.strokeStyle=n.strokeStyle:this.strokeStyle=pool.pull("Color").parseCSS(n.strokeStyle):this.strokeStyle=pool.pull("Color",0,0,0),this.lineWidth=n.lineWidth||1,this.textAlign=n.textAlign||"left",this.textBaseline=n.textBaseline||"top",this.lineHeight=n.lineHeight||1,this.offScreenCanvas=!1,this._text=[],this.fontSize=10,void 0!==n.anchorPoint?this.anchorPoint.setV(n.anchorPoint):this.anchorPoint.set(0,0),void 0!==n.floating&&(this.floating=!!n.floating),this.setFont(n.font,n.size),!0===n.bold&&this.bold(),!0===n.italic&&this.italic(),!0===n.offScreenCanvas&&(this.offScreenCanvas=!0,this.canvas=createCanvas(2,2,!0),this.context=this.canvas.getContext("2d")),this.setText(n.text),this.update(0)}},{key:"onDeactivateEvent",value:function(){!0===this.offScreenCanvas&&(renderer.currentCompositor.deleteTexture2D(renderer.currentCompositor.getTexture2D(this.glTextureUnit)),renderer.cache.delete(this.canvas),this.canvas.width=this.canvas.height=0,this.context=void 0,this.canvas=void 0,this.glTextureUnit=void 0)}},{key:"bold",value:function(){return this.font="bold "+this.font,this.isDirty=!0,this}},{key:"italic",value:function(){return this.font="italic "+this.font,this.isDirty=!0,this}},{key:"setFont",value:function(e,t){var n=e.split(",").map((function(e){return e=e.trim(),/(^".*"$)|(^'.*'$)/.test(e)?e:'"'+e+'"'}));if("number"==typeof t)this.fontSize=t,t+="px";else{var r=t.match(/([-+]?[\d.]*)(.*)/);this.fontSize=parseFloat(r[1]),r[2]?this.fontSize*=toPX[runits.indexOf(r[2])]:t+="px"}return this.height=this.fontSize,this.font=t+" "+n.join(","),this.isDirty=!0,this}},{key:"setText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this._text.toString()!==e.toString()&&(Array.isArray(e)?this._text=e:this._text=(""+e).split("\n"),this.isDirty=!0),this}},{key:"measureText",value:function(e,t,n){var r,i=n||this.getBounds(),o=this.fontSize*this.lineHeight,a=void 0!==t?(""+t).split("\n"):this._text;(r=!0===this.offScreenCanvas?this.context:e.getFontContext()).save(),setContextStyle(r,this),this.height=this.width=0;for(var s=0;s<a.length;s++)this.width=Math.max(r.measureText(trimRight(""+a[s])).width,this.width),this.height+=o;return i.width=Math.ceil(this.width),i.height=Math.ceil(this.height),i.x=Math.floor("right"===this.textAlign?this.pos.x-this.width:"center"===this.textAlign?this.pos.x-this.width/2:this.pos.x),i.y=Math.floor(0===this.textBaseline.search(/^(top|hanging)$/)?this.pos.y:"middle"===this.textBaseline?this.pos.y-i.height/2:this.pos.y-i.height),r.restore(),i}},{key:"update",value:function(){if(!0===this.isDirty){var e=this.measureText(renderer);if(!0===this.offScreenCanvas){var t=Math.round(e.width),n=Math.round(e.height);renderer instanceof WebGLRenderer&&(this.glTextureUnit=renderer.cache.getUnit(renderer.cache.get(this.canvas)),renderer.currentCompositor.unbindTexture2D(null,this.glTextureUnit),1===renderer.WebGLVersion&&(t=nextPowerOfTwo(e.width),n=nextPowerOfTwo(e.height))),this.canvas.width<t||this.canvas.height<n?(this.canvas.width=t,this.canvas.height=n):this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this._drawFont(this.context,this._text,this.pos.x-e.x,this.pos.y-e.y,!1)}}return this.isDirty}},{key:"draw",value:function(e,t,n,r,i){void 0===this.ancestor?(this.setText(t),this.pos.x===n&&this.pos.y===r||(this.pos.x=n,this.pos.y=r,this.isDirty=!0),this.update(0),e.save(),e.setGlobalAlpha(e.globalAlpha()*this.getOpacity())):(n=this.pos.x,r=this.pos.y),!1===e.settings.subPixel&&(n=~~n,r=~~r),!0===this.offScreenCanvas?e.drawImage(this.canvas,this.getBounds().x,this.getBounds().y):e.drawFont(this._drawFont(e.getFontContext(),this._text,n,r,i)),void 0===this.ancestor&&e.restore(),this.isDirty=!1}},{key:"drawStroke",value:function(e,t,n,r){this.draw(e,t,n,r,!0)}},{key:"_drawFont",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];setContextStyle(e,this,i);for(var o=this.fontSize*this.lineHeight,a=0;a<t.length;a++){var s=trimRight(""+t[a]);e[i?"strokeText":"fillText"](s,n,r),r+=o}return this.getBounds()}},{key:"destroy",value:function(){pool.push(this.fillStyle),pool.push(this.strokeStyle),this.fillStyle=this.strokeStyle=void 0,this._text.length=0,_get(_getPrototypeOf(n.prototype),"destroy",this).call(this)}}]),n}(Renderable),measureTextWidth=function(e,t){for(var n=t.split(""),r=0,i=null,o=0;o<n.length;o++){var a=n[o].charCodeAt(0),s=e.fontData.glyphs[a],c=i&&i.kerning?i.getKerning(a):0;r+=(s.xadvance+c)*e.fontScale.x,i=s}return r},measureTextHeight=function(e){return e.fontData.capHeight*e.lineHeight*e.fontScale.y},BitmapText=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r,i.width||0,i.height||0)).textAlign=i.textAlign||"left",o.textBaseline=i.textBaseline||"top",o.lineHeight=i.lineHeight||1,o._text=[],o.fontScale=pool.pull("Vector2d",1,1),o.fontImage="object"===_typeof(i.font)?i.font:loader.getImage(i.font),"string"!=typeof i.fontData?o.fontData=pool.pull("BitmapTextData",loader.getBinary(i.font)):o.fontData=pool.pull("BitmapTextData",i.fontData.includes("info face")?i.fontData:loader.getBinary(i.fontData)),void 0!==i.floating&&(o.floating=!!i.floating),"number"==typeof i.size&&1!==i.size&&o.resize(i.size),void 0!==i.fillStyle&&(i.fillStyle instanceof Color?o.fillStyle.setColor(i.fillStyle):o.fillStyle.parseCSS(i.fillStyle)),void 0!==i.anchorPoint?o.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):o.anchorPoint.set(0,0),o.setText(i.text),o}return _createClass(n,[{key:"set",value:function(e,t){return this.textAlign=e,t&&this.resize(t),this.isDirty=!0,this}},{key:"setText",value:function(e){return void 0===e&&(e=""),this._text.toString()!==e.toString()&&(Array.isArray(e)?this._text=e:this._text=(""+e).split("\n"),this.isDirty=!0),this}},{key:"fillStyle",get:function(){return this.tint},set:function(e){this.tint=e}},{key:"resize",value:function(e){return this.fontScale.set(e,e),this.isDirty=!0,this}},{key:"measureText",value:function(e,t){e=e||this._text;var n=measureTextHeight(this),r=t||this.getBounds(),i="string"==typeof e?(""+e).split("\n"):e;r.height=r.width=0;for(var o=0;o<i.length;o++)r.width=Math.max(measureTextWidth(this,i[o]),r.width),r.height+=n;return r}},{key:"update",value:function(){return!0===this.isDirty&&this.measureText(),this.isDirty}},{key:"draw",value:function(e,t,n,r){var i=e.globalAlpha();void 0===this.ancestor?(this.setText(t),this.update(0),e.setGlobalAlpha(i*this.getOpacity())):(n=this.pos.x,r=this.pos.y);for(var o=n,a=measureTextHeight(this),s=0,c=0;c<this._text.length;c++){n=o;var u=trimRight(this._text[c]),l=measureTextWidth(this,u);switch(this.textAlign){case"right":n-=l;break;case"center":n-=.5*l}switch(this.textBaseline){case"middle":r-=.5*a;break;case"ideographic":case"alphabetic":case"bottom":r-=a}!0===this.isDirty&&void 0===this.ancestor&&(0===c&&(this.pos.y=r),s<l&&(s=l,this.pos.x=n));for(var h=null,d=0,f=u.length;d<f;d++){var p=u.charCodeAt(d),v=this.fontData.glyphs[p],y=v.width,g=v.height,m=h&&h.kerning?h.getKerning(p):0;0!==y&&0!==g&&e.drawImage(this.fontImage,v.x,v.y,y,g,n+v.xoffset,r+v.yoffset*this.fontScale.y,y*this.fontScale.x,g*this.fontScale.y),n+=(v.xadvance+m)*this.fontScale.x,h=v}r+=a}void 0===this.ancestor&&e.setGlobalAlpha(i),this.isDirty=!1}},{key:"destroy",value:function(){pool.push(this.fontScale),this.fontScale=void 0,pool.push(this.fontData),this.fontData=void 0,this._text.length=0,_get(_getPrototypeOf(n.prototype),"destroy",this).call(this)}}]),n}(Renderable),LOG2_PAGE_SIZE=9,PAGE_SIZE=1<<LOG2_PAGE_SIZE,Glyph=function(){function e(){_classCallCheck(this,e),this.id=0,this.x=0,this.y=0,this.width=0,this.height=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.xoffset=0,this.yoffset=0,this.xadvance=0,this.fixedWidth=!1}return _createClass(e,[{key:"getKerning",value:function(e){if(this.kerning){var t=this.kerning[e>>>LOG2_PAGE_SIZE];if(t)return t[e&PAGE_SIZE-1]||0}return 0}},{key:"setKerning",value:function(e,t){this.kerning||(this.kerning={});var n=this.kerning[e>>>LOG2_PAGE_SIZE];void 0===n&&(this.kerning[e>>>LOG2_PAGE_SIZE]={},n=this.kerning[e>>>LOG2_PAGE_SIZE]),n[e&PAGE_SIZE-1]=t}}]),e}(),capChars=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function getValueFromPair(e,t){var n=e.match(t);if(!n)throw new Error("Could not find pattern "+t+" in string: "+e);return n[0].split("=")[1]}function getFirstGlyph(e){for(var t=Object.keys(e),n=0;n<t.length;n++)if(t[n]>32)return e[t[n]];return null}function createSpaceGlyph(e){var t=" ".charCodeAt(0),n=e[t];n||((n=new Glyph).id=t,n.xadvance=getFirstGlyph(e).xadvance,e[t]=n)}var BitmapTextData=function(){function e(t){_classCallCheck(this,e),this.onResetEvent(t)}return _createClass(e,[{key:"onResetEvent",value:function(e){this.padTop=0,this.padRight=0,this.padBottom=0,this.padLeft=0,this.lineHeight=0,this.capHeight=1,this.descent=0,this.glyphs={},this.parse(e)}},{key:"parse",value:function(e){if(!e)throw new Error("File containing font data was empty, cannot load the bitmap font.");var t=e.split(/\r\n|\n/),n=e.match(/padding\=\d+,\d+,\d+,\d+/g);if(!n)throw new Error("Padding not found in first line");var r=n[0].split("=")[1].split(",");this.padTop=parseFloat(r[0]),this.padLeft=parseFloat(r[1]),this.padBottom=parseFloat(r[2]),this.padRight=parseFloat(r[3]),this.lineHeight=parseFloat(getValueFromPair(t[1],/lineHeight\=\d+/g));var i,o=parseFloat(getValueFromPair(t[1],/base\=\d+/g)),a=this.padTop+this.padBottom,s=null;for(i=4;i<t.length;i++){var c=t[i],u=c.split(/=|\s+/);if(c&&!/^kernings/.test(c))if(/^kerning\s/.test(c)){var l=parseFloat(u[2]),h=parseFloat(u[4]),d=parseFloat(u[6]);null!=(s=this.glyphs[l])&&s.setKerning(h,d)}else{s=new Glyph;var f=parseFloat(u[2]);s.id=f,s.x=parseFloat(u[4]),s.y=parseFloat(u[6]),s.width=parseFloat(u[8]),s.height=parseFloat(u[10]),s.xoffset=parseFloat(u[12]),s.yoffset=parseFloat(u[14]),s.xadvance=parseFloat(u[16]),s.width>0&&s.height>0&&(this.descent=Math.min(o+s.yoffset,this.descent)),this.glyphs[f]=s}}this.descent+=this.padBottom,createSpaceGlyph(this.glyphs);var p=null;for(i=0;i<capChars.length;i++){var v=capChars[i];if(p=this.glyphs[v.charCodeAt(0)])break}if(p)this.capHeight=p.height;else for(var y in this.glyphs)if(this.glyphs.hasOwnProperty(y)){if(0===(s=this.glyphs[y]).height||0===s.width)continue;this.capHeight=Math.max(this.capHeight,s.height)}this.capHeight-=a}}]),e}(),ColorLayer=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,0,0,1/0,1/0)).color=pool.pull("Color").parseCSS(r),o.onResetEvent(e,r,i),o}return _createClass(n,[{key:"onResetEvent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.name=e,this.pos.z=n,this.floating=!0,this.color.parseCSS(t)}},{key:"draw",value:function(e,t){var n=viewport.pos;e.save(),e.clipRect(t.left-n.x,t.top-n.y,t.width,t.height),e.clearColor(this.color),e.restore()}},{key:"destroy",value:function(){pool.push(this.color),this.color=void 0,_get(_getPrototypeOf(n.prototype),"destroy",this).call(this)}}]),n}(Renderable),ImageLayer=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r,i)).floating=!0,o.offset.set(e,r),o.ratio=pool.pull("Vector2d",1,1),void 0!==i.ratio&&(isNumeric(i.ratio)?o.ratio.set(i.ratio,+i.ratio):o.ratio.setV(i.ratio)),void 0===i.anchorPoint?o.anchorPoint.set(0,0):"number"==typeof i.anchorPoint?o.anchorPoint.set(i.anchorPoint,i.anchorPoint):o.anchorPoint.setV(i.anchorPoint),o.repeat=i.repeat||"repeat",on(WEBGL_ONCONTEXT_RESTORED,o.createPattern,_assertThisInitialized(o)),o}return _createClass(n,[{key:"repeat",get:function(){return this._repeat},set:function(e){switch(this._repeat=e,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0}this.resize(viewport.width,viewport.height),this.createPattern()}},{key:"onActivateEvent",value:function(){var e=this;on(VIEWPORT_ONCHANGE,this.updateLayer,this),on(VIEWPORT_ONRESIZE,this.resize,this),once(LEVEL_LOADED,(function(){e.updateLayer(viewport.pos)})),!0!==this.ancestor.root&&this.updateLayer(viewport.pos)}},{key:"resize",value:function(e,t){_get(_getPrototypeOf(n.prototype),"resize",this).call(this,this.repeatX?1/0:e,this.repeatY?1/0:t)}},{key:"createPattern",value:function(){this._pattern=renderer.createPattern(this.image,this._repeat)}},{key:"updateLayer",value:function(e){var t=this.ratio.x,n=this.ratio.y;if(0!==t||0!==n){var r=this.width,i=this.height,o=viewport.bounds.width,a=viewport.bounds.height,s=this.anchorPoint.x,c=this.anchorPoint.y,u=s*(t-1)*(o-viewport.width)+this.offset.x-t*e.x,l=c*(n-1)*(a-viewport.height)+this.offset.y-n*e.y;this.repeatX?this.pos.x=u%r:this.pos.x=u,this.repeatY?this.pos.y=l%i:this.pos.y=l,this.isDirty=!0}}},{key:"preDraw",value:function(e){e.save(),e.setGlobalAlpha(e.globalAlpha()*this.getOpacity()),e.setTint(this.tint)}},{key:"draw",value:function(e){var t=this.width,n=this.height,r=viewport.bounds.width,i=viewport.bounds.height,o=this.anchorPoint.x,a=this.anchorPoint.y,s=this.pos.x,c=this.pos.y;0===this.ratio.x&&0===this.ratio.y&&(s+=o*(r-t),c+=a*(i-n)),e.translate(s,c),e.drawPattern(this._pattern,0,0,2*viewport.width,2*viewport.height)}},{key:"onDeactivateEvent",value:function(){off(VIEWPORT_ONCHANGE,this.updateLayer),off(VIEWPORT_ONRESIZE,this.resize)}},{key:"destroy",value:function(){pool.push(this.ratio),this.ratio=void 0,off(WEBGL_ONCONTEXT_RESTORED,this.createPattern),_get(_getPrototypeOf(n.prototype),"destroy",this).call(this)}}]),n}(Sprite),NineSliceSprite=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;if(_classCallCheck(this,n),o=t.call(this,e,r,i),"number"!=typeof i.width||"number"!=typeof i.height)throw new Error("height and width properties are mandatory");return o.nss_width=Math.floor(i.width),o.nss_height=Math.floor(i.height),o.insetx=i.insetx,o.insety=i.insety,o}return _createClass(n,[{key:"draw",value:function(e){var t=this.current,n=this.pos.x,r=this.pos.y,i=t.width,o=t.height,a=t.offset,s=this.offset;0!==t.angle&&(e.translate(-n,-r),e.rotate(t.angle),n-=o,i=t.height,o=t.width);var c=s.x+a.x,u=s.y+a.y,l=this.insetx||i/4,h=this.insety||o/4;e.drawImage(this.image,c,u,l,h,n,r,l,h),e.drawImage(this.image,c+i-l,u,l,h,n+this.nss_width-l,r,l,h),e.drawImage(this.image,c,u+o-h,l,h,n,r+this.nss_height-h,l,h),e.drawImage(this.image,c+i-l,u+o-h,l,h,n+this.nss_width-l,r+this.nss_height-h,l,h);var d=i-(l<<1),f=o-(h<<1),p=this.nss_width-(l<<1),v=this.nss_height-(h<<1);e.drawImage(this.image,c+l,u,d,h,n+l,r,p,h),e.drawImage(this.image,c+l,u+o-h,d,h,n+l,r+this.nss_height-h,p,h),e.drawImage(this.image,c,u+h,l,f,n,r+h,l,v),e.drawImage(this.image,c+i-l,u+h,l,f,n+this.nss_width-l,r+h,l,v),e.drawImage(this.image,c+l,u+h,d,f,n+l,r+h,p,v)}}]),n}(Sprite),GUI_Object=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r,i)).isClickable=!0,o.holdThreshold=250,o.isHoldable=!1,o.hover=!1,o.holdTimeout=null,o.released=!0,o.floating=!0,o.isKinematic=!1,o}return _createClass(n,[{key:"clicked",value:function(e){if(0===e.button&&this.isClickable)return this.dirty=!0,this.released=!1,this.isHoldable&&(null!==this.holdTimeout&&timer$1.clearTimeout(this.holdTimeout),this.holdTimeout=timer$1.setTimeout(this.hold.bind(this),this.holdThreshold,!1),this.released=!1),this.onClick(e)}},{key:"onClick",value:function(){return!1}},{key:"enter",value:function(e){return this.hover=!0,this.dirty=!0,this.onOver(e)}},{key:"onOver",value:function(){}},{key:"leave",value:function(e){return this.hover=!1,this.dirty=!0,this.release(e),this.onOut(e)}},{key:"onOut",value:function(){}},{key:"release",value:function(e){if(!1===this.released)return this.released=!0,this.dirty=!0,timer$1.clearTimeout(this.holdTimeout),this.onRelease(e)}},{key:"onRelease",value:function(){return!1}},{key:"hold",value:function(){timer$1.clearTimeout(this.holdTimeout),this.dirty=!0,this.released||this.onHold()}},{key:"onHold",value:function(){}},{key:"onActivateEvent",value:function(){registerPointerEvent("pointerdown",this,this.clicked.bind(this)),registerPointerEvent("pointerup",this,this.release.bind(this)),registerPointerEvent("pointercancel",this,this.release.bind(this)),registerPointerEvent("pointerenter",this,this.enter.bind(this)),registerPointerEvent("pointerleave",this,this.leave.bind(this))}},{key:"onDeactivateEvent",value:function(){releasePointerEvent("pointerdown",this),releasePointerEvent("pointerup",this),releasePointerEvent("pointercancel",this),releasePointerEvent("pointerenter",this),releasePointerEvent("pointerleave",this),timer$1.clearTimeout(this.holdTimeout)}}]),n}(Sprite),Collectable=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r,i)).name=i.name,o.type=i.type,o.id=i.id,o.body=new Body(_assertThisInitialized(o),i.shapes||new Rect(0,0,o.width,o.height)),o.body.collisionType=collision.types.COLLECTABLE_OBJECT,o.body.setCollisionMask(collision.types.PLAYER_OBJECT),o.body.setStatic(!0),i.anchorPoint?o.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):o.anchorPoint.set(0,0),o}return _createClass(n)}(Sprite),Trigger=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r,i.width||0,i.height||0)).anchorPoint.set(0,0),o.fade=i.fade,o.duration=i.duration,o.fading=!1,o.name="Trigger",o.type=i.type,o.id=i.id,o.gotolevel=i.to,o.triggerSettings={event:"level"},["type","container","onLoaded","flatten","setViewportBounds","to"].forEach(function(e){void 0!==i[e]&&(this.triggerSettings[e]=i[e])}.bind(_assertThisInitialized(o))),o.body=new Body(_assertThisInitialized(o),i.shapes||new Rect(0,0,o.width,o.height)),o.body.collisionType=collision.types.ACTION_OBJECT,o.body.setCollisionMask(collision.types.PLAYER_OBJECT),o.body.setStatic(!0),o.resize(o.body.getBounds().width,o.body.getBounds().height),o}return _createClass(n,[{key:"getTriggerSettings",value:function(){return"string"==typeof this.triggerSettings.container&&(this.triggerSettings.container=world.getChildByName(this.triggerSettings.container)[0]),this.triggerSettings}},{key:"onFadeComplete",value:function(){level.load(this.gotolevel,this.getTriggerSettings()),viewport.fadeOut(this.fade,this.duration)}},{key:"triggerEvent",value:function(){var e=this.getTriggerSettings();if("level"!==e.event)throw new Error("Trigger invalid type");this.gotolevel=e.to,this.fade&&this.duration?this.fading||(this.fading=!0,viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))):level.load(this.gotolevel,e)}},{key:"onCollision",value:function(){return"Trigger"===this.name&&this.triggerEvent.apply(this),!1}}]),n}(Renderable),Draggable=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,e,r,i,o)).isKinematic=!1,a.dragging=!1,a.dragId=null,a.grabOffset=new Vector2d(0,0),a.initEvents(),a}return _createClass(n,[{key:"initEvents",value:function(){var e=this;registerPointerEvent("pointerdown",this,(function(t){emit(DRAGSTART,t,e)})),registerPointerEvent("pointerup",this,(function(t){emit(DRAGEND,t,e)})),registerPointerEvent("pointercancel",this,(function(t){emit(DRAGEND,t,e)})),on(POINTERMOVE,this.dragMove.bind(this)),on(DRAGSTART,(function(t,n){n===e&&e.dragStart(t)})),on(DRAGEND,(function(t,n){n===e&&e.dragEnd(t)}))}},{key:"dragStart",value:function(e){if(!1===this.dragging)return this.dragging=!0,this.grabOffset.set(e.gameX,e.gameY),this.grabOffset.sub(this.pos),!1}},{key:"dragMove",value:function(e){!0===this.dragging&&(this.pos.set(e.gameX,e.gameY,this.pos.z),this.pos.sub(this.grabOffset))}},{key:"dragEnd",value:function(){if(!0===this.dragging)return this.dragging=!1,!1}},{key:"destroy",value:function(){off(POINTERMOVE,this.dragMove),off(DRAGSTART,this.dragStart),off(DRAGEND,this.dragEnd),releasePointerEvent("pointerdown",this),releasePointerEvent("pointerup",this),releasePointerEvent("pointercancel",this),_get(_getPrototypeOf(n.prototype),"destroy",this).call(this)}}]),n}(Renderable),DropTarget=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,e,r,i,o)).isKinematic=!1,a.CHECKMETHOD_OVERLAP="overlaps",a.CHECKMETHOD_CONTAINS="contains",a.checkMethod=a.CHECKMETHOD_OVERLAP,on(DRAGEND,a.checkOnMe,_assertThisInitialized(a)),a}return _createClass(n,[{key:"setCheckMethod",value:function(e){"function"==typeof this.getBounds()[this.checkMethod]&&(this.checkMethod=e)}},{key:"checkOnMe",value:function(e,t){t&&this.getBounds()[this.checkMethod](t.getBounds())&&this.drop(t)}},{key:"drop",value:function(){}},{key:"destroy",value:function(){off(DRAGEND,this.checkOnMe),_get(_getPrototypeOf(n.prototype),"destroy",this).call(this)}}]),n}(Renderable),ParticleContainer=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,viewport.pos.x,viewport.pos.y,viewport.width,viewport.height)).autoSort=!1,r._updateCount=0,r._dt=0,r._emitter=e,r.autoTransform=!1,r.anchorPoint.set(0,0),r.isKinematic=!0,r}return _createClass(n,[{key:"update",value:function(e){if(++this._updateCount>this._emitter.framesToSkip&&(this._updateCount=0),this._updateCount>0)return this._dt+=e,!1;e+=this._dt,this._dt=0;for(var t=this.children.length-1;t>=0;--t){var n=this.children[t];n.inViewport=viewport.isVisible(n,this.floating),n.update(e)||this.removeChildNow(n)}return!0}},{key:"draw",value:function(e,t){if(this.children.length>0){var r,i=e.getContext();this._emitter.textureAdditive&&(r=i.globalCompositeOperation,i.globalCompositeOperation="lighter"),_get(_getPrototypeOf(n.prototype),"draw",this).call(this,e,t),this._emitter.textureAdditive&&(i.globalCompositeOperation=r)}}}]),n}(Container),pixel=(canvas=createCanvas(1,1),context=canvas.getContext("2d"),context.fillStyle="#fff",context.fillRect(0,0,1,1),canvas),canvas,context,ParticleEmitterSettings={width:0,height:0,image:pixel,totalParticles:50,angle:Math.PI/2,angleVariation:0,minLife:1e3,maxLife:3e3,speed:2,speedVariation:1,minRotation:0,maxRotation:0,minStartScale:1,maxStartScale:1,minEndScale:0,maxEndScale:0,gravity:0,wind:0,followTrajectory:!1,textureAdditive:!1,onlyInViewport:!0,floating:!1,maxParticles:10,frequency:100,duration:1/0,framesToSkip:0},ParticleEmitter=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r,1/0,1/0))._stream=!1,o._frequencyTimer=0,o._durationTimer=0,o._enabled=!1,o.alwaysUpdate=!0,o.autoSort=!1,o.container=new ParticleContainer(_assertThisInitialized(o)),o.reset(i),o}return _createClass(n,[{key:"z",get:function(){return this.container.pos.z},set:function(e){this.container.pos.z=e}},{key:"floating",get:function(){return this.container.floating},set:function(e){this.container.floating=e}},{key:"onActivateEvent",value:function(){this.ancestor.addChild(this.container),this.container.pos.z=this.pos.z,this.ancestor.autoSort||this.ancestor.sort()}},{key:"onDeactivateEvent",value:function(){this.ancestor.hasChild(this.container)&&this.ancestor.removeChildNow(this.container)}},{key:"destroy",value:function(){this.reset()}},{key:"getRandomPointX",value:function(){return this.pos.x+randomFloat(0,this.width)}},{key:"getRandomPointY",value:function(){return this.pos.y+randomFloat(0,this.height)}},{key:"reset",value:function(e){var t=ParticleEmitterSettings,n="number"==typeof(e=e||{}).width?e.width:t.width,r="number"==typeof e.height?e.height:t.height;this.resize(n,r),Object.assign(this,t,e),this.container.reset()}},{key:"addParticles",value:function(e){for(var t=0;t<~~e;t++){var n=pool.pull("Particle",this);this.container.addChild(n)}}},{key:"isRunning",value:function(){return this._enabled&&this._stream}},{key:"streamParticles",value:function(e){this._enabled=!0,this._stream=!0,this.frequency=Math.max(this.frequency,1),this._durationTimer="number"==typeof e?e:this.duration}},{key:"stopStream",value:function(){this._enabled=!1}},{key:"burstParticles",value:function(e){this._enabled=!0,this._stream=!1,this.addParticles("number"==typeof e?e:this.totalParticles),this._enabled=!1}},{key:"update",value:function(e){if(this._enabled&&this._stream){if(this._durationTimer!==1/0&&(this._durationTimer-=e,this._durationTimer<=0))return this.stopStream(),!1;this._frequencyTimer+=e;var t=this.container.children.length;t<this.totalParticles&&this._frequencyTimer>=this.frequency&&(t+this.maxParticles<=this.totalParticles?this.addParticles(this.maxParticles):this.addParticles(this.totalParticles-t),this._frequencyTimer=0)}return!0}}]),n}(Renderable),Particle=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e.getRandomPointX(),e.getRandomPointY(),e.image.width,e.image.height)).vel=new Vector2d,r.onResetEvent(e,!0),r}return _createClass(n,[{key:"onResetEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!1===t&&_get(_getPrototypeOf(n.prototype),"onResetEvent",this).call(this,e.getRandomPointX(),e.getRandomPointY(),e.image.width,e.image.height),this.alwaysUpdate=!0,this.image=e.image;var r=e.angle+(e.angleVariation>0?(randomFloat(0,2)-1)*e.angleVariation:0),i=e.speed+(e.speedVariation>0?(randomFloat(0,2)-1)*e.speedVariation:0);this.vel.set(i*Math.cos(r),-i*Math.sin(r)),this.life=randomFloat(e.minLife,e.maxLife),this.startLife=this.life,this.startScale=_clamp(randomFloat(e.minStartScale,e.maxStartScale),e.minStartScale,e.maxStartScale),this.endScale=_clamp(randomFloat(e.minEndScale,e.maxEndScale),e.minEndScale,e.maxEndScale),this.gravity=e.gravity,this.wind=e.wind,this.followTrajectory=e.followTrajectory,this.onlyInViewport=e.onlyInViewport,this.pos.z=e.z,this._deltaInv=timer$1.maxfps/1e3,e.followTrajectory||(this.angle=randomFloat(e.minRotation,e.maxRotation))}},{key:"update",value:function(e){var t=e*this._deltaInv;this.life=this.life>e?this.life-e:0;var n=this.life/this.startLife,r=this.startScale;this.startScale>this.endScale?r=(r*=n)<this.endScale?this.endScale:r:this.startScale<this.endScale&&(r=(r/=n)>this.endScale?this.endScale:r),this.alpha=n,this.vel.x+=this.wind*t,this.vel.y+=this.gravity*t;var i=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this.angle;return this.pos.x+=this.vel.x*t,this.pos.y+=this.vel.y*t,this.currentTransform.setTransform(r,0,0,0,r,0,this.pos.x,this.pos.y,1).rotate(i),(this.inViewport||!this.onlyInViewport)&&this.life>0}},{key:"preDraw",value:function(e){e.save(),e.setGlobalAlpha(e.globalAlpha()*this.alpha),e.transform(this.currentTransform)}},{key:"draw",value:function(e){var t=this.width,n=this.height;e.drawImage(this.image,0,0,t,n,-t/2,-n/2,t,n)}}]),n}(Renderable),Entity=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;if(_classCallCheck(this,n),"number"!=typeof i.width||"number"!=typeof i.height)throw new Error("height and width properties are mandatory when passing settings parameters to an object entity");return(o=t.call(this,e,r,i.width,i.height)).children=[],i.image&&(i.framewidth=i.framewidth||i.width,i.frameheight=i.frameheight||i.height,o.renderable=new Sprite(0,0,i)),i.anchorPoint?o.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):o.anchorPoint.set(0,0),"string"==typeof i.name&&(o.name=i.name),o.type=i.type||"",o.id=i.id||"",o.alive=!0,void 0===i.shapes&&(i.shapes=new Polygon(0,0,[new Vector2d(0,0),new Vector2d(o.width,0),new Vector2d(o.width,o.height),new Vector2d(0,o.height)])),o.body=new Body(_assertThisInitialized(o),i.shapes,o.onBodyUpdate.bind(_assertThisInitialized(o))),0===o.width&&0===o.height&&o.resize(o.body.getBounds().width,o.body.getBounds().height),o.body.setCollisionMask(i.collisionMask),o.body.setCollisionType(i.collisionType),o.autoTransform=!1,o}return _createClass(n,[{key:"renderable",get:function(){return this.children[0]},set:function(e){if(!(e instanceof Renderable))throw new Error(e+"should extend me.Renderable");this.children[0]=e,this.children[0].ancestor=this}},{key:"update",value:function(e){return this.renderable&&(this.isDirty|=this.renderable.update(e)),_get(_getPrototypeOf(n.prototype),"update",this).call(this,e)}},{key:"onBodyUpdate",value:function(e){this.getBounds().addBounds(e.getBounds(),!0),this.updateBoundsPos(this.pos.x,this.pos.y)}},{key:"preDraw",value:function(e){e.save(),e.translate(this.pos.x+this.body.getBounds().x,this.pos.y+this.body.getBounds().y),this.renderable instanceof Renderable&&e.translate(this.anchorPoint.x*this.body.getBounds().width,this.anchorPoint.y*this.body.getBounds().height)}},{key:"draw",value:function(e,t){var n=this.renderable;n instanceof Renderable&&(n.preDraw(e),n.draw(e,t),n.postDraw(e))}},{key:"destroy",value:function(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.children.splice(0,1)),_get(_getPrototypeOf(n.prototype),"destroy",this).call(this,arguments)}},{key:"onDeactivateEvent",value:function(){this.renderable&&this.renderable.onDeactivateEvent&&this.renderable.onDeactivateEvent()}}]),n}(Renderable);function warning(e,t,n){var r="melonJS: %s is deprecated since version %s, please use %s",i=(new Error).stack;console.groupCollapsed?console.groupCollapsed("%c"+r,"font-weight:normal;color:yellow;",e,n,t):console.warn(r,e,n,t),void 0!==i&&console.warn(i),console.groupCollapsed&&console.groupEnd()}device$1.turnOnPointerLock=function(){return warning("device.turnOnPointerLock()","input.requestPointerLock()","10.3.0"),requestPointerLock()},device$1.turnOffPointerLock=function(){return warning("device.turnOffPointerLock()","input.exitPointerLock()","10.3.0"),exitPointerLock()},Object.defineProperty(Renderer.prototype,"Texture",{get:function(){return warning("me.video.renderer.Texture","me.TextureAtlas","10.4.0"),TextureAtlas}});var DraggableEntity=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){return _classCallCheck(this,n),warning("DraggableEntity","Draggable","10.5.0"),t.call(this,e,r,i.width,i.height)}return _createClass(n)}(Draggable),DroptargetEntity=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){return _classCallCheck(this,n),warning("DroptargetEntity","DropTarget","10.5.0"),t.call(this,e,r,i.width,i.height)}return _createClass(n)}(DropTarget),version="10.5.2",initialized=!1,skipAutoInit=!1;function boot(){!0!==initialized&&(pool.register("me.Entity",Entity),pool.register("me.Collectable",Collectable),pool.register("me.Trigger",Trigger),pool.register("me.Tween",Tween,!0),pool.register("me.Color",Color,!0),pool.register("me.Particle",Particle,!0),pool.register("me.Sprite",Sprite),pool.register("me.NineSliceSprite",NineSliceSprite),pool.register("me.Renderable",Renderable),pool.register("me.Text",Text,!0),pool.register("me.BitmapText",BitmapText),pool.register("me.BitmapTextData",BitmapTextData,!0),pool.register("me.ImageLayer",ImageLayer),pool.register("me.ColorLayer",ColorLayer,!0),pool.register("me.Vector2d",Vector2d,!0),pool.register("me.Vector3d",Vector3d,!0),pool.register("me.ObservableVector2d",ObservableVector2d,!0),pool.register("me.ObservableVector3d",ObservableVector3d,!0),pool.register("me.Matrix2d",Matrix2d,!0),pool.register("me.Matrix3d",Matrix3d,!0),pool.register("me.Rect",Rect,!0),pool.register("me.Polygon",Polygon,!0),pool.register("me.Line",Line,!0),pool.register("me.Ellipse",Ellipse,!0),pool.register("me.Bounds",Bounds$1,!0),pool.register("Entity",Entity),pool.register("Collectable",Collectable),pool.register("Trigger",Trigger),pool.register("Tween",Tween,!0),pool.register("Color",Color,!0),pool.register("Particle",Particle,!0),pool.register("Sprite",Sprite),pool.register("NineSliceSprite",NineSliceSprite),pool.register("Renderable",Renderable),pool.register("Text",Text,!0),pool.register("BitmapText",BitmapText),pool.register("BitmapTextData",BitmapTextData,!0),pool.register("ImageLayer",ImageLayer),pool.register("ColorLayer",ColorLayer,!0),pool.register("Vector2d",Vector2d,!0),pool.register("Vector3d",Vector3d,!0),pool.register("ObservableVector2d",ObservableVector2d,!0),pool.register("ObservableVector3d",ObservableVector3d,!0),pool.register("Matrix2d",Matrix2d,!0),pool.register("Matrix3d",Matrix3d,!0),pool.register("Rect",Rect,!0),pool.register("Polygon",Polygon,!0),pool.register("Line",Line,!0),pool.register("Ellipse",Ellipse,!0),pool.register("Bounds",Bounds$1,!0),emit(BOOT),loader.setNocache(utils.getUriFragment().nocache||!1),initKeyboardEvent(),initialized=!0)}device$1.onReady((function(){boot()}))},7694:(e,t,n)=>{n(1761),e.exports=n(5645).RegExp.escape},4963:e=>{e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},3365:(e,t,n)=>{var r=n(2032);e.exports=function(e,t){if("number"!=typeof e&&"Number"!=r(e))throw TypeError(t);return+e}},7722:(e,t,n)=>{var r=n(6314)("unscopables"),i=Array.prototype;null==i[r]&&n(7728)(i,r,{}),e.exports=function(e){i[r][e]=!0}},6793:(e,t,n)=>{"use strict";var r=n(4496)(!0);e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},3328:e=>{e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},7007:(e,t,n)=>{var r=n(5286);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},5216:(e,t,n)=>{"use strict";var r=n(508),i=n(2337),o=n(875);e.exports=[].copyWithin||function(e,t){var n=r(this),a=o(n.length),s=i(e,a),c=i(t,a),u=arguments.length>2?arguments[2]:void 0,l=Math.min((void 0===u?a:i(u,a))-c,a-s),h=1;for(c<s&&s<c+l&&(h=-1,c+=l-1,s+=l-1);l-- >0;)c in n?n[s]=n[c]:delete n[s],s+=h,c+=h;return n}},6852:(e,t,n)=>{"use strict";var r=n(508),i=n(2337),o=n(875);e.exports=function(e){for(var t=r(this),n=o(t.length),a=arguments.length,s=i(a>1?arguments[1]:void 0,n),c=a>2?arguments[2]:void 0,u=void 0===c?n:i(c,n);u>s;)t[s++]=e;return t}},9490:(e,t,n)=>{var r=n(3531);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},9315:(e,t,n)=>{var r=n(2110),i=n(875),o=n(2337);e.exports=function(e){return function(t,n,a){var s,c=r(t),u=i(c.length),l=o(a,u);if(e&&n!=n){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===n)return e||l||0;return!e&&-1}}},50:(e,t,n)=>{var r=n(741),i=n(9797),o=n(508),a=n(875),s=n(6886);e.exports=function(e,t){var n=1==e,c=2==e,u=3==e,l=4==e,h=6==e,d=5==e||h,f=t||s;return function(t,s,p){for(var v,y,g=o(t),m=i(g),_=r(s,p,3),b=a(m.length),x=0,w=n?f(t,b):c?f(t,0):void 0;b>x;x++)if((d||x in m)&&(y=_(v=m[x],x,g),e))if(n)w[x]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return x;case 2:w.push(v)}else if(l)return!1;return h?-1:u||l?l:w}}},7628:(e,t,n)=>{var r=n(4963),i=n(508),o=n(9797),a=n(875);e.exports=function(e,t,n,s,c){r(t);var u=i(e),l=o(u),h=a(u.length),d=c?h-1:0,f=c?-1:1;if(n<2)for(;;){if(d in l){s=l[d],d+=f;break}if(d+=f,c?d<0:h<=d)throw TypeError("Reduce of empty array with no initial value")}for(;c?d>=0:h>d;d+=f)d in l&&(s=t(s,l[d],d,u));return s}},2736:(e,t,n)=>{var r=n(5286),i=n(4302),o=n(6314)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},6886:(e,t,n)=>{var r=n(2736);e.exports=function(e,t){return new(r(e))(t)}},4398:(e,t,n)=>{"use strict";var r=n(4963),i=n(5286),o=n(7242),a=[].slice,s={},c=function(e,t,n){if(!(t in s)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";s[t]=Function("F,a","return new F("+r.join(",")+")")}return s[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=a.call(arguments,1),s=function(){var r=n.concat(a.call(arguments));return this instanceof s?c(t,r.length,r):o(t,r,e)};return i(t.prototype)&&(s.prototype=t.prototype),s}},1488:(e,t,n)=>{var r=n(2032),i=n(6314)("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},2032:e=>{var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},9824:(e,t,n)=>{"use strict";var r=n(9275).f,i=n(2503),o=n(4408),a=n(741),s=n(3328),c=n(3531),u=n(2923),l=n(5436),h=n(2974),d=n(7057),f=n(4728).fastKey,p=n(1616),v=d?"_s":"size",y=function(e,t){var n,r=f(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,u){var l=e((function(e,r){s(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[v]=0,null!=r&&c(r,n,e[u],e)}));return o(l.prototype,{clear:function(){for(var e=p(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var n=p(this,t),r=y(n,e);if(r){var i=r.n,o=r.p;delete n._i[r.i],r.r=!0,o&&(o.n=i),i&&(i.p=o),n._f==r&&(n._f=i),n._l==r&&(n._l=o),n[v]--}return!!r},forEach:function(e){p(this,t);for(var n,r=a(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!y(p(this,t),e)}}),d&&r(l.prototype,"size",{get:function(){return p(this,t)[v]}}),l},def:function(e,t,n){var r,i,o=y(e,t);return o?o.v=n:(e._l=o={i:i=f(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[v]++,"F"!==i&&(e._i[i]=o)),e},getEntry:y,setStrong:function(e,t,n){u(e,t,(function(e,n){this._t=p(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?l(0,"keys"==t?n.k:"values"==t?n.v:[n.k,n.v]):(e._t=void 0,l(1))}),n?"entries":"values",!n,!0),h(t)}}},6132:(e,t,n)=>{var r=n(1488),i=n(9490);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},3657:(e,t,n)=>{"use strict";var r=n(4408),i=n(4728).getWeak,o=n(7007),a=n(5286),s=n(3328),c=n(3531),u=n(50),l=n(9181),h=n(1616),d=u(5),f=u(6),p=0,v=function(e){return e._l||(e._l=new y)},y=function(){this.a=[]},g=function(e,t){return d(e.a,(function(e){return e[0]===t}))};y.prototype={get:function(e){var t=g(this,e);if(t)return t[1]},has:function(e){return!!g(this,e)},set:function(e,t){var n=g(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=f(this.a,(function(t){return t[0]===e}));return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,o){var u=e((function(e,r){s(e,u,t,"_i"),e._t=t,e._i=p++,e._l=void 0,null!=r&&c(r,n,e[o],e)}));return r(u.prototype,{delete:function(e){if(!a(e))return!1;var n=i(e);return!0===n?v(h(this,t)).delete(e):n&&l(n,this._i)&&delete n[this._i]},has:function(e){if(!a(e))return!1;var n=i(e);return!0===n?v(h(this,t)).has(e):n&&l(n,this._i)}}),u},def:function(e,t,n){var r=i(o(t),!0);return!0===r?v(e).set(t,n):r[e._i]=n,e},ufstore:v}},5795:(e,t,n)=>{"use strict";var r=n(3816),i=n(2985),o=n(7234),a=n(4408),s=n(4728),c=n(3531),u=n(3328),l=n(5286),h=n(4253),d=n(7462),f=n(2943),p=n(266);e.exports=function(e,t,n,v,y,g){var m=r[e],_=m,b=y?"set":"add",x=_&&_.prototype,w={},T=function(e){var t=x[e];o(x,e,"delete"==e||"has"==e?function(e){return!(g&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!l(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof _&&(g||x.forEach&&!h((function(){(new _).entries().next()})))){var k=new _,S=k[b](g?{}:-0,1)!=k,E=h((function(){k.has(1)})),C=d((function(e){new _(e)})),P=!g&&h((function(){for(var e=new _,t=5;t--;)e[b](t,t);return!e.has(-0)}));C||((_=t((function(t,n){u(t,_,e);var r=p(new m,t,_);return null!=n&&c(n,y,r[b],r),r}))).prototype=x,x.constructor=_),(E||P)&&(T("delete"),T("has"),y&&T("get")),(P||S)&&T(b),g&&x.clear&&delete x.clear}else _=v.getConstructor(t,e,y,b),a(_.prototype,n),s.NEED=!0;return f(_,e),w[e]=_,i(i.G+i.W+i.F*(_!=m),w),g||v.setStrong(_,e,y),_}},5645:e=>{var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)},2811:(e,t,n)=>{"use strict";var r=n(9275),i=n(681);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},741:(e,t,n)=>{var r=n(4963);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},3537:(e,t,n)=>{"use strict";var r=n(4253),i=Date.prototype.getTime,o=Date.prototype.toISOString,a=function(e){return e>9?e:"0"+e};e.exports=r((function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-50000000000001))}))||!r((function(){o.call(new Date(NaN))}))?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),n=e.getUTCMilliseconds(),r=t<0?"-":t>9999?"+":"";return r+("00000"+Math.abs(t)).slice(r?-6:-4)+"-"+a(e.getUTCMonth()+1)+"-"+a(e.getUTCDate())+"T"+a(e.getUTCHours())+":"+a(e.getUTCMinutes())+":"+a(e.getUTCSeconds())+"."+(n>99?n:"0"+a(n))+"Z"}:o},870:(e,t,n)=>{"use strict";var r=n(7007),i=n(1689),o="number";e.exports=function(e){if("string"!==e&&e!==o&&"default"!==e)throw TypeError("Incorrect hint");return i(r(this),e!=o)}},1355:e=>{e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},7057:(e,t,n)=>{e.exports=!n(4253)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},2457:(e,t,n)=>{var r=n(5286),i=n(3816).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},4430:e=>{e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},5541:(e,t,n)=>{var r=n(7184),i=n(4548),o=n(4682);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var a,s=n(e),c=o.f,u=0;s.length>u;)c.call(e,a=s[u++])&&t.push(a);return t}},2985:(e,t,n)=>{var r=n(3816),i=n(5645),o=n(7728),a=n(7234),s=n(741),c=function(e,t,n){var u,l,h,d,f=e&c.F,p=e&c.G,v=e&c.S,y=e&c.P,g=e&c.B,m=p?r:v?r[t]||(r[t]={}):(r[t]||{}).prototype,_=p?i:i[t]||(i[t]={}),b=_.prototype||(_.prototype={});for(u in p&&(n=t),n)h=((l=!f&&m&&void 0!==m[u])?m:n)[u],d=g&&l?s(h,r):y&&"function"==typeof h?s(Function.call,h):h,m&&a(m,u,h,e&c.U),_[u]!=h&&o(_,u,d),y&&b[u]!=h&&(b[u]=h)};r.core=i,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},8852:(e,t,n)=>{var r=n(6314)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},4253:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},8082:(e,t,n)=>{"use strict";n(8269);var r=n(7234),i=n(7728),o=n(4253),a=n(1355),s=n(6314),c=n(1165),u=s("species"),l=!o((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),h=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();e.exports=function(e,t,n){var d=s(e),f=!o((function(){var t={};return t[d]=function(){return 7},7!=""[e](t)})),p=f?!o((function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===e&&(n.constructor={},n.constructor[u]=function(){return n}),n[d](""),!t})):void 0;if(!f||!p||"replace"===e&&!l||"split"===e&&!h){var v=/./[d],y=n(a,d,""[e],(function(e,t,n,r,i){return t.exec===c?f&&!i?{done:!0,value:v.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}})),g=y[0],m=y[1];r(String.prototype,e,g),i(RegExp.prototype,d,2==t?function(e,t){return m.call(e,this,t)}:function(e){return m.call(e,this)})}}},3218:(e,t,n)=>{"use strict";var r=n(7007);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},3325:(e,t,n)=>{"use strict";var r=n(4302),i=n(5286),o=n(875),a=n(741),s=n(6314)("isConcatSpreadable");e.exports=function e(t,n,c,u,l,h,d,f){for(var p,v,y=l,g=0,m=!!d&&a(d,f,3);g<u;){if(g in c){if(p=m?m(c[g],g,n):c[g],v=!1,i(p)&&(v=void 0!==(v=p[s])?!!v:r(p)),v&&h>0)y=e(t,n,p,o(p.length),y,h-1)-1;else{if(y>=9007199254740991)throw TypeError();t[y]=p}y++}g++}return y}},3531:(e,t,n)=>{var r=n(741),i=n(8851),o=n(6555),a=n(7007),s=n(875),c=n(9002),u={},l={},h=e.exports=function(e,t,n,h,d){var f,p,v,y,g=d?function(){return e}:c(e),m=r(n,h,t?2:1),_=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(o(g)){for(f=s(e.length);f>_;_++)if((y=t?m(a(p=e[_])[0],p[1]):m(e[_]))===u||y===l)return y}else for(v=g.call(e);!(p=v.next()).done;)if((y=i(v,m,p.value,t))===u||y===l)return y};h.BREAK=u,h.RETURN=l},18:(e,t,n)=>{e.exports=n(3825)("native-function-to-string",Function.toString)},3816:e=>{var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},9181:e=>{var t={}.hasOwnProperty;e.exports=function(e,n){return t.call(e,n)}},7728:(e,t,n)=>{var r=n(9275),i=n(681);e.exports=n(7057)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},639:(e,t,n)=>{var r=n(3816).document;e.exports=r&&r.documentElement},1734:(e,t,n)=>{e.exports=!n(7057)&&!n(4253)((function(){return 7!=Object.defineProperty(n(2457)("div"),"a",{get:function(){return 7}}).a}))},266:(e,t,n)=>{var r=n(5286),i=n(7375).set;e.exports=function(e,t,n){var o,a=t.constructor;return a!==n&&"function"==typeof a&&(o=a.prototype)!==n.prototype&&r(o)&&i&&i(e,o),e}},7242:e=>{e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},9797:(e,t,n)=>{var r=n(2032);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},6555:(e,t,n)=>{var r=n(2803),i=n(6314)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},4302:(e,t,n)=>{var r=n(2032);e.exports=Array.isArray||function(e){return"Array"==r(e)}},8367:(e,t,n)=>{var r=n(5286),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},5286:e=>{e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},5364:(e,t,n)=>{var r=n(5286),i=n(2032),o=n(6314)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},8851:(e,t,n)=>{var r=n(7007);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},9988:(e,t,n)=>{"use strict";var r=n(2503),i=n(681),o=n(2943),a={};n(7728)(a,n(6314)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(a,{next:i(1,n)}),o(e,t+" Iterator")}},2923:(e,t,n)=>{"use strict";var r=n(4461),i=n(2985),o=n(7234),a=n(7728),s=n(2803),c=n(9988),u=n(2943),l=n(468),h=n(6314)("iterator"),d=!([].keys&&"next"in[].keys()),f="keys",p="values",v=function(){return this};e.exports=function(e,t,n,y,g,m,_){c(n,t,y);var b,x,w,T=function(e){if(!d&&e in C)return C[e];switch(e){case f:case p:return function(){return new n(this,e)}}return function(){return new n(this,e)}},k=t+" Iterator",S=g==p,E=!1,C=e.prototype,P=C[h]||C["@@iterator"]||g&&C[g],O=P||T(g),R=g?S?T("entries"):O:void 0,A="Array"==t&&C.entries||P;if(A&&(w=l(A.call(new e)))!==Object.prototype&&w.next&&(u(w,k,!0),r||"function"==typeof w[h]||a(w,h,v)),S&&P&&P.name!==p&&(E=!0,O=function(){return P.call(this)}),r&&!_||!d&&!E&&C[h]||a(C,h,O),s[t]=O,s[k]=v,g)if(b={values:S?O:T(p),keys:m?O:T(f),entries:R},_)for(x in b)x in C||o(C,x,b[x]);else i(i.P+i.F*(d||E),t,b);return b}},7462:(e,t,n)=>{var r=n(6314)("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],a=o[r]();a.next=function(){return{done:n=!0}},o[r]=function(){return a},e(o)}catch(e){}return n}},5436:e=>{e.exports=function(e,t){return{value:t,done:!!e}}},2803:e=>{e.exports={}},4461:e=>{e.exports=!1},3086:e=>{var t=Math.expm1;e.exports=!t||t(10)>22025.465794806718||t(10)<22025.465794806718||-2e-17!=t(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:t},4934:(e,t,n)=>{var r=n(1801),i=Math.pow,o=i(2,-52),a=i(2,-23),s=i(2,127)*(2-a),c=i(2,-126);e.exports=Math.fround||function(e){var t,n,i=Math.abs(e),u=r(e);return i<c?u*(i/c/a+1/o-1/o)*c*a:(n=(t=(1+a/o)*i)-(t-i))>s||n!=n?u*(1/0):u*n}},6206:e=>{e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)}},8757:e=>{e.exports=Math.scale||function(e,t,n,r,i){return 0===arguments.length||e!=e||t!=t||n!=n||r!=r||i!=i?NaN:e===1/0||e===-1/0?e:(e-t)*(i-r)/(n-t)+r}},1801:e=>{e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},4728:(e,t,n)=>{var r=n(3953)("meta"),i=n(5286),o=n(9181),a=n(9275).f,s=0,c=Object.isExtensible||function(){return!0},u=!n(4253)((function(){return c(Object.preventExtensions({}))})),l=function(e){a(e,r,{value:{i:"O"+ ++s,w:{}}})},h=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!c(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!o(e,r)){if(!c(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return u&&h.NEED&&c(e)&&!o(e,r)&&l(e),e}}},133:(e,t,n)=>{var r=n(8416),i=n(2985),o=n(3825)("metadata"),a=o.store||(o.store=new(n(147))),s=function(e,t,n){var i=a.get(e);if(!i){if(!n)return;a.set(e,i=new r)}var o=i.get(t);if(!o){if(!n)return;i.set(t,o=new r)}return o};e.exports={store:a,map:s,has:function(e,t,n){var r=s(t,n,!1);return void 0!==r&&r.has(e)},get:function(e,t,n){var r=s(t,n,!1);return void 0===r?void 0:r.get(e)},set:function(e,t,n,r){s(n,r,!0).set(e,t)},keys:function(e,t){var n=s(e,t,!1),r=[];return n&&n.forEach((function(e,t){r.push(t)})),r},key:function(e){return void 0===e||"symbol"==typeof e?e:String(e)},exp:function(e){i(i.S,"Reflect",e)}}},4351:(e,t,n)=>{var r=n(3816),i=n(4193).set,o=r.MutationObserver||r.WebKitMutationObserver,a=r.process,s=r.Promise,c="process"==n(2032)(a);e.exports=function(){var e,t,n,u=function(){var r,i;for(c&&(r=a.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(c)n=function(){a.nextTick(u)};else if(!o||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);n=function(){l.then(u)}}else n=function(){i.call(r,u)};else{var h=!0,d=document.createTextNode("");new o(u).observe(d,{characterData:!0}),n=function(){d.data=h=!h}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},3499:(e,t,n)=>{"use strict";var r=n(4963);function i(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},5345:(e,t,n)=>{"use strict";var r=n(7057),i=n(7184),o=n(4548),a=n(4682),s=n(508),c=n(9797),u=Object.assign;e.exports=!u||n(4253)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r}))?function(e,t){for(var n=s(e),u=arguments.length,l=1,h=o.f,d=a.f;u>l;)for(var f,p=c(arguments[l++]),v=h?i(p).concat(h(p)):i(p),y=v.length,g=0;y>g;)f=v[g++],r&&!d.call(p,f)||(n[f]=p[f]);return n}:u},2503:(e,t,n)=>{var r=n(7007),i=n(5588),o=n(4430),a=n(9335)("IE_PROTO"),s=function(){},c=function(){var e,t=n(2457)("iframe"),r=o.length;for(t.style.display="none",n(639).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;r--;)delete c.prototype[o[r]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[a]=e):n=c(),void 0===t?n:i(n,t)}},9275:(e,t,n)=>{var r=n(7007),i=n(1734),o=n(1689),a=Object.defineProperty;t.f=n(7057)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},5588:(e,t,n)=>{var r=n(9275),i=n(7007),o=n(7184);e.exports=n(7057)?Object.defineProperties:function(e,t){i(e);for(var n,a=o(t),s=a.length,c=0;s>c;)r.f(e,n=a[c++],t[n]);return e}},1670:(e,t,n)=>{"use strict";e.exports=n(4461)||!n(4253)((function(){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete n(3816)[e]}))},8693:(e,t,n)=>{var r=n(4682),i=n(681),o=n(2110),a=n(1689),s=n(9181),c=n(1734),u=Object.getOwnPropertyDescriptor;t.f=n(7057)?u:function(e,t){if(e=o(e),t=a(t,!0),c)try{return u(e,t)}catch(e){}if(s(e,t))return i(!r.f.call(e,t),e[t])}},9327:(e,t,n)=>{var r=n(2110),i=n(616).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(r(e))}},616:(e,t,n)=>{var r=n(189),i=n(4430).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},4548:(e,t)=>{t.f=Object.getOwnPropertySymbols},468:(e,t,n)=>{var r=n(9181),i=n(508),o=n(9335)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},189:(e,t,n)=>{var r=n(9181),i=n(2110),o=n(9315)(!1),a=n(9335)("IE_PROTO");e.exports=function(e,t){var n,s=i(e),c=0,u=[];for(n in s)n!=a&&r(s,n)&&u.push(n);for(;t.length>c;)r(s,n=t[c++])&&(~o(u,n)||u.push(n));return u}},7184:(e,t,n)=>{var r=n(189),i=n(4430);e.exports=Object.keys||function(e){return r(e,i)}},4682:(e,t)=>{t.f={}.propertyIsEnumerable},3160:(e,t,n)=>{var r=n(2985),i=n(5645),o=n(4253);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],a={};a[e]=t(n),r(r.S+r.F*o((function(){n(1)})),"Object",a)}},1131:(e,t,n)=>{var r=n(7057),i=n(7184),o=n(2110),a=n(4682).f;e.exports=function(e){return function(t){for(var n,s=o(t),c=i(s),u=c.length,l=0,h=[];u>l;)n=c[l++],r&&!a.call(s,n)||h.push(e?[n,s[n]]:s[n]);return h}}},7643:(e,t,n)=>{var r=n(616),i=n(4548),o=n(7007),a=n(3816).Reflect;e.exports=a&&a.ownKeys||function(e){var t=r.f(o(e)),n=i.f;return n?t.concat(n(e)):t}},7743:(e,t,n)=>{var r=n(3816).parseFloat,i=n(9599).trim;e.exports=1/r(n(4644)+"-0")!=-1/0?function(e){var t=i(String(e),3),n=r(t);return 0===n&&"-"==t.charAt(0)?-0:n}:r},5960:(e,t,n)=>{var r=n(3816).parseInt,i=n(9599).trim,o=n(4644),a=/^[-+]?0[xX]/;e.exports=8!==r(o+"08")||22!==r(o+"0x16")?function(e,t){var n=i(String(e),3);return r(n,t>>>0||(a.test(n)?16:10))}:r},188:e=>{e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},94:(e,t,n)=>{var r=n(7007),i=n(5286),o=n(3499);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},681:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},4408:(e,t,n)=>{var r=n(7234);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},7234:(e,t,n)=>{var r=n(3816),i=n(7728),o=n(9181),a=n(3953)("src"),s=n(18),c="toString",u=(""+s).split(c);n(5645).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,n,s){var c="function"==typeof n;c&&(o(n,"name")||i(n,"name",t)),e[t]!==n&&(c&&(o(n,a)||i(n,a,e[t]?""+e[t]:u.join(String(t)))),e===r?e[t]=n:s?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,c,(function(){return"function"==typeof this&&this[a]||s.call(this)}))},7787:(e,t,n)=>{"use strict";var r=n(1488),i=RegExp.prototype.exec;e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var o=n.call(e,t);if("object"!=typeof o)throw new TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},1165:(e,t,n)=>{"use strict";var r,i,o=n(3218),a=RegExp.prototype.exec,s=String.prototype.replace,c=a,u=(r=/a/,i=/b*/g,a.call(r,"a"),a.call(i,"a"),0!==r.lastIndex||0!==i.lastIndex),l=void 0!==/()??/.exec("")[1];(u||l)&&(c=function(e){var t,n,r,i,c=this;return l&&(n=new RegExp("^"+c.source+"$(?!\\s)",o.call(c))),u&&(t=c.lastIndex),r=a.call(c,e),u&&r&&(c.lastIndex=c.global?r.index+r[0].length:t),l&&r&&r.length>1&&s.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r}),e.exports=c},5496:e=>{e.exports=function(e,t){var n=t===Object(t)?function(e){return t[e]}:t;return function(t){return String(t).replace(e,n)}}},7195:e=>{e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},1024:(e,t,n)=>{"use strict";var r=n(2985),i=n(4963),o=n(741),a=n(3531);e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,s,c=arguments[1];return i(this),(t=void 0!==c)&&i(c),null==e?new this:(n=[],t?(r=0,s=o(c,arguments[2],2),a(e,!1,(function(e){n.push(s(e,r++))}))):a(e,!1,n.push,n),new this(n))}})}},4881:(e,t,n)=>{"use strict";var r=n(2985);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},7375:(e,t,n)=>{var r=n(5286),i=n(7007),o=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(741)(Function.call,n(8693).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return o(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:o}},2974:(e,t,n)=>{"use strict";var r=n(3816),i=n(9275),o=n(7057),a=n(6314)("species");e.exports=function(e){var t=r[e];o&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function(){return this}})}},2943:(e,t,n)=>{var r=n(9275).f,i=n(9181),o=n(6314)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},9335:(e,t,n)=>{var r=n(3825)("keys"),i=n(3953);e.exports=function(e){return r[e]||(r[e]=i(e))}},3825:(e,t,n)=>{var r=n(5645),i=n(3816),o="__core-js_shared__",a=i[o]||(i[o]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(4461)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},8364:(e,t,n)=>{var r=n(7007),i=n(4963),o=n(6314)("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||null==(n=r(a)[o])?t:i(n)}},7717:(e,t,n)=>{"use strict";var r=n(4253);e.exports=function(e,t){return!!e&&r((function(){t?e.call(null,(function(){}),1):e.call(null)}))}},4496:(e,t,n)=>{var r=n(1467),i=n(1355);e.exports=function(e){return function(t,n){var o,a,s=String(i(t)),c=r(n),u=s.length;return c<0||c>=u?e?"":void 0:(o=s.charCodeAt(c))<55296||o>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):o:e?s.slice(c,c+2):a-56320+(o-55296<<10)+65536}}},2094:(e,t,n)=>{var r=n(5364),i=n(1355);e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(i(e))}},9395:(e,t,n)=>{var r=n(2985),i=n(4253),o=n(1355),a=/"/g,s=function(e,t,n,r){var i=String(o(e)),s="<"+t;return""!==n&&(s+=" "+n+'="'+String(r).replace(a,"&quot;")+'"'),s+">"+i+"</"+t+">"};e.exports=function(e,t){var n={};n[e]=t(s),r(r.P+r.F*i((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3})),"String",n)}},5442:(e,t,n)=>{var r=n(875),i=n(8595),o=n(1355);e.exports=function(e,t,n,a){var s=String(o(e)),c=s.length,u=void 0===n?" ":String(n),l=r(t);if(l<=c||""==u)return s;var h=l-c,d=i.call(u,Math.ceil(h/u.length));return d.length>h&&(d=d.slice(0,h)),a?d+s:s+d}},8595:(e,t,n)=>{"use strict";var r=n(1467),i=n(1355);e.exports=function(e){var t=String(i(this)),n="",o=r(e);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}},9599:(e,t,n)=>{var r=n(2985),i=n(1355),o=n(4253),a=n(4644),s="["+a+"]",c=RegExp("^"+s+s+"*"),u=RegExp(s+s+"*$"),l=function(e,t,n){var i={},s=o((function(){return!!a[e]()||"​"!="​"[e]()})),c=i[e]=s?t(h):a[e];n&&(i[n]=c),r(r.P+r.F*s,"String",i)},h=l.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(c,"")),2&t&&(e=e.replace(u,"")),e};e.exports=l},4644:e=>{e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},4193:(e,t,n)=>{var r,i,o,a=n(741),s=n(7242),c=n(639),u=n(2457),l=n(3816),h=l.process,d=l.setImmediate,f=l.clearImmediate,p=l.MessageChannel,v=l.Dispatch,y=0,g={},m=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},_=function(e){m.call(e.data)};d&&f||(d=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return g[++y]=function(){s("function"==typeof e?e:Function(e),t)},r(y),y},f=function(e){delete g[e]},"process"==n(2032)(h)?r=function(e){h.nextTick(a(m,e,1))}:v&&v.now?r=function(e){v.now(a(m,e,1))}:p?(o=(i=new p).port2,i.port1.onmessage=_,r=a(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",_,!1)):r="onreadystatechange"in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),m.call(e)}}:function(e){setTimeout(a(m,e,1),0)}),e.exports={set:d,clear:f}},2337:(e,t,n)=>{var r=n(1467),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):o(e,t)}},4843:(e,t,n)=>{var r=n(1467),i=n(875);e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length!");return n}},1467:e=>{var t=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:t)(e)}},2110:(e,t,n)=>{var r=n(9797),i=n(1355);e.exports=function(e){return r(i(e))}},875:(e,t,n)=>{var r=n(1467),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},508:(e,t,n)=>{var r=n(1355);e.exports=function(e){return Object(r(e))}},1689:(e,t,n)=>{var r=n(5286);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},8440:(e,t,n)=>{"use strict";if(n(7057)){var r=n(4461),i=n(3816),o=n(4253),a=n(2985),s=n(9383),c=n(1125),u=n(741),l=n(3328),h=n(681),d=n(7728),f=n(4408),p=n(1467),v=n(875),y=n(4843),g=n(2337),m=n(1689),_=n(9181),b=n(1488),x=n(5286),w=n(508),T=n(6555),k=n(2503),S=n(468),E=n(616).f,C=n(9002),P=n(3953),O=n(6314),R=n(50),A=n(9315),M=n(8364),I=n(6997),D=n(2803),L=n(7462),j=n(2974),B=n(6852),N=n(5216),F=n(9275),V=n(8693),z=F.f,G=V.f,U=i.RangeError,H=i.TypeError,W=i.Uint8Array,X="ArrayBuffer",$="SharedArrayBuffer",Y="BYTES_PER_ELEMENT",q=Array.prototype,K=c.ArrayBuffer,J=c.DataView,Z=R(0),Q=R(2),ee=R(3),te=R(4),ne=R(5),re=R(6),ie=A(!0),oe=A(!1),ae=I.values,se=I.keys,ce=I.entries,ue=q.lastIndexOf,le=q.reduce,he=q.reduceRight,de=q.join,fe=q.sort,pe=q.slice,ve=q.toString,ye=q.toLocaleString,ge=O("iterator"),me=O("toStringTag"),_e=P("typed_constructor"),be=P("def_constructor"),xe=s.CONSTR,we=s.TYPED,Te=s.VIEW,ke="Wrong length!",Se=R(1,(function(e,t){return Re(M(e,e[be]),t)})),Ee=o((function(){return 1===new W(new Uint16Array([1]).buffer)[0]})),Ce=!!W&&!!W.prototype.set&&o((function(){new W(1).set({})})),Pe=function(e,t){var n=p(e);if(n<0||n%t)throw U("Wrong offset!");return n},Oe=function(e){if(x(e)&&we in e)return e;throw H(e+" is not a typed array!")},Re=function(e,t){if(!x(e)||!(_e in e))throw H("It is not a typed array constructor!");return new e(t)},Ae=function(e,t){return Me(M(e,e[be]),t)},Me=function(e,t){for(var n=0,r=t.length,i=Re(e,r);r>n;)i[n]=t[n++];return i},Ie=function(e,t,n){z(e,t,{get:function(){return this._d[n]}})},De=function(e){var t,n,r,i,o,a,s=w(e),c=arguments.length,l=c>1?arguments[1]:void 0,h=void 0!==l,d=C(s);if(null!=d&&!T(d)){for(a=d.call(s),r=[],t=0;!(o=a.next()).done;t++)r.push(o.value);s=r}for(h&&c>2&&(l=u(l,arguments[2],2)),t=0,n=v(s.length),i=Re(this,n);n>t;t++)i[t]=h?l(s[t],t):s[t];return i},Le=function(){for(var e=0,t=arguments.length,n=Re(this,t);t>e;)n[e]=arguments[e++];return n},je=!!W&&o((function(){ye.call(new W(1))})),Be=function(){return ye.apply(je?pe.call(Oe(this)):Oe(this),arguments)},Ne={copyWithin:function(e,t){return N.call(Oe(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return te(Oe(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return B.apply(Oe(this),arguments)},filter:function(e){return Ae(this,Q(Oe(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return ne(Oe(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return re(Oe(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){Z(Oe(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return oe(Oe(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return ie(Oe(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return de.apply(Oe(this),arguments)},lastIndexOf:function(e){return ue.apply(Oe(this),arguments)},map:function(e){return Se(Oe(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return le.apply(Oe(this),arguments)},reduceRight:function(e){return he.apply(Oe(this),arguments)},reverse:function(){for(var e,t=this,n=Oe(t).length,r=Math.floor(n/2),i=0;i<r;)e=t[i],t[i++]=t[--n],t[n]=e;return t},some:function(e){return ee(Oe(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return fe.call(Oe(this),e)},subarray:function(e,t){var n=Oe(this),r=n.length,i=g(e,r);return new(M(n,n[be]))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,v((void 0===t?r:g(t,r))-i))}},Fe=function(e,t){return Ae(this,pe.call(Oe(this),e,t))},Ve=function(e){Oe(this);var t=Pe(arguments[1],1),n=this.length,r=w(e),i=v(r.length),o=0;if(i+t>n)throw U(ke);for(;o<i;)this[t+o]=r[o++]},ze={entries:function(){return ce.call(Oe(this))},keys:function(){return se.call(Oe(this))},values:function(){return ae.call(Oe(this))}},Ge=function(e,t){return x(e)&&e[we]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Ue=function(e,t){return Ge(e,t=m(t,!0))?h(2,e[t]):G(e,t)},He=function(e,t,n){return!(Ge(e,t=m(t,!0))&&x(n)&&_(n,"value"))||_(n,"get")||_(n,"set")||n.configurable||_(n,"writable")&&!n.writable||_(n,"enumerable")&&!n.enumerable?z(e,t,n):(e[t]=n.value,e)};xe||(V.f=Ue,F.f=He),a(a.S+a.F*!xe,"Object",{getOwnPropertyDescriptor:Ue,defineProperty:He}),o((function(){ve.call({})}))&&(ve=ye=function(){return de.call(this)});var We=f({},Ne);f(We,ze),d(We,ge,ze.values),f(We,{slice:Fe,set:Ve,constructor:function(){},toString:ve,toLocaleString:Be}),Ie(We,"buffer","b"),Ie(We,"byteOffset","o"),Ie(We,"byteLength","l"),Ie(We,"length","e"),z(We,me,{get:function(){return this[we]}}),e.exports=function(e,t,n,c){var u=e+((c=!!c)?"Clamped":"")+"Array",h="get"+e,f="set"+e,p=i[u],g=p||{},m=p&&S(p),_=!p||!s.ABV,w={},T=p&&p.prototype,C=function(e,n){z(e,n,{get:function(){return function(e,n){var r=e._d;return r.v[h](n*t+r.o,Ee)}(this,n)},set:function(e){return function(e,n,r){var i=e._d;c&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[f](n*t+i.o,r,Ee)}(this,n,e)},enumerable:!0})};_?(p=n((function(e,n,r,i){l(e,p,u,"_d");var o,a,s,c,h=0,f=0;if(x(n)){if(!(n instanceof K||(c=b(n))==X||c==$))return we in n?Me(p,n):De.call(p,n);o=n,f=Pe(r,t);var g=n.byteLength;if(void 0===i){if(g%t)throw U(ke);if((a=g-f)<0)throw U(ke)}else if((a=v(i)*t)+f>g)throw U(ke);s=a/t}else s=y(n),o=new K(a=s*t);for(d(e,"_d",{b:o,o:f,l:a,e:s,v:new J(o)});h<s;)C(e,h++)})),T=p.prototype=k(We),d(T,"constructor",p)):o((function(){p(1)}))&&o((function(){new p(-1)}))&&L((function(e){new p,new p(null),new p(1.5),new p(e)}),!0)||(p=n((function(e,n,r,i){var o;return l(e,p,u),x(n)?n instanceof K||(o=b(n))==X||o==$?void 0!==i?new g(n,Pe(r,t),i):void 0!==r?new g(n,Pe(r,t)):new g(n):we in n?Me(p,n):De.call(p,n):new g(y(n))})),Z(m!==Function.prototype?E(g).concat(E(m)):E(g),(function(e){e in p||d(p,e,g[e])})),p.prototype=T,r||(T.constructor=p));var P=T[ge],O=!!P&&("values"==P.name||null==P.name),R=ze.values;d(p,_e,!0),d(T,we,u),d(T,Te,!0),d(T,be,p),(c?new p(1)[me]==u:me in T)||z(T,me,{get:function(){return u}}),w[u]=p,a(a.G+a.W+a.F*(p!=g),w),a(a.S,u,{BYTES_PER_ELEMENT:t}),a(a.S+a.F*o((function(){g.of.call(p,1)})),u,{from:De,of:Le}),Y in T||d(T,Y,t),a(a.P,u,Ne),j(u),a(a.P+a.F*Ce,u,{set:Ve}),a(a.P+a.F*!O,u,ze),r||T.toString==ve||(T.toString=ve),a(a.P+a.F*o((function(){new p(1).slice()})),u,{slice:Fe}),a(a.P+a.F*(o((function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()}))||!o((function(){T.toLocaleString.call([1,2])}))),u,{toLocaleString:Be}),D[u]=O?P:R,r||O||d(T,ge,R)}}else e.exports=function(){}},1125:(e,t,n)=>{"use strict";var r=n(3816),i=n(7057),o=n(4461),a=n(9383),s=n(7728),c=n(4408),u=n(4253),l=n(3328),h=n(1467),d=n(875),f=n(4843),p=n(616).f,v=n(9275).f,y=n(6852),g=n(2943),m="ArrayBuffer",_="DataView",b="Wrong index!",x=r.ArrayBuffer,w=r.DataView,T=r.Math,k=r.RangeError,S=r.Infinity,E=x,C=T.abs,P=T.pow,O=T.floor,R=T.log,A=T.LN2,M="buffer",I="byteLength",D="byteOffset",L=i?"_b":M,j=i?"_l":I,B=i?"_o":D;function N(e,t,n){var r,i,o,a=new Array(n),s=8*n-t-1,c=(1<<s)-1,u=c>>1,l=23===t?P(2,-24)-P(2,-77):0,h=0,d=e<0||0===e&&1/e<0?1:0;for((e=C(e))!=e||e===S?(i=e!=e?1:0,r=c):(r=O(R(e)/A),e*(o=P(2,-r))<1&&(r--,o*=2),(e+=r+u>=1?l/o:l*P(2,1-u))*o>=2&&(r++,o/=2),r+u>=c?(i=0,r=c):r+u>=1?(i=(e*o-1)*P(2,t),r+=u):(i=e*P(2,u-1)*P(2,t),r=0));t>=8;a[h++]=255&i,i/=256,t-=8);for(r=r<<t|i,s+=t;s>0;a[h++]=255&r,r/=256,s-=8);return a[--h]|=128*d,a}function F(e,t,n){var r,i=8*n-t-1,o=(1<<i)-1,a=o>>1,s=i-7,c=n-1,u=e[c--],l=127&u;for(u>>=7;s>0;l=256*l+e[c],c--,s-=8);for(r=l&(1<<-s)-1,l>>=-s,s+=t;s>0;r=256*r+e[c],c--,s-=8);if(0===l)l=1-a;else{if(l===o)return r?NaN:u?-S:S;r+=P(2,t),l-=a}return(u?-1:1)*r*P(2,l-t)}function V(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function z(e){return[255&e]}function G(e){return[255&e,e>>8&255]}function U(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function H(e){return N(e,52,8)}function W(e){return N(e,23,4)}function X(e,t,n){v(e.prototype,t,{get:function(){return this[n]}})}function $(e,t,n,r){var i=f(+n);if(i+t>e[j])throw k(b);var o=e[L]._b,a=i+e[B],s=o.slice(a,a+t);return r?s:s.reverse()}function Y(e,t,n,r,i,o){var a=f(+n);if(a+t>e[j])throw k(b);for(var s=e[L]._b,c=a+e[B],u=r(+i),l=0;l<t;l++)s[c+l]=u[o?l:t-l-1]}if(a.ABV){if(!u((function(){x(1)}))||!u((function(){new x(-1)}))||u((function(){return new x,new x(1.5),new x(NaN),x.name!=m}))){for(var q,K=(x=function(e){return l(this,x),new E(f(e))}).prototype=E.prototype,J=p(E),Z=0;J.length>Z;)(q=J[Z++])in x||s(x,q,E[q]);o||(K.constructor=x)}var Q=new w(new x(2)),ee=w.prototype.setInt8;Q.setInt8(0,2147483648),Q.setInt8(1,2147483649),!Q.getInt8(0)&&Q.getInt8(1)||c(w.prototype,{setInt8:function(e,t){ee.call(this,e,t<<24>>24)},setUint8:function(e,t){ee.call(this,e,t<<24>>24)}},!0)}else x=function(e){l(this,x,m);var t=f(e);this._b=y.call(new Array(t),0),this[j]=t},w=function(e,t,n){l(this,w,_),l(e,x,_);var r=e[j],i=h(t);if(i<0||i>r)throw k("Wrong offset!");if(i+(n=void 0===n?r-i:d(n))>r)throw k("Wrong length!");this[L]=e,this[B]=i,this[j]=n},i&&(X(x,I,"_l"),X(w,M,"_b"),X(w,I,"_l"),X(w,D,"_o")),c(w.prototype,{getInt8:function(e){return $(this,1,e)[0]<<24>>24},getUint8:function(e){return $(this,1,e)[0]},getInt16:function(e){var t=$(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=$(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return V($(this,4,e,arguments[1]))},getUint32:function(e){return V($(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return F($(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return F($(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){Y(this,1,e,z,t)},setUint8:function(e,t){Y(this,1,e,z,t)},setInt16:function(e,t){Y(this,2,e,G,t,arguments[2])},setUint16:function(e,t){Y(this,2,e,G,t,arguments[2])},setInt32:function(e,t){Y(this,4,e,U,t,arguments[2])},setUint32:function(e,t){Y(this,4,e,U,t,arguments[2])},setFloat32:function(e,t){Y(this,4,e,W,t,arguments[2])},setFloat64:function(e,t){Y(this,8,e,H,t,arguments[2])}});g(x,m),g(w,_),s(w.prototype,a.VIEW,!0),t.ArrayBuffer=x,t.DataView=w},9383:(e,t,n)=>{for(var r,i=n(3816),o=n(7728),a=n(3953),s=a("typed_array"),c=a("view"),u=!(!i.ArrayBuffer||!i.DataView),l=u,h=0,d="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");h<9;)(r=i[d[h++]])?(o(r.prototype,s,!0),o(r.prototype,c,!0)):l=!1;e.exports={ABV:u,CONSTR:l,TYPED:s,VIEW:c}},3953:e=>{var t=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++t+n).toString(36))}},575:(e,t,n)=>{var r=n(3816).navigator;e.exports=r&&r.userAgent||""},1616:(e,t,n)=>{var r=n(5286);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},6074:(e,t,n)=>{var r=n(3816),i=n(5645),o=n(4461),a=n(8787),s=n(9275).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},8787:(e,t,n)=>{t.f=n(6314)},6314:(e,t,n)=>{var r=n(3825)("wks"),i=n(3953),o=n(3816).Symbol,a="function"==typeof o;(e.exports=function(e){return r[e]||(r[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=r},9002:(e,t,n)=>{var r=n(1488),i=n(6314)("iterator"),o=n(2803);e.exports=n(5645).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[r(e)]}},1761:(e,t,n)=>{var r=n(2985),i=n(5496)(/[\\^$*+?.()|[\]{}]/g,"\\$&");r(r.S,"RegExp",{escape:function(e){return i(e)}})},2e3:(e,t,n)=>{var r=n(2985);r(r.P,"Array",{copyWithin:n(5216)}),n(7722)("copyWithin")},5745:(e,t,n)=>{"use strict";var r=n(2985),i=n(50)(4);r(r.P+r.F*!n(7717)([].every,!0),"Array",{every:function(e){return i(this,e,arguments[1])}})},8977:(e,t,n)=>{var r=n(2985);r(r.P,"Array",{fill:n(6852)}),n(7722)("fill")},8837:(e,t,n)=>{"use strict";var r=n(2985),i=n(50)(2);r(r.P+r.F*!n(7717)([].filter,!0),"Array",{filter:function(e){return i(this,e,arguments[1])}})},4899:(e,t,n)=>{"use strict";var r=n(2985),i=n(50)(6),o="findIndex",a=!0;o in[]&&Array(1)[o]((function(){a=!1})),r(r.P+r.F*a,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(7722)(o)},2310:(e,t,n)=>{"use strict";var r=n(2985),i=n(50)(5),o="find",a=!0;o in[]&&Array(1).find((function(){a=!1})),r(r.P+r.F*a,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(7722)(o)},4336:(e,t,n)=>{"use strict";var r=n(2985),i=n(50)(0),o=n(7717)([].forEach,!0);r(r.P+r.F*!o,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},522:(e,t,n)=>{"use strict";var r=n(741),i=n(2985),o=n(508),a=n(8851),s=n(6555),c=n(875),u=n(2811),l=n(9002);i(i.S+i.F*!n(7462)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,i,h,d=o(e),f="function"==typeof this?this:Array,p=arguments.length,v=p>1?arguments[1]:void 0,y=void 0!==v,g=0,m=l(d);if(y&&(v=r(v,p>2?arguments[2]:void 0,2)),null==m||f==Array&&s(m))for(n=new f(t=c(d.length));t>g;g++)u(n,g,y?v(d[g],g):d[g]);else for(h=m.call(d),n=new f;!(i=h.next()).done;g++)u(n,g,y?a(h,v,[i.value,g],!0):i.value);return n.length=g,n}})},3369:(e,t,n)=>{"use strict";var r=n(2985),i=n(9315)(!1),o=[].indexOf,a=!!o&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(a||!n(7717)(o)),"Array",{indexOf:function(e){return a?o.apply(this,arguments)||0:i(this,e,arguments[1])}})},774:(e,t,n)=>{var r=n(2985);r(r.S,"Array",{isArray:n(4302)})},6997:(e,t,n)=>{"use strict";var r=n(7722),i=n(5436),o=n(2803),a=n(2110);e.exports=n(2923)(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},7842:(e,t,n)=>{"use strict";var r=n(2985),i=n(2110),o=[].join;r(r.P+r.F*(n(9797)!=Object||!n(7717)(o)),"Array",{join:function(e){return o.call(i(this),void 0===e?",":e)}})},9564:(e,t,n)=>{"use strict";var r=n(2985),i=n(2110),o=n(1467),a=n(875),s=[].lastIndexOf,c=!!s&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(c||!n(7717)(s)),"Array",{lastIndexOf:function(e){if(c)return s.apply(this,arguments)||0;var t=i(this),n=a(t.length),r=n-1;for(arguments.length>1&&(r=Math.min(r,o(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}})},1802:(e,t,n)=>{"use strict";var r=n(2985),i=n(50)(1);r(r.P+r.F*!n(7717)([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},8295:(e,t,n)=>{"use strict";var r=n(2985),i=n(2811);r(r.S+r.F*n(4253)((function(){function e(){}return!(Array.of.call(e)instanceof e)})),"Array",{of:function(){for(var e=0,t=arguments.length,n=new("function"==typeof this?this:Array)(t);t>e;)i(n,e,arguments[e++]);return n.length=t,n}})},3750:(e,t,n)=>{"use strict";var r=n(2985),i=n(7628);r(r.P+r.F*!n(7717)([].reduceRight,!0),"Array",{reduceRight:function(e){return i(this,e,arguments.length,arguments[1],!0)}})},3057:(e,t,n)=>{"use strict";var r=n(2985),i=n(7628);r(r.P+r.F*!n(7717)([].reduce,!0),"Array",{reduce:function(e){return i(this,e,arguments.length,arguments[1],!1)}})},110:(e,t,n)=>{"use strict";var r=n(2985),i=n(639),o=n(2032),a=n(2337),s=n(875),c=[].slice;r(r.P+r.F*n(4253)((function(){i&&c.call(i)})),"Array",{slice:function(e,t){var n=s(this.length),r=o(this);if(t=void 0===t?n:t,"Array"==r)return c.call(this,e,t);for(var i=a(e,n),u=a(t,n),l=s(u-i),h=new Array(l),d=0;d<l;d++)h[d]="String"==r?this.charAt(i+d):this[i+d];return h}})},6773:(e,t,n)=>{"use strict";var r=n(2985),i=n(50)(3);r(r.P+r.F*!n(7717)([].some,!0),"Array",{some:function(e){return i(this,e,arguments[1])}})},75:(e,t,n)=>{"use strict";var r=n(2985),i=n(4963),o=n(508),a=n(4253),s=[].sort,c=[1,2,3];r(r.P+r.F*(a((function(){c.sort(void 0)}))||!a((function(){c.sort(null)}))||!n(7717)(s)),"Array",{sort:function(e){return void 0===e?s.call(o(this)):s.call(o(this),i(e))}})},1842:(e,t,n)=>{n(2974)("Array")},1822:(e,t,n)=>{var r=n(2985);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},1031:(e,t,n)=>{var r=n(2985),i=n(3537);r(r.P+r.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},9977:(e,t,n)=>{"use strict";var r=n(2985),i=n(508),o=n(1689);r(r.P+r.F*n(4253)((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})),"Date",{toJSON:function(e){var t=i(this),n=o(t);return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},1560:(e,t,n)=>{var r=n(6314)("toPrimitive"),i=Date.prototype;r in i||n(7728)(i,r,n(870))},6331:(e,t,n)=>{var r=Date.prototype,i="Invalid Date",o=r.toString,a=r.getTime;new Date(NaN)+""!=i&&n(7234)(r,"toString",(function(){var e=a.call(this);return e==e?o.call(this):i}))},9730:(e,t,n)=>{var r=n(2985);r(r.P,"Function",{bind:n(4398)})},8377:(e,t,n)=>{"use strict";var r=n(5286),i=n(468),o=n(6314)("hasInstance"),a=Function.prototype;o in a||n(9275).f(a,o,{value:function(e){if("function"!=typeof this||!r(e))return!1;if(!r(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},6059:(e,t,n)=>{var r=n(9275).f,i=Function.prototype,o=/^\s*function ([^ (]*)/,a="name";a in i||n(7057)&&r(i,a,{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(e){return""}}})},8416:(e,t,n)=>{"use strict";var r=n(9824),i=n(1616),o="Map";e.exports=n(5795)(o,(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(i(this,o),e);return t&&t.v},set:function(e,t){return r.def(i(this,o),0===e?0:e,t)}},r,!0)},6503:(e,t,n)=>{var r=n(2985),i=n(6206),o=Math.sqrt,a=Math.acosh;r(r.S+r.F*!(a&&710==Math.floor(a(Number.MAX_VALUE))&&a(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+o(e-1)*o(e+1))}})},6786:(e,t,n)=>{var r=n(2985),i=Math.asinh;r(r.S+r.F*!(i&&1/i(0)>0),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}})},932:(e,t,n)=>{var r=n(2985),i=Math.atanh;r(r.S+r.F*!(i&&1/i(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},7526:(e,t,n)=>{var r=n(2985),i=n(1801);r(r.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},1591:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},9073:(e,t,n)=>{var r=n(2985),i=Math.exp;r(r.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},347:(e,t,n)=>{var r=n(2985),i=n(3086);r(r.S+r.F*(i!=Math.expm1),"Math",{expm1:i})},579:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{fround:n(4934)})},4669:(e,t,n)=>{var r=n(2985),i=Math.abs;r(r.S,"Math",{hypot:function(e,t){for(var n,r,o=0,a=0,s=arguments.length,c=0;a<s;)c<(n=i(arguments[a++]))?(o=o*(r=c/n)*r+1,c=n):o+=n>0?(r=n/c)*r:n;return c===1/0?1/0:c*Math.sqrt(o)}})},7710:(e,t,n)=>{var r=n(2985),i=Math.imul;r(r.S+r.F*n(4253)((function(){return-5!=i(4294967295,5)||2!=i.length})),"Math",{imul:function(e,t){var n=65535,r=+e,i=+t,o=n&r,a=n&i;return 0|o*a+((n&r>>>16)*a+o*(n&i>>>16)<<16>>>0)}})},5789:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},3514:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{log1p:n(6206)})},9978:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},8472:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{sign:n(1801)})},6946:(e,t,n)=>{var r=n(2985),i=n(3086),o=Math.exp;r(r.S+r.F*n(4253)((function(){return-2e-17!=!Math.sinh(-2e-17)})),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(o(e-1)-o(-e-1))*(Math.E/2)}})},5068:(e,t,n)=>{var r=n(2985),i=n(3086),o=Math.exp;r(r.S,"Math",{tanh:function(e){var t=i(e=+e),n=i(-e);return t==1/0?1:n==1/0?-1:(t-n)/(o(e)+o(-e))}})},413:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},1246:(e,t,n)=>{"use strict";var r=n(3816),i=n(9181),o=n(2032),a=n(266),s=n(1689),c=n(4253),u=n(616).f,l=n(8693).f,h=n(9275).f,d=n(9599).trim,f="Number",p=r.Number,v=p,y=p.prototype,g=o(n(2503)(y))==f,m="trim"in String.prototype,_=function(e){var t=s(e,!1);if("string"==typeof t&&t.length>2){var n,r,i,o=(t=m?t.trim():d(t,3)).charCodeAt(0);if(43===o||45===o){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===o){switch(t.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+t}for(var a,c=t.slice(2),u=0,l=c.length;u<l;u++)if((a=c.charCodeAt(u))<48||a>i)return NaN;return parseInt(c,r)}}return+t};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof p&&(g?c((function(){y.valueOf.call(n)})):o(n)!=f)?a(new v(_(t)),n,p):_(t)};for(var b,x=n(7057)?u(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;x.length>w;w++)i(v,b=x[w])&&!i(p,b)&&h(p,b,l(v,b));p.prototype=y,y.constructor=p,n(7234)(r,f,p)}},5972:(e,t,n)=>{var r=n(2985);r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},3403:(e,t,n)=>{var r=n(2985),i=n(3816).isFinite;r(r.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},2516:(e,t,n)=>{var r=n(2985);r(r.S,"Number",{isInteger:n(8367)})},9371:(e,t,n)=>{var r=n(2985);r(r.S,"Number",{isNaN:function(e){return e!=e}})},6479:(e,t,n)=>{var r=n(2985),i=n(8367),o=Math.abs;r(r.S,"Number",{isSafeInteger:function(e){return i(e)&&o(e)<=9007199254740991}})},1736:(e,t,n)=>{var r=n(2985);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},1889:(e,t,n)=>{var r=n(2985);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},5177:(e,t,n)=>{var r=n(2985),i=n(7743);r(r.S+r.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},6943:(e,t,n)=>{var r=n(2985),i=n(5960);r(r.S+r.F*(Number.parseInt!=i),"Number",{parseInt:i})},726:(e,t,n)=>{"use strict";var r=n(2985),i=n(1467),o=n(3365),a=n(8595),s=1..toFixed,c=Math.floor,u=[0,0,0,0,0,0],l="Number.toFixed: incorrect invocation!",h="0",d=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*u[n],u[n]=r%1e7,r=c(r/1e7)},f=function(e){for(var t=6,n=0;--t>=0;)n+=u[t],u[t]=c(n/e),n=n%e*1e7},p=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==u[e]){var n=String(u[e]);t=""===t?n:t+a.call(h,7-n.length)+n}return t},v=function(e,t,n){return 0===t?n:t%2==1?v(e,t-1,n*e):v(e*e,t/2,n)};r(r.P+r.F*(!!s&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n(4253)((function(){s.call({})}))),"Number",{toFixed:function(e){var t,n,r,s,c=o(this,l),u=i(e),y="",g=h;if(u<0||u>20)throw RangeError(l);if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return String(c);if(c<0&&(y="-",c=-c),c>1e-21)if(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(c*v(2,69,1))-69,n=t<0?c*v(2,-t,1):c/v(2,t,1),n*=4503599627370496,(t=52-t)>0){for(d(0,n),r=u;r>=7;)d(1e7,0),r-=7;for(d(v(10,r,1),0),r=t-1;r>=23;)f(1<<23),r-=23;f(1<<r),d(1,1),f(2),g=p()}else d(0,n),d(1<<-t,0),g=p()+a.call(h,u);return u>0?y+((s=g.length)<=u?"0."+a.call(h,u-s)+g:g.slice(0,s-u)+"."+g.slice(s-u)):y+g}})},1901:(e,t,n)=>{"use strict";var r=n(2985),i=n(4253),o=n(3365),a=1..toPrecision;r(r.P+r.F*(i((function(){return"1"!==a.call(1,void 0)}))||!i((function(){a.call({})}))),"Number",{toPrecision:function(e){var t=o(this,"Number#toPrecision: incorrect invocation!");return void 0===e?a.call(t):a.call(t,e)}})},5115:(e,t,n)=>{var r=n(2985);r(r.S+r.F,"Object",{assign:n(5345)})},8132:(e,t,n)=>{var r=n(2985);r(r.S,"Object",{create:n(2503)})},7470:(e,t,n)=>{var r=n(2985);r(r.S+r.F*!n(7057),"Object",{defineProperties:n(5588)})},8388:(e,t,n)=>{var r=n(2985);r(r.S+r.F*!n(7057),"Object",{defineProperty:n(9275).f})},9375:(e,t,n)=>{var r=n(5286),i=n(4728).onFreeze;n(3160)("freeze",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},4882:(e,t,n)=>{var r=n(2110),i=n(8693).f;n(3160)("getOwnPropertyDescriptor",(function(){return function(e,t){return i(r(e),t)}}))},9622:(e,t,n)=>{n(3160)("getOwnPropertyNames",(function(){return n(9327).f}))},1520:(e,t,n)=>{var r=n(508),i=n(468);n(3160)("getPrototypeOf",(function(){return function(e){return i(r(e))}}))},9892:(e,t,n)=>{var r=n(5286);n(3160)("isExtensible",(function(e){return function(t){return!!r(t)&&(!e||e(t))}}))},4157:(e,t,n)=>{var r=n(5286);n(3160)("isFrozen",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},5095:(e,t,n)=>{var r=n(5286);n(3160)("isSealed",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},9176:(e,t,n)=>{var r=n(2985);r(r.S,"Object",{is:n(7195)})},7476:(e,t,n)=>{var r=n(508),i=n(7184);n(3160)("keys",(function(){return function(e){return i(r(e))}}))},4672:(e,t,n)=>{var r=n(5286),i=n(4728).onFreeze;n(3160)("preventExtensions",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},3533:(e,t,n)=>{var r=n(5286),i=n(4728).onFreeze;n(3160)("seal",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},8838:(e,t,n)=>{var r=n(2985);r(r.S,"Object",{setPrototypeOf:n(7375).set})},6253:(e,t,n)=>{"use strict";var r=n(1488),i={};i[n(6314)("toStringTag")]="z",i+""!="[object z]"&&n(7234)(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},4299:(e,t,n)=>{var r=n(2985),i=n(7743);r(r.G+r.F*(parseFloat!=i),{parseFloat:i})},1084:(e,t,n)=>{var r=n(2985),i=n(5960);r(r.G+r.F*(parseInt!=i),{parseInt:i})},851:(e,t,n)=>{"use strict";var r,i,o,a,s=n(4461),c=n(3816),u=n(741),l=n(1488),h=n(2985),d=n(5286),f=n(4963),p=n(3328),v=n(3531),y=n(8364),g=n(4193).set,m=n(4351)(),_=n(3499),b=n(188),x=n(575),w=n(94),T="Promise",k=c.TypeError,S=c.process,E=S&&S.versions,C=E&&E.v8||"",P=c.Promise,O="process"==l(S),R=function(){},A=i=_.f,M=!!function(){try{var e=P.resolve(1),t=(e.constructor={})[n(6314)("species")]=function(e){e(R,R)};return(O||"function"==typeof PromiseRejectionEvent)&&e.then(R)instanceof t&&0!==C.indexOf("6.6")&&-1===x.indexOf("Chrome/66")}catch(e){}}(),I=function(e){var t;return!(!d(e)||"function"!=typeof(t=e.then))&&t},D=function(e,t){if(!e._n){e._n=!0;var n=e._c;m((function(){for(var r=e._v,i=1==e._s,o=0,a=function(t){var n,o,a,s=i?t.ok:t.fail,c=t.resolve,u=t.reject,l=t.domain;try{s?(i||(2==e._h&&B(e),e._h=1),!0===s?n=r:(l&&l.enter(),n=s(r),l&&(l.exit(),a=!0)),n===t.promise?u(k("Promise-chain cycle")):(o=I(n))?o.call(n,c,u):c(n)):u(r)}catch(e){l&&!a&&l.exit(),u(e)}};n.length>o;)a(n[o++]);e._c=[],e._n=!1,t&&!e._h&&L(e)}))}},L=function(e){g.call(c,(function(){var t,n,r,i=e._v,o=j(e);if(o&&(t=b((function(){O?S.emit("unhandledRejection",i,e):(n=c.onunhandledrejection)?n({promise:e,reason:i}):(r=c.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=O||j(e)?2:1),e._a=void 0,o&&t.e)throw t.v}))},j=function(e){return 1!==e._h&&0===(e._a||e._c).length},B=function(e){g.call(c,(function(){var t;O?S.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},N=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),D(t,!0))},F=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw k("Promise can't be resolved itself");(t=I(e))?m((function(){var r={_w:n,_d:!1};try{t.call(e,u(F,r,1),u(N,r,1))}catch(e){N.call(r,e)}})):(n._v=e,n._s=1,D(n,!1))}catch(e){N.call({_w:n,_d:!1},e)}}};M||(P=function(e){p(this,P,T,"_h"),f(e),r.call(this);try{e(u(F,this,1),u(N,this,1))}catch(e){N.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(4408)(P.prototype,{then:function(e,t){var n=A(y(this,P));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=O?S.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&D(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r;this.promise=e,this.resolve=u(F,e,1),this.reject=u(N,e,1)},_.f=A=function(e){return e===P||e===a?new o(e):i(e)}),h(h.G+h.W+h.F*!M,{Promise:P}),n(2943)(P,T),n(2974)(T),a=n(5645).Promise,h(h.S+h.F*!M,T,{reject:function(e){var t=A(this);return(0,t.reject)(e),t.promise}}),h(h.S+h.F*(s||!M),T,{resolve:function(e){return w(s&&this===a?P:this,e)}}),h(h.S+h.F*!(M&&n(7462)((function(e){P.all(e).catch(R)}))),T,{all:function(e){var t=this,n=A(t),r=n.resolve,i=n.reject,o=b((function(){var n=[],o=0,a=1;v(e,!1,(function(e){var s=o++,c=!1;n.push(void 0),a++,t.resolve(e).then((function(e){c||(c=!0,n[s]=e,--a||r(n))}),i)})),--a||r(n)}));return o.e&&i(o.v),n.promise},race:function(e){var t=this,n=A(t),r=n.reject,i=b((function(){v(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}})},1572:(e,t,n)=>{var r=n(2985),i=n(4963),o=n(7007),a=(n(3816).Reflect||{}).apply,s=Function.apply;r(r.S+r.F*!n(4253)((function(){a((function(){}))})),"Reflect",{apply:function(e,t,n){var r=i(e),c=o(n);return a?a(r,t,c):s.call(r,t,c)}})},2139:(e,t,n)=>{var r=n(2985),i=n(2503),o=n(4963),a=n(7007),s=n(5286),c=n(4253),u=n(4398),l=(n(3816).Reflect||{}).construct,h=c((function(){function e(){}return!(l((function(){}),[],e)instanceof e)})),d=!c((function(){l((function(){}))}));r(r.S+r.F*(h||d),"Reflect",{construct:function(e,t){o(e),a(t);var n=arguments.length<3?e:o(arguments[2]);if(d&&!h)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(u.apply(e,r))}var c=n.prototype,f=i(s(c)?c:Object.prototype),p=Function.apply.call(e,f,t);return s(p)?p:f}})},685:(e,t,n)=>{var r=n(9275),i=n(2985),o=n(7007),a=n(1689);i(i.S+i.F*n(4253)((function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})})),"Reflect",{defineProperty:function(e,t,n){o(e),t=a(t,!0),o(n);try{return r.f(e,t,n),!0}catch(e){return!1}}})},5535:(e,t,n)=>{var r=n(2985),i=n(8693).f,o=n(7007);r(r.S,"Reflect",{deleteProperty:function(e,t){var n=i(o(e),t);return!(n&&!n.configurable)&&delete e[t]}})},7347:(e,t,n)=>{"use strict";var r=n(2985),i=n(7007),o=function(e){this._t=i(e),this._i=0;var t,n=this._k=[];for(t in e)n.push(t)};n(9988)(o,"Object",(function(){var e,t=this,n=t._k;do{if(t._i>=n.length)return{value:void 0,done:!0}}while(!((e=n[t._i++])in t._t));return{value:e,done:!1}})),r(r.S,"Reflect",{enumerate:function(e){return new o(e)}})},6633:(e,t,n)=>{var r=n(8693),i=n(2985),o=n(7007);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return r.f(o(e),t)}})},8989:(e,t,n)=>{var r=n(2985),i=n(468),o=n(7007);r(r.S,"Reflect",{getPrototypeOf:function(e){return i(o(e))}})},3049:(e,t,n)=>{var r=n(8693),i=n(468),o=n(9181),a=n(2985),s=n(5286),c=n(7007);a(a.S,"Reflect",{get:function e(t,n){var a,u,l=arguments.length<3?t:arguments[2];return c(t)===l?t[n]:(a=r.f(t,n))?o(a,"value")?a.value:void 0!==a.get?a.get.call(l):void 0:s(u=i(t))?e(u,n,l):void 0}})},8270:(e,t,n)=>{var r=n(2985);r(r.S,"Reflect",{has:function(e,t){return t in e}})},4510:(e,t,n)=>{var r=n(2985),i=n(7007),o=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(e){return i(e),!o||o(e)}})},3984:(e,t,n)=>{var r=n(2985);r(r.S,"Reflect",{ownKeys:n(7643)})},5769:(e,t,n)=>{var r=n(2985),i=n(7007),o=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(e){i(e);try{return o&&o(e),!0}catch(e){return!1}}})},6014:(e,t,n)=>{var r=n(2985),i=n(7375);i&&r(r.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},55:(e,t,n)=>{var r=n(9275),i=n(8693),o=n(468),a=n(9181),s=n(2985),c=n(681),u=n(7007),l=n(5286);s(s.S,"Reflect",{set:function e(t,n,s){var h,d,f=arguments.length<4?t:arguments[3],p=i.f(u(t),n);if(!p){if(l(d=o(t)))return e(d,n,s,f);p=c(0)}if(a(p,"value")){if(!1===p.writable||!l(f))return!1;if(h=i.f(f,n)){if(h.get||h.set||!1===h.writable)return!1;h.value=s,r.f(f,n,h)}else r.f(f,n,c(0,s));return!0}return void 0!==p.set&&(p.set.call(f,s),!0)}})},3946:(e,t,n)=>{var r=n(3816),i=n(266),o=n(9275).f,a=n(616).f,s=n(5364),c=n(3218),u=r.RegExp,l=u,h=u.prototype,d=/a/g,f=/a/g,p=new u(d)!==d;if(n(7057)&&(!p||n(4253)((function(){return f[n(6314)("match")]=!1,u(d)!=d||u(f)==f||"/a/i"!=u(d,"i")})))){u=function(e,t){var n=this instanceof u,r=s(e),o=void 0===t;return!n&&r&&e.constructor===u&&o?e:i(p?new l(r&&!o?e.source:e,t):l((r=e instanceof u)?e.source:e,r&&o?c.call(e):t),n?this:h,u)};for(var v=function(e){e in u||o(u,e,{configurable:!0,get:function(){return l[e]},set:function(t){l[e]=t}})},y=a(l),g=0;y.length>g;)v(y[g++]);h.constructor=u,u.prototype=h,n(7234)(r,"RegExp",u)}n(2974)("RegExp")},8269:(e,t,n)=>{"use strict";var r=n(1165);n(2985)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},6774:(e,t,n)=>{n(7057)&&"g"!=/./g.flags&&n(9275).f(RegExp.prototype,"flags",{configurable:!0,get:n(3218)})},1466:(e,t,n)=>{"use strict";var r=n(7007),i=n(875),o=n(6793),a=n(7787);n(8082)("match",1,(function(e,t,n,s){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=s(n,e,this);if(t.done)return t.value;var c=r(e),u=String(this);if(!c.global)return a(c,u);var l=c.unicode;c.lastIndex=0;for(var h,d=[],f=0;null!==(h=a(c,u));){var p=String(h[0]);d[f]=p,""===p&&(c.lastIndex=o(u,i(c.lastIndex),l)),f++}return 0===f?null:d}]}))},9357:(e,t,n)=>{"use strict";var r=n(7007),i=n(508),o=n(875),a=n(1467),s=n(6793),c=n(7787),u=Math.max,l=Math.min,h=Math.floor,d=/\$([$&`']|\d\d?|<[^>]*>)/g,f=/\$([$&`']|\d\d?)/g;n(8082)("replace",2,(function(e,t,n,p){return[function(r,i){var o=e(this),a=null==r?void 0:r[t];return void 0!==a?a.call(r,o,i):n.call(String(o),r,i)},function(e,t){var i=p(n,e,this,t);if(i.done)return i.value;var h=r(e),d=String(this),f="function"==typeof t;f||(t=String(t));var y=h.global;if(y){var g=h.unicode;h.lastIndex=0}for(var m=[];;){var _=c(h,d);if(null===_)break;if(m.push(_),!y)break;""===String(_[0])&&(h.lastIndex=s(d,o(h.lastIndex),g))}for(var b,x="",w=0,T=0;T<m.length;T++){_=m[T];for(var k=String(_[0]),S=u(l(a(_.index),d.length),0),E=[],C=1;C<_.length;C++)E.push(void 0===(b=_[C])?b:String(b));var P=_.groups;if(f){var O=[k].concat(E,S,d);void 0!==P&&O.push(P);var R=String(t.apply(void 0,O))}else R=v(k,d,S,E,P,t);S>=w&&(x+=d.slice(w,S)+R,w=S+k.length)}return x+d.slice(w)}];function v(e,t,r,o,a,s){var c=r+e.length,u=o.length,l=f;return void 0!==a&&(a=i(a),l=d),n.call(s,l,(function(n,i){var s;switch(i.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(c);case"<":s=a[i.slice(1,-1)];break;default:var l=+i;if(0===l)return n;if(l>u){var d=h(l/10);return 0===d?n:d<=u?void 0===o[d-1]?i.charAt(1):o[d-1]+i.charAt(1):n}s=o[l-1]}return void 0===s?"":s}))}}))},6142:(e,t,n)=>{"use strict";var r=n(7007),i=n(7195),o=n(7787);n(8082)("search",1,(function(e,t,n,a){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=a(n,e,this);if(t.done)return t.value;var s=r(e),c=String(this),u=s.lastIndex;i(u,0)||(s.lastIndex=0);var l=o(s,c);return i(s.lastIndex,u)||(s.lastIndex=u),null===l?-1:l.index}]}))},1876:(e,t,n)=>{"use strict";var r=n(5364),i=n(7007),o=n(8364),a=n(6793),s=n(875),c=n(7787),u=n(1165),l=n(4253),h=Math.min,d=[].push,f=4294967295,p=!l((function(){RegExp(f,"y")}));n(8082)("split",2,(function(e,t,n,l){var v;return v="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!r(e))return n.call(i,e,t);for(var o,a,s,c=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),h=0,p=void 0===t?f:t>>>0,v=new RegExp(e.source,l+"g");(o=u.call(v,i))&&!((a=v.lastIndex)>h&&(c.push(i.slice(h,o.index)),o.length>1&&o.index<i.length&&d.apply(c,o.slice(1)),s=o[0].length,h=a,c.length>=p));)v.lastIndex===o.index&&v.lastIndex++;return h===i.length?!s&&v.test("")||c.push(""):c.push(i.slice(h)),c.length>p?c.slice(0,p):c}:"0".split(void 0,0).length?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,r){var i=e(this),o=null==n?void 0:n[t];return void 0!==o?o.call(n,i,r):v.call(String(i),n,r)},function(e,t){var r=l(v,e,this,t,v!==n);if(r.done)return r.value;var u=i(e),d=String(this),y=o(u,RegExp),g=u.unicode,m=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(p?"y":"g"),_=new y(p?u:"^(?:"+u.source+")",m),b=void 0===t?f:t>>>0;if(0===b)return[];if(0===d.length)return null===c(_,d)?[d]:[];for(var x=0,w=0,T=[];w<d.length;){_.lastIndex=p?w:0;var k,S=c(_,p?d:d.slice(w));if(null===S||(k=h(s(_.lastIndex+(p?0:w)),d.length))===x)w=a(d,w,g);else{if(T.push(d.slice(x,w)),T.length===b)return T;for(var E=1;E<=S.length-1;E++)if(T.push(S[E]),T.length===b)return T;w=x=k}}return T.push(d.slice(x)),T}]}))},6108:(e,t,n)=>{"use strict";n(6774);var r=n(7007),i=n(3218),o=n(7057),a="toString",s=/./.toString,c=function(e){n(7234)(RegExp.prototype,a,e,!0)};n(4253)((function(){return"/a/b"!=s.call({source:"a",flags:"b"})}))?c((function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?i.call(e):void 0)})):s.name!=a&&c((function(){return s.call(this)}))},8184:(e,t,n)=>{"use strict";var r=n(9824),i=n(1616);e.exports=n(5795)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"Set"),e=0===e?0:e,e)}},r)},856:(e,t,n)=>{"use strict";n(9395)("anchor",(function(e){return function(t){return e(this,"a","name",t)}}))},703:(e,t,n)=>{"use strict";n(9395)("big",(function(e){return function(){return e(this,"big","","")}}))},1539:(e,t,n)=>{"use strict";n(9395)("blink",(function(e){return function(){return e(this,"blink","","")}}))},5292:(e,t,n)=>{"use strict";n(9395)("bold",(function(e){return function(){return e(this,"b","","")}}))},9539:(e,t,n)=>{"use strict";var r=n(2985),i=n(4496)(!1);r(r.P,"String",{codePointAt:function(e){return i(this,e)}})},6620:(e,t,n)=>{"use strict";var r=n(2985),i=n(875),o=n(2094),a="endsWith",s="".endsWith;r(r.P+r.F*n(8852)(a),"String",{endsWith:function(e){var t=o(this,e,a),n=arguments.length>1?arguments[1]:void 0,r=i(t.length),c=void 0===n?r:Math.min(i(n),r),u=String(e);return s?s.call(t,u,c):t.slice(c-u.length,c)===u}})},6629:(e,t,n)=>{"use strict";n(9395)("fixed",(function(e){return function(){return e(this,"tt","","")}}))},3694:(e,t,n)=>{"use strict";n(9395)("fontcolor",(function(e){return function(t){return e(this,"font","color",t)}}))},7648:(e,t,n)=>{"use strict";n(9395)("fontsize",(function(e){return function(t){return e(this,"font","size",t)}}))},191:(e,t,n)=>{var r=n(2985),i=n(2337),o=String.fromCharCode,a=String.fromCodePoint;r(r.S+r.F*(!!a&&1!=a.length),"String",{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,a=0;r>a;){if(t=+arguments[a++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?o(t):o(55296+((t-=65536)>>10),t%1024+56320))}return n.join("")}})},2850:(e,t,n)=>{"use strict";var r=n(2985),i=n(2094),o="includes";r(r.P+r.F*n(8852)(o),"String",{includes:function(e){return!!~i(this,e,o).indexOf(e,arguments.length>1?arguments[1]:void 0)}})},7795:(e,t,n)=>{"use strict";n(9395)("italics",(function(e){return function(){return e(this,"i","","")}}))},9115:(e,t,n)=>{"use strict";var r=n(4496)(!0);n(2923)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},4531:(e,t,n)=>{"use strict";n(9395)("link",(function(e){return function(t){return e(this,"a","href",t)}}))},8306:(e,t,n)=>{var r=n(2985),i=n(2110),o=n(875);r(r.S,"String",{raw:function(e){for(var t=i(e.raw),n=o(t.length),r=arguments.length,a=[],s=0;n>s;)a.push(String(t[s++])),s<r&&a.push(String(arguments[s]));return a.join("")}})},823:(e,t,n)=>{var r=n(2985);r(r.P,"String",{repeat:n(8595)})},3605:(e,t,n)=>{"use strict";n(9395)("small",(function(e){return function(){return e(this,"small","","")}}))},7732:(e,t,n)=>{"use strict";var r=n(2985),i=n(875),o=n(2094),a="startsWith",s="".startsWith;r(r.P+r.F*n(8852)(a),"String",{startsWith:function(e){var t=o(this,e,a),n=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return s?s.call(t,r,n):t.slice(n,n+r.length)===r}})},6780:(e,t,n)=>{"use strict";n(9395)("strike",(function(e){return function(){return e(this,"strike","","")}}))},9937:(e,t,n)=>{"use strict";n(9395)("sub",(function(e){return function(){return e(this,"sub","","")}}))},511:(e,t,n)=>{"use strict";n(9395)("sup",(function(e){return function(){return e(this,"sup","","")}}))},4564:(e,t,n)=>{"use strict";n(9599)("trim",(function(e){return function(){return e(this,3)}}))},5767:(e,t,n)=>{"use strict";var r=n(3816),i=n(9181),o=n(7057),a=n(2985),s=n(7234),c=n(4728).KEY,u=n(4253),l=n(3825),h=n(2943),d=n(3953),f=n(6314),p=n(8787),v=n(6074),y=n(5541),g=n(4302),m=n(7007),_=n(5286),b=n(508),x=n(2110),w=n(1689),T=n(681),k=n(2503),S=n(9327),E=n(8693),C=n(4548),P=n(9275),O=n(7184),R=E.f,A=P.f,M=S.f,I=r.Symbol,D=r.JSON,L=D&&D.stringify,j=f("_hidden"),B=f("toPrimitive"),N={}.propertyIsEnumerable,F=l("symbol-registry"),V=l("symbols"),z=l("op-symbols"),G=Object.prototype,U="function"==typeof I&&!!C.f,H=r.QObject,W=!H||!H.prototype||!H.prototype.findChild,X=o&&u((function(){return 7!=k(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=R(G,t);r&&delete G[t],A(e,t,n),r&&e!==G&&A(G,t,r)}:A,$=function(e){var t=V[e]=k(I.prototype);return t._k=e,t},Y=U&&"symbol"==typeof I.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof I},q=function(e,t,n){return e===G&&q(z,t,n),m(e),t=w(t,!0),m(n),i(V,t)?(n.enumerable?(i(e,j)&&e[j][t]&&(e[j][t]=!1),n=k(n,{enumerable:T(0,!1)})):(i(e,j)||A(e,j,T(1,{})),e[j][t]=!0),X(e,t,n)):A(e,t,n)},K=function(e,t){m(e);for(var n,r=y(t=x(t)),i=0,o=r.length;o>i;)q(e,n=r[i++],t[n]);return e},J=function(e){var t=N.call(this,e=w(e,!0));return!(this===G&&i(V,e)&&!i(z,e))&&(!(t||!i(this,e)||!i(V,e)||i(this,j)&&this[j][e])||t)},Z=function(e,t){if(e=x(e),t=w(t,!0),e!==G||!i(V,t)||i(z,t)){var n=R(e,t);return!n||!i(V,t)||i(e,j)&&e[j][t]||(n.enumerable=!0),n}},Q=function(e){for(var t,n=M(x(e)),r=[],o=0;n.length>o;)i(V,t=n[o++])||t==j||t==c||r.push(t);return r},ee=function(e){for(var t,n=e===G,r=M(n?z:x(e)),o=[],a=0;r.length>a;)!i(V,t=r[a++])||n&&!i(G,t)||o.push(V[t]);return o};U||(s((I=function(){if(this instanceof I)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function(n){this===G&&t.call(z,n),i(this,j)&&i(this[j],e)&&(this[j][e]=!1),X(this,e,T(1,n))};return o&&W&&X(G,e,{configurable:!0,set:t}),$(e)}).prototype,"toString",(function(){return this._k})),E.f=Z,P.f=q,n(616).f=S.f=Q,n(4682).f=J,C.f=ee,o&&!n(4461)&&s(G,"propertyIsEnumerable",J,!0),p.f=function(e){return $(f(e))}),a(a.G+a.W+a.F*!U,{Symbol:I});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)f(te[ne++]);for(var re=O(f.store),ie=0;re.length>ie;)v(re[ie++]);a(a.S+a.F*!U,"Symbol",{for:function(e){return i(F,e+="")?F[e]:F[e]=I(e)},keyFor:function(e){if(!Y(e))throw TypeError(e+" is not a symbol!");for(var t in F)if(F[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),a(a.S+a.F*!U,"Object",{create:function(e,t){return void 0===t?k(e):K(k(e),t)},defineProperty:q,defineProperties:K,getOwnPropertyDescriptor:Z,getOwnPropertyNames:Q,getOwnPropertySymbols:ee});var oe=u((function(){C.f(1)}));a(a.S+a.F*oe,"Object",{getOwnPropertySymbols:function(e){return C.f(b(e))}}),D&&a(a.S+a.F*(!U||u((function(){var e=I();return"[null]"!=L([e])||"{}"!=L({a:e})||"{}"!=L(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(_(t)||void 0!==e)&&!Y(e))return g(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!Y(t))return t}),r[1]=t,L.apply(D,r)}}),I.prototype[B]||n(7728)(I.prototype,B,I.prototype.valueOf),h(I,"Symbol"),h(Math,"Math",!0),h(r.JSON,"JSON",!0)},142:(e,t,n)=>{"use strict";var r=n(2985),i=n(9383),o=n(1125),a=n(7007),s=n(2337),c=n(875),u=n(5286),l=n(3816).ArrayBuffer,h=n(8364),d=o.ArrayBuffer,f=o.DataView,p=i.ABV&&l.isView,v=d.prototype.slice,y=i.VIEW,g="ArrayBuffer";r(r.G+r.W+r.F*(l!==d),{ArrayBuffer:d}),r(r.S+r.F*!i.CONSTR,g,{isView:function(e){return p&&p(e)||u(e)&&y in e}}),r(r.P+r.U+r.F*n(4253)((function(){return!new d(2).slice(1,void 0).byteLength})),g,{slice:function(e,t){if(void 0!==v&&void 0===t)return v.call(a(this),e);for(var n=a(this).byteLength,r=s(e,n),i=s(void 0===t?n:t,n),o=new(h(this,d))(c(i-r)),u=new f(this),l=new f(o),p=0;r<i;)l.setUint8(p++,u.getUint8(r++));return o}}),n(2974)(g)},1786:(e,t,n)=>{var r=n(2985);r(r.G+r.W+r.F*!n(9383).ABV,{DataView:n(1125).DataView})},162:(e,t,n)=>{n(8440)("Float32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},3834:(e,t,n)=>{n(8440)("Float64",8,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},4821:(e,t,n)=>{n(8440)("Int16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},1303:(e,t,n)=>{n(8440)("Int32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},5368:(e,t,n)=>{n(8440)("Int8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},9103:(e,t,n)=>{n(8440)("Uint16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},3318:(e,t,n)=>{n(8440)("Uint32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},6964:(e,t,n)=>{n(8440)("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},2152:(e,t,n)=>{n(8440)("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0)},147:(e,t,n)=>{"use strict";var r,i=n(3816),o=n(50)(0),a=n(7234),s=n(4728),c=n(5345),u=n(3657),l=n(5286),h=n(1616),d=n(1616),f=!i.ActiveXObject&&"ActiveXObject"in i,p="WeakMap",v=s.getWeak,y=Object.isExtensible,g=u.ufstore,m=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},_={get:function(e){if(l(e)){var t=v(e);return!0===t?g(h(this,p)).get(e):t?t[this._i]:void 0}},set:function(e,t){return u.def(h(this,p),e,t)}},b=e.exports=n(5795)(p,m,_,u,!0,!0);d&&f&&(c((r=u.getConstructor(m,p)).prototype,_),s.NEED=!0,o(["delete","has","get","set"],(function(e){var t=b.prototype,n=t[e];a(t,e,(function(t,i){if(l(t)&&!y(t)){this._f||(this._f=new r);var o=this._f[e](t,i);return"set"==e?this:o}return n.call(this,t,i)}))})))},9192:(e,t,n)=>{"use strict";var r=n(3657),i=n(1616),o="WeakSet";n(5795)(o,(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,o),e,!0)}},r,!1,!0)},1268:(e,t,n)=>{"use strict";var r=n(2985),i=n(3325),o=n(508),a=n(875),s=n(4963),c=n(6886);r(r.P,"Array",{flatMap:function(e){var t,n,r=o(this);return s(e),t=a(r.length),n=c(r,0),i(n,r,r,t,0,1,e,arguments[1]),n}}),n(7722)("flatMap")},4692:(e,t,n)=>{"use strict";var r=n(2985),i=n(3325),o=n(508),a=n(875),s=n(1467),c=n(6886);r(r.P,"Array",{flatten:function(){var e=arguments[0],t=o(this),n=a(t.length),r=c(t,0);return i(r,t,t,n,0,void 0===e?1:s(e)),r}}),n(7722)("flatten")},2773:(e,t,n)=>{"use strict";var r=n(2985),i=n(9315)(!0);r(r.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(7722)("includes")},8267:(e,t,n)=>{var r=n(2985),i=n(4351)(),o=n(3816).process,a="process"==n(2032)(o);r(r.G,{asap:function(e){var t=a&&o.domain;i(t?t.bind(e):e)}})},2559:(e,t,n)=>{var r=n(2985),i=n(2032);r(r.S,"Error",{isError:function(e){return"Error"===i(e)}})},5575:(e,t,n)=>{var r=n(2985);r(r.G,{global:n(3816)})},525:(e,t,n)=>{n(1024)("Map")},8211:(e,t,n)=>{n(4881)("Map")},7698:(e,t,n)=>{var r=n(2985);r(r.P+r.R,"Map",{toJSON:n(6132)("Map")})},8865:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{clamp:function(e,t,n){return Math.min(n,Math.max(t,e))}})},368:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{DEG_PER_RAD:Math.PI/180})},6427:(e,t,n)=>{var r=n(2985),i=180/Math.PI;r(r.S,"Math",{degrees:function(e){return e*i}})},286:(e,t,n)=>{var r=n(2985),i=n(8757),o=n(4934);r(r.S,"Math",{fscale:function(e,t,n,r,a){return o(i(e,t,n,r,a))}})},2816:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{iaddh:function(e,t,n,r){var i=e>>>0,o=n>>>0;return(t>>>0)+(r>>>0)+((i&o|(i|o)&~(i+o>>>0))>>>31)|0}})},2082:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{imulh:function(e,t){var n=65535,r=+e,i=+t,o=r&n,a=i&n,s=r>>16,c=i>>16,u=(s*a>>>0)+(o*a>>>16);return s*c+(u>>16)+((o*c>>>0)+(u&n)>>16)}})},5986:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{isubh:function(e,t,n,r){var i=e>>>0,o=n>>>0;return(t>>>0)-(r>>>0)-((~i&o|~(i^o)&i-o>>>0)>>>31)|0}})},6308:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{RAD_PER_DEG:180/Math.PI})},9221:(e,t,n)=>{var r=n(2985),i=Math.PI/180;r(r.S,"Math",{radians:function(e){return e*i}})},3570:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{scale:n(8757)})},3776:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{signbit:function(e){return(e=+e)!=e?e:0==e?1/e==1/0:e>0}})},6754:(e,t,n)=>{var r=n(2985);r(r.S,"Math",{umulh:function(e,t){var n=65535,r=+e,i=+t,o=r&n,a=i&n,s=r>>>16,c=i>>>16,u=(s*a>>>0)+(o*a>>>16);return s*c+(u>>>16)+((o*c>>>0)+(u&n)>>>16)}})},8646:(e,t,n)=>{"use strict";var r=n(2985),i=n(508),o=n(4963),a=n(9275);n(7057)&&r(r.P+n(1670),"Object",{__defineGetter__:function(e,t){a.f(i(this),e,{get:o(t),enumerable:!0,configurable:!0})}})},2658:(e,t,n)=>{"use strict";var r=n(2985),i=n(508),o=n(4963),a=n(9275);n(7057)&&r(r.P+n(1670),"Object",{__defineSetter__:function(e,t){a.f(i(this),e,{set:o(t),enumerable:!0,configurable:!0})}})},3276:(e,t,n)=>{var r=n(2985),i=n(1131)(!0);r(r.S,"Object",{entries:function(e){return i(e)}})},8351:(e,t,n)=>{var r=n(2985),i=n(7643),o=n(2110),a=n(8693),s=n(2811);r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,r=o(e),c=a.f,u=i(r),l={},h=0;u.length>h;)void 0!==(n=c(r,t=u[h++]))&&s(l,t,n);return l}})},6917:(e,t,n)=>{"use strict";var r=n(2985),i=n(508),o=n(1689),a=n(468),s=n(8693).f;n(7057)&&r(r.P+n(1670),"Object",{__lookupGetter__:function(e){var t,n=i(this),r=o(e,!0);do{if(t=s(n,r))return t.get}while(n=a(n))}})},372:(e,t,n)=>{"use strict";var r=n(2985),i=n(508),o=n(1689),a=n(468),s=n(8693).f;n(7057)&&r(r.P+n(1670),"Object",{__lookupSetter__:function(e){var t,n=i(this),r=o(e,!0);do{if(t=s(n,r))return t.set}while(n=a(n))}})},6409:(e,t,n)=>{var r=n(2985),i=n(1131)(!1);r(r.S,"Object",{values:function(e){return i(e)}})},6534:(e,t,n)=>{"use strict";var r=n(2985),i=n(3816),o=n(5645),a=n(4351)(),s=n(6314)("observable"),c=n(4963),u=n(7007),l=n(3328),h=n(4408),d=n(7728),f=n(3531),p=f.RETURN,v=function(e){return null==e?void 0:c(e)},y=function(e){var t=e._c;t&&(e._c=void 0,t())},g=function(e){return void 0===e._o},m=function(e){g(e)||(e._o=void 0,y(e))},_=function(e,t){u(e),this._c=void 0,this._o=e,e=new b(this);try{var n=t(e),r=n;null!=n&&("function"==typeof n.unsubscribe?n=function(){r.unsubscribe()}:c(n),this._c=n)}catch(t){return void e.error(t)}g(this)&&y(this)};_.prototype=h({},{unsubscribe:function(){m(this)}});var b=function(e){this._s=e};b.prototype=h({},{next:function(e){var t=this._s;if(!g(t)){var n=t._o;try{var r=v(n.next);if(r)return r.call(n,e)}catch(e){try{m(t)}finally{throw e}}}},error:function(e){var t=this._s;if(g(t))throw e;var n=t._o;t._o=void 0;try{var r=v(n.error);if(!r)throw e;e=r.call(n,e)}catch(e){try{y(t)}finally{throw e}}return y(t),e},complete:function(e){var t=this._s;if(!g(t)){var n=t._o;t._o=void 0;try{var r=v(n.complete);e=r?r.call(n,e):void 0}catch(e){try{y(t)}finally{throw e}}return y(t),e}}});var x=function(e){l(this,x,"Observable","_f")._f=c(e)};h(x.prototype,{subscribe:function(e){return new _(e,this._f)},forEach:function(e){var t=this;return new(o.Promise||i.Promise)((function(n,r){c(e);var i=t.subscribe({next:function(t){try{return e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:n})}))}}),h(x,{from:function(e){var t="function"==typeof this?this:x,n=v(u(e)[s]);if(n){var r=u(n.call(e));return r.constructor===t?r:new t((function(e){return r.subscribe(e)}))}return new t((function(t){var n=!1;return a((function(){if(!n){try{if(f(e,!1,(function(e){if(t.next(e),n)return p}))===p)return}catch(e){if(n)throw e;return void t.error(e)}t.complete()}})),function(){n=!0}}))},of:function(){for(var e=0,t=arguments.length,n=new Array(t);e<t;)n[e]=arguments[e++];return new("function"==typeof this?this:x)((function(e){var t=!1;return a((function(){if(!t){for(var r=0;r<n.length;++r)if(e.next(n[r]),t)return;e.complete()}})),function(){t=!0}}))}}),d(x.prototype,s,(function(){return this})),r(r.G,{Observable:x}),n(2974)("Observable")},9865:(e,t,n)=>{"use strict";var r=n(2985),i=n(5645),o=n(3816),a=n(8364),s=n(94);r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,i.Promise||o.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then((function(){return n}))}:e,n?function(n){return s(t,e()).then((function(){throw n}))}:e)}})},1898:(e,t,n)=>{"use strict";var r=n(2985),i=n(3499),o=n(188);r(r.S,"Promise",{try:function(e){var t=i.f(this),n=o(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},3364:(e,t,n)=>{var r=n(133),i=n(7007),o=r.key,a=r.set;r.exp({defineMetadata:function(e,t,n,r){a(e,t,i(n),o(r))}})},1432:(e,t,n)=>{var r=n(133),i=n(7007),o=r.key,a=r.map,s=r.store;r.exp({deleteMetadata:function(e,t){var n=arguments.length<3?void 0:o(arguments[2]),r=a(i(t),n,!1);if(void 0===r||!r.delete(e))return!1;if(r.size)return!0;var c=s.get(t);return c.delete(n),!!c.size||s.delete(t)}})},4416:(e,t,n)=>{var r=n(8184),i=n(9490),o=n(133),a=n(7007),s=n(468),c=o.keys,u=o.key,l=function(e,t){var n=c(e,t),o=s(e);if(null===o)return n;var a=l(o,t);return a.length?n.length?i(new r(n.concat(a))):a:n};o.exp({getMetadataKeys:function(e){return l(a(e),arguments.length<2?void 0:u(arguments[1]))}})},6562:(e,t,n)=>{var r=n(133),i=n(7007),o=n(468),a=r.has,s=r.get,c=r.key,u=function(e,t,n){if(a(e,t,n))return s(e,t,n);var r=o(t);return null!==r?u(e,r,n):void 0};r.exp({getMetadata:function(e,t){return u(e,i(t),arguments.length<3?void 0:c(arguments[2]))}})},2213:(e,t,n)=>{var r=n(133),i=n(7007),o=r.keys,a=r.key;r.exp({getOwnMetadataKeys:function(e){return o(i(e),arguments.length<2?void 0:a(arguments[1]))}})},8681:(e,t,n)=>{var r=n(133),i=n(7007),o=r.get,a=r.key;r.exp({getOwnMetadata:function(e,t){return o(e,i(t),arguments.length<3?void 0:a(arguments[2]))}})},3471:(e,t,n)=>{var r=n(133),i=n(7007),o=n(468),a=r.has,s=r.key,c=function(e,t,n){if(a(e,t,n))return!0;var r=o(t);return null!==r&&c(e,r,n)};r.exp({hasMetadata:function(e,t){return c(e,i(t),arguments.length<3?void 0:s(arguments[2]))}})},4329:(e,t,n)=>{var r=n(133),i=n(7007),o=r.has,a=r.key;r.exp({hasOwnMetadata:function(e,t){return o(e,i(t),arguments.length<3?void 0:a(arguments[2]))}})},5159:(e,t,n)=>{var r=n(133),i=n(7007),o=n(4963),a=r.key,s=r.set;r.exp({metadata:function(e,t){return function(n,r){s(e,t,(void 0!==r?i:o)(n),a(r))}}})},9467:(e,t,n)=>{n(1024)("Set")},4837:(e,t,n)=>{n(4881)("Set")},8739:(e,t,n)=>{var r=n(2985);r(r.P+r.R,"Set",{toJSON:n(6132)("Set")})},7220:(e,t,n)=>{"use strict";var r=n(2985),i=n(4496)(!0),o=n(4253)((function(){return"𠮷"!=="𠮷".at(0)}));r(r.P+r.F*o,"String",{at:function(e){return i(this,e)}})},4208:(e,t,n)=>{"use strict";var r=n(2985),i=n(1355),o=n(875),a=n(5364),s=n(3218),c=RegExp.prototype,u=function(e,t){this._r=e,this._s=t};n(9988)(u,"RegExp String",(function(){var e=this._r.exec(this._s);return{value:e,done:null===e}})),r(r.P,"String",{matchAll:function(e){if(i(this),!a(e))throw TypeError(e+" is not a regexp!");var t=String(this),n="flags"in c?String(e.flags):s.call(e),r=new RegExp(e.source,~n.indexOf("g")?n:"g"+n);return r.lastIndex=o(e.lastIndex),new u(r,t)}})},2770:(e,t,n)=>{"use strict";var r=n(2985),i=n(5442),o=n(575),a=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);r(r.P+r.F*a,"String",{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},1784:(e,t,n)=>{"use strict";var r=n(2985),i=n(5442),o=n(575),a=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);r(r.P+r.F*a,"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},5869:(e,t,n)=>{"use strict";n(9599)("trimLeft",(function(e){return function(){return e(this,1)}}),"trimStart")},4325:(e,t,n)=>{"use strict";n(9599)("trimRight",(function(e){return function(){return e(this,2)}}),"trimEnd")},9665:(e,t,n)=>{n(6074)("asyncIterator")},9593:(e,t,n)=>{n(6074)("observable")},8967:(e,t,n)=>{var r=n(2985);r(r.S,"System",{global:n(3816)})},4188:(e,t,n)=>{n(1024)("WeakMap")},7594:(e,t,n)=>{n(4881)("WeakMap")},3495:(e,t,n)=>{n(1024)("WeakSet")},9550:(e,t,n)=>{n(4881)("WeakSet")},1181:(e,t,n)=>{for(var r=n(6997),i=n(7184),o=n(7234),a=n(3816),s=n(7728),c=n(2803),u=n(6314),l=u("iterator"),h=u("toStringTag"),d=c.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=i(f),v=0;v<p.length;v++){var y,g=p[v],m=f[g],_=a[g],b=_&&_.prototype;if(b&&(b[l]||s(b,l,d),b[h]||s(b,h,g),c[g]=d,m))for(y in r)b[y]||o(b,y,r[y],!0)}},4633:(e,t,n)=>{var r=n(2985),i=n(4193);r(r.G+r.B,{setImmediate:i.set,clearImmediate:i.clear})},2564:(e,t,n)=>{var r=n(3816),i=n(2985),o=n(575),a=[].slice,s=/MSIE .\./.test(o),c=function(e){return function(t,n){var r=arguments.length>2,i=!!r&&a.call(arguments,2);return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};i(i.G+i.B+i.F*s,{setTimeout:c(r.setTimeout),setInterval:c(r.setInterval)})},1934:(e,t,n)=>{n(5767),n(8132),n(8388),n(7470),n(4882),n(1520),n(7476),n(9622),n(9375),n(3533),n(4672),n(4157),n(5095),n(9892),n(5115),n(9176),n(8838),n(6253),n(9730),n(6059),n(8377),n(1084),n(4299),n(1246),n(726),n(1901),n(5972),n(3403),n(2516),n(9371),n(6479),n(1736),n(1889),n(5177),n(6943),n(6503),n(6786),n(932),n(7526),n(1591),n(9073),n(347),n(579),n(4669),n(7710),n(5789),n(3514),n(9978),n(8472),n(6946),n(5068),n(413),n(191),n(8306),n(4564),n(9115),n(9539),n(6620),n(2850),n(823),n(7732),n(856),n(703),n(1539),n(5292),n(6629),n(3694),n(7648),n(7795),n(4531),n(3605),n(6780),n(9937),n(511),n(1822),n(9977),n(1031),n(6331),n(1560),n(774),n(522),n(8295),n(7842),n(110),n(75),n(4336),n(1802),n(8837),n(6773),n(5745),n(3057),n(3750),n(3369),n(9564),n(2e3),n(8977),n(2310),n(4899),n(1842),n(6997),n(3946),n(8269),n(6108),n(6774),n(1466),n(9357),n(6142),n(1876),n(851),n(8416),n(8184),n(147),n(9192),n(142),n(1786),n(5368),n(6964),n(2152),n(4821),n(9103),n(1303),n(3318),n(162),n(3834),n(1572),n(2139),n(685),n(5535),n(7347),n(3049),n(6633),n(8989),n(8270),n(4510),n(3984),n(5769),n(55),n(6014),n(2773),n(1268),n(4692),n(7220),n(1784),n(2770),n(5869),n(4325),n(4208),n(9665),n(9593),n(8351),n(6409),n(3276),n(8646),n(2658),n(6917),n(372),n(7698),n(8739),n(8211),n(4837),n(7594),n(9550),n(525),n(9467),n(4188),n(3495),n(5575),n(8967),n(2559),n(8865),n(368),n(6427),n(286),n(2816),n(5986),n(2082),n(6308),n(9221),n(3570),n(6754),n(3776),n(9865),n(1898),n(3364),n(1432),n(6562),n(4416),n(8681),n(2213),n(3471),n(4329),n(5159),n(8267),n(6534),n(2564),n(4633),n(1181),e.exports=n(5645)},1424:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(8081),i=n.n(r),o=n(3645),a=n.n(o)()(i());a.push([e.id,"body {\n  background-color: black;\n  color: white;\n\n  /* Allow mouse dragging. */\n  -moz-user-select: none;\n  -ms-user-select: none;\n  -o-user-select: none;\n  -webkit-user-select: none;\n  user-select: none;\n\n  /* disable touch panning/zooming */\n  -ms-touch-action: none;\n  touch-action: none;\n\n  /* Allow canvas to hit the edges of the browser viewport. */\n  margin: 0;\n}\n\n#screen canvas {\n  margin: auto;\n  /* Hide the gap for font descenders. */\n  display: block;\n}\n\n#overlay {\n  display: none;\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  margin: 0;\n  padding: 0;\n  background: rgba(255, 250, 250, 0.8);\n  display: flex;\n  align-items: center;\n}\n\n#welcome {\n  border: 1px solid #707070;\n  background: white;\n  color: #707070;\n  font-family: sans-serif;\n  padding: 40px;\n  width: 50vw;\n  margin: 0 auto;\n}\n#welcome h1 {\n  font-size: 40px;\n  line-height: 57px;\n  margin: 0;\n}\n#welcome p {\n  font-size: 28px;\n  line-height: 34px;\n  margin: 0 0 100px 0;\n}\n#welcome label {\n  font-size: 32px;\n  line-height: 39px;\n  font-weight: bold;\n}\n#welcome input {\n  margin: 20px 0 0 0;\n  font-weight: normal;\n  font-size: 28px;\n  line-height: 35px;\n  width: 100%;\n  padding: 4px 12px;\n  color: #707070;\n  box-sizing: border-box;\n}\n#welcome .button-wrapper {\n  width: 100%;\n  margin: 100px 0 0 0;\n  display: flex;\n  justify-content: center;\n}\n#welcome button {\n  font-weight: normal;\n  font-size: 28px;\n  line-height: 35px;\n  padding: 4px 12px;\n  color: #707070;\n  box-sizing: border-box;\n}\n\n.name-label {\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n.name-label > div {\n  font-family: helvetica, sans-serif;\n  background: white;\n  padding: 4px 6px;\n  border-radius: 3px;\n  color: #333;\n  transform: translate(-50%);\n}\n\n.player-media {\n  position: absolute;\n  top: 0;\n  left: 0;\n  overflow: hidden;\n  display: flex;\n  justify-content: center;\n}\n\n.player-media video {\n  height: 100%;\n}\n",""]);const s=a},3645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var u=0;u<e.length;u++){var l=[].concat(e[u]);r&&a[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),t.push(l))}},t}},8081:e=>{"use strict";e.exports=function(e){return e[1]}},9616:function(e,t){!function(){function t(e,n){return n?require(e):e.slice?t[r(e)]:function(n,i){e(n={exports:{}}),t[r(i)]=n.exports};function r(e){return e.split("/").slice(-1).toString().replace(".js","")}}if(void 0!==e)var n=e;t((function(e){String.random=function(e,t){var n="";for(e=e||24,t=t||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";e-- >0;)n+=t.charAt(Math.floor(Math.random()*t.length));return n},String.match=function(e,t){var n,r;return"string"==typeof e&&("string"==typeof t&&(t={"=":t}),e===(n=(t=t||{})["="]||t["*"]||t[">"]||t["<"])||r===t["="]&&(n=t["*"]||t[">"],e.slice(0,(n||"").length)===n||r===t["*"]&&(r!==t[">"]&&r!==t["<"]?e>=t[">"]&&e<=t["<"]:r!==t[">"]&&e>=t[">"]||r!==t["<"]&&e<=t["<"])))},String.hash=function(e,t){if("string"==typeof e){if(t=t||0,!e.length)return t;for(var n=0,r=e.length;n<r;++n)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}};var t,n,r,i,o=Object.prototype.hasOwnProperty;Object.plain=function(e){return!!e&&(e instanceof Object&&e.constructor===Object||"Object"===Object.prototype.toString.call(e).match(/^\[object (\w+)\]$/)[1])},Object.empty=function(e,t){for(var n in e)if(o.call(e,n)&&(!t||-1==t.indexOf(n)))return!1;return!0},Object.keys=Object.keys||function(e){var t=[];for(var n in e)o.call(e,n)&&t.push(n);return t},t=setTimeout,n=0,r=0,i=typeof setImmediate!=""+void 0&&setImmediate||t,t.poll=t.poll||function(e){1>=+new Date-n&&r++<3333?e():i((function(){n=+new Date,e()}),r=0)},function(){var e,t=setTimeout,n=t.turn=t.turn||function(e){1==r.push(e)&&i(a)},r=n.s=[],i=t.poll,o=0,a=function(){(e=r[o++])&&e(),o!=r.length&&99!=o||(r=n.s=r.slice(o),o=0),r.length&&i(a)}}(),function(){var e,t=setTimeout,n=t.turn;(t.each=t.each||function(t,r,i,o){o=o||9,function a(s,c,u){if(c=(s=(t||[]).splice(0,o)).length){for(var l=0;l<c&&e===(u=r(s[l]));l++);if(e===u)return void n(a)}i&&i(u)}()})()}()}))(t,"./shim"),t((function(e){e.exports=function e(t,n,r){if(!t)return{to:e};var i="function"==typeof n;if(t=(this.tag||(this.tag={}))[t]||i&&(this.tag[t]={tag:t,to:e._={next:function(e){var t;(t=this.to)&&t.next(e)}}}),i){var o={off:e.off||(e.off=function(){if(this.next===e._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=e._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:e._,next:n,the:t,on:this,as:r};return(o.back=t.last||t).to=o,t.last=o}return(t=t.to)&&void 0!==n&&t.next(n),t}}))(t,"./onto"),t((function(e){e.exports=function(e){return null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e&&e!=1/0&&e!=-1/0&&e==e||!!e&&"string"==typeof e["#"]&&1===Object.keys(e).length&&e["#"]}}))(t,"./valid"),t((function(e){function n(){var e=+new Date;return s<e?(o=0,s=e+n.drift):s=e+(o+=1)/a+n.drift}t("./shim"),n.drift=0;var r,i=-1/0,o=0,a=999,s=i;n.is=function(e,t,n){var r=t&&e&&e._&&e._[">"]||n;if(r)return"number"==typeof(r=r[t])?r:i},n.ify=function(e,t,n,i,o){(e=e||{})._=e._||{},o&&(e._["#"]=o);var a=e._[">"]||(e._[">"]={});return r!==t&&"_"!==t&&("number"==typeof n&&(a[t]=n),r!==i&&(e[t]=i)),e},e.exports=n}))(t,"./state"),t((function(e){t("./shim"),e.exports=function(e){var t={s:{}},n=t.s;e=e||{max:999,age:9e3},t.check=function(e){return!!n[e]&&r(e)};var r=t.track=function(r){var i=n[r]||(n[r]={});return i.was=t.now=+new Date,t.to||(t.to=setTimeout(t.drop,e.age+9)),i};return t.drop=function(r){t.to=null,t.now=+new Date;var i=Object.keys(n);console.STAT&&console.STAT(t.now,+new Date-t.now,"dup drop keys"),setTimeout.each(i,(function(i){var o=n[i];o&&(r||e.age)>t.now-o.was||delete n[i]}),0,99)},t}}))(t,"./dup"),t((function(e){t("./onto"),e.exports=function(e,t){if(this.on){var r=(this.opt||{}).lack||9e3;if("function"!=typeof e){if(!e)return;var i=e["#"]||e,o=(this.tag||"")[i];if(!o)return;return t&&(o=this.on(i,t),clearTimeout(o.err),o.err=setTimeout((function(){o.off()}),r)),!0}if(i=t&&t["#"]||n(9),!e)return i;var a=this.on(i,e,t);return a.err=a.err||setTimeout((function(){a.off(),a.next({err:"Error: No ACK yet.",lack:!0})}),r),i}};var n=String.random||function(){return Math.random().toString(36).slice(2)}}))(t,"./ask"),t((function(e){function r(e){return e instanceof r?(this._={$:this}).$:this instanceof r?r.create(this._={$:this,opt:e}):new r(e)}r.is=function(e){return e instanceof r||e&&e._&&e===e._.$||!1},r.version=.202,r.chain=r.prototype,r.chain.toJSON=function(){},t("./shim"),r.valid=t("./valid"),r.state=t("./state"),r.on=t("./onto"),r.dup=t("./dup"),r.ask=t("./ask"),function(){function e(n){if(n)if(n.out!==e){var i,o=this.as,c=o.at||o,u=c.$,l=c.dup,h=n.DBG;if((i=n["#"])||(i=n["#"]=s(9)),!l.check(i)){if(l.track(i),i=n._,n._="function"==typeof i?i:function(){},n.$&&n.$===(n.$._||"").$||(n.$=u),n["@"]&&!n.put&&function(e){var t,n=e["@"]||"";(t=n._)&&(t.acks=(t.acks||0)+1,(t.err=e.err)&&(e["@"]=t["#"],a(t)),t.stop||t.crack||(t.crack=t.match&&t.match.push((function(){f(t)}))),f(t))}(n),!c.ask(n["@"],n)){if(h&&(h.u=+new Date),n.put)return void t(n);n.get&&r.on.get(n,u)}h&&(h.uc=+new Date),this.to.next(n),h&&(h.ua=+new Date),n.nts||n.NTS||(n.out=e,c.on("out",n),h&&(h.ue=+new Date))}}else this.to.next(n)}function t(t){if(t){var r=t._||"",o=r.root=((r.$=t.$||"")._||"").root;if(t["@"]&&r.faith&&!r.miss)return t.out=e,void o.on("out",t);r.latch=o.hatch,r.match=o.hatch=[];var s=t.put,l=r.DBG=t.DBG,h=+new Date;if(p=p||h,!s["#"]||!s["."]){l&&(l.p=h),r["#"]=t["#"],r.msg=t,r.all=0,r.stun=1;var d=Object.keys(s);console.STAT&&console.STAT(h,((l||r).pk=+new Date)-h,"put sort");var f,g,m,_,x,w,T,k=0;!function e(o){if(f!=k){if(f=k,!(m=d[k]))return console.STAT&&console.STAT(h,((l||r).pd=+new Date)-h,"put"),void a(r);(_=s[m])?(T=_._)?m!==T["#"]?w=v+y(m)+"soul not same.":(x=T[">"])||(w=v+y(m)+"no state."):w=v+y(m)+"no meta.":w=v+y(m)+"no node.",g=Object.keys(_||{})}if(w)return t.err=r.err=w,void a(r);var p,S=0;for(o=o||0;o++<9&&(p=g[S++]);)if("_"!==p){var E=_[p],C=x[p];if(i===C){w=v+y(p)+"on"+y(m)+"no state.";break}if(!u(E)){w=v+y(p)+"on"+y(m)+"bad "+typeof E+y(E);break}n(E,p,m,C,t),++b}(g=g.slice(S)).length?c(e):(++k,g=null,e(o))}()}}}function n(e,t,r,i,o){var a,s=o._||"",c=s.root,u=c.graph,h=u[r]||d,f=l(h,t,1),p=h[t],v=s.DBG;(a=console.STAT)&&(u[r]&&p||(a.has=(a.has||0)+1));var y=_();if(i>y)return setTimeout((function(){n(e,t,r,i,o)}),(a=i-y)>m?m:a),void(console.STAT&&console.STAT((v||s).Hf=+new Date,a,"future"));if((!(i<f)||s.miss)&&(s.faith||i!==f||!(e===p||g(e)<=g(p))||s.miss)){s.stun++;var b=o["#"]+s.all++,x={toString:function(){return b},_:s};x.toJSON=x.toString,v&&(v.ph=v.ph||+new Date),c.on("put",{"#":x,"@":o["@"],put:{"#":r,".":t,":":e,">":i},_:s})}}function o(e){var t;(t=(e._||"").DBG)&&(t.pa=+new Date,t.pm=t.pm||+new Date);var n,r=this.as,i=r.graph,o=e._,s=e.put,c=s["#"],u=s["."],l=s[":"],d=s[">"];e["#"],(n=o.msg)&&(n=n.put)&&(n=n[c])&&h(n,u,d,l,c),i[c]=h(i[c],u,d,l,c),(n=(r.next||"")[c])&&n.on("in",e),a(o),this.to.next(e)}function a(t,n){var r;if(!t.stop&&(t.err||!(0<--t.stun))&&(t.stop=1,r=t.root)){var i=t.match;i.end=1,i===r.hatch&&(!(i=t.latch)||i.end?delete r.hatch:r.hatch=i),t.hatch&&t.hatch(),setTimeout.each(t.match,(function(e){e&&e()})),!(n=t.msg)||t.err||n.err||(n.out=e,t.root.on("out",n),x())}}function f(e){e&&e.root&&(e.stun||e.acks!==e.all||e.root.on("in",{"@":e["#"],err:e.err,ok:e.err?i:{"":1}}))}r.create=function(t){t.root=t.root||t,t.graph=t.graph||{},t.on=t.on||r.on,t.ask=t.ask||r.ask,t.dup=t.dup||r.dup();var n=t.$.opt(t.opt);return t.once||(t.on("in",e,t),t.on("out",e,t),t.on("put",o,t),r.on("create",t),t.on("create",t)),t.once=1,n},r.on.put=t;var p,v="Error: Invalid graph!",y=function(e){return" '"+(""+e).slice(0,9)+"...' "},g=JSON.stringify,m=2147483647,_=r.state,b=0,x=function(){b>999&&b/-(p-(p=+new Date))>1&&(r.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),x=function(){b=0})}}(),function(){function e(e,t){var n=+new Date,r=e._||{},o=r.DBG=e.DBG,a=e["#"],c=s(9),u=Object.keys(t||"").sort(),d=((t||"")._||"")["#"],f=(u.length,e.$._.root),p=t===f.graph[d];console.STAT&&console.STAT(n,((o||r).gk=+new Date)-n,"got keys"),t&&function e(){n=+new Date;for(var r,v,y,g=0,m={};g<9&&(r=u[g++]);)h(m,r,l(t,r),t[r],d);u=u.slice(g),(v={})[d]=m,m=v,p&&((y=function(){}).ram=y.faith=!0),v=u.length,console.STAT&&console.STAT(n,-(n-(n=+new Date)),"got copied some"),o&&(o.ga=+new Date),f.on("in",{"@":a,"#":c,put:m,"%":v?c=s(9):i,$:f.$,_:y,DBG:o}),console.STAT&&console.STAT(n,+new Date-n,"got in"),v&&setTimeout.turn(e)}(),t||f.on("in",{"@":e["#"]})}r.on.get=function(t,n){var r=n._,o=t.get,a=o["#"],s=r.graph[a],c=o["."],u=((r.next||(r.next={}))[a],(t._||{}).DBG=t.DBG);if(u&&(u.g=+new Date),!s)return r.on("get",t);if(c){if("string"!=typeof c||i===s[c])return r.on("get",t);s=h({},c,l(s,c),s[c],a)}s&&e(t,s),r.on("get",t)},r.on.get.ack=e}(),r.chain.opt=function(e){e=e||{};var t=this._,n=e.peers||e;return Object.plain(e)||(e={}),Object.plain(t.opt)||(t.opt=e),"string"==typeof n&&(n=[n]),n instanceof Array&&(Object.plain(t.opt.peers)||(t.opt.peers={}),n.forEach((function(e){var n={};n.id=n.url=e,t.opt.peers[e]=t.opt.peers[e]||n}))),t.opt.peers=t.opt.peers||{},a(e,(function e(t){var n=this[t];this&&this.hasOwnProperty(t)||"string"==typeof n||Object.empty(n)?this[t]=n:(!n||n.constructor===Object||n instanceof Array)&&a(n,e)})),r.on("opt",t),t.opt.uuid=t.opt.uuid||function(e){return r.state().toString(36).replace(".","")+String.random(e||12)},this};var i,o,a=function(e,t){Object.keys(e).forEach(t,e)},s=String.random,c=setTimeout.turn,u=r.valid,l=r.state.is,h=r.state.ify,d={};r.log=function(){return!r.log.off&&o.log.apply(o,arguments),[].slice.call(arguments).join(" ")},r.log.once=function(e,t,n){return(n=r.log.once)[e]=n[e]||0,n[e]++||r.log(t)},"undefined"!=typeof window&&((window.GUN=window.Gun=r).window=window);try{void 0!==n&&(n.exports=r)}catch(e){}e.exports=r,(r.window||{}).console=(r.window||{}).console||{log:function(){}},(o=console).only=function(e,t){return o.only.i&&e===o.only.i&&o.only.i++&&(o.log.apply(o,arguments)||t)},r.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")}))(t,"./root"),t((function(e){t("./root").chain.back=function(e,t){if(-1===(e=e||1)||1/0===e)return this._.root.$;if(1===e)return(this._.back||this._).$;var i=this._;if("string"==typeof e&&(e=e.split(".")),e instanceof Array){for(var o=0,a=e.length,s=i;o<a;o++)s=(s||r)[e[o]];return n!==s?t?this:s:(s=i.back)?s.$.back(e,t):void 0}if("function"==typeof e){var c;for(s={back:i};(s=s.back)&&n===(c=e(s,t)););return c}return"number"==typeof e?(i.back||i).$.back(e-1):this};var n,r={}}))(t,"./back"),t((function(e){var n=t("./root");function r(e,t){if(t=t||this.as||e.$._,(!e.$$||this===n.on)&&e.put&&!t.soul){var r=e.put||"",i=r["="]||r[":"],o=t.root,a=o.$.get(r["#"]).get(r["."])._;if("string"==typeof(i=u(i))){if(!(a.echo||(a.echo={}))[t.id]||(o.pass||"")[t.id]){if(s=o.pass){if(s[i+t.id])return;s[i+t.id]=1}(a.echo||(a.echo={}))[t.id]=t,t.has&&(t.link=i);var s,c=o.$.get(a.link=i)._;(c.echo||(c.echo={}))[a.id]=a,((s=t.ask||"")[""]||t.lex)&&c.on("out",{get:{"#":i}}),setTimeout.each(Object.keys(s),(function(e,t){e&&(t=s[e])&&t.on("out",{get:{"#":i,".":e}})}),0,99)}}else this===n.on&&((a.echo||(a.echo={}))[t.id]=t)}}function i(e,t){var n,r,o=e.put||"",s=a!==o["="]?o["="]:o[":"],c=t.root;if(a===s){if(t.soul&&a!==t.put)return;if(r=(e.$$||e.$||"")._||"",e["@"]&&(a!==r.put||a!==t.put))return;return(n=t.link||e.linked)&&delete(c.$.get(n)._.echo||"")[t.id],t.has&&(t.link=null),t.put=a,void setTimeout.each(Object.keys(t.next||""),(function(e,r){(r=t.next[e])&&(n&&delete(c.$.get(n).get(e)._.echo||"")[r.id],r.on("in",{get:e,put:a,$:r.$}))}),0,99)}t.soul||e.$$||(n=u(s),r=e.$._||"",(n!==r.link&&(!t.has||r.link)||(c.pass||"")[t.id]&&"string"!=typeof n)&&(delete(r.echo||"")[t.id],i({get:t.get,put:a,$:e.$,linked:e.linked=e.linked||r.link},t)))}function o(e,t){var r=this.as,i=r.$._,o=(i.root,r.get||""),s=(e.put||"")[o["#"]]||"";if(!e.put||"string"==typeof o["."]&&a===s[o["."]]){if(a!==i.put)return;if(!i.soul&&!i.has)return;return i.ack=(i.ack||0)+1,void i.on("in",{get:i.get,put:i.put=a,$:i.$,"@":e["@"]})}(e._||{}).miss=1,n.on.put(e)}n.chain.chain=function(e){var t,r=this,i=r._,o=new(e||r).constructor(r),a=o._;return a.root=t=i.root,a.id=++t.once,a.back=r._,a.on=n.on,a.on("in",n.on.in,a),a.on("out",n.on.out,a),o},n.on.out=function(e){var t,n,r=this.as,i=r.back,s=r.root;if(e.$||(e.$=r.$),this.to.next(e),!r.err){if(t=e.get){if(s.pass&&(s.pass[r.id]=r),r.lex&&Object.keys(r.lex).forEach((function(e){n[e]=r.lex[e]}),n=e.get=e.get||{}),t["#"]||r.soul){if(t["#"]=t["#"]||r.soul,e["#"]||(e["#"]=c(9)),i=s.$.get(t["#"])._,t=t["."]){if(l(i.put,t)&&(n=i.ask&&i.ask[t],(i.ask||(i.ask={}))[t]=i.$.get(t)._,i.on("in",{get:t,put:{"#":i.soul,".":t,":":i.put[t],">":d(s.graph[i.soul],t)}}),n))return}else{if(n=i.ask&&i.ask[""],(i.ask||(i.ask={}))[""]=i,a!==i.put&&(i.on("in",i),n))return;e.$=i.$}return s.ask(o,e),s.on("in",e)}if(t["."])return r.get?(e={get:{".":r.get},$:r.$},(i.ask||(i.ask={}))[r.get]=e.$._,i.on("out",e)):(e={get:r.lex?e.get:{},$:r.$},i.on("out",e));if((r.ask||(r.ask={}))[""]=r,r.get)return t["."]=r.get,(i.ask||(i.ask={}))[r.get]=e.$._,i.on("out",e)}return i.on("out",e)}r.on("in",{put:r.put=a,$:r.$})},n.on.in=function(e,t){var n,o=(t=t||this.as).root,c=e.$||(e.$=t.$),l=(c||"")._||s,h=e.put||"",p=h["#"],v=h["."],y=a!==h["="]?h["="]:h[":"],g=h[">"]||-1/0;if(a!==e.put&&(a===h["#"]||a===h["."]||a===h[":"]&&a===h["="]||a===h[">"]))return u(h)?void t.on("in",{$:l.back.$,put:{"#":p=l.back.soul,".":v=l.has||l.get,"=":h,">":d(l.back.put,v)},via:e}):(p=((h||"")._||"")["#"])?(c=t.root.$.get(p),setTimeout.each(Object.keys(h).sort(),(function(n){"_"!=n&&a!==(g=d(h,n))&&t.on("in",{$:c,put:{"#":p,".":n,"=":h[n],">":g},VIA:e})}))):void console.log("chain not yet supported for",h,"...",e,t);(e.seen||"")[t.id]||((e.seen||(e.seen=function(){}))[t.id]=t,t!==l&&(Object.keys(e).forEach((function(t){h[t]=e[t]}),h={}),h.get=t.get||h.get,t.soul||t.has?l.soul&&(h.$=t.$,h.$$=h.$$||l.$):h.$$$=h.$$$||t.$,e=h),i(e,t),(t.soul||e.$$)&&g>=d(o.graph[p],v)&&((h=o.$.get(p)._).put=f(h.put,v,g,y,p)),!l.soul&&g>=d(o.graph[p],v)&&(n=(o.$.get(p)._.next||"")[v])&&(n.put=y,"string"==typeof(h=u(y))&&(n.put=o.$.get(h)._.put||y)),this.to&&this.to.next(e),t.any&&setTimeout.each(Object.keys(t.any),(function(n){(n=t.any[n])&&n(e)}),0,99),t.echo&&setTimeout.each(Object.keys(t.echo),(function(n){(n=t.echo[n])&&n.on("in",e)}),0,99),((e.$$||"")._||l).soul&&(n=t.next)&&(n=n[v])&&(h={},Object.keys(e).forEach((function(t){h[t]=e[t]})),h.$=(e.$$||e.$).get(h.get=v),delete h.$$,delete h.$$$,n.on("in",h)),r(e,t))},n.on.link=r,n.on.unlink=i;var a,s={},c=String.random,u=n.valid,l=function(e,t){return e&&Object.prototype.hasOwnProperty.call(e,t)},h=n.state,d=h.is,f=h.ify}))(t,"./chain"),t((function(e){var n=t("./root");function r(e){var t=this.at||this.on;if(!e||t.soul||t.has)return this.off();if(e=(e=(e=e.$||e)._||e).id){var n;if(t.map,(n=this.seen||(this.seen={}))[e])return!0;n[e]=!0}}n.chain.get=function(e,t,s){var c,u;if("string"==typeof e){if(0==e.length)return(c=this.chain())._.err={err:n.log("0 length key!",e)},t&&t.call(c,c._.err),c;(c=((h=this._).next||o)[e])||(c=e&&function(e,t){var n=t._,r=n.next,i=t.chain()._;return r||(r=n.next={}),r[i.get=e]=i,t===n.root.$?i.soul=e:(n.soul||n.has)&&(i.has=e),i}(e,this)),c=c&&c.$}else{if("function"==typeof e){if(!0===t)return function(e,t,r,o){var a,s=e._,c=0;(a=s.soul||s.link)?t(a,o,s):s.jam?s.jam.push([t,o]):(s.jam=[[t,o]],e.get((function(e,t){if(!(i===e.put&&!s.root.opt.super&&(a=Object.keys(s.root.opt.peers).length)&&++c<=a)){t.rid(e);var r,o=(o=e.$)&&o._||{},u=0;for(a=s.jam,delete s.jam;r=a[u++];){var l=r[0];r=r[1],l&&l(o.link||o.soul||n.valid(e.put)||((e.put||{})._||{})["#"],r,e,t)}}}),{out:{get:{".":!0}}}))}(this,e,0,s),this;var l,h=(c=this)._,d=t||{},f=h.root;d.at=h,d.ok=e;var p={};function v(e,t,r){if(!v.stun&&(!(o=f.pass)||o[l])){var o,a=e.$._,s=(e.$$||"")._,c=(s||a).put,u=!a.has&&!a.soul,y={};if((u||i===c)&&(c=i===((o=e.put)||"")["="]?i===(o||"")[":"]?o:o[":"]:o["="]),"string"==typeof(o=n.valid(c))&&(c=i===(o=f.$.get(o)._.put)?d.not?i:c:o),!d.not||i!==c){if(i===d.stun){if((o=f.stun)&&o.on&&(h.$.back((function(e){if(o.on(""+e.id,y={}),(y.run||0)<v.id)return y})),!y.run&&o.on(""+a.id,y={}),!y.run&&s&&o.on(""+s.id,y={}),v.id>y.run&&(y.stun&&!y.stun.end||(y.stun=o.on("stun"),y.stun=y.stun&&y.stun.last),y.stun&&!y.stun.end)))return void((y.stun.add||(y.stun.add={}))[l]=function(){v(e,t,1)});if(i===c&&(r=0),(o=f.hatch)&&!o.end&&i===d.hatch&&!r){if(p[a.$._.id])return;return p[a.$._.id]=1,void o.push((function(){v(e,t,1)}))}p={}}if(f.pass){if(f.pass[l+a.id])return;f.pass[l+a.id]=1}d.on?d.ok.call(a.$,c,a.get,e,t||v):d.v2020?d.ok(e,t||v):(Object.keys(e).forEach((function(t){o[t]=e[t]}),o={}),(e=o).put=c,d.ok.call(d.as,e,t||v))}}}return v.at=h,(h.any||(h.any={}))[l=String.random(7)]=v,v.off=function(){v.stun=1,h.any&&delete h.any[l]},v.rid=r,v.id=d.run||++f.once,u=f.pass,(f.pass={})[l]=1,d.out=d.out||{get:{}},h.on("out",d.out),f.pass=u,c}if("number"==typeof e)return this.get(""+e,t,s);if("string"==typeof(u=a(e)))return this.get(u,t,s);(u=this.get.next)&&(c=u(this,e))}return c?(t&&"function"==typeof t&&c.get(t,s),c):((c=this.chain())._.err={err:n.log("Invalid get request!",e)},t&&t.call(c,c._.err),c)};var i,o={},a=n.valid}))(t,"./get"),t((function(e){var n=t("./root");function r(e,t){if(t){t=(t._||"").id||t;var r,i=e.root.stun||(e.root.stun={on:n.on}),o={};e.stun||(e.stun=i.on("stun",(function(){}))),(r=i.on(""+t))&&r.the.last.next(o),o.run>=e.run||i.on(""+t,(function(t){if(e.stun.end)return this.off(),void this.to.next(t);t.run=t.run||e.run,t.stun=t.stun||e.stun}))}}function i(e){if(e.err)i.end(e.stun,e.root);else if(!e.todo.length&&!e.end&&Object.empty(e.wait)){e.end=1;var t,r=e.$.back(-1)._,o=r.root,a=r.ask((function(t){o.on("ack",t),t.err&&n.log(t),++s>(e.acks||0)&&this.off(),e.ack&&e.ack(t,this)}),e.opt),s=0,c=e.stun;(t=function(){c&&(i.end(c,o),setTimeout.each(Object.keys(c=c.add||""),(function(e){(e=c[e])&&e()})))}).hatch=t,e.via._.on("out",{put:e.out=e.graph,opt:e.opt,"#":a,_:t})}}n.chain.put=function(e,t,a){var l=this,h=l._,d=h.root;(a=a||{}).root=h.root,a.run||(a.run=d.once),r(a,h.id),a.ack=a.ack||t,a.via=a.via||l,a.data=a.data||e,a.soul||(a.soul=h.soul||"string"==typeof t&&t);var f=a.state=a.state||n.state();return"function"==typeof e?(e((function(e){a.data=e,l.put(o,o,a)})),l):a.soul?(a.$=d.$.get(a.soul),a.todo=[{it:a.data,ref:a.$}],a.turn=a.turn||s,a.ran=a.ran||i,function e(){var t,o,s,l,h,d=a.todo,p=d.pop(),v=p.it;if(p.ref&&p.ref._.id,r(a,p.ref),(l=p.todo)&&(v=v[o=l.pop()],l.length&&d.push(p)),o&&(d.path||(d.path=[])).push(o),!(t=c(v))&&!(h=n.is(v))){if(!Object.plain(v))return void i.err(a,"Invalid data: "+function(e,t){return e&&(t=e.constructor)&&t.name||typeof e}(v)+" at "+(a.via.back((function(e){e.get&&l.push(e.get)}),l=[])||l.join("."))+"."+(d.path||[]).join("."));for(var y=a.seen||(a.seen=[]),g=y.length;g--;)if(v===(l=y[g]).it){t=v=l.link;break}}if(o&&t)p.node=u(p.node,o,f,v);else{if(!a.seen)return void i.err(a,"Data at root of graph must be a node (an object).");a.seen.push(s={it:v,link:{},todo:h?[]:Object.keys(v).sort().reverse(),path:(d.path||[]).slice(),up:p}),p.node=u(p.node,o,f,s.link),!h&&s.todo.length&&d.push(s);var m=a.seen.length;function _(e,t){var n=s.link["#"];t&&(t.off(),t.rid(e));var i=n||e.soul||(l=(e.$$||e.$)._||"").soul||l.link||((l=l.put||"")._||"")["#"]||l["#"]||((l=e.put||"")&&e.$$?l["#"]:(l["="]||l[":"]||"")["#"]);!n&&r(a,e.$),i||p.link["#"]?(i||(i=[],(e.$$||e.$).back((function(e){if(l=e.soul||e.link)return i.push(l);i.push(e.get)})),i=i.reverse().join("/")),s.link["#"]=i,!h&&(((a.graph||(a.graph={}))[i]=s.node||(s.node={_:{}}))._["#"]=i),delete a.wait[m],s.wait&&setTimeout.each(s.wait,(function(e){e&&e()})),a.ran(a)):(p.wait||(p.wait=[])).push((function(){_(e,t)}))}(a.wait||(a.wait={}))[m]="",l=(s.ref=h?v:o?p.ref.get(o):p.ref)._,(l=v&&(v._||"")["#"]||l.soul||l.link)?_({soul:l}):s.ref.get(_,{run:a.run,v2020:1,out:{get:{".":" "}}})}if(!d.length)return a.ran(a);a.turn(e)}(),l):(function(e){var t,n=e.via._;e.via=e.via.back((function(n){if(n.soul||!n.get)return n.$;t=e.data,(e.data={})[n.get]=t})),e.via&&e.via._.soul||(e.via=n.root.$.get(((e.data||"")._||"")["#"]||n.$.back("opt.uuid")())),e.via.put(e.data,e.ack,e)}(a),l)},i.end=function(e,t){e.end=a,e.the.to===e&&e===e.the.last&&delete t.stun,e.off()},i.err=function(e,t){(e.ack||a).call(e,e.out={err:e.err=n.log(t)}),e.ran(e)};var o,a=function(){},s=setTimeout.turn,c=n.valid,u=n.state.ify}))(t,"./put"),t((function(e){var n=t("./root");t("./chain"),t("./back"),t("./put"),t("./get"),e.exports=n}))(t,"./index"),t((function(e){var n,r=t("./index");r.chain.on=function(e,t,n,r){var i,o=this,a=o._;if(a.root,"string"==typeof e)return t?(i=a.on(e,t,n||a,r),n&&n.$&&(n.subs||(n.subs=[])).push(i),o):a.on(e);var s=t;return(s=!0===s?{change:!0}:s||{}).not=1,s.on=1,o.get(e,s),o},r.chain.once=function(e,t){if(t=t||{},!e)return function(e,t,n){return r.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(n=e.chain())._.nix=e.once((function(e,t){n._.on("in",this._)})),n._.lex=e._.lex,n}(this);var i,o=this,a=o._,s=a.root,c=(a.put,String.random(7));return o.get((function(o,u,l,h){var d=this,f=d._,p=f.one||(f.one={});function v(y){f.has||f.soul||(f={put:o,get:u}),n===(i=f.put)&&(i=((l.$$||"")._||"").put),"string"!=typeof r.valid(i)||(i=s.$.get(i)._.put)!==n||y?h.stun||""!==p[c]&&(p[c]="",(a.soul||a.has)&&h.off(),e.call(d,i,f.get),clearTimeout(p[c])):p[c]=setTimeout((function(){v(1)}),t.wait||99)}h.stun||""!==p[c]&&(!0!==(i=r.valid(o))?"string"!=typeof i&&(clearTimeout((a.one||"")[c]),clearTimeout(p[c]),p[c]=setTimeout(v,t.wait||99)):v())}),{on:1}),o},r.chain.off=function(){var e,t=this._,n=t.back;if(n)return t.ack=0,(e=n.next)&&e[t.get]&&delete e[t.get],(e=n.ask)&&delete e[t.get],(e=n.put)&&delete e[t.get],(e=t.soul)&&delete n.root.graph[e],(e=t.map)&&Object.keys(e).forEach((function(t,r){(r=e[t]).link&&n.root.$.get(r.link).off()})),(e=t.next)&&Object.keys(e).forEach((function(t,n){e[t].$.off()})),t.on("off",{}),this}}))(t,"./on"),t((function(e){var n=t("./index"),r=n.chain.get.next;function i(e){this.to.next(e);var t,r=this.as,i=e.$._,o=e.put;(i.soul||e.$$)&&((t=r.lex)&&!String.match(e.get||(o||"")["."],t["."]||t["#"]||t)||n.on.link(e,r))}n.chain.get.next=function(e,t){var n;return Object.plain(t)?(n=((n=t["#"])||"")["="]||n)?e.get(n):((n=e.chain()._).lex=t,e.on("in",(function(e){String.match(e.get||(e.put||"")["."],t["."]||t["#"]||t)&&n.on("in",e),this.to.next(e)})),n.$):(r||a)(e,t)},n.chain.map=function(e,t,r){var s,c,u=this,l=u._;return Object.plain(e)&&(s=e["."]?e:{".":e},e=o),e?(n.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),c=u.chain(),u.map().on((function(t,r,i,s){var u=(e||a).call(this,t,r,i,s);if(o!==u){if(t===u)return c._.on("in",i);if(n.is(u))return c._.on("in",u._);var l={};Object.keys(i.put).forEach((function(e){l[e]=i.put[e]}),l),l["="]=u,c._.on("in",{get:r,put:l})}})),c):((c=l.each)||((l.each=c=u.chain())._.lex=s||c._.lex||l.lex,c._.nix=u.back("nix"),u.on("in",i,c._)),c)};var o,a=function(){}}))(t,"./map"),t((function(e){var n=t("./index");n.chain.set=function(e,t,r){var i,o,a=this,s=a.back(-1);return t=t||function(){},(r=r||{}).item=r.item||e,(i=((e||"")._||"")["#"])&&((e={})["#"]=i),"string"==typeof(o=n.valid(e))?a.get(i=o).put(e,t,r):n.is(e)?(a.put((function(r){e.get((function(e,i,s){if(!e)return t.call(a,{err:n.log('Only a node can be linked! Not "'+s.put+'"!')});(o={})[e]={"#":e},r(o)}),!0)})),e):(Object.plain(e)&&(e=s.get(i=a.back("opt.uuid")()).put(e)),a.get(i||s.back("opt.uuid")(7)).put(e,t,r))}}))(t,"./set"),t((function(e){t("./shim");var n,r=function(){},i=JSON.parseAsync||function(e,t,n){var r=+new Date;try{t(void 0,JSON.parse(e,n),o.sucks(+new Date-r))}catch(e){t(e)}},o=JSON.stringifyAsync||function(e,t,n,r){var i=+new Date;try{t(void 0,JSON.stringify(e,n,r),o.sucks(+new Date-i))}catch(e){t(e)}};o.sucks=function(e){e>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),o.sucks=r)};try{e.exports=function(e){var t=function(){},r=e.opt||{};r.log=r.log||console.log,r.gap=r.gap||r.wait||0,r.max=r.max||.3*(r.memory?999*r.memory*999:3e8),r.pack=r.pack||.01*r.max*.01,r.puff=r.puff||9;var a=setTimeout.turn||setTimeout,s=e.dup,c=s.check,u=s.track,l=(new Date,t.hear=function(e,n){if(e){if(r.max<=e.length)return t.say({dam:"!",err:"Message too big!"},n);t===this&&(l.d+=e.length||0,++l.c);var o,s=n.SH=+new Date,c=e[0];return"["===c?(i(e,(function(e,i){if(e||!i)return t.say({dam:"!",err:"DAM JSON parse error."},n);console.STAT&&console.STAT(+new Date,i.length,"# on hear batch");var o=r.puff;!function e(){for(var t,r=+new Date,s=0;s<o&&(t=i[s++]);)l(t,n);i=i.slice(s),console.STAT&&console.STAT(r,+new Date-r,"hear loop"),h(n),i.length&&a(e,0)}()})),void(e="")):"{"===c||(e["#"]||Object.plain(e))&&(o=e)?o?l.one(o,n,s):void i(e,(function(e,r){if(e||!r)return t.say({dam:"!",err:"DAM JSON parse error."},n);l.one(r,n,s)})):void 0}});function h(e){var t=e.batch,n="string"==typeof t;if(n&&(t+="]"),e.batch=e.tail=null,t&&!(n?3>t.length:!t.length)){if(!n)try{t=1===t.length?t[0]:JSON.stringify(t)}catch(e){return r.log("DAM JSON stringify error",e)}t&&d(t,e)}}function d(e,n){try{var r=n.wire;n.say?n.say(e):r.send&&r.send(e),t.say.d+=e.length||0,++t.say.c}catch(t){(n.queue=n.queue||[]).push(e)}}l.one=function(n,r,i){var o,a,l,h,d;if(n.DBG&&(n.DBG=d={DBG:n.DBG}),d&&(d.h=i),d&&(d.hp=+new Date),(o=n["#"])||(o=n["#"]=String.random(9)),!((l=c(o))||(a=n["##"])&&(l=n["@"]||n.get&&o)&&s.check(h=l+a))){if((n._=function(){}).via=t.leap=r,(l=n["><"])&&"string"==typeof l&&l.slice(0,99).split(",").forEach((function(e){this[e]=1}),n._.yo={}),l=n.dam)return(l=t.hear[l])&&l(n,r,e),void u(o);i=+new Date,d&&(d.is=i),r.SI=o,e.on("in",t.last=n),d&&(d.hd=+new Date),console.STAT&&console.STAT(i,+new Date-i,n.get?"msg get":n.put?"msg put":"msg"),(l=u(o)).via=r,n.get&&(l.it=n),h&&u(h),t.leap=t.last=null}},l.c=l.d=0,function(){var e,i=0;function l(e,t){var n;return t instanceof Object?(Object.keys(t).sort().forEach(f,{to:n={},on:t}),n):t}function f(e){this.to[e]=this.on[e]}t.hash=function(e,t){var n,r,i,s=+new Date;o(e.put,(function o(c,u){var l=(r||(r=i=u||"")).slice(0,32768);n=String.hash(l,n),(r=r.slice(32768))?a(o,0):(console.STAT&&console.STAT(s,+new Date-s,"say json+hash"),e._.$put=i,e["##"]=n,p(e,t),delete e._.$put)}),l)};var p=t.say=function(o,c){var l;if((l=this)&&(l=l.to)&&l.next&&l.next(o),!o)return!1;var f,v,y=o["@"],g=o._||(o._=function(){}),m=o.DBG,_=+new Date;if(g.y=g.y||_,c||m&&(m.y=_),(f=o["#"])||(f=o["#"]=String.random(9)),!e&&u(f),o.put&&(o.err||(s.s[f]||"").err))return!1;if(o["##"]||n===o.put||g.via||!y){if(!c&&y&&(c=(l=s.s[y])&&(l.via||(l=l.it)&&(l=l._)&&l.via)||(l=t.last)&&y===l["#"]&&t.leap),!c&&y){if(s.s[y])return;return console.STAT&&console.STAT(+new Date,++i,"total no peer to ack to"),!1}if(!c&&t.way)return t.way(o);if(m&&(m.yh=+new Date),v=g.raw){if(m&&(m.yr=+new Date),!c||!c.id){if(!Object.plain(c||r.peers))return!1;_=+new Date,r.puff;var b=r.peers,x=Object.keys(c||r.peers||{});return console.STAT&&console.STAT(_,+new Date-_,"peer keys"),void function t(){var n=+new Date;e=1;var r=g.raw;g.raw=v;for(var i,s=0;s<9&&(i=(x||"")[s++]);)(i=b[i])&&p(o,i);g.raw=r,e=0,x=x.slice(s),console.STAT&&console.STAT(n,+new Date-n,"say loop"),x.length&&(a(t,0),y&&u(y))}()}if(!c.wire&&t.wire&&t.wire(c),f!==c.last){if(c.last=f,c===g.via)return!1;if((l=g.yo)&&(l[c.url]||l[c.pid]||l[c.id]))return!1;if(console.STAT&&console.STAT(_,((m||g).yp=+new Date)-(g.y||_),"say prep"),!e&&y&&u(y),c.batch){if(c.tail=(l=c.tail||0)+v.length,c.tail<=r.pack)return void(c.batch+=(l?",":"")+v);h(c)}c.batch="[";var w=+new Date;setTimeout((function(){console.STAT&&console.STAT(w,+new Date-w,"0ms TO"),h(c)}),r.gap),d(v,c),console.STAT&&y===c.SI&&console.STAT(_,+new Date-c.SH,"say ack")}}else t.raw(o,c)}else t.hash(o,c)};t.say.c=t.say.d=0,t.raw=function(e,i){if(!e)return"";var a,u,l=e._||{};if(u=l.raw)return u;if("string"==typeof e)return e;var h=e["##"],d=e["@"];if(h&&d){if(!l.via&&c(d+h))return!1;if((u=(s.s[d]||"").it)||(u=t.last)&&d===u["#"]){if(h===u["##"])return!1;u["##"]||(u["##"]=h)}}if(!e.dam){var f=0,v=[];for(var y in u=r.peers){var g=u[y];if(v.push(g.url||g.pid||g.id),++f>6)break}f>1&&(e["><"]=v.join())}if(a=l.$put)return u={},Object.keys(e).forEach((function(t){u[t]=e[t]})),u.put=":])([:",void o(u,(function(e,t){if(!e){var r=+new Date;u=t.indexOf('"put":":])([:"'),m(n,t=t.slice(0,u+6)+a+t.slice(u+14)),console.STAT&&console.STAT(r,+new Date-r,"say slice")}}));function m(t,n){t||(l.raw=n,p(e,i))}o(e,m)}}(),t.hi=function(n){var i=n.wire||{};n.id?r.peers[n.url||n.id]=n:(i=n.id=n.id||String.random(9),t.say({dam:"?",pid:e.opt.pid},r.peers[i]=n),delete s.s[n.last]),n.met=n.met||+new Date,i.hied||e.on(i.hied="hi",n),i=n.queue,n.queue=[],setTimeout.each(i||[],(function(e){d(e,n)}),0,9)},t.bye=function(n){e.on("bye",n);var r=+new Date;r-=n.met||r,t.bye.time=((t.bye.time||r)+r)/2},t.hear["!"]=function(e,t){r.log("Error:",e.err)},t.hear["?"]=function(e,n){e.pid&&(n.pid||(n.pid=e.pid),e["@"])||(t.say({dam:"?",pid:r.pid,"@":e["#"]},n),delete s.s[n.last])},e.on("create",(function(e){e.opt.pid=e.opt.pid||String.random(9),this.to.next(e),e.on("out",t.say)})),e.on("bye",(function(e,t){e=r.peers[e.id||e]||e,this.to.next(e),e.bye?e.bye():(t=e.wire)&&t.close&&t.close(),delete r.peers[e.id],e.wire=null}));var f={};return e.on("bye",(function(e,t){this.to.next(e),(t=console.STAT)&&(t.peers=(t.peers||0)-1),(t=e.url)&&(f[t]=!0,setTimeout((function(){delete f[t]}),r.lack||9e3))})),e.on("hi",(function(n,i){this.to.next(n),(i=console.STAT)&&(i.peers=(i.peers||0)+1),(i=n.url)&&f[i]&&(delete f[i],r.super||setTimeout.each(Object.keys(e.next),(function(r){e.next[r],(i={})[r]=e.graph[r],i=String.hash(i),t.say({"##":i,get:{"#":r}},n)})))})),t}}catch(e){}}))(t,"./mesh"),t((function(e){var n=t("../index");n.Mesh=t("./mesh"),n.on("opt",(function(e){if(this.to.next(e),!e.once){var t=e.opt;if(!1!==t.WebSocket){var r=n.window||{},i=t.WebSocket||r.WebSocket||r.webkitWebSocket||r.mozWebSocket;if(i){t.WebSocket=i;var o=t.mesh=t.mesh||n.Mesh(e);o.wire||t.wire,o.wire=t.wire=c,setTimeout((function(){!t.super&&e.on("out",{dam:"hi"})}),1);var a=1998,s=""+void 0!=typeof document&&document}}}function c(e){try{if(!e||!e.url)return r&&r(e);var n=e.url.replace(/^http/,"ws"),r=e.wire=new t.WebSocket(n);return r.onclose=function(){t.mesh.bye(e),u(e)},r.onerror=function(t){u(e)},r.onopen=function(){t.mesh.hi(e)},r.onmessage=function(n){n&&t.mesh.hear(n.data||n,e)},r}catch(e){}}function u(e){clearTimeout(e.defer),s&&e.retry<=0||(e.retry=(e.retry||t.retry+1||60)-(-e.tried+(e.tried=+new Date)<7992?1:0),e.defer=setTimeout((function t(){if(s&&s.hidden)return setTimeout(t,a);c(e)}),a))}}))}))(t,"./websocket"),t((function(e){if("undefined"!=typeof Gun){var t;try{t=(Gun.window||function(){}).localStorage}catch(e){}t||(Gun.log("Warning: No localStorage exists to persist data to!"),t={setItem:function(e,t){this[e]=t},removeItem:function(e){delete this[e]},getItem:function(e){return this[e]}}),JSON.parseAsync;var n=JSON.stringifyAsync||function(e,t,n,r){try{t(void 0,JSON.stringify(e,n,r))}catch(e){t(e)}};Gun.on("create",(function e(r){this.to.next(r);var i,o,a,s,c=r.opt,u=(r.graph,[]);if(!1!==c.localStorage){c.prefix=c.file||"gun/";try{i=e[c.prefix]=e[c.prefix]||JSON.parse(o=t.getItem(c.prefix))||{}}catch(t){i=e[c.prefix]={}}a=(o||"").length,r.on("get",(function(e){this.to.next(e);var t,n,r,o=e.get;o&&(t=o["#"])&&((n=i[t]||void 0)&&(r=o["."])&&!Object.plain(r)&&(n=Gun.state.ify({},r,Gun.state.is(n,r),n[r],t)),Gun.on.get.ack(e,n))})),r.on("put",(function(e){this.to.next(e);var t=e.put,n=t["#"],c=t["."],h=e["#"];i[n]=Gun.state.ify(i[n],c,t[">"],t[":"],n),s&&a>4999880?r.on("in",{"@":h,err:"localStorage max!"}):(e["@"]||u.push(h),o||(o=setTimeout(l,9+a/333)))}))}function l(){if(u.length||!((setTimeout.turn||"").s||"").length){var e=u;clearTimeout(o),o=!1,u=[],n(i,(function(n,o){try{!n&&t.setItem(c.prefix,o)}catch(e){n=s=e||"localStorage failure"}n&&(Gun.log(n+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),r.on("localStorage:error",{err:n,get:c.prefix,put:i})),a=o.length,(n||Object.empty(c.peers))&&setTimeout.each(e,(function(e){r.on("in",{"@":e,err:n,ok:0})}),0,99)}))}else setTimeout(l,99)}}))}}))(t,"./localStorage")}(),function(){if(""+w!=typeof Gun){var e=function(e){console.warn("Warning! Deprecated internal utility will break in next version:",e)},t=Gun;t.fn=t.fn||{is:function(t){return e("fn"),!!t&&"function"==typeof t}},t.bi=t.bi||{is:function(t){return e("bi"),t instanceof Boolean||"boolean"==typeof t}},t.num=t.num||{is:function(t){return e("num"),!r(t)&&(t-parseFloat(t)+1>=0||1/0===t||-1/0===t)}},t.text=t.text||{is:function(t){return e("text"),"string"==typeof t}},t.text.ify=t.text.ify||function(n){return e("text.ify"),t.text.is(n)?n:"undefined"!=typeof JSON?JSON.stringify(n):n&&n.toString?n.toString():n},t.text.random=t.text.random||function(t,n){e("text.random");var r="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";t>0;)r+=n.charAt(Math.floor(Math.random()*n.length)),t--;return r},t.text.match=t.text.match||function(t,n){var r,i;return e("text.match"),"string"==typeof t&&("string"==typeof n&&(n={"=":n}),t===(r=(n=n||{})["="]||n["*"]||n[">"]||n["<"])||i===n["="]&&(r=n["*"]||n[">"]||n["<"],t.slice(0,(r||"").length)===r||i===n["*"]&&(i!==n[">"]&&i!==n["<"]?t>=n[">"]&&t<=n["<"]:i!==n[">"]&&t>=n[">"]||i!==n["<"]&&t<=n["<"])))},t.text.hash=t.text.hash||function(t,n){if(e("text.hash"),"string"==typeof t){if(n=n||0,!t.length)return n;for(var r=0,i=t.length;r<i;++r)n=(n<<5)-n+t.charCodeAt(r),n|=0;return n}},t.list=t.list||{is:function(t){return e("list"),t instanceof Array}},t.list.slit=t.list.slit||Array.prototype.slice,t.list.sort=t.list.sort||function(t){return e("list.sort"),function(e,n){return e&&n?(e=e[t])<(n=n[t])?-1:e>n?1:0:0}},t.list.map=t.list.map||function(t,n,r){return e("list.map"),a(t,n,r)},t.list.index=1,t.obj=t.boj||{is:function(t){return e("obj"),!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])}},t.obj.put=t.obj.put||function(t,n,r){return e("obj.put"),(t||{})[n]=r,t},t.obj.has=t.obj.has||function(t,n){return e("obj.has"),t&&Object.prototype.hasOwnProperty.call(t,n)},t.obj.del=t.obj.del||function(t,n){if(e("obj.del"),t)return t[n]=null,delete t[n],t},t.obj.as=t.obj.as||function(t,n,r,i){return e("obj.as"),t[n]=t[n]||(i===r?{}:r)},t.obj.ify=t.obj.ify||function(t){if(e("obj.ify"),i(t))return t;try{t=JSON.parse(t)}catch(e){t={}}return t},function(){function n(e,t){o(this,t)&&void 0!==this[t]||(this[t]=e)}t.obj.to=t.obj.to||function(t,r){return e("obj.to"),a(t,n,r=r||{}),r}}(),t.obj.copy=t.obj.copy||function(t){return e("obj.copy"),t?JSON.parse(JSON.stringify(t)):t},function(){function n(e,t){var n=this.n;if(!n||!(t===n||i(n)&&o(n,t)))return void 0!==t||void 0}t.obj.empty=t.obj.empty||function(t,r){return e("obj.empty"),!t||!a(t,n,{n:r})}}(),function(){function n(e,t){if(2===arguments.length)return n.r=n.r||{},void(n.r[e]=t);n.r=n.r||[],n.r.push(e)}var a,s=Object.keys;Object.keys=Object.keys||function(e){return a(e,(function(e,t,n){n(t)}))},t.obj.map=a=t.obj.map||function(a,c,u){e("obj.map");var l,h,d,f,p,v=0,y="function"==typeof c;if(n.r=l,s&&i(a)&&(f=s(a),p=!0),u=u||{},r(a)||f)for(h=(f||a).length;v<h;v++){var g=v+t.list.index;if(y){if((d=p?c.call(u,a[f[v]],f[v],n):c.call(u,a[v],g,n))!==l)return d}else if(c===a[p?f[v]:v])return f?f[v]:g}else for(v in a)if(y){if(o(a,v)&&(d=u?c.call(u,a[v],v,n):c(a[v],v,n))!==l)return d}else if(c===a[v])return v;return y?n.r:t.list.index?0:-1}}(),t.time=t.time||{},t.time.is=t.time.is||function(t){return e("time"),t?t instanceof Date:+(new Date).getTime()};var n=t.fn.is,r=t.list.is,i=(x=t.obj).is,o=x.has,a=x.map,s={is:function(t){return e("val.is"),t!==w&&(null===t||t!==1/0&&(!!(h(t)||u(t)||l(t))||s.link.is(t)||!1))}};s.link=s.rel={_:"#"},function(){function t(e,t){var n=this;return n.id?n.id=!1:t==c&&h(e)?void(n.id=e):n.id=!1}s.link.is=function(n){if(e("val.link.is"),n&&n[c]&&!n._&&i(n)){var r={};if(a(n,t,r),r.id)return r.id}return!1}}(),s.link.ify=function(t){return e("val.link.ify"),d({},c,t)},t.obj.has._=".";var c=s.link._,u=t.bi.is,l=t.num.is,h=t.text.is,d=(i=(x=t.obj).is,x.put);a=x.map,t.val=t.val||s;var f={_:"_",soul:function(t,n){return e("node.soul"),t&&t._&&t._[n||y]}};f.soul.ify=function(t,n){return e("node.soul.ify"),n="string"==typeof n?{soul:n}:n||{},(t=t||{})._=t._||{},t._[y]=n.soul||t._[y]||v(),t},f.soul._=s.link._,function(){function t(e,t){if(t!==f._)return!s.is(e)||void(this.cb&&this.cb.call(this.as,e,t,this.n,this.s))}f.is=function(n,r,o){var s;return e("node.is"),!!i(n)&&!!(s=f.soul(n))&&!a(n,t,{as:o,cb:r,s,n})}}(),function(){function t(e,t){var n,r=this.o;r.map?void 0===(n=r.map.call(this.as,e,""+t,r.node))?p(r.node,t):r.node&&(r.node[t]=n):s.is(e)&&(r.node[t]=e)}f.ify=function(n,r,i){return e("node.ify"),r?"string"==typeof r?r={soul:r}:"function"==typeof r&&(r={map:r}):r={},r.map&&(r.node=r.map.call(i,n,w,r.node||{})),(r.node=f.soul.ify(r.node||{},r))&&a(n,t,{o:r,as:i}),r.node}}(),i=(x=t.obj).is;var p=x.del,v=(a=x.map,t.text.random),y=f.soul._;t.node=t.node||f;var g=t.state;g.lex=function(){return e("state.lex"),g().toString(36).replace(".","")},g.to=function(t,n,r){e("state.to");var o=(t||{})[n];return i(o)&&(o=m(o)),g.ify(r,n,g.is(t,n),o,f.soul(t))},function(){function t(e,t){_!==t&&g.ify(this.o,t,this.s)}g.map=function(r,s,c){var u;e("state.map");var h=i(h=r||s)?h:null;return r=n(r=r||s)?r:null,h&&!r?(s=l(s)?s:g(),h[_]=h[_]||{},a(h,t,{o:h,s}),h):(c=c||i(s)?s:u,s=l(s)?s:g(),function(e,n,i,a){if(!r)return t.call({o:i,s},e,n),e;r.call(c||this||{},e,n,i,a),o(i,n)&&u===i[n]||t.call({o:i,s},e,n)})}}(),(x=t.obj).as,o=x.has,i=x.is,a=x.map;var m=x.copy,_=(l=t.num.is,n=t.fn.is,f._),b={};!function(){function t(e,t){if(!e||t!==f.soul(e)||!f.is(e,this.fn,this.as))return!0;this.cb&&(n.n=e,n.as=this.as,this.cb.call(n.as,e,t,n))}function n(e){e&&f.is(n.n,e,n.as)}b.is=function(n,r,o,s){return e("graph.is"),!(!n||!i(n)||T(n)||a(n,t,{cb:r,fn:o,as:s}))}}(),function(){function n(e,t){var n;return(n=function(e,t){for(var n,r=e.seen,i=r.length;i--;)if(n=r[i],t.obj===n.obj)return n;r.push(t)}(e,t))?n:(t.env=e,t.soul=a,f.ify(t.obj,r,t)&&(t.link=t.link||s.link.ify(f.soul(t.node)),t.obj!==e.shell&&(e.graph[s.link.is(t.link)]=t.node)),t)}function r(e,t,r){var i,a,u=this,l=u.env;if(f._===t&&o(e,s.link._))return r._;if(i=c(e,t,r,u,l)){if(t||(u.node=u.node||r||{},o(e,f._)&&f.soul(e)&&(u.node._=m(e._)),u.node=f.soul.ify(u.node,s.link.is(u.link)),u.link=u.link||s.link.ify(f.soul(u.node))),(a=l.map)&&(a.call(l.as||{},e,t,r,u),o(r,t))){if(e=r[t],w===e)return void p(r,t);if(!(i=c(e,t,r,u,l)))return}if(!t)return u.node;if(!0===i)return e;if((a=n(l,{obj:e,path:u.path.concat(t)})).node)return a.link}}function a(e){var t=this,n=s.link.is(t.link),r=t.env.graph;t.link=t.link||s.link.ify(e),t.link[s.link._]=e,t.node&&t.node[f._]&&(t.node[f._][s.link._]=e),o(r,n)&&(r[e]=r[n],p(r,n))}function c(e,n,r,o,a){var u;return!!s.is(e)||(i(e)?1:(u=a.invalid)?c(e=u.call(a.as||{},e,n,r),n,r,o,a):(a.err="Invalid value at '"+o.path.concat(n).join(".")+"'!",void(t.list.is(e)&&(a.err+=" Use `.set(item)` instead of an Array."))))}b.ify=function(t,r,i){e("graph.ify");var o={path:[],obj:t};return r?"string"==typeof r?r={soul:r}:"function"==typeof r&&(r.map=r):r={},"string"==typeof i&&(r.soul=r.soul||i,i=w),r.soul&&(o.link=s.link.ify(r.soul)),r.shell=(i||{}).shell,r.graph=r.graph||{},r.seen=r.seen||[],r.as=r.as||i,n(r,o),r.root=o.node,r.graph}}(),b.node=function(t){e("graph.node");var n=f.soul(t);if(n)return d({},n,t)},function(){function t(e,t){var n,r;if(f._!==t)(n=s.link.is(e))?(r=this.opt.seen[n])?this.obj[t]=r:this.obj[t]=this.opt.seen[n]=b.to(this.graph,n,this.opt):this.obj[t]=e;else{if(T(e,s.link._))return;this.obj[t]=m(e)}}b.to=function(n,r,i){if(e("graph.to"),n){var o={};return i=i||{seen:{}},a(n[r],t,{obj:o,graph:n,opt:i}),o}}}(),n=t.fn.is,i=(x=t.obj).is,p=x.del,o=x.has;var x,w,T=x.empty;d=x.put,a=x.map,m=x.copy,t.graph=t.graph||b}}()},2597:(e,t,n)=>{var r="undefined"!=typeof window?window.Gun:n(9616);r.chain.open||n(9857),r.chain.load=function(e,t,n){return(t=t||{}).off=!0,this.open(e,t,n)}},9857:(e,t,n)=>{var r="undefined"!=typeof window?window.Gun:n(9616);r.chain.open=function(e,t,n,i){return i=i||1,(t=t||{}).doc=t.doc||{},t.ids=t.ids||{},t.any=t.any||e,t.meta=t.meta||!1,t.eve=t.eve||{off:function(){Object.keys(t.eve.s).forEach((function(e,n){(n=t.eve.s[e])&&n.off()})),t.eve.s={}},s:{}},this.on((function(e,o,a,s){if(clearTimeout(t.to),t.to=setTimeout((function(){t.any&&(t.any.call(t.at.$,t.doc,t.key,t,t.eve),t.off&&(t.eve.off(),t.any=null))}),t.wait||9),t.at=t.at||a,t.key=t.key||o,t.eve.s[this._.id]=s,!0!==r.valid(e)){var c=this;setTimeout.each(Object.keys(e),(function(o,a){if("_"!==o||t.meta){a=e[o];var s,u=n||t.doc;u&&("string"==typeof(s=r.valid(a))?t.ids[s]?u[o]=t.ids[s]:t.depth<=i?u[o]=u[o]||a:c.get(o).open(t.any,t,t.ids[s]=u[o]={},i+1):u[o]=a)}}))}else n?n[o]=e:t.doc=e}))}},3096:(e,t,n)=>{var r="Expected a function",i=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,c=parseInt,u="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,l="object"==typeof self&&self&&self.Object===Object&&self,h=u||l||Function("return this")(),d=Object.prototype.toString,f=Math.max,p=Math.min,v=function(){return h.Date.now()};function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function g(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==d.call(e)}(e))return NaN;if(y(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=y(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(i,"");var n=a.test(e);return n||s.test(e)?c(e.slice(2),n?2:8):o.test(e)?NaN:+e}e.exports=function(e,t,n){var i=!0,o=!0;if("function"!=typeof e)throw new TypeError(r);return y(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),function(e,t,n){var i,o,a,s,c,u,l=0,h=!1,d=!1,m=!0;if("function"!=typeof e)throw new TypeError(r);function _(t){var n=i,r=o;return i=o=void 0,l=t,s=e.apply(r,n)}function b(e){return l=e,c=setTimeout(w,t),h?_(e):s}function x(e){var n=e-u;return void 0===u||n>=t||n<0||d&&e-l>=a}function w(){var e=v();if(x(e))return T(e);c=setTimeout(w,function(e){var n=t-(e-u);return d?p(n,a-(e-l)):n}(e))}function T(e){return c=void 0,m&&i?_(e):(i=o=void 0,s)}function k(){var e=v(),n=x(e);if(i=arguments,o=this,u=e,n){if(void 0===c)return b(u);if(d)return c=setTimeout(w,t),_(u)}return void 0===c&&(c=setTimeout(w,t)),s}return t=g(t)||0,y(n)&&(h=!!n.leading,a=(d="maxWait"in n)?f(g(n.maxWait)||0,t):a,m="trailing"in n?!!n.trailing:m),k.cancel=function(){void 0!==c&&clearTimeout(c),l=0,i=u=o=c=void 0},k.flush=function(){return void 0===c?s:T(v())},k}(e,t,{leading:i,maxWait:t,trailing:o})}},5391:function(e,t){parcelRequire=function(n,r,i,o){var a,s="function"==typeof parcelRequire&&parcelRequire,c="function"==typeof require&&require;function u(e,t){if(!r[e]){if(!n[e]){var i="function"==typeof parcelRequire&&parcelRequire;if(!t&&i)return i(e,!0);if(s)return s(e,!0);if(c&&"string"==typeof e)return c(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}l.resolve=function(t){return n[e][1][t]||t},l.cache={};var a=r[e]=new u.Module(e);n[e][0].call(a.exports,l,a,a.exports,this)}return r[e].exports;function l(e){return u(l.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=n,u.cache=r,u.parent=s,u.register=function(e,t){n[e]=[function(e,n){n.exports=t},{}]};for(var l=0;l<i.length;l++)try{u(i[l])}catch(n){a||(a=n)}if(i.length){var h=u(i[i.length-1]);"object"==typeof t&&void 0!==e?e.exports=h:"function"==typeof define&&define.amd&&define((function(){return h}))}if(parcelRequire=u,a)throw a;return u}({EgBh:[function(e,t,n){var r={};r.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),r.useArrayBufferView=!r.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(e){return!0}}(),t.exports.binaryFeatures=r;var i=t.exports.BlobBuilder;function o(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(i=t.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),o.prototype.append=function(e){"number"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},o.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);r.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},o.prototype.getBuffer=function(){if(this.flush(),r.useBlobBuilder){for(var e=new i,t=0,n=this._parts.length;t<n;t++)e.append(this._parts[t]);return e.getBlob()}return new Blob(this._parts)},t.exports.BufferBuilder=o},{}],kdPp:[function(e,t,n){var r=e("./bufferbuilder").BufferBuilder,i=e("./bufferbuilder").binaryFeatures,o={unpack:function(e){return new a(e).unpack()},pack:function(e){var t=new s;return t.pack(e),t.getBuffer()}};function a(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function s(){this.bufferBuilder=new r}function c(e){var t=e.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}t.exports=o,a.prototype.unpack=function(){var e,t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},a.prototype.unpack_uint8=function(){var e=255&this.dataView[this.index];return this.index++,e},a.prototype.unpack_uint16=function(){var e=this.read(2),t=256*(255&e[0])+(255&e[1]);return this.index+=2,t},a.prototype.unpack_uint32=function(){var e=this.read(4),t=256*(256*(256*e[0]+e[1])+e[2])+e[3];return this.index+=4,t},a.prototype.unpack_uint64=function(){var e=this.read(8),t=256*(256*(256*(256*(256*(256*(256*e[0]+e[1])+e[2])+e[3])+e[4])+e[5])+e[6])+e[7];return this.index+=8,t},a.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-256},a.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-65536},a.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},a.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},a.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},a.prototype.unpack_string=function(e){for(var t,n,r=this.read(e),i=0,o="";i<e;)(t=r[i])<128?(o+=String.fromCharCode(t),i++):(192^t)<32?(n=(192^t)<<6|63&r[i+1],o+=String.fromCharCode(n),i+=2):(n=(15&t)<<12|(63&r[i+1])<<6|63&r[i+2],o+=String.fromCharCode(n),i+=3);return this.index+=e,o},a.prototype.unpack_array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this.unpack();return t},a.prototype.unpack_map=function(e){for(var t={},n=0;n<e;n++){var r=this.unpack(),i=this.unpack();t[r]=i}return t},a.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=(e>>23&255)-127;return(0==e>>31?1:-1)*(8388607&e|8388608)*Math.pow(2,t-23)},a.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),n=(e>>20&2047)-1023;return(0==e>>31?1:-1)*((1048575&e|1048576)*Math.pow(2,n-20)+t*Math.pow(2,n-52))},a.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},s.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},s.prototype.pack=function(e){var t=typeof e;if("string"===t)this.pack_string(e);else if("number"===t)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"===t)!0===e?this.bufferBuilder.append(195):!1===e&&this.bufferBuilder.append(194);else if("undefined"===t)this.bufferBuilder.append(192);else{if("object"!==t)throw new Error('Type "'+t+'" not yet supported');if(null===e)this.bufferBuilder.append(192);else{var n=e.constructor;if(n==Array)this.pack_array(e);else if(n==Blob||n==File||e instanceof Blob||e instanceof File)this.pack_bin(e);else if(n==ArrayBuffer)i.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)i.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(n==Object||n.toString().startsWith("class"))this.pack_object(e);else if(n==Date)this.pack_string(e.toString());else{if("function"!=typeof e.toBinaryPack)throw new Error('Type "'+n.toString()+'" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},s.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},s.prototype.pack_string=function(e){var t=function(e){return e.length>600?new Blob([e]).size:e.replace(/[^\u0000-\u007F]/g,c).length}(e);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(t)}this.bufferBuilder.append(e)},s.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var n=0;n<t;n++)this.pack(e[n])},s.prototype.pack_integer=function(e){if(e>=-32&&e<=127)this.bufferBuilder.append(255&e);else if(e>=0&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(e>=-0x8000000000000000&&e<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(e>=0&&e<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},s.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var n=Math.floor(Math.log(e)/Math.LN2),r=e/Math.pow(2,n)-1,i=Math.floor(r*Math.pow(2,52)),o=Math.pow(2,32),a=t<<31|n+1023<<20|i/o&1048575,s=i%o;this.bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(s)},s.prototype.pack_object=function(e){var t=Object.keys(e).length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(t)}for(var n in e)e.hasOwnProperty(n)&&(this.pack(n),this.pack(e[n]))},s.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},s.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(255&e)},s.prototype.pack_uint32=function(e){var t=4294967295&e;this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},s.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),n=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)},s.prototype.pack_int8=function(e){this.bufferBuilder.append(255&e)},s.prototype.pack_int16=function(e){this.bufferBuilder.append((65280&e)>>8),this.bufferBuilder.append(255&e)},s.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},s.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),n=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)}},{"./bufferbuilder":"EgBh"}],iSxC:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.extractVersion=a,n.wrapPeerConnectionEvent=function(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);var r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},n.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+r(e)+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},n.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+r(e)+". Please use a boolean."):(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},n.log=function(){if("object"===("undefined"==typeof window?"undefined":r(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},n.deprecated=function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},n.detectBrowser=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=a(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=a(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=a(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=a(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t},n.compactObject=function e(t){return s(t)?Object.keys(t).reduce((function(n,r){var i=s(t[r]),o=i?e(t[r]):t[r],a=i&&!Object.keys(o).length;return void 0===o||a?n:Object.assign(n,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},r,o))}),{}):t},n.walkStats=c,n.filterStats=function(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((function(t){e.forEach((function(n){n.type===r&&n.trackId===t.id&&c(e,n,i)}))})),i};var i=!0,o=!0;function a(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function s(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((function(r){r.endsWith("Id")?c(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((function(t){c(e,e.get(t),n)}))})))}},{}],s6SN:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetUserMedia=function(e,t){var n=e&&e.navigator;if(n.mediaDevices){var r=function(e){if("object"!==o(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"===o(e[n])?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var a={};"number"==typeof r.ideal?(a[i("min",n)]=r.ideal,t.optional.push(a),(a={})[i("max",n)]=r.ideal,t.optional.push(a)):(a[i("",n)]=r.ideal,t.optional.push(a))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===o(e.audio)){var s=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};s((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"===o(e.video)){var c=e.video.facingMode;c=c&&("object"===o(c)?c:{ideal:c});var u,l=t.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||l)&&(delete e.video.facingMode,"environment"===c.exact||"environment"===c.ideal?u=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(u=["front"]),u))return n.mediaDevices.enumerateDevices().then((function(t){var n=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return u.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!n&&t.length&&u.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=c.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=r(e.video),a("chrome: "+JSON.stringify(e)),i(e)}));e.video=r(e.video)}return a("chrome: "+JSON.stringify(e)),i(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(function(e){n.webkitGetUserMedia(e,t,(function(e){r&&r(s(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){var c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return i(e,(function(e){return c(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(s(e))}))}))}}}};var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}(e("../utils.js"));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=r.log},{"../utils.js":"iSxC"}],VHa8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((function(t){var r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],uI5X:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},n.shimOnTrack=function(e){if("object"!==c(e)||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)r.wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.track.id})):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})),t.stream.getTracks().forEach((function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.id})):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}},n.shimGetSendersWithDtmf=function(e){if("object"===c(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){n._senders.push(t(n,e))}))};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"===c(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},n.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,[n,r,i]=arguments;if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},a=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};return arguments.length>=2?t.apply(this,[function(e){r(a(o(e)))},n]):new Promise((function(n,r){t.apply(e,[function(e){n(a(o(e)))},r])})).then(r,i)}}},n.shimSenderReceiverGetStats=function(e){if("object"===c(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return r.filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),r.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return r.filterStats(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,n,r,i=arguments[0];return this.getSenders().forEach((function(e){e.track===i&&(t?r=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===i&&(n?r=!0:n=e),e.track===i})),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}}},n.shimAddTrackRemoveTrackWithNative=u,n.shimAddTrackRemoveTrack=function(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return u(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(n.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}r.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((function(e){return e.track===t})))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then((function(){r.dispatchEvent(new Event("negotiationneeded"))}));else{var a=new e.MediaStream([t]);this._streams[n.id]=a,this._reverseStreams[a.id]=n,this.addStream(a)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=s({},t,(function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[function(n){var r=c(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((function(t){return c(e,t)}))}));e.RTCPeerConnection.prototype[t]=r[t]}));var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(e=this,n=(t=arguments[0]).sdp,Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})),o.apply(this,arguments)):o.apply(this,arguments);var e,t,n};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(r){n._streams[r].getTracks().find((function(t){return e.track===t}))&&(t=n._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}},n.shimPeerConnection=function(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=s({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}))},n.fixNegotiationNeeded=function(e,t){r.wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){var n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))},Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}}),Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}});var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=a();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}(e("../utils.js")),i=e("./getusermedia"),o=e("./getdisplaymedia");function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var r=this.getSenders();n.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===r.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]})),i.apply(this,arguments)}}},{"../utils.js":"iSxC","./getusermedia":"s6SN","./getdisplaymedia":"VHa8"}],NZ1C:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.filterIceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof t;return i&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n})),delete e.url,e.urls=i?t[0]:t,!!t.length}}))};var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}(e("../utils"));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}},{"../utils":"iSxC"}],YHvh:[function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},r.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var n=r.matchPrefix(e+t,"a=ice-ufrag:")[0],i=r.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(r.parseExtmap(e))})),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=r.writeExtmap(e)})),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},n.push(r))}})),0===n.length&&c&&n.push({ssrc:c});var l=r.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=l}))),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=r.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(r.matchPrefix(e,"a=sctpmap:").length>0){var a=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||r.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=r)},{}],NJ2u:[function(e,t,n){"use strict";var r=e("sdp");function i(e,t,n,i,o){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach((function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}})),n}function a(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}t.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout((function(){t._dispatchEvent("track",o)}))}var l=function(n){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=o[e].bind(o)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)})),delete e.url,e.urls=i?r[0]:r,!!r.length}}))}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},l.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},l.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),r.getTracks().forEach((function(e){n.addTrack(e,r)}))}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},l.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},l.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},l.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},l.prototype._gather=function(t,n){var i=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1,s.ufrag=o.getLocalParameters().usernameFragment;var u=r.writeCandidate(s);a.candidate=Object.assign(a.candidate,r.parseCandidate(u)),a.candidate.candidate=u,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var l=r.getMediaSections(i._localDescription.sdp);l[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+l.join("");var h=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),h&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){a.forEach((function(e){o.onlocalcandidate(e)}))}),0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,n,i){var a=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},l.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=r.splitSections(i._remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var a=i.transceivers[t],c=a.iceGatherer,u=a.iceTransport,l=a.dtlsTransport,h=a.localCapabilities,d=a.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length||a.rejected)){var f=r.getIceParameters(e,n),p=r.getDtlsParameters(e,n);s&&(p.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===u.state&&u.start(c,f,s?"controlling":"controlled"),"new"===l.state&&l.start(p));var v=o(h,d);i._transceive(a,v.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(i){var l=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,l.signalingState)||l._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+l.signalingState));var h={};l.remoteStreams.forEach((function(e){h[e.id]=e}));var d=[],f=r.splitSections(i.sdp),p=f.shift(),v=r.matchPrefix(p,"a=ice-lite").length>0,y=r.matchPrefix(p,"a=group:BUNDLE ").length>0;l.usingBundle=y;var g=r.matchPrefix(p,"a=ice-options:")[0];return l.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,f.forEach((function(a,c){var u=r.splitLines(a),f=r.getKind(a),g=r.isRejected(a)&&0===r.matchPrefix(a,"a=bundle-only").length,m=u[0].substr(2).split(" ")[2],_=r.getDirection(a,p),b=r.parseMsid(a),x=r.getMid(a)||r.generateIdentifier();if(g||"application"===f&&("DTLS/SCTP"===m||"UDP/DTLS/SCTP"===m))l.transceivers[c]={mid:x,kind:f,protocol:m,rejected:!0};else{var w,T,k,S,E,C,P,O,R;!g&&l.transceivers[c]&&l.transceivers[c].rejected&&(l.transceivers[c]=l._createTransceiver(f,!0));var A,M,I=r.parseRtpParameters(a);g||(A=r.getIceParameters(a,p),(M=r.getDtlsParameters(a,p)).role="client"),P=r.parseRtpEncodingParameters(a);var D=r.parseRtcpParameters(a),L=r.matchPrefix(a,"a=end-of-candidates",p).length>0,j=r.matchPrefix(a,"a=candidate:").map((function(e){return r.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!g&&y&&c>0&&l.transceivers[c]&&(l._disposeIceAndDtlsTransports(c),l.transceivers[c].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[c].iceTransport=l.transceivers[0].iceTransport,l.transceivers[c].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[c].rtpSender&&l.transceivers[c].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[c].rtpReceiver&&l.transceivers[c].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),"offer"!==i.type||g)"answer"!==i.type||g||(T=(w=l.transceivers[c]).iceGatherer,k=w.iceTransport,S=w.dtlsTransport,E=w.rtpReceiver,C=w.sendEncodingParameters,O=w.localCapabilities,l.transceivers[c].recvEncodingParameters=P,l.transceivers[c].remoteCapabilities=I,l.transceivers[c].rtcpParameters=D,j.length&&"new"===k.state&&(!v&&!L||y&&0!==c?j.forEach((function(e){s(w.iceTransport,e)})):k.setRemoteCandidates(j)),y&&0!==c||("new"===k.state&&k.start(T,A,"controlling"),"new"===S.state&&S.start(M)),!o(w.localCapabilities,w.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&w.sendEncodingParameters[0].rtx&&delete w.sendEncodingParameters[0].rtx,l._transceive(w,"sendrecv"===_||"recvonly"===_,"sendrecv"===_||"sendonly"===_),!E||"sendrecv"!==_&&"sendonly"!==_?delete w.rtpReceiver:(R=E.track,b?(h[b.stream]||(h[b.stream]=new e.MediaStream),n(R,h[b.stream]),d.push([R,E,h[b.stream]])):(h.default||(h.default=new e.MediaStream),n(R,h.default),d.push([R,E,h.default]))));else{(w=l.transceivers[c]||l._createTransceiver(f)).mid=x,w.iceGatherer||(w.iceGatherer=l._createIceGatherer(c,y)),j.length&&"new"===w.iceTransport.state&&(!L||y&&0!==c?j.forEach((function(e){s(w.iceTransport,e)})):w.iceTransport.setRemoteCandidates(j)),O=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(O.codecs=O.codecs.filter((function(e){return"rtx"!==e.name}))),C=w.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var B,N=!1;"sendrecv"===_||"sendonly"===_?(N=!w.rtpReceiver,E=w.rtpReceiver||new e.RTCRtpReceiver(w.dtlsTransport,f),N&&(R=E.track,b&&"-"===b.stream||(b?(h[b.stream]||(h[b.stream]=new e.MediaStream,Object.defineProperty(h[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(R,"id",{get:function(){return b.track}}),B=h[b.stream]):(h.default||(h.default=new e.MediaStream),B=h.default)),B&&(n(R,B),w.associatedRemoteMediaStreams.push(B)),d.push([R,E,B]))):w.rtpReceiver&&w.rtpReceiver.track&&(w.associatedRemoteMediaStreams.forEach((function(t){var n,r,i=t.getTracks().find((function(e){return e.id===w.rtpReceiver.track.id}));i&&(n=i,(r=t).removeTrack(n),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:n})))})),w.associatedRemoteMediaStreams=[]),w.localCapabilities=O,w.remoteCapabilities=I,w.rtpReceiver=E,w.rtcpParameters=D,w.sendEncodingParameters=C,w.recvEncodingParameters=P,l._transceive(l.transceivers[c],!1,N)}}})),void 0===l._dtlsRole&&(l._dtlsRole="offer"===i.type?"active":"passive"),l._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(h).forEach((function(t){var n=h[t];if(n.getTracks().length){if(-1===l.remoteStreams.indexOf(n)){l.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout((function(){l._dispatchEvent("addstream",r)}))}d.forEach((function(e){var t=e[0],r=e[1];n.id===e[2].id&&u(l,t,r,[n])}))}})),d.forEach((function(e){e[2]||u(l,e[0],e[1],[])})),e.setTimeout((function(){l&&l.transceivers&&l.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},l.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter((function(e){return"audio"===e.kind})).length,a=n.transceivers.filter((function(e){return"video"===e.kind})).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)}));o>0||a>0;)o>0&&(n._createTransceiver("audio"),o--),a>0&&(n._createTransceiver("video"),a--);var u=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(i,o){var a=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(o,n.usingBundle));var u=e.RTCRtpSender.getCapabilities(s);t<15019&&(u.codecs=u.codecs.filter((function(e){return"rtx"!==e.name}))),u.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),u.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var l=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=u,i.sendEncodingParameters=l})),"max-compat"!==n._config.bundlePolicy&&(u+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",n.transceivers.forEach((function(e,t){u+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,u+="a="+r.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))}));var l=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(l)},l.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var a=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(a+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n";var s=r.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,r){if(!(r+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var u=o(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,u,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}}));var u=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(u)},l.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,o){if(!n._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<n.transceivers.length;u++)if(n.transceivers[u].mid===e.sdpMid){a=u;break}var l=n.transceivers[a];if(!l)return o(c("OperationError","Can not add ICE candidate"));if(l.rejected)return i();var h=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===h.protocol&&(0===h.port||9===h.port))return i();if(h.component&&1!==h.component)return i();if((0===a||a>0&&l.iceTransport!==n.transceivers[0].iceTransport)&&!s(l.iceTransport,h))return o(c("OperationError","Can not add ICE candidate"));var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),(t=r.getMediaSections(n._remoteDescription.sdp))[a]+="a="+(h.type?d:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var f=0;f<n.transceivers.length&&(n.transceivers[f].rejected||(n.transceivers[f].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));f++);i()}))},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){e[n].type=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(e[n]),t.set(n,e[n])})),t}))}}}));var h=["createOffer","createAnswer"];return h.forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(h=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),l}},{sdp:"YHvh"}],YdKx:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetUserMedia=function(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],P3bV:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],XRic:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimPeerConnection=function(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var a=(0,o.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,i.filterIceServers)(e.iceServers,t.version),r.log("ICE servers after filtering:",e.iceServers)),new a(e)},e.RTCPeerConnection.prototype=a.prototype},n.shimReplaceTrack=function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)},Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return a.shimGetUserMedia}}),Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return s.shimGetDisplayMedia}});var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}(e("../utils")),i=e("./filtericeservers"),o=function(e){return e&&e.__esModule?e:{default:e}}(e("rtcpeerconnection-shim")),a=e("./getusermedia"),s=e("./getdisplaymedia");function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}},{"../utils":"iSxC","./filtericeservers":"NZ1C","rtcpeerconnection-shim":"NJ2u","./getusermedia":"YdKx","./getdisplaymedia":"P3bV"}],GzSv:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetUserMedia=function(e,t){var n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===o(e)&&"object"===o(e.audio)&&(e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","mozAutoGainControl"),a(e.audio,"noiseSuppression","mozNoiseSuppression")),s(e)},i&&i.prototype.getSettings){var c=i.prototype.getSettings;i.prototype.getSettings=function(){var e=c.apply(this,arguments);return a(e,"mozAutoGainControl","autoGainControl"),a(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var u=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===o(e)&&(e=JSON.parse(JSON.stringify(e)),a(e,"autoGainControl","mozAutoGainControl"),a(e,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[e])}}}};var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}(e("../utils"));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},{"../utils":"iSxC"}],UuGU:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}},{}],Fzdr:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimOnTrack=function(e){"object"===s(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},n.shimPeerConnection=function(e,t){if("object"===s(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}));var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var[e,i,o]=arguments;return r.apply(this,[e||null]).then((function(e){if(t.version<53&&!i)try{e.forEach((function(e){e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}},n.shimSenderGetStats=function(e){if("object"===s(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},n.shimReceiverGetStats=function(e){if("object"===s(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n}),r.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},n.shimRemoveStream=function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)}))})},n.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},n.shimAddTransceiver=function(e){if("object"===s(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var r=t.apply(this,arguments);if(n){var{sender:i}=r,o=i.getParameters();"encodings"in o&&(1!==o.encodings.length||0!==Object.keys(o.encodings[0]).length)||(o.encodings=e.sendEncodings,i.sendEncodings=e.sendEncodings,this.setParametersPromises.push(i.setParameters(o).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return r})}},n.shimGetParameters=function(e){if("object"===s(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}},n.shimCreateOffer=function(e){if("object"===s(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}},n.shimCreateAnswer=function(e){if("object"===s(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}},Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}}),Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}});var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=a();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}(e("../utils")),i=e("./getusermedia"),o=e("./getdisplaymedia");function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},{"../utils":"iSxC","./getusermedia":"GzSv","./getdisplaymedia":"UuGU"}],t1lL:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimLocalStreamsAPI=function(e){if("object"===o(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(r){return t.call(n,r,e)})),e.getVideoTracks().forEach((function(r){return t.call(n,r,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i&&i.forEach((function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach((function(e){r.includes(e.track)&&t.removeTrack(e)}))}})}},n.shimRemoteStreamsAPI=function(e){if("object"===o(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}},n.shimCallbacksAPI=function(e){if("object"===o(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var c=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=c,c=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=c,c=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=c}},n.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return r(a(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))},n.shimConstraints=a,n.shimRTCIceServerUrls=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}},n.shimTrackEventTransceiver=function(e){"object"===o(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},n.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video")}return t.apply(this,arguments)}},n.shimAudioContext=function(e){"object"!==o(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)};var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}(e("../utils"));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e){return e&&void 0!==e.video?Object.assign({},e,{video:r.compactObject(e.video)}):e}},{"../utils":"iSxC"}],GOQK:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimRTCIceCandidate=function(e){if(e.RTCIceCandidate&&(!e.RTCIceCandidate||!("foundation"in e.RTCIceCandidate.prototype))){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===a(e)&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),i=r.default.parseCandidate(e.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,i.wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}},n.shimMaxMessageSize=function(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;var t=r.default.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=r.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){var i,o=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),a=(u=o,l=65536,"firefox"===t.browser&&(l=t.version<57?-1===u?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),l),s=function(e,n){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var o=r.default.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?i=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],o);i=0===a&&0===s?Number.POSITIVE_INFINITY:0===a||0===s?Math.max(a,s):Math.min(a,s);var c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return i}}),this._sctp=c}var u,l;return n.apply(this,arguments)}}},n.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},i.wrapPeerConnectionEvent(e,"datachannel",(function(e){return n(e.channel,e.target),e}))}function n(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}},n.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}},n.removeExtmapAllowMixed=function(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var r=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return n.apply(this,arguments)}}},n.shimAddIceCandidateNullOrEmpty=function(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}};var r=function(e){return e&&e.__esModule?e:{default:e}}(e("sdp")),i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=r?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}(e("./utils"));function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},{sdp:"YHvh","./utils":"iSxC"}],KtlG:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.adapterFactory=function(){var{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},n=r.log,u=r.detectBrowser(e),l={browserDetails:u,commonShim:c,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(u.browser){case"chrome":if(!i||!i.shimPeerConnection||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),l;if(null===u.version)return n("Chrome shim can not determine version, not shimming."),l;n("adapter.js shimming chrome."),l.browserShim=i,c.shimAddIceCandidateNullOrEmpty(e,u),i.shimGetUserMedia(e,u),i.shimMediaStream(e,u),i.shimPeerConnection(e,u),i.shimOnTrack(e,u),i.shimAddTrackRemoveTrack(e,u),i.shimGetSendersWithDtmf(e,u),i.shimGetStats(e,u),i.shimSenderReceiverGetStats(e,u),i.fixNegotiationNeeded(e,u),c.shimRTCIceCandidate(e,u),c.shimConnectionState(e,u),c.shimMaxMessageSize(e,u),c.shimSendThrowTypeError(e,u),c.removeExtmapAllowMixed(e,u);break;case"firefox":if(!a||!a.shimPeerConnection||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),l;n("adapter.js shimming firefox."),l.browserShim=a,c.shimAddIceCandidateNullOrEmpty(e,u),a.shimGetUserMedia(e,u),a.shimPeerConnection(e,u),a.shimOnTrack(e,u),a.shimRemoveStream(e,u),a.shimSenderGetStats(e,u),a.shimReceiverGetStats(e,u),a.shimRTCDataChannel(e,u),a.shimAddTransceiver(e,u),a.shimGetParameters(e,u),a.shimCreateOffer(e,u),a.shimCreateAnswer(e,u),c.shimRTCIceCandidate(e,u),c.shimConnectionState(e,u),c.shimMaxMessageSize(e,u),c.shimSendThrowTypeError(e,u);break;case"edge":if(!o||!o.shimPeerConnection||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),l;n("adapter.js shimming edge."),l.browserShim=o,o.shimGetUserMedia(e,u),o.shimGetDisplayMedia(e,u),o.shimPeerConnection(e,u),o.shimReplaceTrack(e,u),c.shimMaxMessageSize(e,u),c.shimSendThrowTypeError(e,u);break;case"safari":if(!s||!t.shimSafari)return n("Safari shim is not included in this adapter release."),l;n("adapter.js shimming safari."),l.browserShim=s,c.shimAddIceCandidateNullOrEmpty(e,u),s.shimRTCIceServerUrls(e,u),s.shimCreateOfferLegacy(e,u),s.shimCallbacksAPI(e,u),s.shimLocalStreamsAPI(e,u),s.shimRemoteStreamsAPI(e,u),s.shimTrackEventTransceiver(e,u),s.shimGetUserMedia(e,u),s.shimAudioContext(e,u),c.shimRTCIceCandidate(e,u),c.shimMaxMessageSize(e,u),c.shimSendThrowTypeError(e,u),c.removeExtmapAllowMixed(e,u);break;default:n("Unsupported browser!")}return l};var r=l(e("./utils")),i=l(e("./chrome/chrome_shim")),o=l(e("./edge/edge_shim")),a=l(e("./firefox/firefox_shim")),s=l(e("./safari/safari_shim")),c=l(e("./common_shim"));function u(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function l(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=u();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}},{"./utils":"iSxC","./chrome/chrome_shim":"uI5X","./edge/edge_shim":"XRic","./firefox/firefox_shim":"Fzdr","./safari/safari_shim":"t1lL","./common_shim":"GOQK"}],tI1X:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=(0,e("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});n.default=r},{"./adapter_factory.js":"KtlG"}],sXtV:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.webRTCAdapter=void 0;var i=r(e("webrtc-adapter"));n.webRTCAdapter=i.default},{"webrtc-adapter":"tI1X"}],I31f:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Supports=void 0;var r=e("./adapter");n.Supports=new(function(){function e(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return e.prototype.isWebRTCSupported=function(){return"undefined"!=typeof RTCPeerConnection},e.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion();return!!this.supportedBrowsers.includes(e)&&("chrome"===e?t>=this.minChromeVersion:"firefox"===e?t>=this.minFirefoxVersion:"safari"===e&&!this.isIOS&&t>=this.minSafariVersion)},e.prototype.getBrowser=function(){return r.webRTCAdapter.browserDetails.browser},e.prototype.getVersion=function(){return r.webRTCAdapter.browserDetails.version||0},e.prototype.isUnifiedPlanSupported=function(){var e,t=this.getBrowser(),n=r.webRTCAdapter.browserDetails.version||0;if("chrome"===t&&n<72)return!1;if("firefox"===t&&n>=59)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var i=!1;try{(e=new RTCPeerConnection).addTransceiver("audio"),i=!0}catch(e){}finally{e&&e.close()}return i},e.prototype.toString=function(){return"Supports: \n    browser:"+this.getBrowser()+" \n    version:"+this.getVersion()+" \n    isIOS:"+this.isIOS+" \n    isWebRTCSupported:"+this.isWebRTCSupported()+" \n    isBrowserSupported:"+this.isBrowserSupported()+" \n    isUnifiedPlanSupported:"+this.isUnifiedPlanSupported()},e}())},{"./adapter":"sXtV"}],BHXf:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.util=void 0;var a=o(e("peerjs-js-binarypack")),s=e("./supports"),c={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:0.peerjs.com:3478",username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};n.util=new(function(){function e(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=c,this.browser=s.Supports.getBrowser(),this.browserVersion=s.Supports.getVersion(),this.supports=function(){var e,t={browser:s.Supports.isBrowserSupported(),webRTC:s.Supports.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;try{e=new RTCPeerConnection(c),t.audioVideo=!0;var n=void 0;try{n=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!n.ordered;try{n.binaryType="blob",t.binaryBlob=!s.Supports.isIOS}catch(e){}}catch(e){}finally{n&&n.close()}}catch(e){}finally{e&&e.close()}return t}(),this.pack=a.pack,this.unpack=a.unpack,this._dataCount=1}return e.prototype.noop=function(){},e.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},e.prototype.chunk=function(e){for(var t=[],r=e.size,i=Math.ceil(r/n.util.chunkedMTU),o=0,a=0;a<r;){var s=Math.min(r,a+n.util.chunkedMTU),c=e.slice(a,s),u={__peerData:this._dataCount,n:o,data:c,total:i};t.push(u),a=s,o++}return this._dataCount++,t},e.prototype.blobToArrayBuffer=function(e,t){var n=new FileReader;return n.onload=function(e){e.target&&t(e.target.result)},n.readAsArrayBuffer(e),n},e.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer},e.prototype.randomToken=function(){return Math.random().toString(36).substr(2)},e.prototype.isSecure=function(){return"https:"===location.protocol},e}())},{"peerjs-js-binarypack":"kdPp","./supports":"I31f"}],JJlS:[function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||e,o),c=i?i+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function u(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},u.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,r,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,r),!0;case 5:return l.fn.call(l.context,t,n,r,o),!0;case 6:return l.fn.call(l.context,t,n,r,o,a),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,r);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,r){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return c(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||c(this,o);else{for(var s=0,u=[],l=a.length;s<l;s++)(a[s].fn!==t||r&&!a[s].once||n&&a[s].context!==n)&&u.push(a[s]);u.length?this._events[o]=1===u.length?u[0]:u:c(this,o)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&c(this,t)):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,void 0!==t&&(t.exports=u)},{}],WOs9:[function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(n,"__esModule",{value:!0}),n.LogLevel=void 0;var o,a="PeerJS: ";!function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"}(o=n.LogLevel||(n.LogLevel={}));var s=function(){function e(){this._logLevel=o.Disabled}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=o.All&&this._print.apply(this,i([o.All],r(e)))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=o.Warnings&&this._print.apply(this,i([o.Warnings],r(e)))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=o.Errors&&this._print.apply(this,i([o.Errors],r(e)))},e.prototype.setLogFunction=function(e){this._print=e},e.prototype._print=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var s=i([a],r(t));for(var c in s)s[c]instanceof Error&&(s[c]="("+s[c].name+") "+s[c].message);e>=o.All?console.log.apply(console,i([],r(s))):e>=o.Warnings?console.warn.apply(console,i(["WARNING"],r(s))):e>=o.Errors&&console.error.apply(console,i(["ERROR"],r(s)))},e}();n.default=new s},{}],ZRYf:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),n.ServerMessageType=n.SocketEventType=n.SerializationType=n.PeerErrorType=n.PeerEventType=n.ConnectionType=n.ConnectionEventType=void 0,(r=n.ConnectionEventType||(n.ConnectionEventType={})).Open="open",r.Stream="stream",r.Data="data",r.Close="close",r.Error="error",r.IceStateChanged="iceStateChanged",function(e){e.Data="data",e.Media="media"}(n.ConnectionType||(n.ConnectionType={})),function(e){e.Open="open",e.Close="close",e.Connection="connection",e.Call="call",e.Disconnected="disconnected",e.Error="error"}(n.PeerEventType||(n.PeerEventType={})),function(e){e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc"}(n.PeerErrorType||(n.PeerErrorType={})),function(e){e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json"}(n.SerializationType||(n.SerializationType={})),function(e){e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close"}(n.SocketEventType||(n.SocketEventType={})),function(e){e.Heartbeat="HEARTBEAT",e.Candidate="CANDIDATE",e.Offer="OFFER",e.Answer="ANSWER",e.Open="OPEN",e.Error="ERROR",e.IdTaken="ID-TAKEN",e.InvalidKey="INVALID-KEY",e.Leave="LEAVE",e.Expire="EXPIRE"}(n.ServerMessageType||(n.ServerMessageType={}))},{}],wJlv:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.Socket=void 0;var c=e("eventemitter3"),u=s(e("./logger")),l=e("./enums"),h=function(e){function t(t,n,r,i,o,a){void 0===a&&(a=5e3);var s=e.call(this)||this;s.pingInterval=a,s._disconnected=!0,s._messagesQueue=[];var c=t?"wss://":"ws://";return s._baseUrl=c+n+":"+r+i+"peerjs?key="+o,s}return r(t,e),t.prototype.start=function(e,t){var n=this;this._id=e;var r=this._baseUrl+"&id="+e+"&token="+t;!this._socket&&this._disconnected&&(this._socket=new WebSocket(r),this._disconnected=!1,this._socket.onmessage=function(e){var t;try{t=JSON.parse(e.data),u.default.log("Server message received:",t)}catch(t){return void u.default.log("Invalid server message",e.data)}n.emit(l.SocketEventType.Message,t)},this._socket.onclose=function(e){n._disconnected||(u.default.log("Socket closed.",e),n._cleanup(),n._disconnected=!0,n.emit(l.SocketEventType.Disconnected))},this._socket.onopen=function(){n._disconnected||(n._sendQueuedMessages(),u.default.log("Socket open"),n._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout((function(){e._sendHeartbeat()}),this.pingInterval)},t.prototype._sendHeartbeat=function(){if(this._wsOpen()){var e=JSON.stringify({type:l.ServerMessageType.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}else u.default.log("Cannot send heartbeat, because socket closed")},t.prototype._wsOpen=function(){return!!this._socket&&1===this._socket.readyState},t.prototype._sendQueuedMessages=function(){var e,t,n=o([],i(this._messagesQueue));this._messagesQueue=[];try{for(var r=a(n),s=r.next();!s.done;s=r.next()){var c=s.value;this.send(c)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},t.prototype.send=function(e){if(!this._disconnected)if(this._id)if(e.type){if(this._wsOpen()){var t=JSON.stringify(e);this._socket.send(t)}}else this.emit(l.SocketEventType.Error,"Invalid message");else this._messagesQueue.push(e)},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(c.EventEmitter);n.Socket=h},{eventemitter3:"JJlS","./logger":"WOs9","./enums":"ZRYf"}],HCdX:[function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.Negotiator=void 0;var s=e("./util"),c=a(e("./logger")),u=e("./enums"),l=function(){function e(e){this.connection=e}return e.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===u.ConnectionType.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===u.ConnectionType.Data){var n=this.connection,r={ordered:!!e.reliable},i=t.createDataChannel(n.label,r);n.initialize(i)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},e.prototype._startPeerConnection=function(){c.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},e.prototype._setupListeners=function(e){var t=this,n=this.connection.peer,r=this.connection.connectionId,i=this.connection.type,o=this.connection.provider;c.default.log("Listening for ICE candidates."),e.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&(c.default.log("Received ICE candidates for "+n+":",e.candidate),o.socket.send({type:u.ServerMessageType.Candidate,payload:{candidate:e.candidate,type:i,connectionId:r},dst:n}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":c.default.log("iceConnectionState is failed, closing connections to "+n),t.connection.emit(u.ConnectionEventType.Error,new Error("Negotiation of connection to "+n+" failed.")),t.connection.close();break;case"closed":c.default.log("iceConnectionState is closed, closing connections to "+n),t.connection.emit(u.ConnectionEventType.Error,new Error("Connection to "+n+" closed.")),t.connection.close();break;case"disconnected":c.default.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=s.util.noop}t.connection.emit(u.ConnectionEventType.IceStateChanged,e.iceConnectionState)},c.default.log("Listening for data channel"),e.ondatachannel=function(e){c.default.log("Received data channel");var t=e.channel;o.getConnection(n,r).initialize(t)},c.default.log("Listening for remote stream"),e.ontrack=function(e){c.default.log("Received remote stream");var i=e.streams[0],a=o.getConnection(n,r);if(a.type===u.ConnectionType.Media){var s=a;t._addStreamToMediaConnection(i,s)}}},e.prototype.cleanup=function(){c.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t="closed"!==e.signalingState,n=!1;if(this.connection.type===u.ConnectionType.Data){var r=this.connection.dataChannel;r&&(n=!!r.readyState&&"closed"!==r.readyState)}(t||n)&&e.close()}},e.prototype._makeOffer=function(){return i(this,void 0,Promise,(function(){var e,t,n,i,a,l,h;return o(this,(function(o){switch(o.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:n=o.sent(),c.default.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,e.setLocalDescription(n)];case 4:return o.sent(),c.default.log("Set localDescription:",n,"for:"+this.connection.peer),i={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:s.util.browser},this.connection.type===u.ConnectionType.Data&&(a=this.connection,i=r(r({},i),{label:a.label,reliable:a.reliable,serialization:a.serialization})),t.socket.send({type:u.ServerMessageType.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(l=o.sent())&&(t.emitError(u.PeerErrorType.WebRTC,l),c.default.log("Failed to setLocalDescription, ",l)),[3,6];case 6:return[3,8];case 7:return h=o.sent(),t.emitError(u.PeerErrorType.WebRTC,h),c.default.log("Failed to createOffer, ",h),[3,8];case 8:return[2]}}))}))},e.prototype._makeAnswer=function(){return i(this,void 0,Promise,(function(){var e,t,n,r,i;return o(this,(function(o){switch(o.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:n=o.sent(),c.default.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,e.setLocalDescription(n)];case 4:return o.sent(),c.default.log("Set localDescription:",n,"for:"+this.connection.peer),t.socket.send({type:u.ServerMessageType.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:s.util.browser},dst:this.connection.peer}),[3,6];case 5:return r=o.sent(),t.emitError(u.PeerErrorType.WebRTC,r),c.default.log("Failed to setLocalDescription, ",r),[3,6];case 6:return[3,8];case 7:return i=o.sent(),t.emitError(u.PeerErrorType.WebRTC,i),c.default.log("Failed to create answer, ",i),[3,8];case 8:return[2]}}))}))},e.prototype.handleSDP=function(e,t){return i(this,void 0,Promise,(function(){var n,r,i,a;return o(this,(function(o){switch(o.label){case 0:t=new RTCSessionDescription(t),n=this.connection.peerConnection,r=this.connection.provider,c.default.log("Setting remote description",t),i=this,o.label=1;case 1:return o.trys.push([1,5,,6]),[4,n.setRemoteDescription(t)];case 2:return o.sent(),c.default.log("Set remoteDescription:"+e+" for:"+this.connection.peer),"OFFER"!==e?[3,4]:[4,i._makeAnswer()];case 3:o.sent(),o.label=4;case 4:return[3,6];case 5:return a=o.sent(),r.emitError(u.PeerErrorType.WebRTC,a),c.default.log("Failed to setRemoteDescription, ",a),[3,6];case 6:return[2]}}))}))},e.prototype.handleCandidate=function(e){return i(this,void 0,Promise,(function(){var t,n,r,i,a,s;return o(this,(function(o){switch(o.label){case 0:c.default.log("handleCandidate:",e),t=e.candidate,n=e.sdpMLineIndex,r=e.sdpMid,i=this.connection.peerConnection,a=this.connection.provider,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,i.addIceCandidate(new RTCIceCandidate({sdpMid:r,sdpMLineIndex:n,candidate:t}))];case 2:return o.sent(),c.default.log("Added ICE candidate for:"+this.connection.peer),[3,4];case 3:return s=o.sent(),a.emitError(u.PeerErrorType.WebRTC,s),c.default.log("Failed to handleCandidate, ",s),[3,4];case 4:return[2]}}))}))},e.prototype._addTracksToConnection=function(e,t){if(c.default.log("add tracks from stream "+e.id+" to peer connection"),!t.addTrack)return c.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach((function(n){t.addTrack(n,e)}))},e.prototype._addStreamToMediaConnection=function(e,t){c.default.log("add stream "+e.id+" to media connection "+t.connectionId),t.addStream(e)},e}();n.Negotiator=l},{"./util":"BHXf","./logger":"WOs9","./enums":"ZRYf"}],tQFK:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0}),n.BaseConnection=void 0;var i=function(e){function t(t,n,r){var i=e.call(this)||this;return i.peer=t,i.provider=n,i.options=r,i._open=!1,i.metadata=r.metadata,i}return r(t,e),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),t}(e("eventemitter3").EventEmitter);n.BaseConnection=i},{eventemitter3:"JJlS"}],dbHP:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.MediaConnection=void 0;var s=e("./util"),c=a(e("./logger")),u=e("./negotiator"),l=e("./enums"),h=function(e){function t(n,r,i){var o=e.call(this,n,r,i)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||t.ID_PREFIX+s.util.randomToken(),o._negotiator=new u.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return r(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return l.ConnectionType.Media},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),t.prototype.addStream=function(t){c.default.log("Receiving stream",t),this._remoteStream=t,e.prototype.emit.call(this,l.ConnectionEventType.Stream,t)},t.prototype.handleMessage=function(e){var t=e.type,n=e.payload;switch(e.type){case l.ServerMessageType.Answer:this._negotiator.handleSDP(t,n.sdp),this._open=!0;break;case l.ServerMessageType.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:c.default.warn("Unrecognized message type:"+t+" from peer:"+this.peer)}},t.prototype.answer=function(e,t){var n,r;if(void 0===t&&(t={}),this._localStream)c.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection(i(i({},this.options._payload),{_stream:e}));var a=this.provider._getMessages(this.connectionId);try{for(var s=o(a),u=s.next();!u.done;u=s.next()){var l=u.value;this.handleMessage(l)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}this._open=!0}},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,e.prototype.emit.call(this,l.ConnectionEventType.Close))},t.ID_PREFIX="mc_",t}(e("./baseconnection").BaseConnection);n.MediaConnection=h},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK"}],GGp6:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.EncodingQueue=void 0;var o=e("eventemitter3"),a=i(e("./logger")),s=function(e){function t(){var t=e.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(e){t._processing=!1,e.target&&t.emit("done",e.target.result),t.doNextTask()},t.fileReader.onerror=function(e){a.default.error("EncodingQueue error:",e),t._processing=!1,t.destroy(),t.emit("error",e)},t}return r(t,e),Object.defineProperty(t.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),t.prototype.enque=function(e){this.queue.push(e),this.processing||this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){0!==this.size&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(o.EventEmitter);n.EncodingQueue=s},{eventemitter3:"JJlS","./logger":"WOs9"}],GBTQ:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.DataConnection=void 0;var a=e("./util"),s=o(e("./logger")),c=e("./negotiator"),u=e("./enums"),l=e("./baseconnection"),h=e("./encodingQueue"),d=function(e){function t(n,r,i){var o=e.call(this,n,r,i)||this;return o.stringify=JSON.stringify,o.parse=JSON.parse,o._buffer=[],o._bufferSize=0,o._buffering=!1,o._chunkedData={},o._encodingQueue=new h.EncodingQueue,o.connectionId=o.options.connectionId||t.ID_PREFIX+a.util.randomToken(),o.label=o.options.label||o.connectionId,o.serialization=o.options.serialization||u.SerializationType.Binary,o.reliable=!!o.options.reliable,o._encodingQueue.on("done",(function(e){o._bufferedSend(e)})),o._encodingQueue.on("error",(function(){s.default.error("DC#"+o.connectionId+": Error occured in encoding from blob to arraybuffer, close DC"),o.close()})),o._negotiator=new c.Negotiator(o),o._negotiator.startConnection(o.options._payload||{originator:!0}),o}return r(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return u.ConnectionType.Data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var e=this;a.util.supports.binaryBlob&&!a.util.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){s.default.log("DC#"+e.connectionId+" dc connection success"),e._open=!0,e.emit(u.ConnectionEventType.Open)},this.dataChannel.onmessage=function(t){s.default.log("DC#"+e.connectionId+" dc onmessage:",t.data),e._handleDataMessage(t)},this.dataChannel.onclose=function(){s.default.log("DC#"+e.connectionId+" dc closed for:",e.peer),e.close()}},t.prototype._handleDataMessage=function(t){var n=this,r=t.data,i=r.constructor,o=r;if(this.serialization===u.SerializationType.Binary||this.serialization===u.SerializationType.BinaryUTF8){if(i===Blob)return void a.util.blobToArrayBuffer(r,(function(e){var t=a.util.unpack(e);n.emit(u.ConnectionEventType.Data,t)}));if(i===ArrayBuffer)o=a.util.unpack(r);else if(i===String){var s=a.util.binaryStringToArrayBuffer(r);o=a.util.unpack(s)}}else this.serialization===u.SerializationType.JSON&&(o=this.parse(r));o.__peerData?this._handleChunk(o):e.prototype.emit.call(this,u.ConnectionEventType.Data,o)},t.prototype._handleChunk=function(e){var t=e.__peerData,n=this._chunkedData[t]||{data:[],count:0,total:e.total};if(n.data[e.n]=e.data,n.count++,this._chunkedData[t]=n,n.total===n.count){delete this._chunkedData[t];var r=new Blob(n.data);this._handleDataMessage({data:r})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,e.prototype.emit.call(this,u.ConnectionEventType.Close))},t.prototype.send=function(t,n){if(this.open)if(this.serialization===u.SerializationType.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===u.SerializationType.Binary||this.serialization===u.SerializationType.BinaryUTF8){var r=a.util.pack(t);if(!n&&r.size>a.util.chunkedMTU)return void this._sendChunks(r);a.util.supports.binaryBlob?this._bufferedSend(r):this._encodingQueue.enque(r)}else this._bufferedSend(t);else e.prototype.emit.call(this,u.ConnectionEventType.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."))},t.prototype._bufferedSend=function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(e){var n=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout((function(){n._buffering=!1,n._tryBuffer()}),50),!1;try{this.dataChannel.send(e)}catch(e){return s.default.error("DC#:"+this.connectionId+" Error when sending:",e),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(this.open&&0!==this._buffer.length){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(e){var t,n,r=a.util.chunk(e);s.default.log("DC#"+this.connectionId+" Try to send "+r.length+" chunks...");try{for(var o=i(r),c=o.next();!c.done;c=o.next()){var u=c.value;this.send(u,!0)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},t.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case u.ServerMessageType.Answer:this._negotiator.handleSDP(e.type,t.sdp);break;case u.ServerMessageType.Candidate:this._negotiator.handleCandidate(t.candidate);break;default:s.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},t.ID_PREFIX="dc_",t.MAX_BUFFERED_AMOUNT=8388608,t}(l.BaseConnection);n.DataConnection=d},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK","./encodingQueue":"GGp6"}],in7L:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.API=void 0;var a=e("./util"),s=o(e("./logger")),c=function(){function e(e){this._options=e}return e.prototype._buildUrl=function(e){return(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+e+"?ts="+(new Date).getTime()+Math.random()},e.prototype.retrieveId=function(){return r(this,void 0,Promise,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:e=this._buildUrl("id"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetch(e)];case 2:if(200!==(t=i.sent()).status)throw new Error("Error. Status:"+t.status);return[2,t.text()];case 3:throw n=i.sent(),s.default.error("Error retrieving ID",n),r="","/"===this._options.path&&this._options.host!==a.util.CLOUD_HOST&&(r=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+r);case 4:return[2]}}))}))},e.prototype.listAllPeers=function(){return r(this,void 0,Promise,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:e=this._buildUrl("peers"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetch(e)];case 2:if(200!==(t=i.sent()).status){if(401===t.status)throw n=this._options.host===a.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n);throw new Error("Error. Status:"+t.status)}return[2,t.json()];case 3:throw r=i.sent(),s.default.error("Error retrieving list peers",r),new Error("Could not get list peers from the server."+r);case 4:return[2]}}))}))},e}();n.API=c},{"./util":"BHXf","./logger":"WOs9"}],Hxpd:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.Peer=void 0;var c=e("eventemitter3"),u=e("./util"),l=s(e("./logger")),h=e("./socket"),d=e("./mediaconnection"),f=e("./dataconnection"),p=e("./enums"),v=e("./api"),y=function(e){function t(n,r){var o,a=e.call(this)||this;return a._id=null,a._lastServerId=null,a._destroyed=!1,a._disconnected=!1,a._open=!1,a._connections=new Map,a._lostMessages=new Map,n&&n.constructor==Object?r=n:n&&(o=n.toString()),r=i({debug:0,host:u.util.CLOUD_HOST,port:u.util.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:u.util.randomToken(),config:u.util.defaultConfig},r),a._options=r,"/"===a._options.host&&(a._options.host=window.location.hostname),a._options.path&&("/"!==a._options.path[0]&&(a._options.path="/"+a._options.path),"/"!==a._options.path[a._options.path.length-1]&&(a._options.path+="/")),void 0===a._options.secure&&a._options.host!==u.util.CLOUD_HOST?a._options.secure=u.util.isSecure():a._options.host==u.util.CLOUD_HOST&&(a._options.secure=!0),a._options.logFunction&&l.default.setLogFunction(a._options.logFunction),l.default.logLevel=a._options.debug||0,a._api=new v.API(r),a._socket=a._createServerConnection(),u.util.supports.audioVideo||u.util.supports.data?o&&!u.util.validateId(o)?(a._delayedAbort(p.PeerErrorType.InvalidID,'ID "'+o+'" is invalid'),a):(o?a._initialize(o):a._api.retrieveId().then((function(e){return a._initialize(e)})).catch((function(e){return a._abort(p.PeerErrorType.ServerError,e)})),a):(a._delayedAbort(p.PeerErrorType.BrowserIncompatible,"The current browser does not support WebRTC"),a)}return r(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var e,t,n=Object.create(null);try{for(var r=o(this._connections),i=r.next();!i.done;i=r.next()){var s=a(i.value,2),c=s[0],u=s[1];n[c]=u}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),t.prototype._createServerConnection=function(){var e=this,t=new h.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(p.SocketEventType.Message,(function(t){e._handleMessage(t)})),t.on(p.SocketEventType.Error,(function(t){e._abort(p.PeerErrorType.SocketError,t)})),t.on(p.SocketEventType.Disconnected,(function(){e.disconnected||(e.emitError(p.PeerErrorType.Network,"Lost connection to server."),e.disconnect())})),t.on(p.SocketEventType.Close,(function(){e.disconnected||e._abort(p.PeerErrorType.SocketClosed,"Underlying socket is already closed.")})),t},t.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},t.prototype._handleMessage=function(e){var t,n,r=e.type,i=e.payload,a=e.src;switch(r){case p.ServerMessageType.Open:this._lastServerId=this.id,this._open=!0,this.emit(p.PeerEventType.Open,this.id);break;case p.ServerMessageType.Error:this._abort(p.PeerErrorType.ServerError,i.msg);break;case p.ServerMessageType.IdTaken:this._abort(p.PeerErrorType.UnavailableID,'ID "'+this.id+'" is taken');break;case p.ServerMessageType.InvalidKey:this._abort(p.PeerErrorType.InvalidKey,'API KEY "'+this._options.key+'" is invalid');break;case p.ServerMessageType.Leave:l.default.log("Received leave message from "+a),this._cleanupPeer(a),this._connections.delete(a);break;case p.ServerMessageType.Expire:this.emitError(p.PeerErrorType.PeerUnavailable,"Could not connect to peer "+a);break;case p.ServerMessageType.Offer:var s=i.connectionId;if((y=this.getConnection(a,s))&&(y.close(),l.default.warn("Offer received for existing Connection ID:"+s)),i.type===p.ConnectionType.Media)y=new d.MediaConnection(a,this,{connectionId:s,_payload:i,metadata:i.metadata}),this._addConnection(a,y),this.emit(p.PeerEventType.Call,y);else{if(i.type!==p.ConnectionType.Data)return void l.default.warn("Received malformed connection type:"+i.type);y=new f.DataConnection(a,this,{connectionId:s,_payload:i,metadata:i.metadata,label:i.label,serialization:i.serialization,reliable:i.reliable}),this._addConnection(a,y),this.emit(p.PeerEventType.Connection,y)}var c=this._getMessages(s);try{for(var u=o(c),h=u.next();!h.done;h=u.next()){var v=h.value;y.handleMessage(v)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}break;default:if(!i)return void l.default.warn("You received a malformed message from "+a+" of type "+r);var y;s=i.connectionId,(y=this.getConnection(a,s))&&y.peerConnection?y.handleMessage(e):s?this._storeMessage(s,e):l.default.warn("You received an unrecognized message:",e)}},t.prototype._storeMessage=function(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)},t.prototype._getMessages=function(e){var t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]},t.prototype.connect=function(e,t){if(void 0===t&&(t={}),this.disconnected)return l.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(p.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var n=new f.DataConnection(e,this,t);return this._addConnection(e,n),n},t.prototype.call=function(e,t,n){if(void 0===n&&(n={}),this.disconnected)return l.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(p.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(t){n._stream=t;var r=new d.MediaConnection(e,this,n);return this._addConnection(e,r),r}l.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},t.prototype._addConnection=function(e,t){l.default.log("add connection "+t.type+":"+t.connectionId+" to peerId:"+e),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)},t.prototype._removeConnection=function(e){var t=this._connections.get(e.peer);if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}this._lostMessages.delete(e.connectionId)},t.prototype.getConnection=function(e,t){var n,r,i=this._connections.get(e);if(!i)return null;try{for(var a=o(i),s=a.next();!s.done;s=a.next()){var c=s.value;if(c.connectionId===t)return c}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return null},t.prototype._delayedAbort=function(e,t){var n=this;setTimeout((function(){n._abort(e,t)}),0)},t.prototype._abort=function(e,t){l.default.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(e,t){var n;l.default.error("Error:",t),(n="string"==typeof t?new Error(t):t).type=e,this.emit(p.PeerEventType.Error,n)},t.prototype.destroy=function(){this.destroyed||(l.default.log("Destroy peer with ID:"+this.id),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(p.PeerEventType.Close))},t.prototype._cleanup=function(){var e,t;try{for(var n=o(this._connections.keys()),r=n.next();!r.done;r=n.next()){var i=r.value;this._cleanupPeer(i),this._connections.delete(i)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(e){var t,n,r=this._connections.get(e);if(r)try{for(var i=o(r),a=i.next();!a.done;a=i.next())a.value.close()}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;l.default.log("Disconnect peer with ID:"+e),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit(p.PeerEventType.Disconnected,e)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)l.default.log("Attempting reconnection to server with ID "+this._lastServerId),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");l.default.error("In a hurry? We're still trying to make the initial connection!")}},t.prototype.listAllPeers=function(e){var t=this;void 0===e&&(e=function(e){}),this._api.listAllPeers().then((function(t){return e(t)})).catch((function(e){return t._abort(p.PeerErrorType.ServerError,e)}))},t.DEFAULT_KEY="peerjs",t}(c.EventEmitter);n.Peer=y},{eventemitter3:"JJlS","./util":"BHXf","./logger":"WOs9","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./enums":"ZRYf","./api":"in7L"}],iTK6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.peerjs=void 0;var r=e("./util"),i=e("./peer");n.peerjs={Peer:i.Peer,util:r.util},n.default=i.Peer,window.peerjs=n.peerjs,window.Peer=i.Peer},{"./util":"BHXf","./peer":"Hxpd"}]},{},["iTK6"])},5666:function(e,t,n){!function(t){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",u=t.regeneratorRuntime;if(u)e.exports=u;else{(u=t.regeneratorRuntime=e.exports).wrap=_;var l="suspendedStart",h="suspendedYield",d="executing",f="completed",p={},v={};v[a]=function(){return this};var y=Object.getPrototypeOf,g=y&&y(y(R([])));g&&g!==r&&i.call(g,a)&&(v=g);var m=T.prototype=x.prototype=Object.create(v);w.prototype=m.constructor=T,T.constructor=w,T[c]=w.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,T):(e.__proto__=T,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(m),e},u.awrap=function(e){return{__await:e}},k(S.prototype),S.prototype[s]=function(){return this},u.AsyncIterator=S,u.async=function(e,t,n,r){var i=new S(_(e,t,n,r));return u.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},k(m),m[c]="Generator",m[a]=function(){return this},m.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},u.values=R,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),p}}}function _(e,t,n,r){var i=t&&t.prototype instanceof x?t:x,o=Object.create(i.prototype),a=new O(r||[]);return o._invoke=function(e,t,n){var r=l;return function(i,o){if(r===d)throw new Error("Generator is already running");if(r===f){if("throw"===i)throw o;return A()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var c=b(e,t,n);if("normal"===c.type){if(r=n.done?f:h,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=f,n.method="throw",n.arg=c.arg)}}}(e,n,a),o}function b(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function x(){}function w(){}function T(){}function k(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function S(e){function n(t,r,o,a){var s=b(e[t],e,r);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?Promise.resolve(u.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):Promise.resolve(u).then((function(e){c.value=e,o(c)}),a)}a(s.arg)}var r;"object"==typeof t.process&&t.process.domain&&(n=t.process.domain.bind(n)),this._invoke=function(e,t){function i(){return new Promise((function(r,i){n(e,t,r,i)}))}return r=r?r.then(i,i):i()}}function E(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,E(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=b(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,p;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function R(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:n,done:!0}}}("object"==typeof n.g?n.g:"object"==typeof window?window:"object"==typeof self?self:this)},3379:e=>{"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var o={},a=[],s=0;s<e.length;s++){var c=e[s],u=r.base?c[0]+r.base:c[0],l=o[u]||0,h="".concat(u," ").concat(l);o[u]=l+1;var d=n(h),f={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)t[d].references++,t[d].updater(f);else{var p=i(f,r);r.byIndex=s,t.splice(s,0,{identifier:h,updater:p,references:1})}a.push(h)}return a}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var o=r(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var s=n(o[a]);t[s].references--}for(var c=r(e,i),u=0;u<o.length;u++){var l=n(o[u]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}o=c}}},569:e=>{"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},9216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},3380:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{"use strict";if(__webpack_require__(1934),__webpack_require__(5666),__webpack_require__(7694),__webpack_require__.g._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");function e(e,t,n){e[t]||Object.defineProperty(e,t,{writable:!0,configurable:!0,value:n})}__webpack_require__.g._babelPolyfill=!0,e(String.prototype,"padLeft","".padStart),e(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach((function(t){[][t]&&e(Array,t,Function.call.bind([][t]))}))})(),(()=>{"use strict";var e=__webpack_require__(203),t=__webpack_require__(3379),n=__webpack_require__.n(t),r=__webpack_require__(3380),i=__webpack_require__.n(r),o=__webpack_require__(569),a=__webpack_require__.n(o),s=__webpack_require__(3565),c=__webpack_require__.n(s),u=__webpack_require__(9216),l=__webpack_require__.n(u),h=__webpack_require__(4589),d=__webpack_require__.n(h),f=__webpack_require__(1424),p={};p.styleTagTransform=d(),p.setAttributes=c(),p.insert=a().bind(null,"head"),p.domAPI=i(),p.insertStyleElement=l(),n()(f.Z,p),f.Z&&f.Z.locals&&f.Z.locals;var v="mainPlayer",y="other-player-";function g(e){return"".concat(y).concat(e)}function m(){return e.H6.world.getChildByName(v)[0]}function _(t){return e.H6.world.getChildByName(g(t))[0]}const b=window.location.pathname.includes("studio.html");function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){return k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},k(e,t)}function S(e,t){if(t&&("object"===x(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function E(e){return E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},E(e)}const C=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&k(e,t)}(s,t);var n,r,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=E(i);if(o){var n=E(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return S(this,e)});function s(){return w(this,s),a.apply(this,arguments)}return n=s,(r=[{key:"onResetEvent",value:function(){var t=b?"area02":"area01";e.fu.load(t,{setViewportBounds:!0});var n=m();e.H6.world.moveToTop(n)}}])&&T(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(e.Hf);var P=__webpack_require__(5391),O=__webpack_require__.n(P),R=__webpack_require__(3096),A=__webpack_require__.n(R),M=220,I=["avatar-01","avatar-02","avatar-03","avatar-04","avatar-05","avatar-06","avatar-07","avatar-08","avatar-09","avatar-10","avatar-11","avatar-12"];function D(t,n){var r=e.H6.viewport.worldToLocal(t,n);return function(t,n){var r=e.d_.pull("Vector2d"),i=e.Uh.devicePixelRatio;t/=i,n/=i;var o=e.Rk.scaleRatio,a=e.Rk.renderer,s=o;1===s.x&&1===s.y||(t*=s.x,n*=s.y);var c=e.Uh.getElementBounds(a.getScreenCanvas());return t+=c.left+(window.pageXOffset||0),n+=c.top+(window.pageYOffset||0),r.set(t,n)}(r.x,r.y)}var L=2e3,j={},B={};function N(e){return!!B[e]}function F(e){var t=m(),n=_(e);if(t&&n){var r=t.pos,i=n.pos;!function(e,t){var n=B[e],r=(L-Math.min(t,L))/L;n.volume=r}(e,r.distance(i))}}function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){U(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(){return W="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=X(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},W.apply(this,arguments)}function X(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=q(e)););return e}function $(e,t){return $=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},$(e,t)}function Y(e,t){if(t&&("object"===V(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function q(e){return q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},q(e)}const K=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=q(r);if(i){var n=q(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Y(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,e,t,G(G({},n),{},{width:M,height:M,framewidth:M,frameheight:M}))).anchorPoint.set(.5,.5),r.playerId=n.playerId,r.artistaName=n.artistaName,r.myNameText=document.createElement("div"),r.myNameTextInner=document.createElement("div"),r.myNameTextInner.innerHTML=r.artistaName,r.myNameText.appendChild(r.myNameTextInner),r.myNameText.classList.add("name-label"),r.updateLabelPosition(e,t),document.body.appendChild(r.myNameText),r.body.ignoreGravity=!0,r.alwaysUpdate=!0,r}return t=a,(n=[{key:"onActivateEvent",value:function(){}},{key:"onDeactivateEvent",value:function(){}},{key:"update",value:function(e){return this.updateLabelPosition(this.pos.x,this.pos.y),this.media&&this.updateMediaPosition(this.pos.x,this.pos.y),W(q(a.prototype),"update",this).call(this,e)}},{key:"updateLabelPosition",value:function(e,t){var n=D(e+110,t+M+10);this.myNameText.style.transform="translate(".concat(n.x,"px, ").concat(n.y,"px)")}},{key:"addMedia",value:function(e,t){var n,r;this.mediaIsVideo=e.getVideoTracks().length>0,this.mediaIsVideo?this.media=document.createElement("video"):this.media=document.createElement("audio"),this.media.srcObject=e,this.media.autoplay=!0,t?(console.log("receiving a media stream from",t),delete j[t],n=t,r=this.media,B[n]=r):this.media.volume=0,this.mediaContainer=document.createElement("div"),this.mediaContainer.classList.add("player-media"),this.mediaIsVideo||(this.media.style.display="hidden"),this.mediaContainer.appendChild(this.media),document.body.appendChild(this.mediaContainer),this.updateMediaPosition(this.pos.x,this.pos.y)}},{key:"updateMediaPosition",value:function(e,t){var n=D(e,t),r=D(e+M,t+M).x-n.x;this.mediaContainer.style.borderRadius="".concat(r/2,"px"),this.mediaContainer.style.width="".concat(r,"px"),this.mediaContainer.style.height="".concat(r,"px"),this.mediaContainer.style.transform="translate(".concat(n.x,"px, ").concat(n.y,"px)")}},{key:"select",value:function(){this.myNameText.innerHTML=this.myNameText.innerHTML+" (selected)",this.isSelected=!0}},{key:"deselect",value:function(){this.myNameText.innerHTML=this.myNameText.innerHTML.replace(" (selected)",""),this.isSelected=!1}},{key:"draw",value:function(e,t){this.mediaIsVideo||W(q(a.prototype),"draw",this).call(this,e,t)}},{key:"onDestroyEvent",value:function(){this.myNameText.remove(),this.mediaContainer&&this.mediaContainer.remove()}}])&&H(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(e.JH);var J,Z,Q=__webpack_require__(9616),ee=__webpack_require__.n(Q);function te(e){return function(e){if(Array.isArray(e))return ne(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ne(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ne(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function re(e){Z=e}function ie(e){J=e}function oe(){return J&&Z?new MediaStream([].concat(te(J.getVideoTracks()),te(Z.getAudioTracks()))):J||Z||void 0}function ae(e){return new Promise((function(t,n){(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia)(e,(function(e){t(e)}),(function(e){console.error("Failed to get local stream",e),n(e)}))}))}function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ue(e,t){return ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ue(e,t)}function le(e,t){if(t&&("object"===se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function he(e){return he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},he(e)}__webpack_require__(2597);const de=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ue(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=he(r);if(i){var n=he(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return le(this,e)});function a(e,t,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this,e,t,n)}return t=a,(n=[{key:"onCollision",value:function(e,t){return!1}}])&&ce(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(K);var fe={};function pe(t){var n=_(t);n&&e.H6.world.removeChild(n),delete fe[t],function(e){delete B[e]}(t)}const ve=function(t,n){var r=fe[t];if(r)r.pos.x===n[be].x&&r.pos.y===n[be].y||(r.pos.x=n[be].x,r.pos.y=n[be].y,N(t)&&F(t));else if(n[_e]===b&&Date.now()-n[we]<2e4){r=new de(n[be].x,n[be].y,{name:g(t),playerId:t,artistaName:n[Te],image:n[ke],width:M,height:M,framewidth:M,frameheight:M}),fe[t]=r,e.H6.world.addChild(r,3);var i=m();if(i&&(e.H6.world.moveToTop(i),Number(i.playerId)>Number(t)&&!function(e){return j[e]}(t)&&!N(t))){console.log("there is no open call. we should call peer ".concat(t,", trying..."));var o=oe(),a=i.peer.call(t,o);!function(e){j[e]=!0}(t),a?a.on("stream",(function(e){console.log("remoteStream",e),console.log("received an answer from ",t),N(t)||_(t).addMedia(e,t)})):console.log("why is there no call?")}}};var ye,ge=ee()("https://hypha-gun-relay.herokuapp.com/gun"),me="ME_KEY",_e="instudio",be="location",xe="destination",we="lastseen",Te="artistaName",ke="artistaImage",Se=ge.get("artistas"),Ee=!1,Ce=localStorage.getItem(me);function Pe(e){Ce=e,localStorage.setItem(me,Ce),ye=Se.get(Ce)}function Oe(e){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oe(e)}function Re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(){return Ae="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=Me(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Ae.apply(this,arguments)}function Me(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=je(e)););return e}function Ie(e,t){return Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ie(e,t)}function De(e,t){if(t&&("object"===Oe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Le(e)}function Le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function je(e){return je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},je(e)}function Be(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Ce?(console.log("second time here, this is my id: ",Ce),Pe(Ce)):(Ee=!0,console.log("first time here"));var Ne=A()((function(e,t){var n;ye.put((Be(n={},be,{x:e,y:t}),Be(n,we,Date.now()),n)),Object.keys(B).forEach(F)}),50);const Fe=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ie(e,t)}(s,t);var n,r,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=je(i);if(o){var n=je(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return De(this,e)});function s(t,n,r){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(i=a.call(this,t,n,r)).playerId=r.playerId,i.peer=new(O())(i.playerId,{host:"peerjs.staging.hypha.coop",port:443,path:"/myapp",secure:!0,debug:3,config:{iceServers:[{urls:"turn:roobot.hypha.coop:8443?transport=tcp",username:"hypha",credentials:"hyphacoop"},{urls:"stun:http://roobot.hypha.coop:3478"},{urls:"stun:stun.l.google.com:19302"}],sdpSemantics:"unified-plan"}}),Le(i).peer.on("call",(function(e){var t=oe();console.log("receiving a call from",e.peer),N(e.peer)?console.log("there was already an open call with",e.peer):(console.log("there was no open call with ",e.peer),console.log("now accepting..."),e.answer(t),e.on("stream",(function(t){var n=e.peer;!function e(){if(!N(n)){var r=_(n);r?r.addMedia(t,n):setTimeout(e,1e3)}}()})))}));var o=oe();return i.addMedia(o),i.isLeaving=!1,i.body.setMaxVelocity(10,10),i.body.setFriction(.8,.8),e.H6.viewport.follow(i.pos,e.H6.viewport.AXIS.BOTH,.4),i.destination=null,i}return n=s,(r=[{key:"onActivateEvent",value:function(){Ae(je(s.prototype),"onActivateEvent",this).call(this),e.qH.registerPointerEvent("pointerdown",e.H6.viewport,this.pointerDown.bind(this))}},{key:"onDeactivateEvent",value:function(){Ae(je(s.prototype),"onDeactivateEvent",this).call(this),e.qH.releaseAllPointerEvents(this)}},{key:"pointerDown",value:function(t){var n,r,i,o=(n=t.clientX,r=t.clientY,i=e.qH.globalToLocal(n,r),e.H6.viewport.localToWorld(i.x,i.y)),a={x:o.x-this.width/2,y:o.y-this.height/2},s=e.H6.world.getChildren().find((function(e){return e.isSelected}));s?(console.log("setting new destination for player ",s.playerId),Se.get(s.playerId).put(Be({},xe,a))):this.destination=a}},{key:"update",value:function(t){return e.qH.isKeyPressed("left")||e.qH.isKeyPressed("right")||e.qH.isKeyPressed("up")||e.qH.isKeyPressed("down")?(this.resetDestination(),e.qH.isKeyPressed("left")?this.body.force.x=-this.body.maxVel.x:e.qH.isKeyPressed("right")&&(this.body.force.x=this.body.maxVel.x),e.qH.isKeyPressed("up")?this.body.force.y=-this.body.maxVel.y:e.qH.isKeyPressed("down")&&(this.body.force.y=this.body.maxVel.y)):this.destination&&(this.destination.x||this.destination.y)?(this.destination.y&&(this.destination.y-this.pos.y>10?this.body.force.y=this.body.maxVel.y:this.destination.y-this.pos.y<-10?this.body.force.y=-this.body.maxVel.y:(this.body.force.y=0,this.pos.y=this.destination.y,this.destination.y=void 0)),this.destination.x&&(this.destination.x-this.pos.x>10?this.body.force.x=this.body.maxVel.x:this.destination.x-this.pos.x<-10?this.body.force.x=-this.body.maxVel.x:(this.body.force.x=0,this.pos.x=this.destination.x,this.destination.x=void 0))):(this.resetDestination(),this.body.force.x=0,this.body.force.y=0),Ne(this.pos.x,this.pos.y),this.updateLabelPosition(this.pos.x,this.pos.y),Ae(je(s.prototype),"update",this).call(this,t)||0!==this.body.vel.x||0!==this.body.vel.y}},{key:"resetDestination",value:function(){this.destination=null,ye.put(Be({},xe,null))}},{key:"onCollision",value:function(e,t){return!t.name||("doorway"===t.name?(this.isLeaving||(this.isLeaving=!0,window.location.href=b?window.location.href.replace("/studio.html","?from-studio=true"):window.location.href.replace("?from-studio=true","")+"studio.html"),!1):"background"!==t.name&&!t.name.includes(y))}}])&&Re(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),s}(K),Ve=[{name:"building",type:"image",src:"data/img/map/building.png"},{name:"room",type:"image",src:"data/img/map/room.png"},{name:"avatar-01",type:"image",src:"data/img/sprite/avatar-01.png"},{name:"avatar-02",type:"image",src:"data/img/sprite/avatar-02.png"},{name:"avatar-03",type:"image",src:"data/img/sprite/avatar-03.png"},{name:"avatar-04",type:"image",src:"data/img/sprite/avatar-04.png"},{name:"avatar-05",type:"image",src:"data/img/sprite/avatar-05.png"},{name:"avatar-06",type:"image",src:"data/img/sprite/avatar-06.png"},{name:"avatar-07",type:"image",src:"data/img/sprite/avatar-07.png"},{name:"avatar-08",type:"image",src:"data/img/sprite/avatar-08.png"},{name:"avatar-09",type:"image",src:"data/img/sprite/avatar-09.png"},{name:"avatar-10",type:"image",src:"data/img/sprite/avatar-10.png"},{name:"avatar-11",type:"image",src:"data/img/sprite/avatar-11.png"},{name:"avatar-12",type:"image",src:"data/img/sprite/avatar-12.png"},{name:"area01",type:"tmx",src:"data/map/area01.tmx"},{name:"area02",type:"tmx",src:"data/map/area02.tmx"}];function ze(e){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ze(e)}function Ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ue(e,t){return Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ue(e,t)}function He(e,t){if(t&&("object"===ze(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function We(e){return We=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},We(e)}const Xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ue(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=We(r);if(i){var n=We(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return He(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,e,t,n)).body.ignoreGravity=!0,r}return t=a,(n=[{key:"onCollision",value:function(e,t){return!1}}])&&Ge(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(e.JH);function $e(e){return $e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$e(e)}function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qe(e,t){return qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},qe(e,t)}function Ke(e,t){if(t&&("object"===$e(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Je(e){return Je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Je(e)}const Ze=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qe(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Je(r);if(i){var n=Je(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ke(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,e,t,n)).body.ignoreGravity=!0,r}return t=a,(n=[{key:"onCollision",value:function(e,t){return!1}}])&&Ye(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(e.JH);function Qe(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function et(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Qe(o,r,i,a,s,"next",e)}function s(e){Qe(o,r,i,a,s,"throw",e)}a(void 0)}))}}function tt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var nt,rt,it=console.log;console.log=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];"string"!=typeof t[0]?it.apply(void 0,t):t[0].includes("warning!")||t[0].includes("Warning!")||it.apply(void 0,t)};var ot=new URLSearchParams(window.location.search);b?(nt=1930,rt=3170):ot.get("from-studio")?(nt=2843,rt=3753):(nt=3852,rt=7723);var at=b?3e3:2e3,st=b?3e3:2e3,ct=document.getElementById("overlay"),ut=function(){ct.style.display="flex";var e=document.getElementById("name-input"),t=document.getElementById("enter-space-button"),n=function(){e.value?t.removeAttribute("disabled"):t.setAttribute("disabled",!0)};e.addEventListener("paste",n),e.addEventListener("keyup",n),t.addEventListener("click",(function(){var t,n=Math.random().toString().split(".")[1];Pe(n),lt(e.value,(t=Math.floor(Math.random()*I.length),I[t]),n)}))},lt=function(t,n,r){var i;ct&&ct.remove(),ht();var o,a=new Fe(nt,rt,{name:v,playerId:r,artistaName:t,image:n});e.H6.world.addChild(a,4),ye.put((tt(i={},_e,b),tt(i,ke,n),tt(i,Te,t),tt(i,xe,null),tt(i,be,{x:nt,y:rt}),i)),o=ve,Se.map((function(e,t){return t===Ce?void 0:e})).on((function(e,t){e&&e[be]?Se.get(t).load((function(e){e&&e[_e]===b&&e[be]&&"number"==typeof e[be].y&&"number"==typeof e[be].x?o(t,e):pe(t)})):pe(t)}))},ht=function(){e.qH.bindKey(e.qH.KEY.LEFT,"left"),e.qH.bindKey(e.qH.KEY.RIGHT,"right"),e.qH.bindKey(e.qH.KEY.UP,"up"),e.qH.bindKey(e.qH.KEY.DOWN,"down")};et(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.Uh.onReady((function(){e.Rk.init(at,st,{parent:"screen",renderer:e.Rk.WEBGL,scale:"auto",scaleMethod:"flex-width"})?(e._m.crossOrigin="anonymous",e._m.preload(Ve,et(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.SB.set(e.SB.PLAY,new C),e.d_.register("background",Xe),e.d_.register("doorway",Ze),e.SB.change(e.SB.PLAY),setTimeout((function(){b||e.H6.viewport.setBounds(0,0,7798,8192);var t=new e.EY(nt,rt);e.H6.viewport.follow(t),e.H6.viewport.unfollow(),e.H6.repaint()}),50),window.game=e.H6,t.prev=8,t.next=11,ae({video:!1,audio:!0});case 11:re(n=t.sent),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(8),console.log(t.t0);case 18:return t.prev=18,t.next=21,ae({video:!0,audio:!1});case 21:ie(r=t.sent),t.next=28;break;case 25:t.prev=25,t.t1=t.catch(18),console.log(t.t1);case 28:n||r||alert("Unable to enter the space, because there is no access to audio or video"),Ee?b||ut():ye.load((function(e){lt(e[Te],e[ke],Ce)}));case 30:case"end":return t.stop()}}),t,null,[[8,15],[18,25]])}))))):alert("Your browser does not support HTML5 canvas.")}));case 1:case"end":return t.stop()}}),t)})))()})()})();